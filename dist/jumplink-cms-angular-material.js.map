{"version":3,"sources":["general/general.js","admin/admin.js","async/async.js","attachment/attachment.js","blog/blog.js","browser/browser.js","config/config.js","content/ContentService.js","crossbrowser/crossbrowser.js","download/download.js","event/event.js","fallback/fallback.js","focus/focus.js","gallery/gallery.js","history/history.js","importexport/importexport.js","info/info.js","multisite/multisite.js","routes/routes.js","sails/sails.js","session/session.js","sidebar/sidebar.js","signin/signin.js","sortable/sortable.js","subnavigation/subnavigation.js","theme/theme.js","toolbar/toolbar.js","user/user.js","utilities/utilities.js","validation/validation.js","content/bootstrap/ContentBootstrapService.js","content/medium/ContentMediumService.js","content/medium/jlContentBlocksDirective.js","content/medium/jlContentDirective.js"],"names":["angular","module","directive","$compile","$window","$sailsSocket","$state","restrict","templateUrl","scope","upload","download","toogleHtml","refresh","save","add","addDropdown","addDropdownActions","adminSettingDropdown","authenticated","allowActions","link","$scope","$element","$attrs","goToState","go","isUndefined","text","click","service","async","objectMap","obj","func","cb","i","arr","keys","Object","length","wrapper","this","map","err","data","res","moment","$async","$log","open","url","target","destroyLocally","blogPosts","postIndex","attachmentIndex","attachments","splice","destroyExternally","put","blogPostID","id","attachmentUploadedAs","uploadedAs","success","status","headers","config","debug","error","destroy","post","indexOf","$filter","AttachmentService","types","deleteAttachment","validate","blogPost","page","callback","title","fix","isFunction","chooseType","type","removeFromClient","index","users","sort","reverse","transform","append","moreBlogPosts","push","apply","prepent","unshift","create","createdAt","content","author","object","name","toLowerCase","replace","fixEach","objects","saveOne","errors","isDefined","isArray","saveBlocks","blogPostsArray","find","limit","skip","then","resp","count","subscribe","msg","verb","$rootScope","pop","findEvent","blogPostBlock","BlogService","resolve","remove","destroyAttachment","force","get","$modal","$download","JLSailsService","SortableService","UtilityService","focus","showHtml","editModal","getShowHtml","setEditModal","show","ok","accept","hide","abort","changeName","$watch","newValue","oldValue","generateName","$on","event","validateContent","getEditModal","toogleShowHtml","contents","beautifyEach","beautify","html_beautify","getByName","findKeyValue","createEdit","edit","swap","index_1","index_2","moveForward","moveBackward","$promise","isNumber","position","warn","saveParallel","logger","options","parallel","results","applyResults","extend","findOne","next","query","Array","findAll","findByHost","method","resultIsArray","exportByHost","host","JSON","stringify","updateOrCreateByHostByTitleAndPage","findAllWithImage","images","resolveOne","resolveAll","resolveAllWithImage","Date","now","getTime","vendors","window","requestAnimationFrame","vp","cancelAnimationFrame","test","navigator","userAgent","lastTime","nextTime","Math","max","setTimeout","clearTimeout","FileUploader","typeModal","openTypeChooserModal","setModals","fileOptions","pageString","isString","uploadOptions","removeAfterUpload","uploader","onCompleteItem","fileItem","response","files","onProgressItem","progress","console","info","getModals","getTypeModal","eventBlockName","split","events","unknown","before","after","to","from","isAfter","invertOrder","merge","concat","allEvents","minutes","person","place","eventBlocks","saveAllInBlock","eventBlocksArray","eventBlock","EventService","$location","path","protocol","charAt","factory","$timeout","element","document","getElementById","elem","attr","on","eventFocus","eventFocusId","off","Fullscreen","ContentService","uploadModal","fullscreenImage","dropdown","getDropdown","prepairUploadModal","imageBlocks","contentBlocks","selects","getSelects","selectedContentBlock","value","setUploadModal","onCompleteCallback","thumbnail","width","rescrop","cropwidth","cropheight","filters","fn","item","slice","lastIndexOf","onComplete","forEach","file","selected","currentImages","last_position","original","image","getUploadModal","blockNames","result","blockName","array","label","contentname","saveAllBlocks","saveAll","filename","addBlock","aspect","height","scale","aspectRatio","win","paddingTopBottom","paddingLeftRight","isFullScreen","getWindowDimensions","padding-right","padding-left","padding-top","padding-bottom","jumplink","$anchorScroll","history","state","params","all","step","prev","previous","abs","back","goToHashPosition","hash","yOffset","autoScroll","run","HistoryService","toParams","fromParams","log","current","warns","infoUser","infoAdmin","restart","resolveNames","resolveHosts","provider","jlRoutesProvider","$stateProvider","$urlRouterProvider","$locationProvider","html5Mode","otherwise","when","url1","url2","setLayouts","layouts","stateName","setRoutes","routes","routeOptions","main","customstate","eval","views","view","objectName","isObject","alternativeUrls","a","$get","jlRoutes","filter","active","match","fallback","route","updateOrCreate","updateOrCreateByHostByObjectNameAndNavbar","updateOrCreateByHost","updateOrCreateEach","updateOrCreateEachByHost","generateObjectnameFromStatename","statename","objectname","k","capitalizeFirstLetter","lowercaseFirstLetter","generateObjectnameFromUrl","saveEachByHost","$q","deferred","defer","reject","promise","user","isAuthenticated","needToBeAuthenticated","bloggerOrBetter","developerOrBetter","siteadminOrBetter","superadmin","employee","employeeOrBetter","needToBeEmployeeOrBetter","needToBeSiteadminOrBetter","getAllPolicies","getUser","transclude","SessionService","signin","goBackAfterSignin","extendRoles","resetPosition","object_1","object_2","position_tmp","move","old_index","new_index","undefined","unique","uniqueKey","new_object","new_position","uniqueIndex","okay","moveObjectToAnotherArray","index_from","array_from","array_to","replaceData","errorParamsNotSet","index_to","dropMove","dropObjectIndex","dragObject","moveFunction","dragObjectIndex","dropObject","resizeOnImagesLoaded","imagesLoaded","triggerHandler","navs","Number","nav","removeByTarget","fixed","SubnavigationService","afterSave","afterRemove","afterEdit","afterAdd","controller","goTo","addNav","moveForwardNav","moveBackwardNav","editNavs","removeNav","onDragOnComplete","evt","onDragOnNavComplete","onDropOnComplete","dropnavindex","dragnav","onDropOnNavComplete","onDropOnAreaComplete","isSubscribed","themes","shorttitle","fluid","subnavigation","fullscreenIsSupported","isSupported","isFullscreen","isFullscreenEnabled","toggleFullscreen","isEnabled","cancel","role","password","key","getKeys","string","toUpperCase","$validationProvider","getLocale","defaultMsg","minlength","getDefaultMsg","maxlength","required","email","number","changeLocale","lang","setDefaultMsg","jlValidation","ImportExportBootstrapService","modals","setHost","newHost","setupImportModal","onImportFinsih","onCompleteFile","setImports","identifierKey","descriptionKey","onImportStart","imports","importOptions","doImport","onAbort","showImportModal","buttonLabels","toolbar","buttons","Imager","button","createElement","className","innerText","innerHTML","onclick","onClick","bind","prototype","classApplier","toggleSelection","getButton","checkState","node","tagName","classList","mediumOptions","ContentMediumService","html","afterRefresh","afterSaveNav","afterRemoveNav","afterEditNav","afterAddNav","mediumBindOptions","toggleHtml","extensions"],"mappings":"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","file":"jumplink-cms-angular-material.js","sourcesContent":["if (typeof jumplink === 'undefined') {\n  var jumplink = {};\n}","angular.module('jumplink.cms.admin', [\n    'sails.io',\n  ])\n\n  .directive('adminbar', function ($compile, $window, $sailsSocket, $state) {\n\n    return {\n      restrict: 'E',\n      templateUrl: '/views/modern/adminbar.bootstrap.jade',\n      scope: {\n        upload : \"=?\",\n        download : \"=?\",\n        toogleHtml: \"=?\",\n        refresh: \"=?\",\n        save: \"=?\",\n        add: \"=?\",\n        addDropdown: \"=?\",\n        addDropdownActions: \"=?\",\n        adminSettingDropdown: \"=?\",\n        authenticated: \"=?\",\n        allowActions: \"=?\",\n      },\n      link: function ($scope, $element, $attrs) {\n\n        $scope.goToState = $state.go;\n\n        if(angular.isUndefined($scope.adminSettingDropdown)) {\n          $scope.adminSettingDropdown = [\n            {\n              \"text\": \"<i class=\\\"fa fa-list\\\"></i>&nbsp;Übersicht\",\n              \"click\": \"goToState('layout.administration')\"\n            },\n            {\n              \"text\": \"<i class=\\\"fa fa-users\\\"></i>&nbsp;Benutzer\",\n              \"click\": \"goToState('layout.users')\"\n            },\n            {\n              \"text\": \"<i class=\\\"fa fa-sign-out\\\"></i>&nbsp;Abmelden\",\n              \"click\": \"$root.logout()\"\n            }\n          ];\n        }\n      }\n    };\n  })\n\n;","angular.module('ngAsync', [])\n.service('$async', function () {\n  // https://github.com/caolan/async/issues/374#issuecomment-27498818\n  async.objectMap = function ( obj, func, cb ) {\n    var i, arr = [], keys = Object.keys( obj );\n    for ( i = 0; i < keys.length; i += 1 ) {\n      var wrapper = {};\n      wrapper[keys[i]] = obj[keys[i]];\n      arr[i] = wrapper;\n    }\n    this.map( arr, func, function( err, data ) {\n      if ( err ) { return cb( err ); }\n      var res = {};\n      for ( i = 0; i < data.length; i += 1 ) {\n          res[keys[i]] = data[i];\n      }\n      return cb( err, res );\n    });\n  };\n  return async;\n});","angular.module('jumplink.cms.attachment', [\n  'sails.io',\n])\n\n.service('AttachmentService', function (moment, $sailsSocket, $async, $log, $window) {\n\n  var open = function (url, target) {\n    $window.open(url, target);\n  };\n\n  /**\n   * delete attachment on local / client / browser\n   */\n  var destroyLocally = function (blogPosts, postIndex, attachmentIndex, cb) {\n    if(blogPosts[postIndex].attachments.length > 0) {\n      blogPosts[postIndex].attachments.splice(attachmentIndex, 1);\n    }\n    return cb(null, blogPosts, postIndex, attachmentIndex);\n  };\n\n  /**\n   * delete attachment extern / server\n   */\n  var destroyExternally = function (blogPosts, postIndex, attachmentIndex, cb) {\n    $sailsSocket.put('/blog/destroyAttachment', {blogPostID: blogPosts[postIndex].id, attachmentUploadedAs: blogPosts[postIndex].attachments[attachmentIndex].uploadedAs})\n    .success(function (data, status, headers, config) {\n      $log.debug(null, data, status, headers, config);\n      cb();\n    })\n    .error(function (data, status, headers, config) {\n      $log.error(data, status, headers, config);\n      cb(\"error\", data, status, headers, config);\n    });\n  };\n\n  var destroy = function (blogPosts, post, attachmentIndex, cb) {\n    var postIndex = blogPosts.indexOf(post);\n    $log.debug(\"[BlogService.destroy]\", blogPosts[postIndex], attachmentIndex);\n    return destroyExternally(blogPosts, postIndex, attachmentIndex, function (err, data, status, headers, config) {\n      if(err) {\n        return cb(err, data, status, headers, config);\n      }\n      return destroyLocally(blogPosts, postIndex, attachmentIndex, cb);\n    });\n  };\n\n  return {\n    open: open,\n    destroyLocally: destroyLocally,\n    destroyExternally: destroyExternally,\n    destroy: destroy,\n  };\n});","angular.module('jumplink.cms.blog', [\n  'jumplink.cms.attachment',\n  'angularMoment',\n  'ngAsync',\n  'sails.io',\n])\n\n.service('BlogService', function (moment, $sailsSocket, $async, $log, $filter, AttachmentService) {\n\n  var types = ['news', 'other'];\n\n  /**\n   * delete attachment on local / client / browser\n   */\n  var deleteAttachmentLocally = AttachmentService.destroyLocally;\n\n  /**\n   * delete attachment extern / server\n   */\n  var deleteAttachmentExternally = AttachmentService.destroyExternally;\n\n  var deleteAttachment = AttachmentService.destroy;\n\n  var validate = function (blogPost, page, callback) {\n    if(blogPost.title) {\n      return fix(blogPost, page, callback);\n    }\n    if(angular.isFunction(callback)) {\n      return callback(\"Title not set\", blogPost);\n    }\n    return null;\n  };\n\n  var chooseType = function(blogPost, type) {\n    blogPost.type = type;\n  };\n\n  var removeFromClient = function (blogPosts, blogPost, callback) {\n    // $log.debug(\"removeFromClient\", blogPost);\n    var index = blogPosts.indexOf(blogPost);\n    if (index > -1) {\n      blogPosts.splice(index, 1);\n      if(angular.isFunction(callback)) {\n        callback(null, blogPosts);\n      }\n    } else {\n      if(angular.isFunction(callback)) {\n        callback(\"no blogPost on client site found to remove\", blogPosts);\n      }\n    }\n  };\n\n  var destroy = function(blogPosts, blogPost, callback) {\n    // $log.debug(\"remove blogPost\", blogPost);\n    if(blogPost.id) {\n      $log.debug(\"[jumplink.cms.blog.BlogService.destroy]\", blogPost);\n      $sailsSocket.delete('/blog/'+blogPost.id).success(function(users, status, headers, config) {\n        removeFromClient(blogPosts, blogPost, callback);\n      });\n    } else {\n      removeFromClient(blogPosts, blogPost, callback);\n    }\n  };\n\n  var sort = function(blogPosts) {\n    var reverse = true;\n    return $filter('orderBy')(blogPosts, 'createdAt', reverse);\n  };\n\n  var transform = function(blogPosts) {\n    blogPosts = sort(blogPosts);\n    return blogPosts;\n  };\n\n  var append = function(blogPosts, moreBlogPosts, callback) {\n    blogPosts.push.apply(blogPosts, moreBlogPosts);\n    blogPosts = transform(blogPosts);\n    if(angular.isFunction(callback)) {\n      return callback(null, blogPosts);\n    }\n    return blogPosts;\n  };\n\n  var prepent = function(blogPosts, blogPost, callback) {\n    blogPosts.unshift(blogPost);\n    blogPosts = transform(blogPosts);\n    if(angular.isFunction(callback)) {\n      return callback(null, blogPosts);\n    }\n    return blogPosts;\n  };\n\n  var create = function(data) {\n    if(!data || !data.createdAt) {\n      data.createdAt = moment();\n    }\n    // if(!data || !data.updatedAt) data.createdAt = moment();\n    if(!data || !data.title) {\n      data.title = \"\";\n    }\n    if(!data || !data.content) {\n      data.content = \"\";\n    }\n    if(!data || !data.author) {\n      data.author = \"\";\n    }\n    if(!data || !data.page) {\n      callback(\"Page not set.\");\n    }\n    if(!data || !data.type) {\n      data.type = types[0]; // news\n    }\n    $log.debug(\"[BlogService,create]\", data);\n    return data;\n  };\n\n  var createEdit = function(blogPosts, blogPost, callback) {\n    blogPost = create(blogPost); \n    edit(blogPost, callback);\n  };\n\n  var fix = function(object, page, callback) {\n    if(angular.isUndefined(object.page) && page !== null) {\n      object.page = page;\n    }\n    if(!object.name || object.name === \"\") {\n      // Set object.name to object.title but only the letters in lower case\n      object.name = object.title.toLowerCase().replace(/[^a-z]+/g, '');\n      // $log.debug(\"set object.name to\", object.name);\n    }\n    if(angular.isFunction(callback)) {\n      return callback(null, object);\n    }\n    return object;\n  };\n\n  var fixEach = function(objects, page, callback) {\n    for (var i = objects.length - 1; i >= 0; i--) {\n      objects[i] = fix(objects[i], page);\n    }\n    if(angular.isFunction(callback)) {\n      return callback(null, objects);\n    }\n    return objects;\n  };\n\n  var refresh = function(blogPosts, callback) {\n    $log.debug(\"[jumplink.cms.blog.BlogService.refresh]\");\n    blogPosts = transform(blogPosts);\n    if(angular.isFunction(callback)) {\n      return callback(null, blogPosts);\n    }\n    return blogPosts;\n  };\n\n  var saveOne = function (blogPosts, blogPost, index, page, callback) {\n    var errors = [\n      \"BlogService: Can't save blogPost.\",\n      \"BlogService: Can't save blogPost, blogPost to update not found.\",\n      \"BlogService: Can't save blogPost, parameters undefind.\",\n    ];\n    $log.debug(\"[BlogService.saveOne]\", blogPost);\n    if(angular.isDefined(blogPost) && angular.isDefined(callback)) {\n      blogPost = fix(blogPost, page);\n      if(angular.isUndefined(blogPost.id)) {\n        // create because id is undefined\n        $sailsSocket.post('/blog', blogPost).success(function(data, status, headers, config) {\n          if(angular.isArray(data)) {\n            data = data[0];\n          }\n          callback(null, data);\n        }).error(function (data, status, headers, config) {\n          if(angular.isArray(data)) {\n            data = data[0];\n          }\n          $log.error(data, status, headers, config);\n          return callback(errors[0]);\n        });\n      } else {\n        // update because id is defined\n        $sailsSocket.put('/blog/'+blogPost.id, blogPost).success(function(data, status, headers, config) {\n          if(angular.isArray(data)) {\n            data = data[0];\n          }\n          return callback(null, data);\n        }).error(function (data, status, headers, config) {\n          $log.error(data, status, headers, config);\n          return callback(errors[0]);\n        });\n      }\n    } else {\n      return callback(errors[2]);\n    }\n  };\n\n  var saveBlocks = function(blogPosts, page, callback) {\n    var errors = [\n      \"[BlogService.saveBlocks] Can't save blogPosts, parameters undefind.\"\n    ];\n    // save just this blogPost if defined\n    if(angular.isDefined(blogPosts) && angular.isDefined(callback)) {\n      $async.map(blogPosts, function (blogPost, callback) {\n        saveOne(blogPosts, blogPost, null, page, callback);\n      }, function(err, blogPostsArray) {\n        if(err) {\n          return callback(err);\n        }\n        blogPosts = transform(blogPosts);\n        return callback(null, blogPosts);\n      });\n    } else {\n      $log.error(errors[0]);\n      if(angular.isFunction(callback)) {\n        return callback(errors[0]);\n      }\n    }\n  };\n\n  var save = function(blogPosts, blogPost, index, page, callback) {\n    // save just this blogPost if defined\n    if(angular.isDefined(blogPost)) {\n      saveOne(blogPosts, blogPost, index, page, callback);\n    } else { // save all blogPostBlocks\n      saveBlocks(blogPosts, page, callback);\n    }\n  };\n\n  var find = function(page, limit, skip, callback) {\n    return $sailsSocket.put('/blog/find', {page:page, limit:limit, skip:skip}).then (function (data) {\n      data.data = transform(data.data);\n      if(angular.isFunction(callback)) {\n        return callback(null, data.data);\n      }\n      return data.data;\n    }, function error (resp){\n      $log.error(\"Error on find \"+page, resp);\n      if(angular.isFunction(callback)) {\n        return callback(resp);\n      }\n      return null;\n    });\n  };\n\n  var count = function(page, limit, skip, callback) {\n    return $sailsSocket.put('/blog/count', {page:page}).then (function (data) {\n      // $log.debug(data);\n      if(angular.isFunction(callback)) {\n        return callback(null, data.data.count);\n      }\n      return data.data.count;\n    }, function error (resp){\n      $log.error(\"Error on resolve \"+page, resp);\n      if(angular.isFunction(callback)) {\n        return callback(resp);\n      }\n      return null;\n    });\n  };\n\n  var subscribe = function () {\n    $sailsSocket.subscribe('blog', function(msg){\n      $log.debug(msg);\n      switch(msg.verb) {\n        case 'updated':\n          if($rootScope.authenticated) {\n            $rootScope.pop('success', 'Ein Blogpost wurde aktualisiert', msg.data.title);\n          }\n          findEvent(msg.id, function(error, blogPost, blogPostBlock, index) {\n            if(error) {\n              $log.debug(error);\n            }\n            else {\n              blogPost = msg.data;\n            }\n            $scope.refresh();\n          });\n        break;\n        case 'created':\n          if($rootScope.authenticated) {\n            $rootScope.pop('success', 'Ein Blogpost wurde erstellt', msg.data.title);\n          }\n          $scope.blogPosts.push(msg.data);\n          $scope.refresh();\n        break;\n        case 'removedFrom':\n          if($rootScope.authenticated) {\n            $rootScope.pop('success', 'Ein Blogpost wurde entfernt', msg.data.title);\n          }\n          findEvent(msg.id, function(error, blogPost, blogPostBlock, index) {\n            if(error) {\n              $log.debug(error);\n            }\n            else {\n              BlogService.removeFromClient($scope.blogPosts, blogPost, blogPostBlock);\n            }\n          });\n        break;\n        case 'destroyed':\n          if($rootScope.authenticated) {\n            $rootScope.pop('success', 'Ein Blogpost wurde gelöscht', msg.data.title);\n          }\n          findEvent(msg.id, function(error, blogPost, blogPostBlock, index) {\n            if(error) {\n              $log.debug(error);\n              return error;\n            }\n            else {\n              BlogService.removeFromClient($scope.blogPosts, blogPost, blogPostBlock);\n            }\n          });\n        break;\n        case 'addedTo':\n          if($rootScope.authenticated) {\n            $rootScope.pop('success', 'Ein Blogpost wurde hinzugefügt', msg.data.title);\n          }\n        break;\n      }\n    });\n  };\n\n  return {\n    validate: validate,\n    subscribe: subscribe,\n    append: append,\n    prepent: prepent,\n    sort: sort,\n    transform: transform,\n    saveOne: saveOne,\n    saveBlocks: saveBlocks,\n    save: save,\n    fixEach: fixEach,\n    find: find,\n    resolve: find, // alias\n    count: count,\n    refresh: refresh,\n    chooseType: chooseType,\n    removeFromClient: removeFromClient,\n    remove: destroy, // alias\n    destroy: destroy,\n    deleteAttachment: deleteAttachment,\n    destroyAttachment: deleteAttachment, // alias\n    create: create\n  };\n});","angular.module('jumplink.cms.browser', [])\n.directive('jlBrowser', function ($compile, $window) {\n\n  return {\n    restrict: 'E',\n    templateUrl: '/views/modern/browser.bootstrap.jade',\n    scope: {\n      force: \"=\"\n    },\n    link: function ($scope, $element, $attrs) {\n      \n    }\n  };\n});","angular.module('jumplink.cms.config', [\n  'sails.io',\n])\n.service('ConfigService', function ($sailsSocket, $filter, $log) {\n  var resolve = function(page) {\n    return $sailsSocket.get('/config/find').then (function (data) {\n      return data.data;\n    }, function error (resp){\n      $log.error(\"Error on resolve \"+page, resp);\n    });\n  };\n  return {\n    resolve: resolve\n  };\n});","angular.module('jumplink.cms.content', [\n  'mgcrea.ngStrap',\n  'angular-medium-editor',\n  'ui.ace',\n  'sails.io',\n  'jumplink.cms.sortable',\n  'ngFocus',\n  'jumplink.cms.utilities',\n])\n.service('ContentService', function ($rootScope, $log, $sailsSocket, $filter, $modal, $download, JLSailsService, SortableService, UtilityService, focus, $async) {\n\n  var showHtml = false;\n  var editModal = null;\n\n  var getShowHtml = function() {\n    return showHtml;\n  };\n\n  var setEditModal = function($scope) {\n    editModal = $modal({title: 'Inhaltsblock bearbeiten', templateUrl: '/views/modern/contentmodal.jade', show: false});\n    editModal.$scope.ok = false;\n    editModal.$scope.accept = function (hide) {\n      editModal.$scope.ok = true;\n      hide();\n    };\n    editModal.$scope.abort = function (hide) {\n      editModal.$scope.ok = false;\n      hide();\n    };\n    editModal.$scope.changeName = false;\n\n    editModal.$scope.$watch('content.title', function(newValue, oldValue) {\n      // $log.debug(\"Content in Content Modal changed!\", \"new\", newValue, \"old\", oldValue);\n      if(editModal.$scope.changeName && angular.isDefined(editModal.$scope.content)) {\n        editModal.$scope.content.name = generateName(newValue);\n      }\n    });\n\n    editModal.$scope.$on('modal.hide.before',function(event, editModal) {\n      // $log.debug(\"edit closed\", event, editModal);\n      editModal.$scope.changeName = false;\n      if(editModal.$scope.ok) {\n        return validateContent(editModal.$scope.content, editModal.$scope.callback);\n      }\n      if(angular.isFunction(editModal.$scope.callback)) {\n        return editModal.$scope.callback(\"discarded\", editModal.$scope.content);\n      }\n    });\n    return getEditModal();\n  };\n\n  var getEditModal = function() {\n    return editModal;\n  };\n\n  var subscribe = function() {\n    // called on content changes\n    $sailsSocket.subscribe('content', function(msg){\n      $log.debug(\"Content event!\", msg);\n      switch(msg.verb) {\n        case 'updated':\n          if($rootScope.authenticated) {\n            $rootScope.pop('success', 'Seite wurde aktualisiert', msg.id);\n          }\n        break;\n      }\n    });\n  };\n\n  var toogleShowHtml = function(contents, callback) {\n    showHtml = !showHtml;\n    if(showHtml && contents) {\n      contents = beautifyEach(contents);\n    }\n    if(angular.isFunction(callback)) {\n      return callback(null, showHtml);\n    }\n    return showHtml;\n  };\n\n  var beautify = function(content, callback) {\n    content.content = html_beautify(content.content);\n    if(angular.isFunction(callback)) {\n      return callback(null, content);\n    }\n    return content;\n  };\n\n  var beautifyEach = function(contents, callback) {\n    for (var i = contents.length - 1; i >= 0; i--) {\n      contents[i].content = beautify(contents[i].content);\n    }\n    if(angular.isFunction(callback)) {\n      return callback(null, contents);\n    }\n    return contents;\n  };\n\n  var getByName = function (contents, name) {\n    var index = UtilityService.findKeyValue(contents, 'name', name);\n    if(index > -1) {\n      return contents[index];\n    }\n    return null;\n  };\n\n  var create = function(data) {\n    if(!data || !data.content) {\n      data.content = \"\";\n    }\n    if(!data || !data.title) {\n      data.title = \"\";\n    }\n    if(!data || !data.name) {\n      data.name = \"\";\n    }\n    if(!data || !data.type) {\n      data.type = \"dynamic\";\n    }\n    if(!data || !data.page) {\n      $log.error(\"[ContentService] Page not set.\");\n    }\n    return data;\n  };\n\n  var append = function(contents, content, callback) {\n    SortableService.append(contents, content, callback, true, 'name');\n  };\n\n  var createEdit = function(contents, page, callback) {\n    var data = create({page:page});\n    edit(data, callback, true);\n  };\n\n  var swap = function(contents, index_1, index_2, callback) {\n    return SortableService.swap(contents, index_1, index_2, callback);\n  };\n\n  var moveForward = function(index, contents, callback) {\n    return SortableService.moveForward(index, contents, callback);\n  };\n\n  var moveBackward = function(index, contents, callback) {\n    return SortableService.moveBackward(index, contents, callback);\n  };\n\n  var validateContent = function (content, callback) {\n    if(content.title) {\n      return fix(content, callback);\n    }\n    if(angular.isFunction(callback)) {\n      return callback(\"Title not set\", content);\n    }\n    return null;\n  };\n\n  var edit = function(content, callback, changeName) {\n    $log.debug(\"edit\", content);\n    editModal.$scope.content = content;\n    editModal.$scope.callback = callback;\n    if(changeName) {\n      editModal.$scope.changeName = changeName;\n    }\n    else {\n      editModal.$scope.changeName = false;\n    }\n    focus('contentedittitle');\n    //- Show when some event occurs (use $promise property to ensure the template has been loaded)\n    editModal.$promise.then(editModal.show);\n  };\n\n  var removeFromClient = function (contents, index, content, callback) {\n    return SortableService.remove(index, contents, callback);\n  };\n\n  var remove = function(contents, index, content, page, callback) {\n    var errors = [\n      'Content konnte nicht gelöscht werden.'\n    ];\n    if(typeof(index) === 'undefined' || index === null) {\n      index = contents.indexOf(content);\n    }\n    // remove from client\n    contents = SortableService.remove(contents, index, content);\n    // if content has an id it is saved on database, if not, not\n    if(content.id) {\n      $log.debug(\"remove from server, too\" ,content);\n      $sailsSocket.delete('/content/'+content.id+\"?page=\"+page, {id:content.id, page: page}).success(function(data, status, headers, config) {\n        if(angular.isFunction(callback)) {\n          return callback(null, contents);\n        }\n        return contents;\n      }).\n      error(function(data, status, headers, config) {\n        $log.error (errors[0], data);\n        if(angular.isFunction(callback)) {\n          return callback(data);\n        }\n        return data;\n      });\n    } else {\n      if(angular.isFunction(callback)) {\n        return callback(null, contents);\n      }\n      return contents;\n    }\n  };\n\n  var refresh = function(contents, callback) {\n    fixEach(contents, function(err, contents) {\n      if(err) {\n        $log.error(err);\n        if(angular.isFunction(callback)) {\n          return callback(err);\n        }\n        return err;\n      }\n      beautifyEach(contents, function(err, contents) {\n        if(err) {\n          $log.error(err);\n          if(angular.isFunction(callback)) {\n            return callback(err);\n          }\n          return err;\n        }\n        if(angular.isFunction(callback)) {\n          return callback(null, contents);\n        }\n        return contents;\n      });\n    });\n  };\n\n  var generateName = function (title) {\n    var name = \"\";\n    if(title && title !== \"\") {\n      // Set content.name to content.title but only the letters in lower case\n      name = title.toLowerCase().replace(/[^a-z1-9]+/g, '');\n      $log.debug(\"set content.name to\", name);\n    }\n    return name;\n  };\n\n  /*\n   * Validate and fix content to make it saveable\n   */\n  var fix = function(content, callback) {\n\n    if(angular.isDefined(content)) {\n      if(angular.isUndefined(content.name) || content.name === '' || content.name === null) {\n        content.name = generateName(content.title);\n      }\n\n      if(!angular.isNumber(content.position)) {\n        content.position = 0;\n      }\n\n      if(!content.type || content.type === \"\") {\n        $log.warn(\"Fix content type not set, set it to dynamic\");\n        content.type = 'fix';\n      }\n    } else {\n      if(angular.isFunction(callback)) {\n        return callback(\"content not set\");\n      }\n      return null;\n    }\n\n    if(angular.isFunction(callback)) {\n      return callback(null, content);\n    }\n    return content;\n  };\n\n  /*\n   * Validate and fix all contents to make them saveable\n   */\n  var fixEach = function(contents, callback) {\n    for (var i = contents.length - 1; i >= 0; i--) {\n      contents[i] = fix(contents[i]);\n    }\n    if(angular.isFunction(callback)) {\n      return callback(null, contents);\n    }\n    return contents;\n  };\n\n  var saveOne = function(content, page, callback) {\n    var errors = [\n      'Inhalt konnte nicht gespeichert werden'\n    ];\n    content.page = page;\n    fix(content, function(err, content) {\n      if(err) {\n        if(angular.isFunction(callback)) {\n          return callback(err);\n        }\n        return err;\n      }\n      $sailsSocket.put('/content/replace', content).success(function(data, status, headers, config) {\n        //- $log.debug (\"save response from /content/replaceall\", data, status, headers, config);\n        if(data !== null && typeof(data) !== \"undefined\") {\n          content = data;\n          // $log.debug (content);\n          if(angular.isFunction(callback)) {\n            return callback(null, content);\n          }\n          return content;\n        } else {\n          $log.error(errors[0]);\n          if(angular.isFunction(callback)) {\n            return callback(errors[0]);\n          }\n          return errors[0];\n        }\n      }).\n      error(function(data, status, headers, config) {\n        $log.error (errors[0], data);\n        if(angular.isFunction(callback)) {\n          return callback(data);\n        }\n        return data;\n      });\n    });\n  };\n\n  var save = function(contents, page, callback) {\n    var errors = [\n      'Seite konnte nicht gespeichert werden'\n    ];\n    fixEach(contents, function(err, contents) {\n      if(err) {\n        if(angular.isFunction(callback)) {\n          return callback(err);\n        }\n        return err;\n      }\n      return $sailsSocket.put('/content/replaceall', {contents: contents, page: page}).success(function(data, status, headers, config) {\n        //- $log.debug (\"save response from /content/replaceall\", data, status, headers, config);\n        if(data !== null && typeof(data) !== \"undefined\") {\n          contents = $filter('orderBy')(data, 'position');\n          // $log.debug (data);\n          if(angular.isFunction(callback)) {\n            return callback(null, contents);\n          }\n          return contents;\n        }\n        $log.error(errors[0]);\n        if(angular.isFunction(callback)) {\n          return callback(errors[0]);\n        }\n        return errors[0];\n      }).\n      error(function(data, status, headers, config) {\n        $log.error (errors[0], data);\n        if(angular.isFunction(callback)) {\n          callback(data);\n        }\n      });\n    });\n  };\n  \n  var saveParallel = function(page, logger, options, obj, callback) {\n    $async.parallel(obj, function(err, results) {\n      if(err) {\n        $log.error(\"Error: On save content!\", err);\n        logger('error', 'Seiteninhalt konnte nichtgespeichert werden', err);\n        if(angular.isFunction(callback)) {\n          return callback(err);\n        }\n        return err;\n      }\n      if(options.applyResults) {\n        options.scope = angular.extend(options.scope, results);\n      }\n      logger('success', 'Seiteninhalt wurde gespeichert', \"\");\n      if(angular.isFunction(callback)) {\n        return callback(null, results);\n      }\n      return results;\n    });\n  };\n\n  var findOne = function(page, name, type, callback, next) {\n    var errors = [\n      \"Error: On trying to find one with page: \"+page+\", name: \"+name,\n      \"request has more than one results\"\n    ];\n    var query = {\n      page: page,\n      name: name\n    };\n    var url = '/content/find';\n    if(angular.isDefined(type) && type !== null) {\n      query.type = type;\n    }\n    return $sailsSocket.put(url, query).then (function (data) {\n      if(angular.isUndefined(data) || angular.isUndefined(data.data)) {\n        return null;\n      }\n      if(data.data instanceof Array) {\n        data.data = data.data[0];\n        $log.error(errors[1]);\n      }\n      // data.data.content = html_beautify(data.data.content);\n      if(next) {\n        data.data = next(data.data);\n      }\n      if(angular.isFunction(callback)) {\n        return callback(null, data.data);\n      }\n      return data.data;\n    }, function error (resp){\n      $log.error(errors[0], resp);\n      if(angular.isFunction(callback)) {\n        return callback(errors[0], resp);\n      }\n      return resp;\n    });\n  };\n\n  var findAll = function(page, type, callback, next) {\n    var errors = [\n      \"Error: On trying to find all with page: \"+page+\" and type: \"+type,\n      \"Warn: On trying to find all \"+page+\" contents! Not found, content is empty!\"\n    ];\n    var query = {};\n    var url = '/content/findall';\n    if(angular.isDefined(page) && page !== null) {\n      query.page = page;\n    }\n    if(angular.isDefined(type) && type !== null) {\n      query.type = type;\n    }\n    return $sailsSocket.put(url, query).then (function (data) {\n      if(angular.isUndefined(data) || angular.isUndefined(data.data)) {\n        $log.warn(errors[1]);\n        return null;\n      }\n      // data.data.content = html_beautify(data.data.content);\n      data.data = $filter('orderBy')(data.data, 'position');\n      // $log.debug(data);\n      if(next) {\n        data.data = next(data.data);\n      }\n\n      if(angular.isFunction(callback)) {\n        callback(null, data.data);\n      } else {\n        return data.data;\n      }\n    }, function error (resp){\n      $log.error(errors[0], resp);\n      if(angular.isFunction(callback)) {\n        return callback(errors[0], resp);\n      }\n      return resp;\n    });\n  };\n\n  /**\n   * For superadminsd\n   */\n  var findByHost = function(query, callback) {\n    var options = {\n      method: 'post',\n      resultIsArray: true\n    };\n    return JLSailsService.resolve('/Content/findByHost', query, options, callback);\n  };\n\n  /**\n   * For superadminsd\n   */\n  var exportByHost = function(host, download, callback) {\n    // $log.debug(\"[ContentService.findByHost]\");\n    var options = {\n      method: 'post',\n      resultIsArray: true\n    };\n    \n    return JLSailsService.resolve('/Content/exportByHost', {host: host}, options, function(err, data) {\n      $log.debug(\"[ContentService.exportByHost]\", err, data);\n      if(err) {\n        if(download) {\n          $download(JSON.stringify(data), \"error.txt\", \"text/plain\");\n        }\n        return callback(err);\n      }\n      if(download) {\n        $download(JSON.stringify(data), \"content.json\", \"text/json\");\n      }\n      return callback(err, data);\n    });\n  };\n\n  /**\n   * Update or create content for any passed host.\n   * Only for superadmins!\n   *\n   * @param req.param.host Host to save content for\n   */\n  var updateOrCreateByHostByTitleAndPage = function(host, content, callback) {\n    $log.debug(\"[contentsService.updateOrCreateByHostByTitleAndPage]\", host, content);\n    var options = {\n      method: 'post',\n      resultIsArray: false\n    };\n    return JLSailsService.resolve('/Content/updateOrCreateByHostByTitleAndPage', {host: host, content: content}, options, callback);\n  };\n  /*\n   * get all contents for page including images for each content.name \n   */\n  var findAllWithImage = function(page, type, callback, next) {\n    // $log.debug(\"findAllWithImage\");\n    var errors = [\n      \"Error: On trying to find all with page: \"+page+\" and type: \"+type,\n      \"Warn: On trying to find all \"+page+\" contents! Not found, content is empty!\"\n    ];\n    var query = {\n      page: page\n    };\n    var url = '/content/findAllWithImage?page='+page;\n    if(type) {\n      query.type = type;\n      url = url+'&type='+type;\n    }\n    return $sailsSocket.get(url, query).then (function (data) {\n      if(angular.isUndefined(data) || angular.isUndefined(data.data)) {\n        $log.warn(errors[1]);\n        return null;\n      }\n      // data.data.content = html_beautify(data.data.content);\n      data.data.contents = $filter('orderBy')(data.data.contents, 'position');\n      data.data.images = $filter('orderBy')(data.data.images, 'position');\n      // $log.debug(data);\n      if(next) {\n        data.data = next(data.data);\n      }\n      if(angular.isFunction(callback)) {\n        return callback(null, data.data);\n      }\n      return data.data;\n    }, function error (resp){\n      $log.error(errors[0], resp);\n      if(angular.isFunction(callback)) {\n        return callback(errors[0], resp);\n      }\n      return resp;\n    });\n  };\n\n  /**\n   *\n   */\n  var find = function(page, name, type, callback, next) {\n    //- get soecial content (one)\n    if(angular.isDefined(name)) {\n      return findOne(page, name, type, next);\n    // get all for page\n    } else {\n      return findAll(page, type, callback, next);\n    }\n  };\n\n  return {\n    subscribe: subscribe,\n    setEditModal: setEditModal,\n    getShowHtml: getShowHtml,\n    toogleShowHtml: toogleShowHtml,\n    beautify: beautify,\n    beautifyEach: beautifyEach,\n    create: create,\n    createEdit: createEdit,\n    append: append,\n    swap: swap,\n    moveForward: moveForward,\n    moveBackward: moveBackward,\n    edit: edit,\n    removeFromClient: removeFromClient,\n    remove: remove,\n    refresh: refresh,\n    fix: fix,\n    fixEach: fixEach,\n    save: save,\n    saveOne: saveOne,\n    saveParallel: saveParallel,\n    find: find,\n    resolve: find, // alias\n    findOne: findOne,\n    resolveOne: findOne, // alias\n    findAll: findAll, \n    resolveAll: findAll, //alias\n    findByHost: findByHost,\n    exportByHost: exportByHost,\n    updateOrCreateByHostByTitleAndPage: updateOrCreateByHostByTitleAndPage,\n    findAllWithImage: findAllWithImage,\n    resolveAllWithImage: findAllWithImage,  //alias\n    getByName: getByName\n  };\n});","// window.saveAs\n// Shims the saveAs method, using saveBlob in IE10. \n// And for when Chrome and FireFox get round to implementing saveAs we have their vendor prefixes ready. \n// But otherwise this creates a object URL resource and opens it on an anchor tag which contains the \"download\" attribute (Chrome)\n// ... or opens it in a new tab (FireFox)\n// @author Andrew Dodson\n// @copyright MIT, BSD. Free to clone, modify and distribute for commercial and personal use.\n// window.saveAs || ( window.saveAs = (window.navigator.msSaveBlob ? function(b,n){ return window.navigator.msSaveBlob(b,n); } : false) || window.webkitSaveAs || window.mozSaveAs || window.msSaveAs || (function(){\n//   // URL's\n//   window.URL || (window.URL = window.webkitURL);\n//   if(!window.URL){\n//     return false;\n//   }\n//   return function(blob,name){\n//     var url = URL.createObjectURL(blob);\n//     // Test for download link support\n//     if( \"download\" in document.createElement(\"a\") ){\n//       var a = document.createElement(\"a\");\n//       a.setAttribute(\"href\", url);\n//       a.setAttribute(\"download\", name);\n//       // Create Click event\n//       var clickEvent = document.createEvent (\"MouseEvent\");\n//       clickEvent.initMouseEvent (\"click\", true, true, window, 0, \n//         clickEvent.screenX, clickEvent.screenY, clickEvent.clientX, clickEvent.clientY, \n//         clickEvent.ctrlKey, clickEvent.altKey, clickEvent.shiftKey, clickEvent.metaKey, \n//         0, null);\n//       // dispatch click event to simulate download\n//       a.dispatchEvent (clickEvent);\n//     }\n//     else{\n//       // fallover, open resource in new tab.\n//       window.open(url, \"_blank\", \"\");\n//     }\n//   };\n// })() );\n\n// Source: https://github.com/darius/requestAnimationFrame\n// Adapted from https://gist.github.com/paulirish/1579671 which derived from\n// http://paulirish.com/2011/requestanimationframe-for-smart-animating/\n// http://my.opera.com/emoller/blog/2011/12/20/requestanimationframe-for-smart-er-animating\n\n// requestAnimationFrame polyfill by Erik Möller.\n// Fixes from Paul Irish, Tino Zijdel, Andrew Mao, Klemen Slavič, Darius Bacon\n\n// MIT license\n\nif (!Date.now) {\n  Date.now = function() { return new Date().getTime(); };\n}\n\n(function() {\n    'use strict';\n\n    var vendors = ['webkit', 'moz'];\n    for (var i = 0; i < vendors.length && !window.requestAnimationFrame; ++i) {\n        var vp = vendors[i];\n        window.requestAnimationFrame = window[vp+'RequestAnimationFrame'];\n        window.cancelAnimationFrame = (window[vp+'CancelAnimationFrame'] || window[vp+'CancelRequestAnimationFrame']);\n    }\n    // iOS6 is buggy\n    if (/iP(ad|hone|od).*OS 6/.test(window.navigator.userAgent) || !window.requestAnimationFrame || !window.cancelAnimationFrame) {\n        var lastTime = 0;\n        window.requestAnimationFrame = function(callback) {\n          var now = Date.now();\n          var nextTime = Math.max(lastTime + 16, now);\n          return setTimeout(function() { callback(lastTime = nextTime); }, nextTime - now);\n        };\n        window.cancelAnimationFrame = clearTimeout;\n    }\n}());","// https://github.com/rndme/download\nangular.module('ngDownload', [])\n.service('$download', function ($log) { \n  if(angular.isDefined(download)) {\n    return download;\n  } else {\n    $log.error(\"[ngDownload] download is not defined, please install it from https://github.com/rndme/download\");\n    return null;\n  }\n  \n});","angular.module('jumplink.cms.event', [\n  'mgcrea.ngStrap',\n  'angular-medium-editor',\n  'angularFileUpload',\n  'angularMoment',\n  'ngFocus',\n  'ngAsync',\n  'sails.io',\n  'jumplink.cms.utilities',\n])\n.service('EventService', function (moment, UtilityService, $sailsSocket, $async, $log, focus, $modal, FileUploader) {\n  var editModal = null;\n  var typeModal = null;\n  var types = ['lecture', 'panel discussion', 'travel', 'info', 'food', 'other'];\n  var page = null;\n\n  var validate = function (event, callback) {\n    if(event.title) {\n      return fix(event, callback);\n    }\n    if(angular.isFunction(callback)) {\n      return callback(\"Title not set\", event);\n    }\n    return null;\n  };\n\n  var chooseType = function(event, type, hide) {\n    event.type = type;\n    hide();\n  };\n\n  var openTypeChooserModal = function(event) {\n    typeModal.$scope.event = event;\n    //- Show when some event occurs (use $promise property to ensure the template has been loaded)\n    typeModal.$promise.then(typeModal.show);\n  };\n\n  var setModals = function($scope, fileOptions, pageString) {\n\n    if(!angular.isString(page)) {\n      page = pageString;\n    }\n    \n    editModal = $modal({title: 'Ereignis bearbeiten', templateUrl: '/views/modern/events/editmodal.jade', show: false});\n    editModal.$scope.ok = false;\n    editModal.$scope.accept = function (hide) {\n      editModal.$scope.ok = true;\n      hide();\n    };\n    editModal.$scope.abort = function (hide) {\n      editModal.$scope.ok = false;\n      hide();\n    };\n\n    // set default fileOptions\n    if(angular.isUndefined(fileOptions)) {\n      fileOptions = {};\n    }\n\n    var uploadOptions = {\n      url: 'timeline/upload',\n      removeAfterUpload: true,\n      // WARN: headers HTML5 only\n      headers: {\n        options: JSON.stringify(fileOptions)\n      }\n    };\n\n    editModal.$scope.uploader = new FileUploader(uploadOptions);\n    editModal.$scope.openTypeChooserModal = openTypeChooserModal;\n\n    editModal.$scope.uploader.onCompleteItem = function(fileItem, response, status, headers) {\n      fileItem.event.download = response.files[0].uploadedAs;\n    };\n    editModal.$scope.uploader.onProgressItem = function(fileItem, progress) {\n      console.info('onProgressItem', fileItem, progress);\n    };\n    editModal.$scope.upload = function(fileItem, event) {\n      fileItem.event = event;\n      fileItem.upload();\n    };\n    typeModal = $modal({title: 'Typ wählen', templateUrl: '/views/modern/events/typechoosermodal.jade', show: false});\n    typeModal.$scope.chooseType = chooseType;\n    editModal.$scope.$on('modal.hide.before',function(event, editModal) {\n      $log.debug(\"edit closed\", event, editModal);\n      if(editModal.$scope.ok) {\n        return validate(editModal.$scope.event, editModal.$scope.callback);\n      }\n      if(angular.isFunction(editModal.$scope.callback)) {\n        return editModal.$scope.callback(\"discarded\", editModal.$scope.event);\n      }\n    });\n    return getModals();\n  };\n\n  var getEditModal = function() {\n    return editModal;\n  };\n\n  var getTypeModal = function() {\n    return typeModal;\n  };\n\n  var getModals = function() {\n    return {\n      editModal: getTypeModal(),\n      typeModal: getTypeModal()\n    };\n  };\n\n  var edit = function(event, eventBlockName, callback) {\n    // $log.debug(\"edit\", event);\n    editModal.$scope.event = event;\n    // editModal.$scope.eventBlockName = eventBlockName;\n    editModal.$scope.callback = callback;\n    editModal.$scope.ok = false;\n    focus('eventtitle');\n    //- Show when some event occurs (use $promise property to ensure the template has been loaded)\n    editModal.$promise.then(editModal.show);\n  };\n\n  var split = function(events) {\n    var unknown = [], before = [], after = [];\n    for (var i = 0; i < events.length; i++) {\n      if(angular.isDefined(events[i].to)) {\n        events[i].to = moment(events[i].to);\n      }\n      if(angular.isDefined(events[i].from)) {\n        events[i].from = moment(events[i].from);\n        if(events[i].from.isAfter()) {\n          after.push(events[i]);\n        }\n        else {\n          before.push(events[i]);\n        }\n      } else {\n        unknown.push(events[i]);\n      }\n    }\n    return {unknown:unknown, before:before, after:after};\n  };\n\n  var removeFromClient = function (events, event, eventBlockName, callback) {\n    var errors = [\n      \"no event on client site found to remove\"\n    ];\n    var index = events[eventBlockName].indexOf(event);\n    if (index > -1) {\n      events[eventBlockName].splice(index, 1);\n      if(angular.isFunction(callback)) {\n        return callback(null, events);\n      }\n      return events;\n    }\n    if(angular.isFunction(callback)) {\n      return callback(errors[0], events);\n    }\n    return errors[0];\n  };\n\n  var remove = function(events, event, eventBlockName, callback) {\n    // $log.debug(\"remove event\", event, eventBlockName);\n    if(event.id) {\n      $log.debug(event);\n      $sailsSocket.delete('/timeline/'+event.id).success(function(users, status, headers, config) {\n        removeFromClient(events, event, eventBlockName, callback);\n      });\n    } else {\n      removeFromClient(events, event, eventBlockName, callback);\n    }\n  };\n\n  var transform = function(events) {\n    events = split(events);\n    events.before = UtilityService.invertOrder(events.before);\n    return events;\n  };\n\n  var merge = function(unknown, before, after) {\n    if(angular.isUndefined(unknown)) {\n      unknown = [];\n    }\n    if(angular.isUndefined(before)) {\n      before = [];\n    }\n    if(angular.isUndefined(after)) {\n      after = [];\n    }\n    return unknown.concat(before).concat(after);\n  };\n\n  var append = function(events, event, callback) {\n    events.unknown.push(event);\n    var allEvents = merge(events.unknown, events.before, events.after);\n    events = transform(allEvents);\n    if(angular.isFunction(callback)) {\n      return callback(null, events);\n    }\n    return events;\n  };\n\n  var create = function(data) {\n    if(!data || !data.from) {\n      data.from = moment();\n      data.from.add(1, 'hours');\n      data.from.minutes(0);\n    }\n    if(!data || !data.title) {\n      data.title = \"\";\n    }\n    if(!data || !data.person) {\n      data.person = \"\";\n    }\n    if(!data || !data.place) {\n      data.place = \"\";\n    }\n    if(!data || !data.page) {\n      callback(\"Page not set.\");\n    }\n    return data;\n  };\n\n  var createEdit = function(events, event, callback) {\n    event = create(event); \n    edit(event, null, callback);\n  };\n\n  var fix = function(object, callback) {\n    if(!object.name || object.name === \"\") {\n      // Set object.name to object.title but only the letters in lower case\n      object.name = object.title.toLowerCase().replace(/[^a-z]+/g, '');\n      // $log.debug(\"set object.name to\", object.name);\n    }\n    if(angular.isFunction(callback)) {\n      return callback(null, object);\n    }\n    return object;\n  };\n\n  var fixEach = function(objects, callback) {\n    for (var i = objects.length - 1; i >= 0; i--) {\n      objects[i] = fix(objects[i]);\n    }\n    if(angular.isFunction(callback)) {\n      return callback(null, objects);\n    }\n    return objects;\n  };\n\n  var refresh = function(eventBlocks) {\n    var allEvents = merge(eventBlocks.unknown, eventBlocks.before, eventBlocks.after);\n    // $log.debug(\"allEvents.length\", allEvents.length);\n    eventBlocks = transform(allEvents);\n    // $log.debug(\"refreshed\");\n    return eventBlocks;\n  };\n\n  var saveOne = function (eventBlocks, eventBlockName, event, callback) {\n    var errors = [\n      \"EventService: Can't save event.\",\n      \"EventService: Can't save event, event to update not found.\",\n      \"EventService: Can't save event, parameters undefind.\",\n    ];\n    if(angular.isDefined(event) && angular.isDefined(eventBlockName) && angular.isDefined(callback)) {\n      event = fix(event);\n      if(angular.isUndefined(event.id)) {\n        // create because id is undefined\n        $sailsSocket.post('/timeline', event).success(function(data, status, headers, config) {\n          if(angular.isArray(data)) {\n            data = data[0];\n          }\n          // $log.debug(\"event created\", event, data);\n          var index = eventBlocks[eventBlockName].indexOf(event);\n          if (index > -1) {\n            eventBlocks[eventBlockName][index] = data;\n            // $log.debug(eventBlocks[eventBlockName][index]);\n            callback(null, eventBlocks[eventBlockName][index]);\n          } else {\n            callback(errors[1]);\n          }\n        }).error(function (data, status, headers, config) {\n          if(angular.isArray(data)) {\n            data = data[0];\n          }\n          $log.error(data, status, headers, config);\n          callback(errors[0]);\n        });\n      } else {\n        // update because id is defined\n        $sailsSocket.put('/timeline/'+event.id, event).success(function(data, status, headers, config) {\n          if(angular.isArray(data)) {\n            data = data[0];\n          }\n          // $log.debug(\"event updated\", event, data);\n          event = data;\n          callback(null, event);\n        }).error(function (data, status, headers, config) {\n          $log.error(data, status, headers, config);\n          callback(errors[0]);\n        });\n      }\n    } else {\n      callback(errors[2]);\n    }\n  };\n\n  var saveAllInBlock = function(eventBlocks, eventBlockName, callback) {\n    $async.map(eventBlocks[eventBlockName], function (event, callback) {\n      saveOne(eventBlocks, eventBlockName, event, callback);\n    }, callback);\n  };\n\n\n  var saveBlocks = function(eventBlocks, callback) {\n    var errors = [\n      \"EventService: Can't save eventBlocks, parameters undefind.\"\n    ];\n    // save just this event if defined\n    if(angular.isDefined(eventBlocks) && angular.isDefined(callback)) {\n      return $async.map(['after', 'before', 'unknown'], function (eventBlockName, callback) {\n        saveAllInBlock(eventBlocks, eventBlockName, callback);\n      }, function(err, eventBlocksArray) {\n        if(err) {\n           $log.error(err);\n          if(angular.isFunction(callback)) {\n            return callback(err);\n          }\n        }\n        var allEvents = merge(eventBlocksArray[0], eventBlocksArray[1], eventBlocksArray[2]);\n        eventBlocks = transform(allEvents);\n        return callback(null, eventBlocks);\n      });\n    }\n    $log.error(errors[0]);\n    if(angular.isFunction(callback)) {\n      return callback(errors[0]);\n    }\n  };\n\n  var resolve = function(page) {\n    return $sailsSocket.get('/timeline').then (function (data) {\n      // $log.debug(data);\n      return transform(data.data);\n    }, function error (resp){\n      $log.error(\"Error on resolve \"+page, resp);\n    });\n  };\n\n  var subscribe = function () {\n    $sailsSocket.subscribe('timeline', function(msg){\n      $log.debug(msg);\n      switch(msg.verb) {\n        case 'updated':\n          if($rootScope.authenticated) {\n            $rootScope.pop('success', 'Ein Ereignis wurde aktualisiert', msg.data.title);\n          }\n          findEvent(msg.id, function(error, event, eventBlock, index) {\n            if(error) {\n              $log.debug(error);\n              return error;\n            }\n            event = msg.data;\n            $scope.refresh();\n          });\n        break;\n        case 'created':\n          if($rootScope.authenticated) {\n            $rootScope.pop('success', 'Ein Ereignis wurde erstellt', msg.data.title);\n          }\n          $scope.events.before.push(msg.data);\n          $scope.refresh();\n        break;\n        case 'removedFrom':\n          if($rootScope.authenticated) {\n            $rootScope.pop('success', 'Ein Ereignis wurde entfernt', msg.data.title);\n          }\n          findEvent(msg.id, function(error, event, eventBlock, index) {\n            if(error) {\n              $log.debug(error);\n              return error;\n            }\n            EventService.removeFromClient($scope.events, event, eventBlock);\n          });\n        break;\n        case 'destroyed':\n          if($rootScope.authenticated) {\n            $rootScope.pop('success', 'Ein Ereignis wurde gelöscht', msg.data.title);\n          }\n          findEvent(msg.id, function(error, event, eventBlock, index) {\n            if(error) {\n              $log.debug(error);\n              return error;\n            }\n            EventService.removeFromClient($scope.events, event, eventBlock);\n          });\n        break;\n        case 'addedTo':\n          if($rootScope.authenticated) {\n            $rootScope.pop('success', 'Ein Ereignis wurde hinzugefügt', msg.data.title);\n          }\n        break;\n      }\n    });\n  };\n\n  return {\n    subscribe: subscribe,\n    split: split,\n    merge: merge,\n    append: append,\n    transform: transform,\n    saveOne: saveOne,\n    saveAllInBlock: saveAllInBlock,\n    saveBlocks: saveBlocks,\n    edit: edit,\n    createEdit: createEdit,\n    fixEach: fixEach,\n    resolve: resolve,\n    setModals: setModals,\n    refresh: refresh,\n    openTypeChooserModal: openTypeChooserModal,\n    chooseType: chooseType,\n    removeFromClient: removeFromClient,\n    remove: remove\n  };\n});","angular.module('jumplink.cms.fallback', [\n])\n.service('FallbackService', function ($window, $location, $log) {\n\n  var go = function(path) {\n    var protocol = $location.protocol();\n    var host = $location.host();\n    if(!angular.isString(path)) {\n      path = \"/fallback\";\n    } else {\n      if(path.charAt(0) !== '/') {\n        path = '/'+path;\n      }\n    }\n    var url = protocol+\"://\"+host+path+\"?force=fallback\";\n    $log.debug(\"Go to fallback url: \"+url);\n    // $window.location.href = url;\n  };\n\n  return {\n    go: go\n  };\n});","angular.module('ngFocus', [])\n// Source and Copyright: http://stackoverflow.com/questions/25596399/set-element-focus-in-angular-way\n.factory('focus', function($timeout, $window) {\n  return function(id) {\n    // timeout makes sure that it is invoked after any other event has been triggered.\n    // e.g. click events that need to run before the focus or\n    // inputs elements that are in a disabled state but are enabled when those events\n    // are triggered.\n    $timeout(function() {\n      var element = $window.document.getElementById(id);\n      if(element) {\n        element.focus();\n      }\n    });\n  };\n})\n.directive('eventFocus', function(focus) {\n  return function(scope, elem, attr) {\n    elem.on(attr.eventFocus, function() {\n      focus(attr.eventFocusId);\n    });\n\n    // Removes bound events in the element itself\n    // when the scope is destroyed\n    scope.$on('$destroy', function() {\n      elem.off(attr.eventFocus);\n    });\n  };\n});","angular.module('jumplink.cms.gallery', [\n  'mgcrea.ngStrap',\n  'ngAsync',\n  'angular-medium-editor',\n  'FBAngular',\n  'sails.io',\n  'angularFileUpload',\n  'jumplink.cms.sortable',\n  'jumplink.cms.content',\n])\n.service('GalleryService', function ($rootScope, $sailsSocket, $async, $filter, Fullscreen, SortableService, ContentService, FileUploader, $modal, $log) {\n\n  var editModal = null;\n  uploadModal = null;\n  fullscreenImage = null;\n\n  var dropdown = [\n    {\n      \"text\": \"<i class=\\\"fa fa-eye\\\"></i>&nbsp;Anzeigen\",\n      \"click\": \"goToImage(image)\"\n    },\n    {\n      \"text\": \"<i class=\\\"fa fa-edit\\\"></i>&nbsp;Bearbeiten\",\n      \"click\": \"editImage(image)\"\n    },\n    {\n      \"text\": \"<i class=\\\"fa fa-trash\\\"></i>&nbsp;Löschen\",\n      \"click\": \"$dropdown.hide();$dropdown.destroy();removeImage(image);\" // TODO delay\n    },\n    {\n      \"text\": \"<i class=\\\"fa fa-floppy-o\\\"></i>&nbsp;Speichern\",\n      \"click\": \"saveImage(image)\"\n    }\n  ];\n\n  var getDropdown = function () {\n    return dropdown;\n  };\n\n  var setEditModal = function($scope) {\n    editModal = $modal({scope: $scope, title: 'Bild bearbeiten', templateUrl: '/views/modern/gallery/editmodal.jade', show: false});\n    return getEditModal();\n  };\n\n  var getEditModal = function() {\n    return editModal;\n  };\n\n  var prepairUploadModal = function (uploadModal, imageBlocks, contentBlocks) {\n    \n    uploadModal.$scope.imageBlocks = imageBlocks;\n    uploadModal.$scope.selects = getSelects(imageBlocks, contentBlocks);\n    if(uploadModal.$scope.selects.length > 0) {\n      $rootScope.selectedContentBlock = uploadModal.$scope.selects[0].value;\n    }\n\n    $rootScope.$watch('selectedContentBlock', function(newValue, oldValue) {\n      $log.debug(\"selected changed to\", newValue);\n    });\n\n    return uploadModal;\n  };\n\n  var setUploadModal = function($scope, imageBlocks, contentBlocks, options, callback, onCompleteCallback) {\n\n    // if options not set, set to default values\n    if(angular.isUndefined(options)) {\n      options = {\n        thumbnail: {\n          width: 300,\n        },\n        rescrop: {\n          width: 1200,\n          cropwidth: 1200,\n          cropheight: 1200,\n        }\n      };\n    }\n\n    var uploadOptions = {\n      url: 'gallery/upload',\n      removeAfterUpload: true,\n      // WARN: headers HTML5 only\n      headers: {\n        options: JSON.stringify(options)\n      }\n    };\n\n    $scope.uploader = new FileUploader(uploadOptions);\n    $scope.uploader.filters.push({\n      name: 'imageFilter',\n      fn: function(item /*{File|FileLikeObject}*/, options) {\n        var type = '|' + item.type.slice(item.type.lastIndexOf('/') + 1) + '|';\n        return '|jpg|png|jpeg|bmp|gif|'.indexOf(type) !== -1;\n      }\n    });\n\n    if(angular.isFunction(onCompleteCallback)) {\n      $scope.uploader.onComplete = onCompleteCallback;\n    }\n\n    $scope.uploader.onCompleteItem = function(fileItem, response, status, headers) {\n      //fileItem.member.image = response.files[0].uploadedAs;\n      $log.debug(\"[GalleryService.uploader.onCompleteItem]\",fileItem, response, status, headers);\n      // WORKAROUND until the socket method works\n      response.files.forEach(function (file, index, files) {\n\n        var selected = $rootScope.selectedContentBlock;\n        var imageBlocks = uploadModal.$scope.imageBlocks;\n        var currentImages = imageBlocks[selected];\n\n        $log.debug(\"[GalleryService.$scope.uploader.onCompleteItem] selected\", selected, \"imageBlocks\", imageBlocks, \"currentImages\", currentImages);\n\n        var last_position = 0;\n        if(currentImages.length > 0) {\n          last_position = currentImages[currentImages.length-1].position;\n        }\n        if($rootScope.authenticated) {\n          $rootScope.pop('success', 'Ein Bild wurde hochgeladen', file.original.name);\n        }\n        if(typeof file.position === 'undefined') {\n          last_position++;\n          file.position = last_position;\n          file.content = selected;\n        }\n\n        $log.debug(\"[GalleryService.$scope.uploader.onCompleteItem] file\", file);\n        \n        currentImages.push(file);\n      });\n    };\n\n    $scope.upload = function(fileItem, image) {\n      fileItem.image = image;\n      fileItem.upload();\n    };\n\n    uploadModal = $modal({scope: $scope, title: 'Bilder hinzufügen', uploader: $scope.uploader, templateUrl: '/views/modern/gallery/uploadimagesmodal.jade', show: false});\n    uploadModal = prepairUploadModal(uploadModal, imageBlocks, contentBlocks);\n\n    if(angular.isFunction(callback)) {\n      return callback(getUploadModal());\n    }\n    return getUploadModal();\n  };\n\n  var getSelects = function (imageBlocks, contentBlocks) {\n    var blockNames = Object.keys(imageBlocks);\n    var result = [];\n    // console.log(\"contentBlocks\", contentBlocks);\n    blockNames.forEach(function (blockName, index, array) {\n      var label = ContentService.getByName(contentBlocks, blockName).title || blockName; // TODO WARNING slow!\n      result.push({\n        label: label,\n        value: blockName\n      });\n    });\n    return result;\n  };\n\n  var getUploadModal = function() {\n    return uploadModal;\n  };\n\n  var fix = function(image, page, contentname, callback) {\n    if(!image.page || image.page === \"\") {\n      image.page = page;\n    }\n\n    if(!image.content || image.content === \"\") {\n      image.content = contentname;\n    }\n\n    if(angular.isFunction(callback)) {\n      return callback(null, image);\n    }\n    return image;\n  };\n\n  // var setFullScreen = function(image) {\n  //   // http://stackoverflow.com/questions/21702375/angularjs-ng-click-over-ng-click\n  //   fullscreenImage = image;\n  // }\n\n  // var closeFullScreen = function(image) {\n  //   Fullscreen.cancel();\n  // }\n\n  // Fullscreen.$on('FBFullscreen.change', function(evt, isFullscreenEnabled){\n  //   if(!isFullscreenEnabled) {\n  //     delete fullscreenImage;\n  //   }\n  //   $scope.$apply();\n  // });\n\n  // var isFullScreen = function(image) {\n  //   if(angular.isDefined($scope.fullscreenImage) && angular.isDefined($scope.fullscreenImage.original) && angular.isDefined($scope.fullscreenImage.original.name) && $scope.fullscreenImage.original.name == image.original.name) {\n  //     return true;\n  //   } else {\n  //     return false;\n  //   }\n  // }\n\n  var saveOne = function(image, page, contentname, callback) {\n    image = fix(image, page, contentname);\n    var errors = [\n      'Bild konnte nicht gespeichert werden'\n    ];\n    $sailsSocket.put('/gallery/'+image.id, image).success(function(data, status, headers, config) {\n      if(angular.isArray(data)) {\n        data = data[0];\n      }\n      if(angular.isFunction(callback)) {\n        callback(null, data);\n      }\n    }).\n    error(function(data, status, headers, config) {\n      $log.error (errors[0], data);\n      if(angular.isFunction(callback)) {\n        callback(errors[0], data);\n      }\n    });\n  };\n\n  var saveAllBlocks = function(imageBlocks, page, callback) {\n    var blockNames = Object.keys(imageBlocks);\n    // $log.debug(\"saveAllBlocks\",\"blockNames\" , blockNames);\n\n    $async.map(blockNames,\n    function iterator(contentname, callback) {\n      saveAll(imageBlocks[contentname], page, contentname, callback);\n    }, callback);\n\n    // $async.map(images,\n    // function iterator(image, callback) {\n    //   saveOne(image, page, contentname, callback);\n    // }, callback);\n  };\n\n  var saveAll = function(images, page, contentname, callback) {\n    $async.map(images,\n    function iterator(image, callback) {\n      saveOne(image, page, contentname, callback);\n    }, callback);\n  };\n\n  var remove = function(images, index, image, page, callback) {\n    if(typeof(index) === 'undefined' || index === null) {\n      index = images.indexOf(image);\n    }\n    images = SortableService.remove(images, index, image);\n    // if image has an id it is saved on database, if not, not\n    if(image.id) {\n      // $log.debug(\"remove from server, too\" ,image);\n      $sailsSocket.delete('/gallery/'+image.id+\"?filename=\"+image.original.name+\"&page=\"+page, {id:image.id, filename:image.original.name, page: page}).success(function(data, status, headers, config) {\n        if(angular.isFunction(callback)) {\n          callback(null, images);\n        }\n      }).\n      error(function(data, status, headers, config) {\n        $log.error (errors[0], data);\n        if(angular.isFunction(callback)) {\n          callback(data);\n        }\n      });\n    } else {\n      if(angular.isFunction(callback)) {\n        callback(null, images);\n      }\n    }\n  };\n\n  var add = function(imageBlocks, contentBlocks, callback) {\n    // $log.debug(\"add\");\n    uploadModal.$promise.then(uploadModal.show);\n\n    uploadModal = prepairUploadModal(uploadModal, imageBlocks, contentBlocks);\n\n    uploadModal.$scope.$on('modal.hide',function(){\n      $log.debug(\"upload modal closed\");\n      if(angular.isFunction(callback)) {\n        callback(null);\n      }\n    });\n  };\n\n  // Images for Content\n  var addBlock = function(imageBlocks, content, callback) {\n    imageBlocks[content.name] = [];\n    if(angular.isFunction(callback)) {\n      return callback(null, imageBlocks[content.name]);\n    }\n    return imageBlocks[content.name];\n  };\n\n  var edit = function(image, callback) {\n    $log.debug(\"edit\", image);\n    editModal.$scope.image = image;\n    //- Show when some event occurs (use $promise property to ensure the template has been loaded)\n    editModal.$promise.then(editModal.show);\n\n    editModal.$scope.$on('modal.hide',function(){\n      $log.debug(\"edit closed\");\n      if(angular.isFunction(callback)) {\n        callback(null, editModal.$scope.image);\n      }\n    });\n  };\n\n  var aspect = function (image, width)  {\n    var height, scale, aspectRatio, win, paddingTopBottom = 0, paddingLeftRight = 0;\n    if($scope.isFullScreen(image)) {\n      // customised jQuery Method of http://css-tricks.com/perfect-full-page-background-image/\n      aspectRatio = image.original.width / image.original.height;\n      win = $rootScope.getWindowDimensions();\n      if(win.width / win.height < aspectRatio) {\n        width = win.width; // width 100%\n        scale = image.original.width / width;\n        height = image.original.height / scale;\n        paddingTopBottom = (win.height - height) / 2;\n        height = win.height;\n      } else {\n        height = win.height;  // height 100%\n        scale = image.original.height / height;\n        width = image.original.width / scale;\n        paddingLeftRight = (win.width - width) / 2;\n        width = win.width;\n      }\n      return {width: width+'px', height: height+'px', 'padding-right': paddingLeftRight+\"px\", 'padding-left': paddingLeftRight+\"px\", 'padding-top': paddingTopBottom+\"px\", 'padding-bottom': paddingTopBottom+\"px\" };\n    } else {\n      scale = image.original.width / width;\n      height =  image.original.height / scale;\n      return {width: width+'px', height: height+'px'};\n    }\n  };\n\n  var subscribe = function () {\n    $sailsSocket.subscribe('gallery', function(msg) {\n      $log.debug(msg);\n      switch(msg.verb) {\n        case 'updated':\n          if($rootScope.authenticated) {\n            $log.debug('success', 'Ein Bild wurde aktualisiert', msg.data.original.name);\n            // $rootScope.pop('success', 'Ein Bild wurde aktualisiert', msg.data.original.name);\n          }\n        break;\n        case 'created':\n          // TODO not broadcast / fired why?!\n          if($rootScope.authenticated) {\n            $rootScope.pop('success', 'Ein Bild wurde hochgeladen', msg.data.original.name);\n          }\n          $scope.images.push(msg.data);\n        break;\n        case 'removedFrom':\n          if($rootScope.authenticated) {\n            $rootScope.pop('success', 'Ein Bild wurde entfernt', \"\");\n          }\n          $log.debug(msg.data);\n        break;\n        case 'destroyed':\n          // if($rootScope.authenticated) {\n          //   $rootScope.pop('success', 'Ein Bild wurde gelöscht', \"\");\n          // }\n          $log.debug(msg.data);\n        break;\n        case 'addedTo':\n          if($rootScope.authenticated) {\n            $rootScope.pop('success', 'Ein Bild wurde hinzugefügt', \"\");\n          }\n          $log.debug(msg.data);\n        break;\n      }\n    });\n  };\n\n  var resolve = function(page, content) {\n    var url = '/gallery?limit=0&page='+page;\n    if(content) {\n      url = url+'&content='+content;\n    }\n    return $sailsSocket.get(url).then (function (data) {\n      return $filter('orderBy')(data.data, 'position');\n    }, function error (resp) {\n      $log.error(resp);\n    });\n  };\n\n  return {\n    getDropdown: getDropdown,\n    setEditModal: setEditModal,\n    getEditModal: getEditModal,\n    setUploadModal: setUploadModal,\n    getUploadModal: getUploadModal,\n    saveOne: saveOne,\n    saveAll: saveAll,\n    saveAllBlocks: saveAllBlocks,\n    remove: remove,\n    add: add,\n    addBlock: addBlock,\n    edit: edit,\n    aspect: aspect,\n    subscribe: subscribe,\n    resolve: resolve\n  };\n});","angular.module('jumplink.cms.history', [\n  'ui.router',\n])\n/**\n * @see: https://github.com/angular-ui/ui-router/issues/92\n */\n.service('HistoryService', function ($window, $location, $state, $anchorScroll, $timeout, $log) {\n  var history = [];\n  var push = function(state, params) {\n    history.push({ state: state, params: params });\n  };\n\n  var all = function() {\n    return history;\n  };\n\n  var go = function(step) {\n    $log.debug('[jumplink.cms.history.HistoryService], history.length', history.length, 'step', step, 'history.length + step =', history.length + step);\n    // If the past has not been saved as far as the steps that we want to go back, then go to the beginning of time\n    if(history.length + step <= 0) {\n     return $location.path('/');\n    }\n    // TODOlocation    // (1) Determine # of states in stack with URLs, attempt to\n    //    shell out to $window.history when possible\n    // (2) Attempt to figure out some algorthim for reversing that,\n    //     so you can also go forward\n    var prev = this.previous(step || -1);\n    return $state.go(prev.state, prev.params);\n  };\n\n  var previous = function(step) {\n    return history[history.length - Math.abs(step || 1)];\n  };\n\n  var back = function() {\n    return this.go(-1);\n  };\n\n  var goToHashPosition = function (hash) {\n    // $log.debug(\"go to hash\", hash);\n    $location.hash(hash);\n    $anchorScroll.yOffset = 60;\n    $anchorScroll();\n  };\n\n  var autoScroll = function () {\n    var hash = $location.hash();\n    // $log.debug(\"hash\", hash);\n    if(hash) {\n      // WORKAROUND\n      $timeout(function(){ goToHashPosition(hash); }, 1000); // TODO smooth?\n    } else {\n      $anchorScroll();\n    }    \n  };\n\n  return {\n    push: push,\n    all: all,\n    go: go,\n    previous: previous,\n    back: back,\n    goToHashPosition: goToHashPosition,\n    autoScroll: autoScroll\n  };\n\n})\n.run(function(HistoryService, $state, $rootScope) {\n\n  $rootScope.$on(\"$stateChangeSuccess\", function(event, to, toParams, from, fromParams) {\n    if (!from.abstract) {\n      HistoryService.push(from, fromParams);\n    }\n  });\n  console.log(HistoryService);\n  HistoryService.push($state.current, $state.params);\n\n});","angular.module('jumplink.cms.importexport', [\n  'jumplink.cms.attachment',\n  'ngAsync',\n  'sails.io',\n])\n\n.service('ImportExportService', function ($sailsSocket, $async, $log, $filter) {\n\n\n  return {\n\n  };\n});","angular.module('jumplink.cms.info', [\n  'sails.io',\n])\n\n.service('CmsService', function ($log, $sailsSocket) {\n\n  var info = function(url, callback) {\n    var errors = [\n      \"[CmsService] Error: On trying to get cms info, url: \"+url,\n      \"[CmsService] Error: Result is null, url: \"+url\n    ];\n    var warns = [\n      \"[CmsService] Warn: Request has more than one results, url: \"+url\n    ];\n    return $sailsSocket.get(url).then (function (data) {\n      if(angular.isUndefined(data) || angular.isUndefined(data.data)) {\n        if(angular.isFunction(callback)) {\n          return callback(errors[1]);\n        }\n        return null;\n      }\n      if (data.data instanceof Array) {\n        data.data = data.data[0];\n        $log.warn(warns[0]);\n      }\n      if(angular.isFunction(callback)) {\n        return callback(null, data.data);\n      }\n      return data.data;\n    }, function error (resp){\n      $log.error(errors[0], resp);\n      if(angular.isFunction(callback)) {\n        return callback(errors[0], resp);\n      }\n      return resp;\n    });\n  };\n\n  // CMS Info for Users\n  var infoUser = function(callback) {\n    return info('/cms/infouser', callback);\n  };\n\n  var infoAdmin = function(callback) {\n    return info('/cms/infoadmin', callback);\n  };\n\n  var restart = function(callback) {\n    return $sailsSocket.post('/cms/restart').then (function (data) {\n      $log.debug(\"[CmsService.restart]\", data);\n      return callback(null, data);\n    }, function error (resp){\n      $log.error(\"[CmsService.restart]\", resp);\n      return callback(resp);\n    });\n  };\n\n\n  /**\n   * Public functions\n   */\n  return {\n    infoUser: infoUser,\n    infoAdmin: infoAdmin,\n    restart: restart,\n  };\n});","angular.module('jumplink.cms.multisite', [\n  'sails.io',\n  'jumplink.cms.sails'\n])\n.service('MultisiteService', function ($rootScope, JLSailsService, $log) {\n\n  var resolve = function(query, callback) {\n    // $log.debug(\"[MultisiteService.resolve]\");\n    var options = {\n      method: 'get',\n      resultIsArray: true\n    };\n    return JLSailsService.resolve('/multisite/find', query, options, callback);\n  };\n\n  var resolveNames = function(query, callback) {\n    // $log.debug(\"[MultisiteService.resolveNames]\");\n    var options = {\n      method: 'get',\n      resultIsArray: true\n    };\n    return JLSailsService.resolve('/multisite/findnames', query, options, callback);\n  };\n\n  var resolveHosts = function(query, callback) {\n    // $log.debug(\"[MultisiteService.resolveNames]\");\n    var options = {\n      method: 'get',\n      resultIsArray: true\n    };\n    return JLSailsService.resolve('/multisite/findhosts', query, options, callback);\n  };\n\n  return {\n    resolve: resolve,\n    resolveNames: resolveNames,\n    resolveHosts: resolveHosts\n  };\n});","angular.module('jumplink.cms.routes', [\n  'ui.router',                 // AngularUI Router: https://github.com/angular-ui/ui-router\n  'jumplink.cms.sails',\n  'jumplink.cms.sortable',\n  'jumplink.cms.utilities',\n  'ngDownload'\n])\n.provider('jlRoutes', function jlRoutesProvider($stateProvider, $urlRouterProvider, $locationProvider) {\n\n  this.html5Mode = $locationProvider.html5Mode;\n\n  this.otherwise = $urlRouterProvider.otherwise;\n\n  this.state = $stateProvider.state;\n\n  this.when = function (url1, url2) {\n    $urlRouterProvider.when(url1, url2);\n  };\n\n  this.setLayouts = function(layouts) {\n    for (var stateName in layouts ) {\n      this.state(stateName, layouts[stateName]);\n    }\n  };\n\n  this.setRoutes = function(routes, routeOptions) {\n    /**\n     * Load optional addional states.\n     * WARNING: Very experimental and dangerous.\n     */\n    for (var i = 0; i < routes.length; i++) {\n      // if is Main Route\n      if(routes[i].main) {\n        var options = {};\n        // set state main url\n        if(typeof(routes[i].url) === 'string' && routes[i].url.length > 0) {\n          options.url = routes[i].url;\n        }\n        // WARNING custom states are very experimental\n        if(routes[i].customstate === true) {\n          // TODO Dirty hack!\n          if(angular.isDefined(routes[i].state.resolve) && typeof(routes[i].state.resolve) === 'string' && routes[i].state.resolve.length > 0) {\n            eval(routes[i].state.resolve); // jshint ignore:line\n            options.resolve = resolve;\n          }\n          // TODO Dirty hack!\n          if(angular.isDefined(routes[i].state.views) && typeof(routes[i].state.views) === 'string' && routes[i].state.views.length > 0) {\n            eval(routes[i].state.views); // jshint ignore:line\n            options.views = view;\n          }\n        // states wich are defined in routeOptions\n        } else {\n          // set state options\n          if(angular.isDefined(routes[i].objectName) && angular.isDefined(routeOptions[routes[i].objectName])) {\n            // console.log(routeOptions[routes[i].objectName]);\n            if(angular.isObject(routeOptions[routes[i].objectName].resolve)) {\n              options.resolve = routeOptions[routes[i].objectName].resolve;\n            }\n            if(angular.isObject(routeOptions[routes[i].objectName].views)) {\n              options.views = routeOptions[routes[i].objectName].views;\n            }\n            \n          } else {\n            console.error(\"objectName \"+routes[i].objectName+\" not found for route \"+routes[i]);\n          } \n        }\n        // If options are set, init state\n        if(angular.isDefined(options.url) && angular.isDefined(options.views)) {\n          // console.log(\"New Route\", routes[i].state.name, options);\n          $stateProvider.state(routes[i].state.name, options);\n        }\n        //set alternative urls as redirects\n        if(angular.isArray(routes[i].alternativeUrls)) {\n          for (var a = 0; a < routes[i].alternativeUrls.length; a++) {\n            // e.g. $urlRouterProvider.when('/referenzen', '/referenzen/uebersicht');\n            console.log(\"New redirect: \"+routes[i].alternativeUrls[a]+\" -> \"+routes[i].url);\n            $urlRouterProvider.when(routes[i].alternativeUrls[a], routes[i].url);\n          }\n        }\n      } else {\n        // if route is not a main route\n        // if(typeof(routes[i].url) === 'string' && routes[i].url.length > 0) {\n        //   options.url = routes[i].url;\n        //   $urlRouterProvider.when(routes[i].alternativeUrls[a], routes[i].url);\n        // }\n        \n      }\n    }\n  };\n\n\n  this.$get = function jlRoutesFactory() {\n    // let's assume that the UnicornLauncher constructor was also changed to\n    // accept and use the useTinfoilShielding argument\n    return new jlRoutes();\n  };\n})\n.filter('showOnlyMainRoutes', function() {\n  // In the return function, we must pass in a single parameter which will be the data we will work on.\n  // We have the ability to support multiple other parameters that can be passed into the filter optionally\n  return function(routes, active) {\n    if(active !== true) {\n      return routes;\n    }\n    var result = [];\n    for (var i = 0; i < routes.length; i++) {\n      if(routes[i].main === true) {\n        result.push(routes[i]);\n      }\n    }\n    return result;\n  };\n})\n.service('RoutesService', function ($rootScope, $download, JLSailsService, $log, SortableService, UtilityService) {\n\n  var create = function(data) {\n    $log.debug(\"[RoutesService.create] data\", data);\n    if(!angular.isObject(data)) {\n      data = {};\n    }\n    if(!angular.isString(data.match)) {\n      data.match = \"\";\n    }\n    if(!angular.isString(data.title)) {\n      data.title = \"\";\n    }\n    if(data.main !== true && data.main !== false) {\n      data.main = false;\n    }\n    if(!angular.isString(data.url)) {\n      data.url = \"\";\n    }\n    if(!angular.isArray(data.alternativeUrls)) {\n      data.alternativeUrls = [];\n    }\n    if(angular.isUndefined(data.state) || !angular.isObject(data.state)) {\n      data.state = {};\n    }\n    if(!angular.isString(data.state.name)) {\n      data.state.name = \"\";\n    }\n    if(data.state.customstate !== true && data.state.customstate !== false) {\n      data.state.customstate = false;\n    }\n    if(!angular.isString(data.state.url)) {\n      data.state.url = \"\";\n    }\n    if(!angular.isString(data.state.views)) {\n      data.state.views = \"\";\n    }\n    if(!angular.isString(data.state.resolve)) {\n      data.state.resolve = \"\";\n    }\n    if(!angular.isObject(data.fallback)) {\n      data.fallback = {};\n    }\n    if(!angular.isString(data.fallback.url)) {\n      data.fallback.url = \"\";\n    }\n    return data;\n  };\n\n  var append = function(routes, data, callback) {\n    $log.debug(\"[RoutesService] data before\", data);\n    data = create(data);\n    $log.debug(\"[RoutesService] data after\", data);\n    SortableService.append(routes, data, callback);\n  };\n\n  var swap = function(routes, index_1, index_2, callback) {\n    return SortableService.swap(contents, index_1, index_2, callback);\n  };\n\n  var moveForward = function(index, routes, callback) {\n    return SortableService.moveForward(index, routes, callback);\n  };\n\n  var moveBackward = function(index, routes, callback) {\n    return SortableService.moveBackward(index, routes, callback);\n  };\n\n  var removeFromClient = function (routes, index, route, callback) {\n    if(angular.isFunction(callback)) {\n      return SortableService.remove(routes, index, route, callback);\n    }\n    return SortableService.remove(routes, index, route);\n  };\n\n  var remove = function(routes, index, route, callback) {\n    if((angular.isUndefined(route) || route === null) && angular.isDefined(index)) {\n      route = routes[index];\n    }\n    if(angular.isUndefined(index) || index === null) {\n      index = routes.indexOf(route);\n    }\n    routes = removeFromClient(routes, index, route);\n    // if route has an id it is saved on database, if not, not\n    if(route.id) {\n      $log.debug(\"[RoutesService.remove] remove from server, too\", route);\n      var options = {\n        method: 'delete',\n        resultIsArray: false\n      };\n      return JLSailsService.resolve('/routes/destroy/'+route.id, {id:route.id}, options, callback);\n    }\n  };\n\n  var find = function(query, callback) {\n    // $log.debug(\"[RoutesService.find]\");\n    var options = {\n      method: 'post',\n      resultIsArray: true\n    };\n    return JLSailsService.resolve('/routes/find', query, options, callback);\n  };\n\n  var findOne = function(query, callback) {\n    // $log.debug(\"[RoutesService.find]\");\n    var options = {\n      method: 'post',\n      resultIsArray: false\n    };\n    return JLSailsService.resolve('/routes/findOne', query, options, callback);\n  };\n\n\n  /**\n   * For superadminsd\n   */\n  var findByHost = function(query, callback) {\n    // $log.debug(\"[RoutesService.findByHost]\");\n    var options = {\n      method: 'post',\n      resultIsArray: true\n    };\n    return JLSailsService.resolve('/Routes/findByHost', query, options, callback);\n  };\n\n  /**\n   * For superadminsd\n   */\n  var exportByHost = function(host, download, callback) {\n    // $log.debug(\"[RoutesService.findByHost]\");\n    var options = {\n      method: 'post',\n      resultIsArray: true\n    };\n    \n    return JLSailsService.resolve('/Routes/exportByHost', {host: host}, options, function(err, data) {\n      $log.debug(\"[RoutesService.exportByHost]\", err, data);\n      if(err) {\n        if(download) {\n          $download(JSON.stringify(data), \"error.txt\", \"text/plain\");\n        }\n        return callback(err);\n      }\n      if(download) {\n        $download(JSON.stringify(data), \"routes.json\", \"text/json\");\n      }\n      return callback(err, data);\n    });\n  };\n\n  /**\n   * Update or create route (eg. position) for current host.\n   */\n  var updateOrCreate = function(route, callback) {\n    $log.debug(\"[RoutesService.updateOrCreate]\", route);\n    var options = {\n      method: 'post',\n      resultIsArray: false\n    };\n    return JLSailsService.resolve('/Routes/updateOrCreate', {route: route}, options, callback);\n  };\n\n  /**\n   * Update or create route for any passed host.\n   * Only for superadmins!\n   *\n   * @param req.param.host Host to save route for\n   */\n  var updateOrCreateByHostByObjectNameAndNavbar = function(host, route, callback) {\n    $log.debug(\"[RoutesService.updateOrCreateByHostByObjectNameAndNavbar]\", host, route);\n    var options = {\n      method: 'post',\n      resultIsArray: false\n    };\n    return JLSailsService.resolve('/Routes/updateOrCreateByHostByObjectNameAndNavbar', {host: host, route: route}, options, callback);\n  };\n\n  /**\n   * Update or create route (eg. position) for any passed host.\n   * Only for superadmins!\n   *\n   * @param req.param.host Host to save route for\n   */\n  var updateOrCreateByHost = function(host, route, callback) {\n    $log.debug(\"[RoutesService.updateOrCreateByHost]\", host, route);\n    var options = {\n      method: 'post',\n      resultIsArray: false\n    };\n    return JLSailsService.resolve('/Routes/updateOrCreateByHost', {host: host, route: route}, options, callback);\n  };\n\n  /**\n   * Update or create each route (eg. position) for current host.\n   */\n  var updateOrCreateEach = function(routes, callback) {\n    $log.debug(\"[RoutesService.updateOrCreateEach]\", routes);\n    var options = {\n      method: 'post',\n      resultIsArray: true\n    };\n    return JLSailsService.resolve('/Routes/updateOrCreateEach', {routes: routes}, options, callback);\n  };\n\n  /**\n   * Update or create each route (eg. position) for any passed host.\n   * Only for superadmins!\n   *\n   * @param req.param.host Host to save route for\n   */\n  var updateOrCreateEachByHost = function(host, routes, callback) {\n    $log.debug(\"[RoutesService.updateOrCreateEachByHost]\", host, routes);\n    var options = {\n      method: 'post',\n      resultIsArray: true\n    };\n    return JLSailsService.resolve('/Routes/updateOrCreateEachByHost', {host: host, routes: routes}, options, callback);\n  };\n\n  var generateObjectnameFromStatename = function (statename) {\n    $log.debug(\"[RoutesController.generateObjectnameFromStatename]\", statename);\n    var objectname = \"\";\n    var keys = statename.split('.');\n    for (var k = 0; k < keys.length; k++) {\n      objectname += UtilityService.capitalizeFirstLetter(keys[k]);\n    }\n    objectname = UtilityService.lowercaseFirstLetter(objectname);\n    return objectname;\n  };\n\n  var generateObjectnameFromUrl = function (url) {\n    var objectname = \"\";\n    var keys = url.split('/');\n    for (var k = 0; k < keys.length; k++) {\n      objectname += UtilityService.capitalizeFirstLetter(keys[k]);\n    }\n    objectname = UtilityService.lowercaseFirstLetter(objectname);\n    $log.debug(\"[RoutesController.generateObjectnameFromUrl]\", url, keys, objectname, objectname.length);\n    return objectname;\n  };\n\n  return {\n    create: create,\n    append: append,\n    swap: swap,\n    moveForward: moveForward,\n    moveBackward: moveBackward,\n    removeFromClient: removeFromClient,\n    remove: remove,\n    destroy: remove, // Alias\n    find: find,\n    findOne: findOne,\n    findByHost: findByHost,\n    exportByHost: exportByHost,\n    updateOrCreate: updateOrCreate,\n    updateOrCreateByHostByObjectNameAndNavbar: updateOrCreateByHostByObjectNameAndNavbar,\n    updateOrCreateByHost: updateOrCreateByHost,\n    updateOrCreateEach: updateOrCreateEach,\n    updateOrCreateEachByHost: updateOrCreateEachByHost,\n    saveEachByHost: updateOrCreateEachByHost, // Alias\n    generateObjectnameFromStatename: generateObjectnameFromStatename,\n    generateObjectnameFromUrl: generateObjectnameFromUrl,\n  };\n});","angular.module('jumplink.cms.sails', [\n    'sails.io',\n  ])\n\n  .service('JLSailsService', function ($rootScope, $sailsSocket, $q, $log) {\n\n    var resolve = function(url, query, options, callback, next) {\n      var deferred = $q.defer();\n      var errors = [\n        \"On trying to resolve \"+url,\n        \"Request has more than one results\",\n        \"No result\"\n      ];\n      if(angular.isUndefined(options)) {\n        options = {};\n      }\n      if(angular.isUndefined(options.method)) {\n        options.method = 'get';\n      }\n      if(angular.isUndefined(options.resultIsArray)) {\n        options.resultIsArray = false;\n      }\n      if(angular.isUndefined(query)) {\n        query = {};\n      }\n      // $log.debug(\"[JLSailsService.resolve]\", url, query, options);\n      $sailsSocket[options.method](url, query).then (function (data) {\n        if(angular.isUndefined(data) || angular.isUndefined(data.data)) {\n          if(angular.isFunction(callback)) {\n            return callback(null, null);\n          }\n          return deferred.resolve(null);\n        }\n        if (!options.resultIsArray && angular.isArray(data.data)) {\n          data.data = data.data[0];\n          $log.warn(errors[1]);\n        }\n        // data.data.content = html_beautify(data.data.content);\n        if(next) {\n          data.data = next(data.data);\n        }\n        if(angular.isFunction(callback)) {\n          callback(null, data.data);\n        }\n        return deferred.resolve(data.data);\n      }, function error (resp){\n        $log.error(errors[0], resp);\n        if(angular.isFunction(callback)) {\n          return callback(errors[0], resp);\n        }\n        return deferred.reject(errors[0]);\n      });\n      return deferred.promise;\n    };\n    return {\n      resolve: resolve,\n    };\n  })\n;","angular.module('jumplink.cms.session', [\n  'sails.io',\n  'jumplink.cms.sails'\n])\n.service('SessionService', function ($rootScope, JLSailsService, $sailsSocket, $q, $log) {\n\n  var create = function(user, callback) {\n    $log.debug(\"[SessionService.create]\", user);\n    var options = {\n      method: 'post',\n      resultIsArray: false\n    };\n    return JLSailsService.resolve('/session/create', user, options, callback);\n  };\n\n  var destroy = function(user, callback) {\n    $log.debug(\"[SessionService.destroy]\", user);\n    var options = {\n      method: 'post',\n      resultIsArray: false\n    };\n    return JLSailsService.resolve('/session/destroy', user, options, callback);\n  };\n\n  /**\n   * Check if user is authentication in current cms session\n   * Used if you need authentication conditions\n   */\n  var isAuthenticated = function (callback) {\n    $log.log(\"[SessionService.isauthenticated]\");\n    var deferred = $q.defer();\n    return $sailsSocket.get('/session/authenticated').then (function (data) {\n      if(angular.isFunction(callback)) {\n        return callback(null, data.data);\n      }\n      return data.data;\n    });\n  };\n\n  /**\n   * Used for routes you can only visit if you are signed in, throws an error message if your are not authenticated\n   */\n  var needToBeAuthenticated = function () {\n    $log.log(\"[SessionService.needToBeAuthenticated] authenticated\");\n    var deferred = $q.defer();\n    $sailsSocket.get('/session/authenticated').then (function (data) {\n      if (data.data) {\n        $log.log(\"is authenticated\", data);\n        return deferred.resolve(data.data);\n      } else {\n        $log.log(\"is not authenticated\", data);\n        return deferred.reject('You need to be logged in');\n      }\n    });\n    return deferred.promise;\n  };\n\n  /**\n   * Check if authentifcated user is blogger or better\n   */\n  var bloggerOrBetter = function (callback) {\n    $log.log(\"[SessionService.bloggerOrBetter]\");\n    var deferred = $q.defer();\n    return $sailsSocket.get('/session/bloggerOrBetter').then (function (data) {\n      if(angular.isFunction(callback)) {\n        return callback(null, data.data);\n      }\n      return data.data;\n    });\n  };\n\n  /**\n   * Check if cms is in developer mode or session user is better than that\n   */\n  var developerOrBetter = function (callback) {\n    $log.log(\"[SessionService.developerOrBetter]\");\n    var deferred = $q.defer();\n    return $sailsSocket.get('/session/developerOrBetter').then (function (data) {\n      if(angular.isFunction(callback)) {\n        return callback(null, data.data);\n      }\n      return data.data;\n    });\n  };\n\n  /**\n   * Check if authentifcated user is siteadmin or better\n   */\n  var siteadminOrBetter = function (callback) {\n    $log.log(\"[SessionService.siteadminOrBetter]\");\n    var deferred = $q.defer();\n    return $sailsSocket.get('/session/siteadminOrBetter').then (function (data) {\n      if(angular.isFunction(callback)) {\n        return callback(null, data.data);\n      }\n      return data.data;\n    });\n  };\n\n  /**\n   * Check if authentifcated user is superadmin\n   */\n  var superadmin = function (callback) {\n    $log.log(\"[SessionService.superadmin]\");\n    var deferred = $q.defer();\n    return $sailsSocket.get('/session/superadmin').then (function (data) {\n      if(angular.isFunction(callback)) {\n        return callback(null, data.data);\n      }\n      return data.data;\n    });\n  };\n\n  /**\n   * Check if authentifcated user is an employee\n   */\n  var employee = function (callback) {\n    $log.log(\"[SessionService.employee]\");\n    var deferred = $q.defer();\n    return $sailsSocket.get('/session/employee').then (function (data) {\n      if(angular.isFunction(callback)) {\n        return callback(null, data.data);\n      }\n      return data.data;\n    });\n  };\n\n  /**\n   * Check if authentifcated user is an employee or better\n   */\n  var employeeOrBetter = function (callback) {\n    $log.log(\"[SessionService.employee]\");\n    var deferred = $q.defer();\n    return $sailsSocket.get('/session/employeeOrBetter').then (function (data) {\n      if(angular.isFunction(callback)) {\n        return callback(null, data.data);\n      }\n      return data.data;\n    });\n  };\n\n  /**\n   * Used for routes you can only visit if you are signed in and user employee or better, throws an error message if your are not employee or better\n   */\n  var needToBeEmployeeOrBetter = function (callback) {\n    $log.log(\"[SessionService.authenticated] authenticated\");\n    var deferred = $q.defer();\n    $sailsSocket.get('/session/employeeOrBetter').then (function (data) {\n      if (data.data) {\n        $log.log(\"is employeeOrBetter\", data);\n        return deferred.resolve(data.data);\n      } else {\n        $log.log(\"is not employeeOrBetter\", data);\n        return deferred.reject('You must be an employee or a user with more credentials to do that');\n      }\n    });\n    return deferred.promise;\n  };\n\n  /**\n   * Used for routes you can only visit if you are signed in and user is admin or better, throws an error message if your are not employee or better\n   */\n  var needToBeSiteadminOrBetter = function (callback) {\n    $log.log(\"[SessionService.authenticated] authenticated\");\n    var deferred = $q.defer();\n    $sailsSocket.get('/session/siteadminOrBetter').then (function (data) {\n      if (data.data) {\n        $log.log(\"is siteadminOrBetter\", data);\n        return deferred.resolve(data.data);\n      } else {\n        $log.log(\"is not employeeOrBetter\", data);\n        return deferred.reject('You must be an admin or a user with more credentials to do that');\n      }\n    });\n    return deferred.promise;\n  };\n  /**\n   * \n   */\n  var getAllPolicies = function (callback) {\n    $log.log(\"[SessionService.getAllPolicies]\");\n    var deferred = $q.defer();\n    return $sailsSocket.get('/session/getAllPolicies').then (function (data) {\n      if(angular.isFunction(callback)) {\n        return callback(null, data.data);\n      }\n      return data.data;\n    });\n  };\n\n  /**\n   * Get logged in user\n   */\n  var getUser = function (callback) {\n    $log.log(\"[SessionService.getUser]\");\n    var deferred = $q.defer();\n    return $sailsSocket.get('/session/getUser').then (function (data) {\n      if(angular.isFunction(callback)) {\n        return callback(null, data.data);\n      }\n      return data.data;\n    });\n  };\n\n  return {\n    create: create,\n    destroy: destroy,\n    authenticated: needToBeAuthenticated, //alias TODO remove\n    needToBeAuthenticated: needToBeAuthenticated,\n    isAuthenticated: isAuthenticated, // TODO rename to authenticated\n    bloggerOrBetter: bloggerOrBetter,\n    developerOrBetter: developerOrBetter,\n    siteadminOrBetter: siteadminOrBetter,\n    superadmin: superadmin,\n    employee: employee,\n    employeeOrBetter: employeeOrBetter,\n    needToBeEmployeeOrBetter: needToBeEmployeeOrBetter,\n    needToBeSiteadminOrBetter: needToBeSiteadminOrBetter,\n    getAllPolicies: getAllPolicies,\n    getUser: getUser\n  };\n});","angular.module('jumplink.cms.sidebar', [\n    'mgcrea.ngStrap.aside',\n  ])\n\n  .directive('jlSidebar', function ($compile, $window) {\n\n    return {\n      restrict: 'E',\n      replace: true,\n      transclude: true,\n      templateUrl: '/views/modern/sidebar.jade',\n      scope: {\n        routes: \"=\",\n        title: \"=\" \n      },\n      link: function ($scope, $element, $attrs) {\n        \n      }\n    };\n  });","angular.module('jumplink.cms.signin', [\n  'jumplink.cms.session',\n  'jumplink.cms.history',\n  'ngAsync'\n])\n.service('SigninService', function (SessionService, $log, HistoryService, $async) {\n\n\n  var getRoles = function (scope, callback) {\n    $async.parallel({\n      authenticated: function(callback) {\n        SessionService.isAuthenticated(callback);\n      },\n      bloggerOrBetter: function(callback) {\n        SessionService.bloggerOrBetter(callback);\n      },\n      siteadminOrBetter: function(callback) {\n        SessionService.siteadminOrBetter(callback);\n      },\n      employeeOrBetter: function(callback) {\n        SessionService.employeeOrBetter(callback);\n      }\n    },\n    callback);\n  };\n\n  var signin = function (user, goBackAfterSignin, extendRoles, scope, callback) {\n    if(angular.isFunction(goBackAfterSignin) && !angular.isFunction(callback)) {\n      callback = goBackAfterSignin;\n      goBackAfterSignin = false;\n    }\n\n    if(angular.isFunction(extendRoles) && !angular.isFunction(callback)) {\n      callback = extendRoles;\n      extendRoles = false;\n    }\n\n    if(angular.isFunction(scope) && !angular.isFunction(callback)) {\n      callback = scope;\n      scope = null;\n    }\n\n    $log.debug(\"[SigninService.signin]\", user);\n    // $scope.user.role = 'superadmin';\n    SessionService.create(user, function (err, result) {\n      if(err) {\n        return callback(err);\n      }\n      if(!result.authenticated) {\n        return null;\n      }\n      if(extendRoles === true) {\n        SessionService.getAllPolicies(function (err, results) {\n          if(err) {\n            return callback(err);\n          }\n          $log.debug(\"scope before extend\", scope);\n          angular.extend(scope, results);\n          $log.debug(\"scope after extend\", scope);\n          if(goBackAfterSignin === true) {\n            HistoryService.back();\n          }\n        });\n      }\n      if(goBackAfterSignin === true) {\n        HistoryService.back();\n      }\n\n      $log.debug(\"[SigninService.signin]\", user);\n      $log.debug(\"[SigninService.signin] err result\", err, result);\n      return callback(null, result);\n    });\n  };\n  return {\n    signin: signin\n  };\n});","angular.module('jumplink.cms.sortable', [\n    'jumplink.cms.utilities'\n  ])\n  .service('SortableService', function (UtilityService, $log, $filter) {\n    var resetPosition = function (array) {\n      for (var i = array.length - 1; i >= 0; i--) {\n        array[i].position = i+1;\n      }\n      return array;\n    };\n\n    var sort = function(objects) {\n      return $filter('orderBy')(objects, 'position');\n    };\n\n    /*\n     * Swap two elements within the object array (called objects) and adjust the position\n     */\n    var swap = function(objects, index_1, index_2, cb) {\n\n      var object_1 = objects[index_1];\n      var object_2 = objects[index_2];\n\n      // swap position too\n      var position_tmp = object_1.position;\n      object_1.position = object_2.position;\n      object_2.position = position_tmp;\n\n      // IMPORTANT: swap Indexes, too\n      objects[index_1] = object_2;\n      objects[index_2] = object_1;\n\n      if(angular.isFunction(cb)) {\n        return cb(null, objects);\n      }\n      return objects;\n    };\n\n    /*\n     * Insert new object to position and move the underlying objects one index back\n     * http://stackoverflow.com/questions/5306680/move-an-array-element-from-one-array-position-to-another\n     */\n    var move = function (array, old_index, new_index, cb) {\n      $log.debug(\"[SortableService] move\");\n\n      if (new_index >= array.length) {\n          var k = new_index - array.length;\n          while ((k--) + 1) {\n              array.push(undefined);\n          }\n      }\n      array.splice(new_index, 0, array.splice(old_index, 1)[0]);\n\n      array = resetPosition(array);\n\n      if(angular.isFunction(cb)) {\n        cb(null, array);\n      }\n      return array;\n    };\n\n    /*\n     * Append a new object to array, check unique key value if set\n     */\n    var append = function(objects, data, cb, unique, uniqueKey) {\n      $log.debug(\"[SortableService.append] data\", data);\n      var errors = [\n        \"Unique key '\"+uniqueKey+\"' already exist\"\n      ];\n      var new_index = objects.length;\n      var new_position = 1;\n      var new_object;\n      var uniqueIndex = -1;\n\n      var okay = function (new_object, objects, new_index, cb) {\n        // $log.debug(\"old objects\", objects);\n        objects.push(new_object);\n        // $log.debug(\"new objects\", objects);\n        if(angular.isFunction(cb)) {\n          return cb(null, objects, new_index);\n        }\n        return objects;\n      };\n\n      var error = function (error, objects, uniqueIndex, cb) {\n        if(angular.isFunction(cb)) {\n          return cb(error, objects, uniqueIndex);\n        }\n        return error;\n      };\n\n      if(new_index >= 1) {\n        new_position = objects[new_index-1].position+1;\n      }\n\n      new_object = {\n        position: new_position,\n      };\n\n      new_object = angular.extend(new_object, data);\n      $log.debug(\"[SortableService.append] new_object\", new_object);\n\n      if(unique && new_object[uniqueKey]) {\n        uniqueIndex = UtilityService.findKeyValue(objects, uniqueKey, new_object[uniqueKey]);\n        if(uniqueIndex > -1) {\n          return error(errors[0], objects, uniqueIndex, cb);\n        } else {\n          return okay(new_object, objects, new_index, cb);\n        }\n      } else {\n        return okay(new_object, objects, new_index, cb);\n      }\n    };\n\n    /*\n     * removed object from an array and adds it in another\n     */\n    var moveObjectToAnotherArray = function(object, index_from, array_from, array_to, cb, replaceData) {\n      var errors = [\n        \"[SortableService] Error: Function parameters not correctly set\"\n      ];\n\n      var errorParamsNotSet = function () {\n        $log.error(errors[0], object, index_from, array_from, array_to);\n        return cb(errors[0]);\n      };\n\n      if(object === null) {\n        object = array_from[index_from];\n      } else if (index_from === null) {\n        index_from = array_from.indexOf(object);\n      } else {\n        errorParamsNotSet();\n      }\n\n      if(!angular.isArray(array_from) || !angular.isArray(array_to)) {\n        errorParamsNotSet();\n      }\n\n      append(array_to, object, function (err, array_to, index_to) {\n        if(err) {\n          return cb(err);\n        }\n        remove(array_from, index_from, object, function (err, array_from) {\n          if(err) {\n            return cb(err);\n          }\n          return cb(null, {index_from: index_from, array_from: array_from, index_to:index_to, array_to: array_to });\n        });\n      }, false );\n    };\n\n    var moveForward = function(index, objects, cb) {\n      if(index + 1 < objects.length ) {\n        return swap(objects, index, index+1, cb);\n      }\n      if(angular.isFunction(cb)) {\n        return cb(\"Can't move forward, index is the last element.\", objects);\n      }\n      return objects;\n    };\n\n    var moveBackward = function(index, objects, cb) {\n      if(index - 1 >= 0) {\n        return swap(objects, index, index-1, cb);\n      }\n      if(angular.isFunction(cb)) {\n        return cb(\"Can't move backward, index is the first element.\", objects);\n      }\n      return objects;\n    };\n\n    var remove = function (objects, index, object, cb) {\n      if(typeof(index) === 'undefined' || index === null) {\n        index = objects.indexOf(object);\n      }\n      // $log.debug(\"remove from client\", index, object);\n      if (index > -1) {\n        objects.splice(index, 1);\n      }\n      if(angular.isFunction(cb)) {\n        return cb(null, objects);\n      }\n      return objects;\n    };\n\n    /*\n     * find value by key in array\n     */\n    var findKeyValue = function (objects, key, value) {\n      // $log.debug(\"findKeyValue\", key, value);\n      var index = -1;\n      for (var i = objects.length - 1; i >= 0 && index <= -1; i--) {\n        if(objects[i][key] === value) {\n          index = i;\n        } \n      }\n      return index;\n    };\n\n    /*\n     * Function for Drag and Drop functionality.\n     * Moves an moveable element with the moveFunction (e.g. to swap or insert the obkect).\n     * Usually called when the mouse button is released over an existing moveable element.\n     */\n    var dropMove = function(objects, dropObjectIndex, dragObject, event, cb, moveFunction) {\n      if(!moveFunction) {\n        moveFunction = move; // swap | move\n      }\n      var dragObjectIndex = objects.indexOf(dragObject);\n      var dropObject = objects[dropObjectIndex];\n      $log.debug(\"[SortableService] dropMove, dragObject:\", dragObject, \"dragObjectIndex\", dragObjectIndex, \"dropObject\", dropObject, \"dropObjectIndex\", dropObjectIndex);\n      return moveFunction(objects, dragObjectIndex, dropObjectIndex, cb);\n    };\n\n    return {\n      resetPosition: resetPosition,\n      sort: sort,\n      swap: swap,\n      moveObjectToAnotherArray: moveObjectToAnotherArray,\n      move: move,\n      moveForward: moveForward,\n      moveBackward: moveBackward,\n      remove: remove,\n      append: append,\n      dropMove: dropMove,\n    };\n  })\n\n;","angular.module('jumplink.cms.subnavigation', [\n  'mgcrea.ngStrap',\n  'sails.io',\n  'jumplink.cms.sortable',\n  'ngFocus',\n  'jumplink.cms.utilities'\n])\n\n.service('SubnavigationService', function ($rootScope, $window, $log, $sailsSocket, $filter, $modal, SortableService, UtilityService, focus) {\n\n  var editModal = null;\n\n  var setEditModal = function($scope) {\n    editModal = $modal({scope: $scope, title: 'Navigation bearbeiten', templateUrl: '/views/modern/editsubnavigationmodal.jade', show: false});\n    return getEditModal();\n  };\n\n  var getEditModal = function() {\n    return editModal;\n  };\n\n  var subscribe = function() {\n    // called on content changes\n    $sailsSocket.subscribe('navigation', function(msg){\n      $log.debug(\"[SubnavigationService] Navigation event!\", msg);\n      switch(msg.verb) {\n        case 'updated':\n          if($rootScope.authenticated) {\n            $rootScope.pop('success', 'Navigation wurde aktualisiert', msg.id);\n          }\n        break;\n      }\n    });\n  };\n\n  // WORKAROUND wait until image is loaded to fix bs-sidebar\n  var resizeOnImagesLoaded = function () {\n    angular.element($window).imagesLoaded(function() {\n      angular.element($window).triggerHandler('resize');\n    });\n  };\n\n  var create = function(data) {\n    if(!data || !data.target) {\n      data.target = \"\";\n    }\n    if(!data || !data.name) {\n      data.name = \"\";\n    }\n    if(!data || !data.page) {\n      cb(\"Page not set.\");\n    }\n    return data;\n  };\n\n  var append = function(navs, data, cb) {\n\n    data = create(data);\n\n    // $log.debug(\"[SubnavigationService] data\", data);\n\n    SortableService.append(navs, data, cb);\n  };\n\n  var swap = function(navs, index_1, index_2, cb) {\n    return SortableService.swap(contents, index_1, index_2, cb);\n  };\n\n  var moveForward = function(index, navs, cb) {\n    return SortableService.moveForward(index, navs, cb);\n  };\n\n  var moveBackward = function(index, navs, cb) {\n    return SortableService.moveBackward(index, navs, cb);\n  };\n\n  var edit = function(navs, cb) {\n    // $log.debug(\"[SubnavigationService] edit subnavigations\", navs);\n    editModal.$scope.navs = navs;\n    //- Show when some event occurs (use $promise property to ensure the template has been loaded)\n    editModal.$promise.then(editModal.show);\n\n    if(angular.isDefined(editModal.$scope.navs) && editModal.$scope.navs.length > 0) {\n      var index = Number(editModal.$scope.navs.length-1);\n      // $log.debug(\"[SubnavigationService] focus last subnavigationeditname\", index);\n      focus('subnavigationeditname'+index);\n    }\n\n    editModal.$scope.$on('modal.hide',function(){\n      // $log.debug(\"[SubnavigationService] edit navigation modal closed\");\n      cb(null, editModal.$scope.navs);\n    });\n  };\n\n  var removeFromClient = function (navs, index, nav, cb) {\n    if(angular.isFunction(cb)) {\n      return SortableService.remove(navs, index, nav, cb);\n    }\n    return SortableService.remove(navs, index, nav);\n  };\n\n  var remove = function(navs, index, nav, page, cb) {\n\n    if((angular.isUndefined(nav) || nav === null) && angular.isDefined(index)) {\n      nav = navs[index];\n    }\n\n    if(angular.isUndefined(index) || index === null) {\n      index = navs.indexOf(nav);\n    }\n\n    navs = removeFromClient(navs, index, nav);\n    // if nav has an id it is saved on database, if not, not\n    if(nav.id) {\n      $log.debug(\"[SubnavigationService] remove from server, too\" ,nav);\n      $sailsSocket.delete('/navigation/'+nav.id+\"?page=\"+page, {id:nav.id, page: page}).success(function(data, status, headers, config) {\n        if(angular.isFunction(cb)) {\n          return cb(null, navs);\n        }\n      }).\n      error(function(data, status, headers, config) {\n        $log.error (errors[0], data);\n        if(angular.isFunction(cb)) {\n          return cb(data);\n        }\n      });\n    }\n  };\n\n  var removeByTarget = function (navs, target, page, cb) {\n    $log.debug(\"[SubnavigationService] remove subnavigation by target \"+target);\n    var index = UtilityService.findKeyValue(navs, 'target', target);\n    if(index > -1) {\n      $log.debug(\"[SubnavigationService] subnavigation found \"+index);\n      remove(navs, index, null, page, cb);\n    } else {\n      if(angular.isFunction(cb)) {\n        cb(\"Subnavigation not found\");\n      }\n    }\n  };\n\n  var fix = function(fixed, object, index, cb) {\n    if(angular.isDefined(object.name) && angular.isString(object.name) && object.name !== \"\") {\n      fixed.push(object);\n    } else {\n      $log.warn(\"Name not set, remove Subnavigation\");\n    }\n    if(angular.isFunction(cb)) {\n      return cb(null, fixed);\n    }\n    return fixed;\n  };\n\n  var fixEach = function(objects, cb) {\n    var fixed = [];\n    for (var i = objects.length - 1; i >= 0; i--) {\n      fixed = fix(fixed, objects[i], i);\n    }\n    if(angular.isFunction(cb)) {\n      return cb(null, fixed);\n    }\n    return fixed;\n  };\n\n  var save = function(navs, page, cb) {\n    fixEach(navs, function(err, navs) {\n      $sailsSocket.put('/navigation/replaceall', {navs: navs, page: page}).success(function(data, status, headers, config) {\n        if(data !== null && typeof(data) !== \"undefined\") {\n          // WORKAROUND until socket event works\n          navs = $filter('orderBy')(data, 'position');\n          if(angular.isFunction(cb)) {\n            cb(null, navs);\n          }\n        } else {\n          var err = 'Navigation konnte nicht gespeichert werden';\n          $rootScope.pop('error', err, \"\");\n          if(angular.isFunction(cb)) {\n            cb(err, navs);\n          } \n        }\n      });\n    });\n  };\n\n  var resolve = function(page) {\n    var statename = 'layout.gallery';\n    return $sailsSocket.get('/navigation?page='+page, {page: page}).then (function (data) {\n      if(angular.isUndefined(data) || angular.isUndefined(data.data)) {\n        $log.warn(\"Warn: On trying to resolve \"+page+\" navs!\", \"Not found, navigation is empty!\");\n        return null;\n      }\n      data.data = $filter('orderBy')(data.data, 'position');\n      $log.debug(\"[SubnavigationService]\", data);\n      return data.data;\n    }, function error (resp){\n      $log.error(\"[SubnavigationService] Error: On trying to resolve \"+page+\" navs!\", resp);\n    });\n  };\n\n  return {\n    resizeOnImagesLoaded: resizeOnImagesLoaded,\n    subscribe: subscribe,\n    setEditModal: setEditModal,\n    getEditModal: getEditModal,\n    create: create,\n    append: append,\n    add: append,\n    swap: swap,\n    moveForward: moveForward,\n    moveBackward: moveBackward,\n    edit: edit,\n    removeFromClient: removeFromClient,\n    remove: remove,\n    removeByTarget: removeByTarget,\n    save: save,\n    resolve: resolve\n  };\n})\n\n.directive('jlSubnavigation', function ($compile, $window, SubnavigationService, HistoryService) {\n\n  return {\n    restrict: 'E',\n    templateUrl: '/views/modern/subnavigation.bootstrap.jade',\n    scope: {\n      authenticated : \"=\",\n      navs: \"=\",\n      afterSave: \"=?\",\n      afterRemove: \"=?\",\n      afterEdit: \"=?\",\n      afterAdd: \"=?\",\n      logger: \"=\",\n      page: \"=?\"\n\n    },\n    link: function ($scope, $element, $attrs) {\n    },\n    controller: function ($rootScope, $scope, ContentService, $log, $state) {\n\n      SubnavigationService.setEditModal($scope);\n      $scope.goTo = HistoryService.goToHashPosition;\n      SubnavigationService.subscribe();\n      // SubnavigationService.resizeOnImagesLoaded();\n\n      if(angular.isUndefined($scope.page)) {\n        $scope.page = $state.current.name;\n      }\n\n      if(angular.isUndefined($scope.afterSave)) {\n        $scope.afterSave = function (err, result) {\n          if(err) {\n            return $scope.logger('error', \"Navigation wurde nicht gespeichert!\", err);\n          }\n          $scope.logger('success', \"Navigation gespeichert!\", result.title);\n        };\n      }\n\n      if(angular.isUndefined($scope.afterRemove)) {\n        $scope.afterRemove = function (err, result) {\n          if(err) {\n            return $scope.logger('error', \"Navigation wurde nicht entfernt!\", err);\n          }\n          $scope.logger('success', \"Navigation entfernt!\", result.title);\n        };\n      }\n\n      if(angular.isUndefined($scope.afterEdit)) {\n        $scope.afterEdit = function (err, result) {\n          if(err) {\n            return $scope.logger('error', \"Navigation wurde nicht bearbeitet!\", err);\n          }\n          $scope.logger('success', \"Navigation bearbeitet!\", result.title);\n        };\n      }\n\n      if(angular.isUndefined($scope.afterAdd)) {\n        $scope.afterAdd = function (err, result) {\n          if(err) {\n            return $scope.logger('error', \"Navigation wurde nicht hinzugefügt!\", err);\n          }\n          $scope.logger('success', \"Navigation hinzugefügt!\", result.title);\n        };\n      }\n\n      $scope.add = function() {\n        if(!$scope.authenticated) {\n          return false;\n        }\n        SubnavigationService.add($scope.navs, {page:page}, $scope.afterAdd);\n      };\n      $scope.addNav = $scope.add; // alias\n\n      $scope.moveForward = function(index, nav) {\n        SortableService.moveForward(index, $scope.navs, function(err, navs) {\n          if(err) {\n            $log.error(\"Error: On move subnavigation forward!\", err);\n            return err;\n          }\n          $scope.navs = navs;\n        });\n      };\n      $scope.moveForwardNav = $scope.moveForward; // alias\n\n      $scope.moveBackward = function(index, nav) {\n        SortableService.moveBackward(index, $scope.navs, function(err, navs) {\n          if(err) {\n            $log.error(\"Error: On move content backward!\", err);\n            return err;\n          }\n          $scope.navs = navs;\n        });\n      };\n      $scope.moveBackwardNav = $scope.moveBackward; // alias\n\n      $scope.edit = function(navs) {\n        if(!$scope.authenticated) {\n          return false;\n        }\n        SubnavigationService.edit(navs, $scope.afterEdit);\n      };\n      $scope.editNavs = $scope.edit; // alias\n\n      $scope.remove = function(index, nav) {\n        if(!$scope.authenticated) {\n          return false;\n        }\n        SubnavigationService.remove($scope.navs, index, nav, page, $scope.afterRemove);\n      };\n      $scope.removeNav = remove; // alias\n\n      $scope.save = function () {\n        SubnavigationService.save($scope.navs, page, $scope.afterSave);\n      };\n\n\n      // TODO move to own drag and drops sortable navigation directive \n      $scope.onDragOnComplete = function(index, nav, evt) {\n        if(nav === null) {\n          $log.debug(\"*click*\", index);\n        }\n        $log.debug(\"onDragOnComplete, nav:\", nav, \"index\", index);\n      };\n      $scope.onDragOnNavComplete = $scope.onDragOnComplete; // alias\n\n      $scope.onDropOnComplete = function(dropnavindex, dragnav, event) {\n        SortableService.dropMove($scope.navs, dropnavindex, dragnav, event, function(err, navs) {\n          $scope.navs = navs;\n        });\n      };\n      $scope.onDropOnNavComplete = $scope.onDropOnComplete; // alias\n\n      $scope.onDropOnAreaComplete = function(nav, evt) {\n        var index = $scope.navs.indexOf(nav);\n      };\n\n    }\n  };\n});","angular.module('jumplink.cms.theme', [\n  'sails.io',\n  'ngAsync',\n  'jumplink.cms.sails',\n])\n\n.service('ThemeService', function ($rootScope, $sailsSocket, $log, $async, JLSailsService) {\n  var isSubscribed = false;\n\n  /**\n   * find themes for current host from database and isert priority from database (or from local.json if no priority is set).\n   * @see CMS.ThemesController.find\n   */\n  var find = function(query, callback) {\n    $log.debug(\"[ThemeService.find]\", query);\n    var options = {\n      method: 'get',\n      resultIsArray: true\n    };\n    return JLSailsService.resolve('/theme/find', query, options, callback);\n  };\n\n  /**\n   * find themes for any host from database and isert priority from database (or from local.json if no priority is set).\n   * Only for superadmins!\n   */\n  var findByHost = function(host, callback) {\n    // $log.debug(\"[ThemeService.findByHost]\", host);\n    var options = {\n      method: 'post',\n      resultIsArray: true\n    };\n    return JLSailsService.resolve('/theme/findbyhost', {host: host}, options, callback);\n  };\n\n  var save = function (themes, callback) {\n    updateOrCreateEach(themes, function (err, result) {\n      if(angular.isDefined(callback)) {\n        callback(err, result);\n      }\n    });\n  };\n  \n  var updateOrCreateEach = function(themes, callback) {\n    $log.debug(\"[ThemeService.updateOrCreateEach]\", themes);\n    // $sailsSocket.put('/Theme/updateOrCreateEach', {themes: themes}).success(function(data, status, headers, config) {\n    //   $log.debug(data, status, headers, config);\n    //   callback(data, status, headers, config)\n    // });\n    var options = {\n      method: 'post',\n      resultIsArray: true\n    };\n    return JLSailsService.resolve('/Theme/updateOrCreateEach', {themes: themes}, options, callback);\n  };\n\n  var updateOrCreateEachByHost = function(host, themes, callback) {\n    // $log.debug(\"[ThemeService.updateOrCreateEachByHost]\", host, themes);\n    var options = {\n      method: 'post',\n      resultIsArray: true\n    };\n    return JLSailsService.resolve('/Theme/updateOrCreateEachByHost', {host: host, themes: themes}, options, callback);\n  };\n\n  // TODO\n  var subscribe = function () {\n    if(!isSubscribed) {\n      $sailsSocket.subscribe('theme', function(msg){\n        if($rootScope.authenticated) {\n          $log.debug(msg);\n        }\n        switch(msg.verb) {\n          case 'updated':\n            if($rootScope.authenticated) {\n              $rootScope.pop('success', 'Themeeinstellungen wurdne aktualisiert', msg.data);\n            }\n          break;\n          case 'created':\n            if($rootScope.authenticated) {\n              $rootScope.pop('success', 'Themeeinstellungen wurden erstellt', msg.data);\n            }\n          break;\n          case 'removedFrom':\n            if($rootScope.authenticated) {\n              $rootScope.pop('success', 'Themeeinstellungen wurden entfernt', \"\");\n            }\n          break;\n          case 'destroyed':\n            if($rootScope.authenticated) {\n              $rootScope.pop('success', 'Themeeinstellungen wurden gelöscht', \"\");\n            }\n          break;\n          case 'addedTo':\n            if($rootScope.authenticated) {\n              $rootScope.pop('success', 'Themeeinstellungen wurden hinzugefügt', \"\");\n            }\n          break;\n        }\n      });\n      isSubscribed = true;\n    }\n  };\n\n  return {\n    find: find,\n    findByHost: findByHost,\n    save: save,\n    updateOrCreateEach: updateOrCreateEach,\n    updateOrCreateEachByHost: updateOrCreateEachByHost,\n    subscribe: subscribe\n  };\n});","angular.module('jumplink.cms.toolbar', [\n  'FBAngular'\n])\n.directive('jlToolbar', function ($compile, $window) {\n\n  return {\n    restrict: 'E',\n    templateUrl: '/views/modern/toolbar.jade',\n    scope: {\n      routes: \"=\",\n      title: \"=\",\n      shorttitle: \"=\",\n      fluid: \"=\",\n      position: \"=\",\n      filter: \"=\",\n      subnavigation: \"=?\",\n    },\n    link: function ($scope, $element, $attrs) {\n\n    },\n    controller: function ($scope, $log, Fullscreen) {\n      $scope.fullscreenIsSupported = Fullscreen.isSupported();\n      $scope.isFullscreen = false;\n      $log.debug(\"[jumplink.cms.toolbar.jlToolbar.controller]\", $scope);\n      Fullscreen.$on('FBFullscreen.change', function(evt, isFullscreenEnabled){\n        $scope.isFullscreen = isFullscreenEnabled === true;\n        // $scope.$apply();\n      });\n\n      $scope.toggleFullscreen = function () {\n        if (Fullscreen.isEnabled()) {\n          Fullscreen.cancel();\n        } else {\n          Fullscreen.all();\n        }\n      };\n    }\n  };\n});","angular.module('jumplink.cms.user', [\n    'sails.io',\n    'jumplink.cms.sails',\n  ])\n\n  .service('UserService', function ($rootScope, $sailsSocket, $log, JLSailsService) {\n    var isSubscribed = false;\n\n    var save = function(user, callback) {\n      if(!angular.isString(user.role)) {\n        user.role = \"siteadmin\";\n      }\n      \n      // update user\n      if(angular.isDefined(user.id)) {\n        $log.debug(\"update user: sailsSocket.put('/user/\"+user.id+\"..'\");\n        $sailsSocket.put('/user/'+user.id, user).success(function(data, status, headers, config) {\n          $log.debug(data, status, headers, config);\n          if(angular.isDefined(data) && angular.isDefined(data.password)) {\n            delete data.password;\n          }\n          callback(null, data, status, headers, config);\n        });\n      } else {\n        // create user\n        $log.debug(\"create user: sailsSocket.post('/user..\");\n        $sailsSocket.post('/user', user).success(function(data, status, headers, config) {\n          // TODO FIXME data ist not the request result ?!\n          $log.debug(\"data\", data, \"status\", status, \"headers\", headers, \"config\", config);\n          if(angular.isDefined(data) && angular.isDefined(data.password)) {\n            delete data.password;\n          }\n          callback(null, data, status, headers, config);\n        });\n      }\n    };\n\n    var subscribe = function () {\n      if(!isSubscribed) {\n        $sailsSocket.subscribe('user', function(msg){\n          if($rootScope.authenticated) {\n            $log.debug(msg);\n          }\n          switch(msg.verb) {\n            case 'updated':\n              if($rootScope.authenticated) {\n                $rootScope.pop('success', 'Ein Benutzer wurde aktualisiert', msg.data.name);\n              }\n            break;\n            case 'created':\n              if($rootScope.authenticated) {\n                $rootScope.pop('success', 'Ein Benutzer wurde erstellt', msg.data.name);\n              }\n            break;\n            case 'removedFrom':\n              if($rootScope.authenticated) {\n                $rootScope.pop('success', 'Ein Benutzer wurde entfernt', \"\");\n              }\n            break;\n            case 'destroyed':\n              if($rootScope.authenticated) {\n                $rootScope.pop('success', 'Ein Benutzer wurde gelöscht', \"\");\n              }\n            break;\n            case 'addedTo':\n              if($rootScope.authenticated) {\n                $rootScope.pop('success', 'Ein Benutzer wurde hinzugefügt', \"\");\n              }\n            break;\n          }\n        });\n        isSubscribed = true;\n      }\n    };\n\n    var removeFromClient = function (users, user) {\n      var index = users.indexOf(user);\n      $log.debug(\"removeFromClient\", user, index);\n      if (index > -1) {\n        users.splice(index, 1);\n      }\n    };\n\n    var remove = function(users, user) {\n      $log.debug(\"$scope.remove\", user);\n      if($rootScope.authenticated) {\n        if(users.length <= 1) {\n          $log.error('Der letzte Benutzer kann nicht gelöscht werden.');\n        } else {\n          removeFromClient(users, user);\n          if(user.id) {\n            $sailsSocket.delete('/user/'+user.id, {id:user.id}).success(function(data, status, headers, config) {\n              $log.debug(\"user delete request\", data, status, headers, config);\n            });\n          }\n        }\n      }\n    };\n\n    /**\n     * find users for any host from database and isert priority from database (or from local.json if no priority is set).\n     * Only for superadmins!\n     */\n    var findByHost = function(host, callback) {\n      // $log.debug(\"[ThemeService.findByHost]\", host);\n      var options = {\n        method: 'post',\n        resultIsArray: true\n      };\n      return JLSailsService.resolve('/user/findbyhost', {host: host}, options, callback);\n    };\n\n    var updateOrCreateByHost = function(host, user, callback) {\n      $log.debug(\"[UserService.updateOrCreateByHost]\", host, routes);\n      var options = {\n        method: 'post',\n        resultIsArray: false\n      };\n      return JLSailsService.resolve('/user/updateOrCreateByHost', {host: host, user: user}, options, callback);\n    };\n\n    return {\n      save: save,\n      subscribe: subscribe,\n      remove: remove,\n      findByHost: findByHost,\n      updateOrCreateByHost: updateOrCreateByHost\n    };\n  })\n;","angular.module('jumplink.cms.utilities', [\n  ])\n  .service('UtilityService', function ($log) {\n    var invertOrder = function (array) {\n      var result = [];\n      for (var i = array.length - 1; i >= 0; i--) {\n        result.push(array[i]);\n      }\n      return result;\n    };\n\n    /**\n     * find value by key in array\n     */\n    var findKeyValue = function (objects, key, value) {\n      // $log.debug(\"findKeyValue\", key, value);\n      var index = -1;\n      for (var i = objects.length - 1; i >= 0 && index <= -1; i--) {\n        if(objects[i][key] === value) {\n          index = i;\n        } \n      }\n      return index;\n    };\n\n    /**\n     * @see: http://stackoverflow.com/questions/3068534/getting-javascript-object-key-list\n     */\n    var getKeys = function (obj) {\n      var keys = [];\n      if(!angular.isObject(obj)) {\n        console.error(\"[UtilityService.getKeys] is not an Object\", obj);\n        return keys;\n      }\n      for(var k in obj) {\n        keys.push(k);\n      }\n      return keys;\n    };\n\n    /**\n     * Capitalize the first character of a string, but not change the case of any of the other letters.\n     *\n     * @see http://stackoverflow.com/questions/1026069/capitalize-the-first-letter-of-string-in-javascript\n     */\n    var capitalizeFirstLetter = function (string) {\n      return string.charAt(0).toUpperCase() + string.slice(1).toLowerCase();\n    };\n\n    var lowercaseFirstLetter = function (string) {\n      return string.charAt(0).toLowerCase() + string.slice(1);\n    };\n\n    return {\n      invertOrder: invertOrder,\n      findKeyValue: findKeyValue,\n      getKeys: getKeys,\n      capitalizeFirstLetter: capitalizeFirstLetter,\n      lowercaseFirstLetter: lowercaseFirstLetter,\n    };\n  });","angular.module('jumplink.cms.validation', [\n  'validation',                               // https://github.com/huei90/angular-validation\n  'validation.rule',                          // https://github.com/huei90/angular-validation\n])\n.provider('jlValidation', function jlValidationProvider($validationProvider) {\n  this.getLocale = function () {\n    var defaultMsg = {\n      \"minlength\": $validationProvider.getDefaultMsg('minlength'),\n      \"maxlength\": $validationProvider.getDefaultMsg('maxlength'),\n      \"required\": $validationProvider.getDefaultMsg('required'),\n      \"email\": $validationProvider.getDefaultMsg('email'),\n      \"number\": $validationProvider.getDefaultMsg('number'),\n      \"url\": $validationProvider.getDefaultMsg('url'),\n    };\n    return defaultMsg;\n  };\n  this.changeLocale = function (lang) {\n    var defaultMsg = {};\n    switch(lang) {\n      case 'de':\n        defaultMsg = {\n          'minlength': {\n            error: \"Eingabe muss länger sein!\",\n            success: \"Eingabe lang genug\"\n          },\n          'maxlength': {\n            error: \"Eingabe muss kürzer sein!\",\n            success: \"Eingabe kurz genug\"\n          },\n          'required': {\n            error: \"Eine Eingabe ist erforderlich!\",\n            success: \"Okay\"\n          },\n          'email': {\n            error: \"Eingabe muss einer E-Mail entsprechen!\",\n            success: \"Eingabe ist eine E-Mail\"\n          },\n          'number': {\n            error: \"Eingabe darf nur Zahlen enthalten!\",\n            success: \"Eingabe enthält nur Zahlen\"\n          },\n          'url': {\n            error: \"Eingabe muss einer URL entsprechen!\",\n            success: \"Eingabe entspricht einer URL\"\n          },\n        };\n      break;\n      case 'en':\n      break;\n      default:\n      break;\n    }\n    switch(lang) {\n      case 'de':\n        $validationProvider.setDefaultMsg(defaultMsg);\n      break;\n      case 'en':\n        // do nothing\n      break;\n      default:\n        // do nothing\n      break;\n    }\n  };\n  this.$get = function jlValidationFactory() {\n    // let's assume that the UnicornLauncher constructor was also changed to\n    // accept and use the useTinfoilShielding argument\n    return new jlValidation();\n  };\n});","angular.module('jumplink.cms.bootstrap.content', [\n  'jumplink.cms.content',\n])\n/**\n * TODO move other bootstrap stuff from  ContentService to this ContentBootstrapService\n */\n.service('ContentBootstrapService', function ($log, $async, ImportExportBootstrapService, UtilityService, ContentService, SortableService) {\n  var modals = null;\n  var host = null;\n\n  var setHost = function (newHost) {\n    host = newHost;\n  };\n\n  var setupImportModal = function ($scope, onImportFinsih) {\n    var fileOptions = {};\n\n    var onCompleteFile = function (err, files) {\n      $log.debug(\"[ContentBootstrapService.onCompleteFile]\", files);\n      var data = [];\n      for (var i = 0; i < files.length; i++) {\n        data = data.concat(files[i].data);\n      }\n      ImportExportBootstrapService.setImports(data, {identifierKey: 'name', descriptionKey: 'title'});\n    };\n\n    var onImportStart = function (imports, next) {\n      $log.debug(\"[ContentBootstrapService.onImportStart]\", host);\n      $async.map(imports, function (item, callback) {\n        if(item.importOptions.doImport === true) {\n          ContentService.updateOrCreateByHostByTitleAndPage(host, item, callback);\n        } else {\n          callback();\n        }\n        \n      }, function(err, results) {\n        $log.debug(\"[ContentBootstrapService.onImportStart] done\", err, results);\n        results = SortableService.sort(results);\n        next(err, results);\n      });\n      \n    };\n\n    var onAbort = function (imports, next) {\n      $log.debug(\"[ContentBootstrapService.onAbort]\");\n      next();\n    };\n\n    modals = ImportExportBootstrapService.setModals($scope, fileOptions, onCompleteFile, onImportStart, onAbort, onImportFinsih);\n  };\n\n  return {\n    setHost: setHost,\n    setupImportModal: setupImportModal,\n    showImportModal: ImportExportBootstrapService.show,\n  };\n});","angular.module('jumplink.cms.content.medium', [\n  'jumplink.cms.content',\n  'angular-medium-editor',\n])\n.value('mediumOptions', {\n  buttonLabels: \"fontawesome\",\n  toolbar: {\n    buttons: [\"bold\", \"italic\", \"underline\", \"anchor\", \"h2\", \"h3\", \"h4\", \"quote\", \"orderedlist\", \"unorderedlist\"]\n  }\n})\n.service('ContentMediumService', function ($rootScope, $log, $sailsSocket, $filter, $modal, SortableService, UtilityService, focus) {\n  // TODO\n  var Imager = function () {\n    this.button = document.createElement('button');\n    this.button.className = 'medium-editor-action';\n    this.button.innerText = 'Image';\n    this.button.innerHTML = '<i class=\"fa fa-picture-o\"></i>';\n    this.button.onclick = this.onClick.bind(this);\n    // this.classApplier = rangy.createCssClassApplier('highlight', {\n    //   elementTagName: 'mark',\n    //   normalize: true\n    // });\n  };\n  Imager.prototype.onClick = function() {\n    this.classApplier.toggleSelection();\n  };\n  Imager.prototype.getButton = function() {\n    return this.button;\n  };\n  Imager.prototype.checkState = function(node) {\n    if (node.tagName === 'MARK') {\n      this.button.classList.add('medium-editor-button-active');\n    }\n  };\n\n  return {\n    Imager: Imager\n  };\n});","angular.module('jumplink.cms.content.medium').directive('jlContentBlocks', function ($compile, $window, mediumOptions, ContentMediumService, SubnavigationService, HistoryService) {\n\n  return {\n    restrict: 'E',\n    templateUrl: '/views/modern/contentBlocks.jade',\n    scope: {\n      authenticated : \"=\",\n      html: \"=\",\n      contents: \"=\",\n      navs: \"=?\",\n      afterRefresh: \"=?\",\n      afterSave: \"=?\",\n      afterRemove: \"=?\",\n      afterEdit: \"=?\",\n      afterAdd: \"=?\",\n      subnavigation: \"=?\",\n      afterSaveNav: \"=?\",\n      afterRemoveNav: \"=?\",\n      afterEditNav: \"=?\",\n      afterAddNav: \"=?\",\n      logger: \"=\",\n      page: \"=?\",\n      mediumOptions: \"=?\",\n      mediumBindOptions: \"=?\",\n\n    },\n    link: function ($scope, $element, $attrs) {\n    },\n    controller: function ($rootScope, $scope, ContentService, $log, $state) {\n\n      ContentService.setEditModal($scope);\n      SubnavigationService.setEditModal($scope);\n      $scope.goTo = HistoryService.goToHashPosition;\n      ContentService.subscribe();\n      SubnavigationService.subscribe();\n      // SubnavigationService.resizeOnImagesLoaded();\n\n      if(angular.isUndefined($scope.page)) {\n        $scope.page = $state.current.name;\n      }\n\n      if(angular.isUndefined($scope.subnavigation)) {\n        $scope.subnavigation = false;\n      }\n\n      if(angular.isUndefined($scope.afterRefresh)) {\n        $scope.afterRefresh = function (err, result) {\n          if(err) {\n            return $scope.logger('error', \"Inhaltsblock wurde nicht erneuert!\", err);\n          }\n          $scope.logger('success', \"Inhaltsblock erneuert!\", \"\");\n        };\n      }\n\n      if(angular.isUndefined($scope.afterSave)) {\n        $scope.afterSave = function (err, result) {\n          if(err) {\n            return $scope.logger('error', \"Inhaltsblock wurde nicht gespeichert!\", err);\n          }\n          $scope.logger('success', \"Inhaltsblock gespeichert!\", result.title);\n        };\n      }\n\n      if(angular.isUndefined($scope.afterRemove)) {\n        $scope.afterRemove = function (err, result) {\n          if(err) {\n            return $scope.logger('error', \"Inhaltsblock wurde nicht entfernt!\", err);\n          }\n          $scope.logger('success', \"Inhaltsblock entfernt!\", result.title);\n        };\n      }\n\n      if(angular.isUndefined($scope.afterEdit)) {\n        $scope.afterEdit = function (err, result) {\n          if(err) {\n            return $scope.logger('error', \"Inhaltsblock wurde nicht bearbeitet!\", err);\n          }\n          $scope.logger('success', \"Inhaltsblock bearbeitet!\", result.title);\n        };\n      }\n\n      if(angular.isUndefined($scope.afterAdd)) {\n        $scope.afterAdd = function (err, result) {\n          if(err) {\n            return $scope.logger('error', \"Inhaltsblock wurde nicht hinzugefügt!\", err);\n          }\n          $scope.logger('success', \"Inhaltsblock hinzugefügt!\", result.title);\n        };\n      }\n\n      if(angular.isUndefined($scope.afterSaveNav)) {\n        $scope.afterSaveNav = function (err, result) {\n          if(err) {\n            return $scope.logger('error', \"Navigation wurde nicht gespeichert!\", err);\n          }\n          $scope.logger('success', \"Navigation gespeichert!\", result.title);\n        };\n      }\n\n\n      $scope.add = function() {\n        var errors = [\n          \"Error: Konnte Inhaltsblock nicht erzeugen\",\n          \"Error: Konnte Inhaltsblock nicht hinzufügen\",\n        ];\n\n        var successes = [\n          \"Neuen Inhaltsblock erfolgreich hinzugefügt\",\n          \"Neue Subnavigation erfolgreich hinzugefügt\",\n          \"Neuen Block erfolgreich hinzugefügt\",\n        ];\n\n        if(!$scope.authenticated) {\n          return false;\n        }\n        // generates new content and opens the modal\n        ContentService.createEdit($scope.contents, $scope.page, function(err, content) {\n          if(err) {\n            return $scope.afterAdd(err);\n          }\n          ContentService.append($scope.contents, content, $scope.afterAdd);  \n        });\n      };\n\n      $scope.moveForward = function(index, content) {\n        if(!$scope.authenticated) {\n          return false;\n        }       \n        SortableService.moveForward(index, $scope.contents, function(err, contents) {\n          if(err) {\n            $log.error(\"Error: On move content forward!\", err);\n            return err;\n          }\n          $scope.contents = contents;\n        });\n      };\n\n      $scope.moveBackward = function(index, content) {\n        if(!$scope.authenticated) {\n          return false;\n        }\n        SortableService.moveBackward(index, $scope.contents, function(err, contents) {\n          if(err) {\n            $log.error(\"Error: On move content backward!\", err);\n            return err;\n          }\n          $scope.contents = contents;\n        });\n      };\n\n      $scope.edit = function(index, content) {\n        if(!$scope.authenticated) {\n          return false;\n        }\n        ContentService.edit(content, $scope.afterEdit);\n      };\n\n      $scope.remove = function(index, content) {\n        if(!$scope.authenticated) {\n          return false;\n        }\n        ContentService.remove($scope.contents, index, content, $scope.page, $scope.afterRemove);\n      };\n\n      $scope.refresh = function() {\n        ContentService.refresh($scope.contents, $scope.afterRefresh);\n      };\n\n      $scope.toggleHtml = function(index, content) {\n        content.html = content.html !== true;\n      };\n\n      $scope.save = function() {\n        if(!$scope.authenticated) {\n          return false;\n        }\n        ContentService.save($scope.contents, $scope.page, $scope.afterSave);\n        if($scope.subnavigation) {\n          SubnavigationService.save($scope.navs, $scope.page, $scope.afterSaveNav);\n        }\n      };\n    }\n  };\n});","angular.module('jumplink.cms.content.medium').directive('jlContent', function ($compile, $window, mediumOptions, ContentMediumService) {\n\n  return {\n    restrict: 'E',\n    templateUrl: '/views/modern/content.jade',\n    scope: {\n      authenticated : \"=\",\n      html: \"=\",\n      content: \"=?\",\n      mediumOptions: \"=?\",\n      mediumBindOptions: \"=?\",\n    },\n    link: function ($scope, $element, $attrs) {\n      if(angular.isUndefined($scope.mediumOptions)) {\n        $scope.mediumOptions = mediumOptions;\n      }\n      if(angular.isUndefined($scope.mediumBindOptions)) {\n        $scope.mediumBindOptions = {\n          extensions: {\n            'image': new ContentMediumService.Imager()\n          }\n        };\n      }\n    }\n  };\n});"],"sourceRoot":"/source/"}
{"version":3,"sources":["general/general.js","admin/admin.js","attachment/attachment.bootstrap.js","attachment/attachment.js","async/async.js","blog/blog.bootstrap.js","blog/blog.js","browser/browser.js","config/config.js","content/content.bootstrap.js","content/content.js","content/content.medium.js","crossbrowser/crossbrowser.js","download/download.js","event/event.js","fallback/fallback.js","focus/focus.js","gallery/gallery.js","history/history.js","importexport/importexport.bootstrap.js","importexport/importexport.js","info/info.js","multisite/multisite.js","routes/routes.bootstrap.js","routes/routes.js","sails/sails.js","session/session.js","sidebar/sidebar.js","signin/signin.bootstrap.js","signin/signin.js","sortable/sortable.js","subnavigation/subnavigation.js","theme/theme.js","toolbar/toolbar.js","uploader/uploader.bootstrap.js","user/user.js","utilities/utilities.js","validation/validation.bootstrap.js","validation/validation.js"],"names":["angular","module","directive","$compile","$window","$sailsSocket","$state","restrict","templateUrl","scope","upload","download","toogleHtml","refresh","save","add","addDropdown","addDropdownActions","adminSettingDropdown","authenticated","allowActions","link","$scope","$element","$attrs","goToState","go","isUndefined","text","click","mediumOptions","AttachmentService","attachment","attachmentIndex","parent","path","destroy","centerImage","console","log","controller","open","service","moment","$async","$log","url","target","destroyLocally","blogPosts","postIndex","cb","attachments","length","splice","destroyExternally","put","blogPostID","id","attachmentUploadedAs","uploadedAs","success","data","status","headers","config","debug","error","post","indexOf","err","async","objectMap","obj","func","i","arr","keys","Object","wrapper","this","map","res","focus","BlogService","$modal","FileUploader","editModal","typeModal","page","openTypeChooserModal","blogPost","$promise","then","show","setModals","fileOptions","pageString","onFileCompleteCallback","isString","title","ok","accept","hide","abort","thumbnail","width","rescrop","cropwidth","cropheight","uploadOptions","removeAfterUpload","options","JSON","stringify","uploader","isFunction","onComplete","onCompleteItem","fileItem","response","isArray","files","push","onProgressItem","progress","chooseType","$on","modalEvent","validate","callback","getModals","getEditModal","getTypeModal","edit","createEdit","create","update","$filter","types","deleteAttachment","fix","type","removeFromClient","index","users","sort","reverse","transform","append","moreBlogPosts","apply","prepent","unshift","createdAt","content","author","object","name","toLowerCase","replace","fixEach","objects","saveOne","errors","isDefined","saveBlocks","blogPostsArray","find","limit","skip","resp","count","subscribe","msg","verb","$rootScope","pop","findEvent","blogPostBlock","resolve","remove","destroyAttachment","force","get","ImportExportBootstrapService","UtilityService","ContentService","SortableService","modals","host","setHost","newHost","setupImportModal","onImportFinsih","onCompleteFile","concat","setImports","identifierKey","descriptionKey","onImportStart","imports","next","item","importOptions","doImport","updateOrCreateByHostByTitleAndPage","results","onAbort","showImportModal","$download","JLSailsService","showHtml","getShowHtml","setEditModal","changeName","$watch","newValue","oldValue","generateName","event","validateContent","toogleShowHtml","contents","beautifyEach","beautify","html_beautify","getByName","findKeyValue","swap","index_1","index_2","moveForward","moveBackward","isNumber","position","warn","saveParallel","logger","parallel","applyResults","extend","findOne","query","Array","findAll","findByHost","method","resultIsArray","exportByHost","findAllWithImage","images","resolveOne","resolveAll","resolveAllWithImage","value","buttonLabels","toolbar","buttons","Imager","button","document","createElement","className","innerText","innerHTML","onclick","onClick","bind","prototype","classApplier","toggleSelection","getButton","checkState","node","tagName","classList","ContentMediumService","html","mediumBindOptions","extensions","image","SubnavigationService","HistoryService","navs","afterRefresh","afterSave","afterRemove","afterEdit","afterAdd","subnavigation","afterSaveNav","afterRemoveNav","afterEditNav","afterAddNav","goTo","goToHashPosition","current","result","toggleHtml","Date","now","getTime","vendors","window","requestAnimationFrame","vp","cancelAnimationFrame","test","navigator","userAgent","lastTime","nextTime","Math","max","setTimeout","clearTimeout","info","eventBlockName","split","events","unknown","before","after","to","from","isAfter","invertOrder","merge","allEvents","minutes","person","place","eventBlocks","saveAllInBlock","eventBlocksArray","eventBlock","EventService","$location","protocol","charAt","factory","$timeout","element","getElementById","elem","attr","on","eventFocus","eventFocusId","off","Fullscreen","uploadModal","fullscreenImage","dropdown","getDropdown","prepairUploadModal","imageBlocks","contentBlocks","selects","getSelects","selectedContentBlock","setUploadModal","onCompleteCallback","filters","fn","slice","lastIndexOf","forEach","file","selected","currentImages","last_position","original","getUploadModal","blockNames","blockName","array","label","contentname","saveAllBlocks","saveAll","filename","addBlock","aspect","height","scale","aspectRatio","win","paddingTopBottom","paddingLeftRight","isFullScreen","getWindowDimensions","padding-right","padding-left","padding-top","padding-bottom","jumplink","$anchorScroll","history","state","params","all","step","prev","previous","abs","back","hash","yOffset","autoScroll","run","toParams","fromParams","onCompleteItemCallback","alias","onCompleteAll","identifier","description","warns","infoUser","infoAdmin","restart","resolveNames","resolveHosts","RoutesService","updateOrCreateByHostByObjectNameAndNavbar","provider","jlRoutesProvider","$stateProvider","$urlRouterProvider","$locationProvider","html5Mode","otherwise","when","url1","url2","setLayouts","layouts","stateName","setRoutes","routes","routeOptions","main","customstate","eval","views","view","objectName","isObject","alternativeUrls","a","$get","jlRoutes","filter","active","match","fallback","route","updateOrCreate","updateOrCreateByHost","updateOrCreateEach","updateOrCreateEachByHost","generateObjectnameFromStatename","statename","objectname","k","capitalizeFirstLetter","lowercaseFirstLetter","generateObjectnameFromUrl","saveEachByHost","$q","deferred","defer","reject","promise","user","isAuthenticated","needToBeAuthenticated","bloggerOrBetter","developerOrBetter","siteadminOrBetter","superadmin","employee","employeeOrBetter","needToBeEmployeeOrBetter","needToBeSiteadminOrBetter","getAllPolicies","getUser","transclude","SigninService","siginWithModal","goBackAfterSignin","extendRoles","signinModal","aborted","email","password","signin","SessionService","resetPosition","object_1","object_2","position_tmp","move","old_index","new_index","undefined","unique","uniqueKey","new_object","new_position","uniqueIndex","okay","moveObjectToAnotherArray","index_from","array_from","array_to","replaceData","errorParamsNotSet","index_to","dropMove","dropObjectIndex","dragObject","moveFunction","dragObjectIndex","dropObject","resizeOnImagesLoaded","imagesLoaded","triggerHandler","Number","nav","removeByTarget","fixed","addNav","moveForwardNav","moveBackwardNav","editNavs","removeNav","onDragOnComplete","evt","onDragOnNavComplete","onDropOnComplete","dropnavindex","dragnav","onDropOnNavComplete","onDropOnAreaComplete","isSubscribed","themes","shorttitle","fluid","fullscreenIsSupported","isSupported","isFullscreen","isFullscreenEnabled","toggleFullscreen","isEnabled","cancel","labelFiles","role","key","getKeys","string","toUpperCase","jlValidationProvider","$validationProvider","setup","setErrorHTML","setSuccessHTML","validCallback","$","parents","removeClass","addClass","invalidCallback","getLocale","changeLocale","jlValidationBootstrap","defaultMsg","minlength","getDefaultMsg","maxlength","required","number","lang","setDefaultMsg","jlValidation"],"mappings":"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","file":"jumplink-cms-angular.js","sourcesContent":["if (typeof jumplink === 'undefined') {\n  var jumplink = {};\n}","angular.module('jumplink.cms.admin', [\n    'sails.io',\n  ])\n\n  .directive('adminbar', function ($compile, $window, $sailsSocket, $state) {\n\n    return {\n      restrict: 'E',\n      templateUrl: '/views/modern/adminbar.jade',\n      scope: {\n        upload : \"=?\",\n        download : \"=?\",\n        toogleHtml: \"=?\",\n        refresh: \"=?\",\n        save: \"=?\",\n        add: \"=?\",\n        addDropdown: \"=?\",\n        addDropdownActions: \"=?\",\n        adminSettingDropdown: \"=?\",\n        authenticated: \"=?\",\n        allowActions: \"=?\",\n      },\n      link: function ($scope, $element, $attrs) {\n\n        $scope.goToState = $state.go;\n\n        if(angular.isUndefined($scope.adminSettingDropdown)) {\n          $scope.adminSettingDropdown = [\n            {\n              \"text\": \"<i class=\\\"fa fa-list\\\"></i>&nbsp;Übersicht\",\n              \"click\": \"goToState('layout.administration')\"\n            },\n            {\n              \"text\": \"<i class=\\\"fa fa-users\\\"></i>&nbsp;Benutzer\",\n              \"click\": \"goToState('layout.users')\"\n            },\n            {\n              \"text\": \"<i class=\\\"fa fa-sign-out\\\"></i>&nbsp;Abmelden\",\n              \"click\": \"$root.logout()\"\n            }\n          ];\n        }\n      }\n    };\n  })\n\n;","angular.module('jumplink.cms.bootstrap.attachment', [\n  'jumplink.cms.attachment',\n])\n.directive('jlAttachmentBootstrap', function ($compile, $window, mediumOptions, AttachmentService) {\n\n  return {\n    restrict: 'E',\n    templateUrl: '/views/modern/attachment.bootstrap.jade',\n    scope: {\n      attachment: \"=\",\n      attachmentIndex: \"=\",\n      parent: \"=\",\n      path: \"=\",\n      authenticated: \"=\",\n      destroy: \"=\",\n      centerImage: \"=\"\n    },\n    link: function ($scope, $element, $attrs) {\n      console.log(\"[jlAttachmentBootstrap.link]\", $scope);\n    },\n    controller: function ($scope, AttachmentService) {\n      $scope.open = AttachmentService.open;\n    }\n  };\n});","angular.module('jumplink.cms.attachment', [\n  'sails.io',\n])\n\n.service('AttachmentService', function (moment, $sailsSocket, $async, $log, $window) {\n\n  var open = function (url, target) {\n    $window.open(url, target);\n  };\n\n  /**\n   * delete attachment on local / client / browser\n   */\n  var destroyLocally = function (blogPosts, postIndex, attachmentIndex, cb) {\n    if(blogPosts[postIndex].attachments.length > 0) {\n      blogPosts[postIndex].attachments.splice(attachmentIndex, 1);\n    }\n    return cb(null, blogPosts, postIndex, attachmentIndex);\n  };\n\n  /**\n   * delete attachment extern / server\n   */\n  var destroyExternally = function (blogPosts, postIndex, attachmentIndex, cb) {\n    $sailsSocket.put('/blog/destroyAttachment', {blogPostID: blogPosts[postIndex].id, attachmentUploadedAs: blogPosts[postIndex].attachments[attachmentIndex].uploadedAs})\n    .success(function (data, status, headers, config) {\n      $log.debug(null, data, status, headers, config);\n      cb();\n    })\n    .error(function (data, status, headers, config) {\n      $log.error(data, status, headers, config);\n      cb(\"error\", data, status, headers, config);\n    });\n  };\n\n  var destroy = function (blogPosts, post, attachmentIndex, cb) {\n    var postIndex = blogPosts.indexOf(post);\n    $log.debug(\"[BlogService.destroy]\", blogPosts[postIndex], attachmentIndex);\n    return destroyExternally(blogPosts, postIndex, attachmentIndex, function (err, data, status, headers, config) {\n      if(err) {\n        return cb(err, data, status, headers, config);\n      }\n      return destroyLocally(blogPosts, postIndex, attachmentIndex, cb);\n    });\n  };\n\n  return {\n    open: open,\n    destroyLocally: destroyLocally,\n    destroyExternally: destroyExternally,\n    destroy: destroy,\n  };\n});","angular.module('ngAsync', [])\n.service('$async', function () {\n  // https://github.com/caolan/async/issues/374#issuecomment-27498818\n  async.objectMap = function ( obj, func, cb ) {\n    var i, arr = [], keys = Object.keys( obj );\n    for ( i = 0; i < keys.length; i += 1 ) {\n      var wrapper = {};\n      wrapper[keys[i]] = obj[keys[i]];\n      arr[i] = wrapper;\n    }\n    this.map( arr, func, function( err, data ) {\n      if ( err ) { return cb( err ); }\n      var res = {};\n      for ( i = 0; i < data.length; i += 1 ) {\n          res[keys[i]] = data[i];\n      }\n      return cb( err, res );\n    });\n  };\n  return async;\n});","angular.module('jumplink.cms.bootstrap.blog', [\n  'jumplink.cms.blog',\n  'mgcrea.ngStrap',\n  'angular-medium-editor',\n  'angularFileUpload',\n  'ngFocus',\n])\n\n.service('BlogBootstrapService', function ($log, focus, BlogService, $modal, FileUploader) {\n\n  var editModal = null;\n  var typeModal = null;\n  var page = null;\n\n  var openTypeChooserModal = function(blogPost) {\n    typeModal.$scope.blogPost = blogPost;\n    //- Show when some blogPost occurs (use $promise property to ensure the template has been loaded)\n    typeModal.$promise.then(typeModal.show);\n  };\n\n  var setModals = function($scope, fileOptions, pageString, onFileCompleteCallback) {\n\n    if(!angular.isString(page)) {\n      page = pageString;\n    }\n\n    editModal = $modal({title: 'Blogpost bearbeiten', templateUrl: '/views/modern/blog/editmodal.bootstrap.jade', show: false});\n    editModal.$scope.ok = false;\n    editModal.$scope.accept = function (hide) {\n      editModal.$scope.ok = true;\n      hide();\n    };\n    editModal.$scope.abort = function (hide) {\n      editModal.$scope.ok = false;\n      hide();\n    };\n\n    // set default fileOptions\n    if(angular.isUndefined(fileOptions)) {\n      fileOptions = {\n        path: 'assets/files/blog', // TODO get path from config\n        thumbnail: {\n          width: 300,\n          path: 'assets/files/blog' // TODO get path from config\n        },\n        rescrop: {\n          width: 1200,\n          cropwidth: 1200,\n          cropheight: 1200,\n        }\n      };\n    }\n\n    var uploadOptions = {\n      url: 'blog/upload',\n      removeAfterUpload: true,\n      // WARN: headers HTML5 only\n      headers: {\n        options: JSON.stringify(fileOptions)\n      }\n    };\n\n    editModal.$scope.uploader = new FileUploader(uploadOptions);\n    editModal.$scope.openTypeChooserModal = openTypeChooserModal;\n\n    if(angular.isFunction(onFileCompleteCallback)) {\n      $scope.uploader.onComplete = onFileCompleteCallback;\n    }\n\n    editModal.$scope.uploader.onCompleteItem = function(fileItem, response, status, headers) {\n      $log.debug(\"[BlogBootstrapService.onCompleteItem] fileItem\", fileItem, \"response\", response);\n      if(!angular.isArray(fileItem.blogPost.attachments)) {\n        fileItem.blogPost.attachments = [];\n      }\n      for (var i = 0; i < response.files.length; i++) {\n        fileItem.blogPost.attachments.push(response.files[i]);\n      }\n    };\n\n    editModal.$scope.uploader.onProgressItem = function(fileItem, progress) {\n      $log.debug('[BlogBootstrapService.onProgressItem]', fileItem, progress);\n    };\n\n    editModal.$scope.upload = function(fileItem, blogPost) {\n      fileItem.blogPost = blogPost;\n      fileItem.upload();\n    };\n\n    typeModal = $modal({title: 'Typ wählen', templateUrl: '/views/modern/blog/typechoosermodal.bootstrap.jade', show: false});\n    typeModal.$scope.chooseType = BlogService.chooseType;\n\n    editModal.$scope.$on('modal.hide.before',function(modalEvent, editModal) {\n      $log.debug(\"edit closed\", editModal.$scope.blogPost, editModal);\n      if(editModal.$scope.ok) {\n        // BlogService.saveOne(null, editModal.$scope.blogPost, null, page, function (err, result) {\n        //   editModal.$scope.blogPost = result\n        //   return BlogService.validate(editModal.$scope.blogPost, null, editModal.$scope.callback);\n        // });\n        return BlogService.validate(editModal.$scope.blogPost, null, editModal.$scope.callback);\n      } else {\n        if(editModal.$scope.callback) {\n          editModal.$scope.callback(\"discarded\", editModal.$scope.blogPost);\n        }\n      }\n    });\n\n    return getModals();\n  };\n\n  var getEditModal = function() {\n    return editModal;\n  };\n\n  var getTypeModal = function() {\n    return typeModal;\n  };\n\n  var getModals = function() {\n    return {\n      editModal: getEditModal(),\n      typeModal: getTypeModal()\n    };\n  };\n\n  var edit = function(blogPost, cb) {\n    $log.debug(\"[BlogService.edit]\", blogPost);\n    editModal.$scope.blogPost = blogPost;\n    editModal.$scope.callback = cb;\n    editModal.$scope.ok = false;\n\n    focus('blogposttitle');\n    //- Show when some blogPost occurs (use $promise property to ensure the template has been loaded)\n    editModal.$promise.then(editModal.show);\n  };\n\n  var createEdit = function(blogPosts, blogPost, cb) {\n    blogPost = BlogService.create(blogPost); \n    edit(blogPost, cb);\n  };\n\n  return {\n    edit: edit,\n    update: edit, // alias\n    createEdit: createEdit,\n    setModals: setModals,\n    openTypeChooserModal: openTypeChooserModal,\n  };\n});","angular.module('jumplink.cms.blog', [\n  'jumplink.cms.attachment',\n  'angularMoment',\n  'ngAsync',\n  'sails.io',\n])\n\n.service('BlogService', function (moment, $sailsSocket, $async, $log, $filter, AttachmentService) {\n\n  var types = ['news', 'other'];\n\n  /**\n   * delete attachment on local / client / browser\n   */\n  var deleteAttachmentLocally = AttachmentService.destroyLocally;\n\n  /**\n   * delete attachment extern / server\n   */\n  var deleteAttachmentExternally = AttachmentService.destroyExternally;\n\n  var deleteAttachment = AttachmentService.destroy;\n\n  var validate = function (blogPost, page, callback) {\n    if(blogPost.title) {\n      return fix(blogPost, page, callback);\n    }\n    if(angular.isFunction(callback)) {\n      return callback(\"Title not set\", blogPost);\n    }\n    return null;\n  };\n\n  var chooseType = function(blogPost, type) {\n    blogPost.type = type;\n  };\n\n  var removeFromClient = function (blogPosts, blogPost, callback) {\n    // $log.debug(\"removeFromClient\", blogPost);\n    var index = blogPosts.indexOf(blogPost);\n    if (index > -1) {\n      blogPosts.splice(index, 1);\n      if(angular.isFunction(callback)) {\n        callback(null, blogPosts);\n      }\n    } else {\n      if(angular.isFunction(callback)) {\n        callback(\"no blogPost on client site found to remove\", blogPosts);\n      }\n    }\n  };\n\n  var destroy = function(blogPosts, blogPost, callback) {\n    // $log.debug(\"remove blogPost\", blogPost);\n    if(blogPost.id) {\n      $log.debug(\"[jumplink.cms.blog.BlogService.destroy]\", blogPost);\n      $sailsSocket.delete('/blog/'+blogPost.id).success(function(users, status, headers, config) {\n        removeFromClient(blogPosts, blogPost, callback);\n      });\n    } else {\n      removeFromClient(blogPosts, blogPost, callback);\n    }\n  };\n\n  var sort = function(blogPosts) {\n    var reverse = true;\n    return $filter('orderBy')(blogPosts, 'createdAt', reverse);\n  };\n\n  var transform = function(blogPosts) {\n    blogPosts = sort(blogPosts);\n    return blogPosts;\n  };\n\n  var append = function(blogPosts, moreBlogPosts, callback) {\n    blogPosts.push.apply(blogPosts, moreBlogPosts);\n    blogPosts = transform(blogPosts);\n    if(angular.isFunction(callback)) {\n      return callback(null, blogPosts);\n    }\n    return blogPosts;\n  };\n\n  var prepent = function(blogPosts, blogPost, callback) {\n    blogPosts.unshift(blogPost);\n    blogPosts = transform(blogPosts);\n    if(angular.isFunction(callback)) {\n      return callback(null, blogPosts);\n    }\n    return blogPosts;\n  };\n\n  var create = function(data) {\n    if(!data || !data.createdAt) {\n      data.createdAt = moment();\n    }\n    // if(!data || !data.updatedAt) data.createdAt = moment();\n    if(!data || !data.title) {\n      data.title = \"\";\n    }\n    if(!data || !data.content) {\n      data.content = \"\";\n    }\n    if(!data || !data.author) {\n      data.author = \"\";\n    }\n    if(!data || !data.page) {\n      callback(\"Page not set.\");\n    }\n    if(!data || !data.type) {\n      data.type = types[0]; // news\n    }\n    $log.debug(\"[BlogService,create]\", data);\n    return data;\n  };\n\n  var createEdit = function(blogPosts, blogPost, callback) {\n    blogPost = create(blogPost); \n    edit(blogPost, callback);\n  };\n\n  var fix = function(object, page, callback) {\n    if(angular.isUndefined(object.page) && page !== null) {\n      object.page = page;\n    }\n    if(!object.name || object.name === \"\") {\n      // Set object.name to object.title but only the letters in lower case\n      object.name = object.title.toLowerCase().replace(/[^a-z]+/g, '');\n      // $log.debug(\"set object.name to\", object.name);\n    }\n    if(angular.isFunction(callback)) {\n      return callback(null, object);\n    }\n    return object;\n  };\n\n  var fixEach = function(objects, page, callback) {\n    for (var i = objects.length - 1; i >= 0; i--) {\n      objects[i] = fix(objects[i], page);\n    }\n    if(angular.isFunction(callback)) {\n      return callback(null, objects);\n    }\n    return objects;\n  };\n\n  var refresh = function(blogPosts, callback) {\n    $log.debug(\"[jumplink.cms.blog.BlogService.refresh]\");\n    blogPosts = transform(blogPosts);\n    if(angular.isFunction(callback)) {\n      return callback(null, blogPosts);\n    }\n    return blogPosts;\n  };\n\n  var saveOne = function (blogPosts, blogPost, index, page, callback) {\n    var errors = [\n      \"BlogService: Can't save blogPost.\",\n      \"BlogService: Can't save blogPost, blogPost to update not found.\",\n      \"BlogService: Can't save blogPost, parameters undefind.\",\n    ];\n    $log.debug(\"[BlogService.saveOne]\", blogPost);\n    if(angular.isDefined(blogPost) && angular.isDefined(callback)) {\n      blogPost = fix(blogPost, page);\n      if(angular.isUndefined(blogPost.id)) {\n        // create because id is undefined\n        $sailsSocket.post('/blog', blogPost).success(function(data, status, headers, config) {\n          if(angular.isArray(data)) {\n            data = data[0];\n          }\n          callback(null, data);\n        }).error(function (data, status, headers, config) {\n          if(angular.isArray(data)) {\n            data = data[0];\n          }\n          $log.error(data, status, headers, config);\n          return callback(errors[0]);\n        });\n      } else {\n        // update because id is defined\n        $sailsSocket.put('/blog/'+blogPost.id, blogPost).success(function(data, status, headers, config) {\n          if(angular.isArray(data)) {\n            data = data[0];\n          }\n          return callback(null, data);\n        }).error(function (data, status, headers, config) {\n          $log.error(data, status, headers, config);\n          return callback(errors[0]);\n        });\n      }\n    } else {\n      return callback(errors[2]);\n    }\n  };\n\n  var saveBlocks = function(blogPosts, page, callback) {\n    var errors = [\n      \"[BlogService.saveBlocks] Can't save blogPosts, parameters undefind.\"\n    ];\n    // save just this blogPost if defined\n    if(angular.isDefined(blogPosts) && angular.isDefined(callback)) {\n      $async.map(blogPosts, function (blogPost, callback) {\n        saveOne(blogPosts, blogPost, null, page, callback);\n      }, function(err, blogPostsArray) {\n        if(err) {\n          return callback(err);\n        }\n        blogPosts = transform(blogPosts);\n        return callback(null, blogPosts);\n      });\n    } else {\n      $log.error(errors[0]);\n      if(angular.isFunction(callback)) {\n        return callback(errors[0]);\n      }\n    }\n  };\n\n  var save = function(blogPosts, blogPost, index, page, callback) {\n    // save just this blogPost if defined\n    if(angular.isDefined(blogPost)) {\n      saveOne(blogPosts, blogPost, index, page, callback);\n    } else { // save all blogPostBlocks\n      saveBlocks(blogPosts, page, callback);\n    }\n  };\n\n  var find = function(page, limit, skip, callback) {\n    return $sailsSocket.put('/blog/find', {page:page, limit:limit, skip:skip}).then (function (data) {\n      data.data = transform(data.data);\n      if(angular.isFunction(callback)) {\n        return callback(null, data.data);\n      }\n      return data.data;\n    }, function error (resp){\n      $log.error(\"Error on find \"+page, resp);\n      if(angular.isFunction(callback)) {\n        return callback(resp);\n      }\n      return null;\n    });\n  };\n\n  var count = function(page, limit, skip, callback) {\n    return $sailsSocket.put('/blog/count', {page:page}).then (function (data) {\n      // $log.debug(data);\n      if(angular.isFunction(callback)) {\n        return callback(null, data.data.count);\n      }\n      return data.data.count;\n    }, function error (resp){\n      $log.error(\"Error on resolve \"+page, resp);\n      if(angular.isFunction(callback)) {\n        return callback(resp);\n      }\n      return null;\n    });\n  };\n\n  var subscribe = function () {\n    $sailsSocket.subscribe('blog', function(msg){\n      $log.debug(msg);\n      switch(msg.verb) {\n        case 'updated':\n          if($rootScope.authenticated) {\n            $rootScope.pop('success', 'Ein Blogpost wurde aktualisiert', msg.data.title);\n          }\n          findEvent(msg.id, function(error, blogPost, blogPostBlock, index) {\n            if(error) {\n              $log.debug(error);\n            }\n            else {\n              blogPost = msg.data;\n            }\n            $scope.refresh();\n          });\n        break;\n        case 'created':\n          if($rootScope.authenticated) {\n            $rootScope.pop('success', 'Ein Blogpost wurde erstellt', msg.data.title);\n          }\n          $scope.blogPosts.push(msg.data);\n          $scope.refresh();\n        break;\n        case 'removedFrom':\n          if($rootScope.authenticated) {\n            $rootScope.pop('success', 'Ein Blogpost wurde entfernt', msg.data.title);\n          }\n          findEvent(msg.id, function(error, blogPost, blogPostBlock, index) {\n            if(error) {\n              $log.debug(error);\n            }\n            else {\n              BlogService.removeFromClient($scope.blogPosts, blogPost, blogPostBlock);\n            }\n          });\n        break;\n        case 'destroyed':\n          if($rootScope.authenticated) {\n            $rootScope.pop('success', 'Ein Blogpost wurde gelöscht', msg.data.title);\n          }\n          findEvent(msg.id, function(error, blogPost, blogPostBlock, index) {\n            if(error) {\n              $log.debug(error);\n              return error;\n            }\n            else {\n              BlogService.removeFromClient($scope.blogPosts, blogPost, blogPostBlock);\n            }\n          });\n        break;\n        case 'addedTo':\n          if($rootScope.authenticated) {\n            $rootScope.pop('success', 'Ein Blogpost wurde hinzugefügt', msg.data.title);\n          }\n        break;\n      }\n    });\n  };\n\n  return {\n    validate: validate,\n    subscribe: subscribe,\n    append: append,\n    prepent: prepent,\n    sort: sort,\n    transform: transform,\n    saveOne: saveOne,\n    saveBlocks: saveBlocks,\n    save: save,\n    fixEach: fixEach,\n    find: find,\n    resolve: find, // alias\n    count: count,\n    refresh: refresh,\n    chooseType: chooseType,\n    removeFromClient: removeFromClient,\n    remove: destroy, // alias\n    destroy: destroy,\n    deleteAttachment: deleteAttachment,\n    destroyAttachment: deleteAttachment, // alias\n    create: create\n  };\n});","angular.module('jumplink.cms.browser', [])\n.directive('jlBrowser', function ($compile, $window) {\n\n  return {\n    restrict: 'E',\n    templateUrl: '/views/modern/browser.bootstrap.jade',\n    scope: {\n      force: \"=\"\n    },\n    link: function ($scope, $element, $attrs) {\n      \n    }\n  };\n});","angular.module('jumplink.cms.config', [\n  'sails.io',\n])\n.service('ConfigService', function ($sailsSocket, $filter, $log) {\n  var resolve = function(page) {\n    return $sailsSocket.get('/config/find').then (function (data) {\n      return data.data;\n    }, function error (resp){\n      $log.error(\"Error on resolve \"+page, resp);\n    });\n  };\n  return {\n    resolve: resolve\n  };\n});","angular.module('jumplink.cms.bootstrap.content', [\n  'jumplink.cms.content',\n])\n/**\n * TODO move other bootstrap stuff from  ContentService to this ContentBootstrapService\n */\n.service('ContentBootstrapService', function ($log, $async, ImportExportBootstrapService, UtilityService, ContentService, SortableService) {\n  var modals = null;\n  var host = null;\n\n  var setHost = function (newHost) {\n    host = newHost;\n  };\n\n  var setupImportModal = function ($scope, onImportFinsih) {\n    var fileOptions = {};\n\n    var onCompleteFile = function (err, files) {\n      $log.debug(\"[ContentBootstrapService.onCompleteFile]\", files);\n      var data = [];\n      for (var i = 0; i < files.length; i++) {\n        data = data.concat(files[i].data);\n      }\n      ImportExportBootstrapService.setImports(data, {identifierKey: 'name', descriptionKey: 'title'});\n    };\n\n    var onImportStart = function (imports, next) {\n      $log.debug(\"[ContentBootstrapService.onImportStart]\", host);\n      $async.map(imports, function (item, callback) {\n        if(item.importOptions.doImport === true) {\n          ContentService.updateOrCreateByHostByTitleAndPage(host, item, callback);\n        } else {\n          callback();\n        }\n        \n      }, function(err, results) {\n        $log.debug(\"[ContentBootstrapService.onImportStart] done\", err, results);\n        results = SortableService.sort(results);\n        next(err, results);\n      });\n      \n    };\n\n    var onAbort = function (imports, next) {\n      $log.debug(\"[ContentBootstrapService.onAbort]\");\n      next();\n    };\n\n    modals = ImportExportBootstrapService.setModals($scope, fileOptions, onCompleteFile, onImportStart, onAbort, onImportFinsih);\n  };\n\n  return {\n    setHost: setHost,\n    setupImportModal: setupImportModal,\n    showImportModal: ImportExportBootstrapService.show,\n  };\n});","angular.module('jumplink.cms.content', [\n  'mgcrea.ngStrap',\n  'angular-medium-editor',\n  'ui.ace',\n  'sails.io',\n  'jumplink.cms.sortable',\n  'ngFocus',\n  'jumplink.cms.utilities',\n])\n.service('ContentService', function ($rootScope, $log, $sailsSocket, $filter, $modal, $download, JLSailsService, SortableService, UtilityService, focus, $async) {\n\n  var showHtml = false;\n  var editModal = null;\n\n  var getShowHtml = function() {\n    return showHtml;\n  };\n\n  var setEditModal = function($scope) {\n    editModal = $modal({title: 'Inhaltsblock bearbeiten', templateUrl: '/views/modern/contentmodal.jade', show: false});\n    editModal.$scope.ok = false;\n    editModal.$scope.accept = function (hide) {\n      editModal.$scope.ok = true;\n      hide();\n    };\n    editModal.$scope.abort = function (hide) {\n      editModal.$scope.ok = false;\n      hide();\n    };\n    editModal.$scope.changeName = false;\n\n    editModal.$scope.$watch('content.title', function(newValue, oldValue) {\n      // $log.debug(\"Content in Content Modal changed!\", \"new\", newValue, \"old\", oldValue);\n      if(editModal.$scope.changeName && angular.isDefined(editModal.$scope.content)) {\n        editModal.$scope.content.name = generateName(newValue);\n      }\n    });\n\n    editModal.$scope.$on('modal.hide.before',function(event, editModal) {\n      // $log.debug(\"edit closed\", event, editModal);\n      editModal.$scope.changeName = false;\n      if(editModal.$scope.ok) {\n        return validateContent(editModal.$scope.content, editModal.$scope.callback);\n      }\n      if(angular.isFunction(editModal.$scope.callback)) {\n        return editModal.$scope.callback(\"discarded\", editModal.$scope.content);\n      }\n    });\n    return getEditModal();\n  };\n\n  var getEditModal = function() {\n    return editModal;\n  };\n\n  var subscribe = function() {\n    // called on content changes\n    $sailsSocket.subscribe('content', function(msg){\n      $log.debug(\"Content event!\", msg);\n      switch(msg.verb) {\n        case 'updated':\n          if($rootScope.authenticated) {\n            $rootScope.pop('success', 'Seite wurde aktualisiert', msg.id);\n          }\n        break;\n      }\n    });\n  };\n\n  var toogleShowHtml = function(contents, callback) {\n    showHtml = !showHtml;\n    if(showHtml && contents) {\n      contents = beautifyEach(contents);\n    }\n    if(angular.isFunction(callback)) {\n      return callback(null, showHtml);\n    }\n    return showHtml;\n  };\n\n  var beautify = function(content, callback) {\n    content.content = html_beautify(content.content);\n    if(angular.isFunction(callback)) {\n      return callback(null, content);\n    }\n    return content;\n  };\n\n  var beautifyEach = function(contents, callback) {\n    for (var i = contents.length - 1; i >= 0; i--) {\n      contents[i].content = beautify(contents[i].content);\n    }\n    if(angular.isFunction(callback)) {\n      return callback(null, contents);\n    }\n    return contents;\n  };\n\n  var getByName = function (contents, name) {\n    var index = UtilityService.findKeyValue(contents, 'name', name);\n    if(index > -1) {\n      return contents[index];\n    }\n    return null;\n  };\n\n  var create = function(data) {\n    if(!data || !data.content) {\n      data.content = \"\";\n    }\n    if(!data || !data.title) {\n      data.title = \"\";\n    }\n    if(!data || !data.name) {\n      data.name = \"\";\n    }\n    if(!data || !data.type) {\n      data.type = \"dynamic\";\n    }\n    if(!data || !data.page) {\n      $log.error(\"[ContentService] Page not set.\");\n    }\n    return data;\n  };\n\n  var append = function(contents, content, callback) {\n    SortableService.append(contents, content, callback, true, 'name');\n  };\n\n  var createEdit = function(contents, page, callback) {\n    var data = create({page:page});\n    edit(data, callback, true);\n  };\n\n  var swap = function(contents, index_1, index_2, callback) {\n    return SortableService.swap(contents, index_1, index_2, callback);\n  };\n\n  var moveForward = function(index, contents, callback) {\n    return SortableService.moveForward(index, contents, callback);\n  };\n\n  var moveBackward = function(index, contents, callback) {\n    return SortableService.moveBackward(index, contents, callback);\n  };\n\n  var validateContent = function (content, callback) {\n    if(content.title) {\n      return fix(content, callback);\n    }\n    if(angular.isFunction(callback)) {\n      return callback(\"Title not set\", content);\n    }\n    return null;\n  };\n\n  var edit = function(content, callback, changeName) {\n    $log.debug(\"edit\", content);\n    editModal.$scope.content = content;\n    editModal.$scope.callback = callback;\n    if(changeName) {\n      editModal.$scope.changeName = changeName;\n    }\n    else {\n      editModal.$scope.changeName = false;\n    }\n    focus('contentedittitle');\n    //- Show when some event occurs (use $promise property to ensure the template has been loaded)\n    editModal.$promise.then(editModal.show);\n  };\n\n  var removeFromClient = function (contents, index, content, callback) {\n    return SortableService.remove(index, contents, callback);\n  };\n\n  var remove = function(contents, index, content, page, callback) {\n    var errors = [\n      'Content konnte nicht gelöscht werden.'\n    ];\n    if(typeof(index) === 'undefined' || index === null) {\n      index = contents.indexOf(content);\n    }\n    // remove from client\n    contents = SortableService.remove(contents, index, content);\n    // if content has an id it is saved on database, if not, not\n    if(content.id) {\n      $log.debug(\"remove from server, too\" ,content);\n      $sailsSocket.delete('/content/'+content.id+\"?page=\"+page, {id:content.id, page: page}).success(function(data, status, headers, config) {\n        if(angular.isFunction(callback)) {\n          return callback(null, contents);\n        }\n        return contents;\n      }).\n      error(function(data, status, headers, config) {\n        $log.error (errors[0], data);\n        if(angular.isFunction(callback)) {\n          return callback(data);\n        }\n        return data;\n      });\n    } else {\n      if(angular.isFunction(callback)) {\n        return callback(null, contents);\n      }\n      return contents;\n    }\n  };\n\n  var refresh = function(contents, callback) {\n    fixEach(contents, function(err, contents) {\n      if(err) {\n        $log.error(err);\n        if(angular.isFunction(callback)) {\n          return callback(err);\n        }\n        return err;\n      }\n      beautifyEach(contents, function(err, contents) {\n        if(err) {\n          $log.error(err);\n          if(angular.isFunction(callback)) {\n            return callback(err);\n          }\n          return err;\n        }\n        if(angular.isFunction(callback)) {\n          return callback(null, contents);\n        }\n        return contents;\n      });\n    });\n  };\n\n  var generateName = function (title) {\n    var name = \"\";\n    if(title && title !== \"\") {\n      // Set content.name to content.title but only the letters in lower case\n      name = title.toLowerCase().replace(/[^a-z1-9]+/g, '');\n      $log.debug(\"set content.name to\", name);\n    }\n    return name;\n  };\n\n  /*\n   * Validate and fix content to make it saveable\n   */\n  var fix = function(content, callback) {\n\n    if(angular.isDefined(content)) {\n      if(angular.isUndefined(content.name) || content.name === '' || content.name === null) {\n        content.name = generateName(content.title);\n      }\n\n      if(!angular.isNumber(content.position)) {\n        content.position = 0;\n      }\n\n      if(!content.type || content.type === \"\") {\n        $log.warn(\"Fix content type not set, set it to dynamic\");\n        content.type = 'fix';\n      }\n    } else {\n      if(angular.isFunction(callback)) {\n        return callback(\"content not set\");\n      }\n      return null;\n    }\n\n    if(angular.isFunction(callback)) {\n      return callback(null, content);\n    }\n    return content;\n  };\n\n  /*\n   * Validate and fix all contents to make them saveable\n   */\n  var fixEach = function(contents, callback) {\n    for (var i = contents.length - 1; i >= 0; i--) {\n      contents[i] = fix(contents[i]);\n    }\n    if(angular.isFunction(callback)) {\n      return callback(null, contents);\n    }\n    return contents;\n  };\n\n  var saveOne = function(content, page, callback) {\n    var errors = [\n      'Inhalt konnte nicht gespeichert werden'\n    ];\n    content.page = page;\n    fix(content, function(err, content) {\n      if(err) {\n        if(angular.isFunction(callback)) {\n          return callback(err);\n        }\n        return err;\n      }\n      $sailsSocket.put('/content/replace', content).success(function(data, status, headers, config) {\n        //- $log.debug (\"save response from /content/replaceall\", data, status, headers, config);\n        if(data !== null && typeof(data) !== \"undefined\") {\n          content = data;\n          // $log.debug (content);\n          if(angular.isFunction(callback)) {\n            return callback(null, content);\n          }\n          return content;\n        } else {\n          $log.error(errors[0]);\n          if(angular.isFunction(callback)) {\n            return callback(errors[0]);\n          }\n          return errors[0];\n        }\n      }).\n      error(function(data, status, headers, config) {\n        $log.error (errors[0], data);\n        if(angular.isFunction(callback)) {\n          return callback(data);\n        }\n        return data;\n      });\n    });\n  };\n\n  var save = function(contents, page, callback) {\n    var errors = [\n      'Seite konnte nicht gespeichert werden'\n    ];\n    fixEach(contents, function(err, contents) {\n      if(err) {\n        if(angular.isFunction(callback)) {\n          return callback(err);\n        }\n        return err;\n      }\n      return $sailsSocket.put('/content/replaceall', {contents: contents, page: page}).success(function(data, status, headers, config) {\n        //- $log.debug (\"save response from /content/replaceall\", data, status, headers, config);\n        if(data !== null && typeof(data) !== \"undefined\") {\n          contents = $filter('orderBy')(data, 'position');\n          // $log.debug (data);\n          if(angular.isFunction(callback)) {\n            return callback(null, contents);\n          }\n          return contents;\n        }\n        $log.error(errors[0]);\n        if(angular.isFunction(callback)) {\n          return callback(errors[0]);\n        }\n        return errors[0];\n      }).\n      error(function(data, status, headers, config) {\n        $log.error (errors[0], data);\n        if(angular.isFunction(callback)) {\n          callback(data);\n        }\n      });\n    });\n  };\n  \n  var saveParallel = function(page, logger, options, obj, callback) {\n    $async.parallel(obj, function(err, results) {\n      if(err) {\n        $log.error(\"Error: On save content!\", err);\n        logger('error', 'Seiteninhalt konnte nichtgespeichert werden', err);\n        if(angular.isFunction(callback)) {\n          return callback(err);\n        }\n        return err;\n      }\n      if(options.applyResults) {\n        options.scope = angular.extend(options.scope, results);\n      }\n      logger('success', 'Seiteninhalt wurde gespeichert', \"\");\n      if(angular.isFunction(callback)) {\n        return callback(null, results);\n      }\n      return results;\n    });\n  };\n\n  var findOne = function(page, name, type, callback, next) {\n    var errors = [\n      \"Error: On trying to find one with page: \"+page+\", name: \"+name,\n      \"request has more than one results\"\n    ];\n    var query = {\n      page: page,\n      name: name\n    };\n    var url = '/content/find';\n    if(angular.isDefined(type) && type !== null) {\n      query.type = type;\n    }\n    return $sailsSocket.put(url, query).then (function (data) {\n      if(angular.isUndefined(data) || angular.isUndefined(data.data)) {\n        return null;\n      }\n      if(data.data instanceof Array) {\n        data.data = data.data[0];\n        $log.error(errors[1]);\n      }\n      // data.data.content = html_beautify(data.data.content);\n      if(next) {\n        data.data = next(data.data);\n      }\n      if(angular.isFunction(callback)) {\n        return callback(null, data.data);\n      }\n      return data.data;\n    }, function error (resp){\n      $log.error(errors[0], resp);\n      if(angular.isFunction(callback)) {\n        return callback(errors[0], resp);\n      }\n      return resp;\n    });\n  };\n\n  var findAll = function(page, type, callback, next) {\n    var errors = [\n      \"Error: On trying to find all with page: \"+page+\" and type: \"+type,\n      \"Warn: On trying to find all \"+page+\" contents! Not found, content is empty!\"\n    ];\n    var query = {};\n    var url = '/content/findall';\n    if(angular.isDefined(page) && page !== null) {\n      query.page = page;\n    }\n    if(angular.isDefined(type) && type !== null) {\n      query.type = type;\n    }\n    return $sailsSocket.put(url, query).then (function (data) {\n      if(angular.isUndefined(data) || angular.isUndefined(data.data)) {\n        $log.warn(errors[1]);\n        return null;\n      }\n      // data.data.content = html_beautify(data.data.content);\n      data.data = $filter('orderBy')(data.data, 'position');\n      // $log.debug(data);\n      if(next) {\n        data.data = next(data.data);\n      }\n\n      if(angular.isFunction(callback)) {\n        callback(null, data.data);\n      } else {\n        return data.data;\n      }\n    }, function error (resp){\n      $log.error(errors[0], resp);\n      if(angular.isFunction(callback)) {\n        return callback(errors[0], resp);\n      }\n      return resp;\n    });\n  };\n\n  /**\n   * For superadminsd\n   */\n  var findByHost = function(query, callback) {\n    var options = {\n      method: 'post',\n      resultIsArray: true\n    };\n    return JLSailsService.resolve('/Content/findByHost', query, options, callback);\n  };\n\n  /**\n   * For superadminsd\n   */\n  var exportByHost = function(host, download, callback) {\n    // $log.debug(\"[ContentService.findByHost]\");\n    var options = {\n      method: 'post',\n      resultIsArray: true\n    };\n    \n    return JLSailsService.resolve('/Content/exportByHost', {host: host}, options, function(err, data) {\n      $log.debug(\"[ContentService.exportByHost]\", err, data);\n      if(err) {\n        if(download) {\n          $download(JSON.stringify(data), \"error.txt\", \"text/plain\");\n        }\n        return callback(err);\n      }\n      if(download) {\n        $download(JSON.stringify(data), \"content.json\", \"text/json\");\n      }\n      return callback(err, data);\n    });\n  };\n\n  /**\n   * Update or create content for any passed host.\n   * Only for superadmins!\n   *\n   * @param req.param.host Host to save content for\n   */\n  var updateOrCreateByHostByTitleAndPage = function(host, content, callback) {\n    $log.debug(\"[contentsService.updateOrCreateByHostByTitleAndPage]\", host, content);\n    var options = {\n      method: 'post',\n      resultIsArray: false\n    };\n    return JLSailsService.resolve('/Content/updateOrCreateByHostByTitleAndPage', {host: host, content: content}, options, callback);\n  };\n  /*\n   * get all contents for page including images for each content.name \n   */\n  var findAllWithImage = function(page, type, callback, next) {\n    // $log.debug(\"findAllWithImage\");\n    var errors = [\n      \"Error: On trying to find all with page: \"+page+\" and type: \"+type,\n      \"Warn: On trying to find all \"+page+\" contents! Not found, content is empty!\"\n    ];\n    var query = {\n      page: page\n    };\n    var url = '/content/findAllWithImage?page='+page;\n    if(type) {\n      query.type = type;\n      url = url+'&type='+type;\n    }\n    return $sailsSocket.get(url, query).then (function (data) {\n      if(angular.isUndefined(data) || angular.isUndefined(data.data)) {\n        $log.warn(errors[1]);\n        return null;\n      }\n      // data.data.content = html_beautify(data.data.content);\n      data.data.contents = $filter('orderBy')(data.data.contents, 'position');\n      data.data.images = $filter('orderBy')(data.data.images, 'position');\n      // $log.debug(data);\n      if(next) {\n        data.data = next(data.data);\n      }\n      if(angular.isFunction(callback)) {\n        return callback(null, data.data);\n      }\n      return data.data;\n    }, function error (resp){\n      $log.error(errors[0], resp);\n      if(angular.isFunction(callback)) {\n        return callback(errors[0], resp);\n      }\n      return resp;\n    });\n  };\n\n  /**\n   *\n   */\n  var find = function(page, name, type, callback, next) {\n    //- get soecial content (one)\n    if(angular.isDefined(name)) {\n      return findOne(page, name, type, next);\n    // get all for page\n    } else {\n      return findAll(page, type, callback, next);\n    }\n  };\n\n  return {\n    subscribe: subscribe,\n    setEditModal: setEditModal,\n    getShowHtml: getShowHtml,\n    toogleShowHtml: toogleShowHtml,\n    beautify: beautify,\n    beautifyEach: beautifyEach,\n    create: create,\n    createEdit: createEdit,\n    append: append,\n    swap: swap,\n    moveForward: moveForward,\n    moveBackward: moveBackward,\n    edit: edit,\n    removeFromClient: removeFromClient,\n    remove: remove,\n    refresh: refresh,\n    fix: fix,\n    fixEach: fixEach,\n    save: save,\n    saveOne: saveOne,\n    saveParallel: saveParallel,\n    find: find,\n    resolve: find, // alias\n    findOne: findOne,\n    resolveOne: findOne, // alias\n    findAll: findAll, \n    resolveAll: findAll, //alias\n    findByHost: findByHost,\n    exportByHost: exportByHost,\n    updateOrCreateByHostByTitleAndPage: updateOrCreateByHostByTitleAndPage,\n    findAllWithImage: findAllWithImage,\n    resolveAllWithImage: findAllWithImage,  //alias\n    getByName: getByName\n  };\n});","angular.module('jumplink.cms.content.medium', [\n  'jumplink.cms.content',\n  'angular-medium-editor',\n])\n.value('mediumOptions', {\n  buttonLabels: \"fontawesome\",\n  toolbar: {\n    buttons: [\"bold\", \"italic\", \"underline\", \"anchor\", \"h2\", \"h3\", \"h4\", \"quote\", \"orderedlist\", \"unorderedlist\"]\n  }\n})\n.service('ContentMediumService', function ($rootScope, $log, $sailsSocket, $filter, $modal, SortableService, UtilityService, focus) {\n  // TODO\n  var Imager = function () {\n    this.button = document.createElement('button');\n    this.button.className = 'medium-editor-action';\n    this.button.innerText = 'Image';\n    this.button.innerHTML = '<i class=\"fa fa-picture-o\"></i>';\n    this.button.onclick = this.onClick.bind(this);\n    // this.classApplier = rangy.createCssClassApplier('highlight', {\n    //   elementTagName: 'mark',\n    //   normalize: true\n    // });\n  };\n  Imager.prototype.onClick = function() {\n    this.classApplier.toggleSelection();\n  };\n  Imager.prototype.getButton = function() {\n    return this.button;\n  };\n  Imager.prototype.checkState = function(node) {\n    if (node.tagName === 'MARK') {\n      this.button.classList.add('medium-editor-button-active');\n    }\n  };\n\n  return {\n    Imager: Imager\n  };\n})\n.directive('jlContent', function ($compile, $window, mediumOptions, ContentMediumService) {\n\n  return {\n    restrict: 'E',\n    templateUrl: '/views/modern/content.jade',\n    scope: {\n      authenticated : \"=\",\n      html: \"=\",\n      content: \"=?\",\n      mediumOptions: \"=?\",\n      mediumBindOptions: \"=?\",\n    },\n    link: function ($scope, $element, $attrs) {\n      if(angular.isUndefined($scope.mediumOptions)) {\n        $scope.mediumOptions = mediumOptions;\n      }\n      if(angular.isUndefined($scope.mediumBindOptions)) {\n        $scope.mediumBindOptions = {\n          extensions: {\n            'image': new ContentMediumService.Imager()\n          }\n        };\n      }\n    }\n  };\n})\n.directive('jlContentBlocks', function ($compile, $window, mediumOptions, ContentMediumService, SubnavigationService, HistoryService) {\n\n  return {\n    restrict: 'E',\n    templateUrl: '/views/modern/contentBlocks.jade',\n    scope: {\n      authenticated : \"=\",\n      html: \"=\",\n      contents: \"=\",\n      navs: \"=?\",\n      afterRefresh: \"=?\",\n      afterSave: \"=?\",\n      afterRemove: \"=?\",\n      afterEdit: \"=?\",\n      afterAdd: \"=?\",\n      subnavigation: \"=?\",\n      afterSaveNav: \"=?\",\n      afterRemoveNav: \"=?\",\n      afterEditNav: \"=?\",\n      afterAddNav: \"=?\",\n      logger: \"=\",\n      page: \"=?\",\n      mediumOptions: \"=?\",\n      mediumBindOptions: \"=?\",\n\n    },\n    link: function ($scope, $element, $attrs) {\n    },\n    controller: function ($rootScope, $scope, ContentService, $log, $state) {\n\n      ContentService.setEditModal($scope);\n      SubnavigationService.setEditModal($scope);\n      $scope.goTo = HistoryService.goToHashPosition;\n      ContentService.subscribe();\n      SubnavigationService.subscribe();\n      // SubnavigationService.resizeOnImagesLoaded();\n\n      if(angular.isUndefined($scope.page)) {\n        $scope.page = $state.current.name;\n      }\n\n      if(angular.isUndefined($scope.subnavigation)) {\n        $scope.subnavigation = false;\n      }\n\n      if(angular.isUndefined($scope.afterRefresh)) {\n        $scope.afterRefresh = function (err, result) {\n          if(err) {\n            return $scope.logger('error', \"Inhaltsblock wurde nicht erneuert!\", err);\n          }\n          $scope.logger('success', \"Inhaltsblock erneuert!\", \"\");\n        };\n      }\n\n      if(angular.isUndefined($scope.afterSave)) {\n        $scope.afterSave = function (err, result) {\n          if(err) {\n            return $scope.logger('error', \"Inhaltsblock wurde nicht gespeichert!\", err);\n          }\n          $scope.logger('success', \"Inhaltsblock gespeichert!\", result.title);\n        };\n      }\n\n      if(angular.isUndefined($scope.afterRemove)) {\n        $scope.afterRemove = function (err, result) {\n          if(err) {\n            return $scope.logger('error', \"Inhaltsblock wurde nicht entfernt!\", err);\n          }\n          $scope.logger('success', \"Inhaltsblock entfernt!\", result.title);\n        };\n      }\n\n      if(angular.isUndefined($scope.afterEdit)) {\n        $scope.afterEdit = function (err, result) {\n          if(err) {\n            return $scope.logger('error', \"Inhaltsblock wurde nicht bearbeitet!\", err);\n          }\n          $scope.logger('success', \"Inhaltsblock bearbeitet!\", result.title);\n        };\n      }\n\n      if(angular.isUndefined($scope.afterAdd)) {\n        $scope.afterAdd = function (err, result) {\n          if(err) {\n            return $scope.logger('error', \"Inhaltsblock wurde nicht hinzugefügt!\", err);\n          }\n          $scope.logger('success', \"Inhaltsblock hinzugefügt!\", result.title);\n        };\n      }\n\n      if(angular.isUndefined($scope.afterSaveNav)) {\n        $scope.afterSaveNav = function (err, result) {\n          if(err) {\n            return $scope.logger('error', \"Navigation wurde nicht gespeichert!\", err);\n          }\n          $scope.logger('success', \"Navigation gespeichert!\", result.title);\n        };\n      }\n\n\n      $scope.add = function() {\n        var errors = [\n          \"Error: Konnte Inhaltsblock nicht erzeugen\",\n          \"Error: Konnte Inhaltsblock nicht hinzufügen\",\n        ];\n\n        var successes = [\n          \"Neuen Inhaltsblock erfolgreich hinzugefügt\",\n          \"Neue Subnavigation erfolgreich hinzugefügt\",\n          \"Neuen Block erfolgreich hinzugefügt\",\n        ];\n\n        if(!$scope.authenticated) {\n          return false;\n        }\n        // generates new content and opens the modal\n        ContentService.createEdit($scope.contents, $scope.page, function(err, content) {\n          if(err) {\n            return $scope.afterAdd(err);\n          }\n          ContentService.append($scope.contents, content, $scope.afterAdd);  \n        });\n      };\n\n      $scope.moveForward = function(index, content) {\n        if(!$scope.authenticated) {\n          return false;\n        }       \n        SortableService.moveForward(index, $scope.contents, function(err, contents) {\n          if(err) {\n            $log.error(\"Error: On move content forward!\", err);\n            return err;\n          }\n          $scope.contents = contents;\n        });\n      };\n\n      $scope.moveBackward = function(index, content) {\n        if(!$scope.authenticated) {\n          return false;\n        }\n        SortableService.moveBackward(index, $scope.contents, function(err, contents) {\n          if(err) {\n            $log.error(\"Error: On move content backward!\", err);\n            return err;\n          }\n          $scope.contents = contents;\n        });\n      };\n\n      $scope.edit = function(index, content) {\n        if(!$scope.authenticated) {\n          return false;\n        }\n        ContentService.edit(content, $scope.afterEdit);\n      };\n\n      $scope.remove = function(index, content) {\n        if(!$scope.authenticated) {\n          return false;\n        }\n        ContentService.remove($scope.contents, index, content, $scope.page, $scope.afterRemove);\n      };\n\n      $scope.refresh = function() {\n        ContentService.refresh($scope.contents, $scope.afterRefresh);\n      };\n\n      $scope.toggleHtml = function(index, content) {\n        content.html = content.html !== true;\n      };\n\n      $scope.save = function() {\n        if(!$scope.authenticated) {\n          return false;\n        }\n        ContentService.save($scope.contents, $scope.page, $scope.afterSave);\n        if($scope.subnavigation) {\n          SubnavigationService.save($scope.navs, $scope.page, $scope.afterSaveNav);\n        }\n      };\n    }\n  };\n});","// window.saveAs\n// Shims the saveAs method, using saveBlob in IE10. \n// And for when Chrome and FireFox get round to implementing saveAs we have their vendor prefixes ready. \n// But otherwise this creates a object URL resource and opens it on an anchor tag which contains the \"download\" attribute (Chrome)\n// ... or opens it in a new tab (FireFox)\n// @author Andrew Dodson\n// @copyright MIT, BSD. Free to clone, modify and distribute for commercial and personal use.\n// window.saveAs || ( window.saveAs = (window.navigator.msSaveBlob ? function(b,n){ return window.navigator.msSaveBlob(b,n); } : false) || window.webkitSaveAs || window.mozSaveAs || window.msSaveAs || (function(){\n//   // URL's\n//   window.URL || (window.URL = window.webkitURL);\n//   if(!window.URL){\n//     return false;\n//   }\n//   return function(blob,name){\n//     var url = URL.createObjectURL(blob);\n//     // Test for download link support\n//     if( \"download\" in document.createElement(\"a\") ){\n//       var a = document.createElement(\"a\");\n//       a.setAttribute(\"href\", url);\n//       a.setAttribute(\"download\", name);\n//       // Create Click event\n//       var clickEvent = document.createEvent (\"MouseEvent\");\n//       clickEvent.initMouseEvent (\"click\", true, true, window, 0, \n//         clickEvent.screenX, clickEvent.screenY, clickEvent.clientX, clickEvent.clientY, \n//         clickEvent.ctrlKey, clickEvent.altKey, clickEvent.shiftKey, clickEvent.metaKey, \n//         0, null);\n//       // dispatch click event to simulate download\n//       a.dispatchEvent (clickEvent);\n//     }\n//     else{\n//       // fallover, open resource in new tab.\n//       window.open(url, \"_blank\", \"\");\n//     }\n//   };\n// })() );\n\n// Source: https://github.com/darius/requestAnimationFrame\n// Adapted from https://gist.github.com/paulirish/1579671 which derived from\n// http://paulirish.com/2011/requestanimationframe-for-smart-animating/\n// http://my.opera.com/emoller/blog/2011/12/20/requestanimationframe-for-smart-er-animating\n\n// requestAnimationFrame polyfill by Erik Möller.\n// Fixes from Paul Irish, Tino Zijdel, Andrew Mao, Klemen Slavič, Darius Bacon\n\n// MIT license\n\nif (!Date.now) {\n  Date.now = function() { return new Date().getTime(); };\n}\n\n(function() {\n    'use strict';\n\n    var vendors = ['webkit', 'moz'];\n    for (var i = 0; i < vendors.length && !window.requestAnimationFrame; ++i) {\n        var vp = vendors[i];\n        window.requestAnimationFrame = window[vp+'RequestAnimationFrame'];\n        window.cancelAnimationFrame = (window[vp+'CancelAnimationFrame'] || window[vp+'CancelRequestAnimationFrame']);\n    }\n    // iOS6 is buggy\n    if (/iP(ad|hone|od).*OS 6/.test(window.navigator.userAgent) || !window.requestAnimationFrame || !window.cancelAnimationFrame) {\n        var lastTime = 0;\n        window.requestAnimationFrame = function(callback) {\n          var now = Date.now();\n          var nextTime = Math.max(lastTime + 16, now);\n          return setTimeout(function() { callback(lastTime = nextTime); }, nextTime - now);\n        };\n        window.cancelAnimationFrame = clearTimeout;\n    }\n}());","// https://github.com/rndme/download\nangular.module('ngDownload', [])\n.service('$download', function ($log) { \n  if(angular.isDefined(download)) {\n    return download;\n  } else {\n    $log.error(\"[ngDownload] download is not defined, please install it from https://github.com/rndme/download\");\n    return null;\n  }\n  \n});","angular.module('jumplink.cms.event', [\n  'mgcrea.ngStrap',\n  'angular-medium-editor',\n  'angularFileUpload',\n  'angularMoment',\n  'ngFocus',\n  'ngAsync',\n  'sails.io',\n  'jumplink.cms.utilities',\n])\n.service('EventService', function (moment, UtilityService, $sailsSocket, $async, $log, focus, $modal, FileUploader) {\n  var editModal = null;\n  var typeModal = null;\n  var types = ['lecture', 'panel discussion', 'travel', 'info', 'food', 'other'];\n  var page = null;\n\n  var validate = function (event, callback) {\n    if(event.title) {\n      return fix(event, callback);\n    }\n    if(angular.isFunction(callback)) {\n      return callback(\"Title not set\", event);\n    }\n    return null;\n  };\n\n  var chooseType = function(event, type, hide) {\n    event.type = type;\n    hide();\n  };\n\n  var openTypeChooserModal = function(event) {\n    typeModal.$scope.event = event;\n    //- Show when some event occurs (use $promise property to ensure the template has been loaded)\n    typeModal.$promise.then(typeModal.show);\n  };\n\n  var setModals = function($scope, fileOptions, pageString) {\n\n    if(!angular.isString(page)) {\n      page = pageString;\n    }\n    \n    editModal = $modal({title: 'Ereignis bearbeiten', templateUrl: '/views/modern/events/editmodal.jade', show: false});\n    editModal.$scope.ok = false;\n    editModal.$scope.accept = function (hide) {\n      editModal.$scope.ok = true;\n      hide();\n    };\n    editModal.$scope.abort = function (hide) {\n      editModal.$scope.ok = false;\n      hide();\n    };\n\n    // set default fileOptions\n    if(angular.isUndefined(fileOptions)) {\n      fileOptions = {};\n    }\n\n    var uploadOptions = {\n      url: 'timeline/upload',\n      removeAfterUpload: true,\n      // WARN: headers HTML5 only\n      headers: {\n        options: JSON.stringify(fileOptions)\n      }\n    };\n\n    editModal.$scope.uploader = new FileUploader(uploadOptions);\n    editModal.$scope.openTypeChooserModal = openTypeChooserModal;\n\n    editModal.$scope.uploader.onCompleteItem = function(fileItem, response, status, headers) {\n      fileItem.event.download = response.files[0].uploadedAs;\n    };\n    editModal.$scope.uploader.onProgressItem = function(fileItem, progress) {\n      console.info('onProgressItem', fileItem, progress);\n    };\n    editModal.$scope.upload = function(fileItem, event) {\n      fileItem.event = event;\n      fileItem.upload();\n    };\n    typeModal = $modal({title: 'Typ wählen', templateUrl: '/views/modern/events/typechoosermodal.jade', show: false});\n    typeModal.$scope.chooseType = chooseType;\n    editModal.$scope.$on('modal.hide.before',function(event, editModal) {\n      $log.debug(\"edit closed\", event, editModal);\n      if(editModal.$scope.ok) {\n        return validate(editModal.$scope.event, editModal.$scope.callback);\n      }\n      if(angular.isFunction(editModal.$scope.callback)) {\n        return editModal.$scope.callback(\"discarded\", editModal.$scope.event);\n      }\n    });\n    return getModals();\n  };\n\n  var getEditModal = function() {\n    return editModal;\n  };\n\n  var getTypeModal = function() {\n    return typeModal;\n  };\n\n  var getModals = function() {\n    return {\n      editModal: getTypeModal(),\n      typeModal: getTypeModal()\n    };\n  };\n\n  var edit = function(event, eventBlockName, callback) {\n    // $log.debug(\"edit\", event);\n    editModal.$scope.event = event;\n    // editModal.$scope.eventBlockName = eventBlockName;\n    editModal.$scope.callback = callback;\n    editModal.$scope.ok = false;\n    focus('eventtitle');\n    //- Show when some event occurs (use $promise property to ensure the template has been loaded)\n    editModal.$promise.then(editModal.show);\n  };\n\n  var split = function(events) {\n    var unknown = [], before = [], after = [];\n    for (var i = 0; i < events.length; i++) {\n      if(angular.isDefined(events[i].to)) {\n        events[i].to = moment(events[i].to);\n      }\n      if(angular.isDefined(events[i].from)) {\n        events[i].from = moment(events[i].from);\n        if(events[i].from.isAfter()) {\n          after.push(events[i]);\n        }\n        else {\n          before.push(events[i]);\n        }\n      } else {\n        unknown.push(events[i]);\n      }\n    }\n    return {unknown:unknown, before:before, after:after};\n  };\n\n  var removeFromClient = function (events, event, eventBlockName, callback) {\n    var errors = [\n      \"no event on client site found to remove\"\n    ];\n    var index = events[eventBlockName].indexOf(event);\n    if (index > -1) {\n      events[eventBlockName].splice(index, 1);\n      if(angular.isFunction(callback)) {\n        return callback(null, events);\n      }\n      return events;\n    }\n    if(angular.isFunction(callback)) {\n      return callback(errors[0], events);\n    }\n    return errors[0];\n  };\n\n  var remove = function(events, event, eventBlockName, callback) {\n    // $log.debug(\"remove event\", event, eventBlockName);\n    if(event.id) {\n      $log.debug(event);\n      $sailsSocket.delete('/timeline/'+event.id).success(function(users, status, headers, config) {\n        removeFromClient(events, event, eventBlockName, callback);\n      });\n    } else {\n      removeFromClient(events, event, eventBlockName, callback);\n    }\n  };\n\n  var transform = function(events) {\n    events = split(events);\n    events.before = UtilityService.invertOrder(events.before);\n    return events;\n  };\n\n  var merge = function(unknown, before, after) {\n    if(angular.isUndefined(unknown)) {\n      unknown = [];\n    }\n    if(angular.isUndefined(before)) {\n      before = [];\n    }\n    if(angular.isUndefined(after)) {\n      after = [];\n    }\n    return unknown.concat(before).concat(after);\n  };\n\n  var append = function(events, event, callback) {\n    events.unknown.push(event);\n    var allEvents = merge(events.unknown, events.before, events.after);\n    events = transform(allEvents);\n    if(angular.isFunction(callback)) {\n      return callback(null, events);\n    }\n    return events;\n  };\n\n  var create = function(data) {\n    if(!data || !data.from) {\n      data.from = moment();\n      data.from.add(1, 'hours');\n      data.from.minutes(0);\n    }\n    if(!data || !data.title) {\n      data.title = \"\";\n    }\n    if(!data || !data.person) {\n      data.person = \"\";\n    }\n    if(!data || !data.place) {\n      data.place = \"\";\n    }\n    if(!data || !data.page) {\n      callback(\"Page not set.\");\n    }\n    return data;\n  };\n\n  var createEdit = function(events, event, callback) {\n    event = create(event); \n    edit(event, null, callback);\n  };\n\n  var fix = function(object, callback) {\n    if(!object.name || object.name === \"\") {\n      // Set object.name to object.title but only the letters in lower case\n      object.name = object.title.toLowerCase().replace(/[^a-z]+/g, '');\n      // $log.debug(\"set object.name to\", object.name);\n    }\n    if(angular.isFunction(callback)) {\n      return callback(null, object);\n    }\n    return object;\n  };\n\n  var fixEach = function(objects, callback) {\n    for (var i = objects.length - 1; i >= 0; i--) {\n      objects[i] = fix(objects[i]);\n    }\n    if(angular.isFunction(callback)) {\n      return callback(null, objects);\n    }\n    return objects;\n  };\n\n  var refresh = function(eventBlocks) {\n    var allEvents = merge(eventBlocks.unknown, eventBlocks.before, eventBlocks.after);\n    // $log.debug(\"allEvents.length\", allEvents.length);\n    eventBlocks = transform(allEvents);\n    // $log.debug(\"refreshed\");\n    return eventBlocks;\n  };\n\n  var saveOne = function (eventBlocks, eventBlockName, event, callback) {\n    var errors = [\n      \"EventService: Can't save event.\",\n      \"EventService: Can't save event, event to update not found.\",\n      \"EventService: Can't save event, parameters undefind.\",\n    ];\n    if(angular.isDefined(event) && angular.isDefined(eventBlockName) && angular.isDefined(callback)) {\n      event = fix(event);\n      if(angular.isUndefined(event.id)) {\n        // create because id is undefined\n        $sailsSocket.post('/timeline', event).success(function(data, status, headers, config) {\n          if(angular.isArray(data)) {\n            data = data[0];\n          }\n          // $log.debug(\"event created\", event, data);\n          var index = eventBlocks[eventBlockName].indexOf(event);\n          if (index > -1) {\n            eventBlocks[eventBlockName][index] = data;\n            // $log.debug(eventBlocks[eventBlockName][index]);\n            callback(null, eventBlocks[eventBlockName][index]);\n          } else {\n            callback(errors[1]);\n          }\n        }).error(function (data, status, headers, config) {\n          if(angular.isArray(data)) {\n            data = data[0];\n          }\n          $log.error(data, status, headers, config);\n          callback(errors[0]);\n        });\n      } else {\n        // update because id is defined\n        $sailsSocket.put('/timeline/'+event.id, event).success(function(data, status, headers, config) {\n          if(angular.isArray(data)) {\n            data = data[0];\n          }\n          // $log.debug(\"event updated\", event, data);\n          event = data;\n          callback(null, event);\n        }).error(function (data, status, headers, config) {\n          $log.error(data, status, headers, config);\n          callback(errors[0]);\n        });\n      }\n    } else {\n      callback(errors[2]);\n    }\n  };\n\n  var saveAllInBlock = function(eventBlocks, eventBlockName, callback) {\n    $async.map(eventBlocks[eventBlockName], function (event, callback) {\n      saveOne(eventBlocks, eventBlockName, event, callback);\n    }, callback);\n  };\n\n\n  var saveBlocks = function(eventBlocks, callback) {\n    var errors = [\n      \"EventService: Can't save eventBlocks, parameters undefind.\"\n    ];\n    // save just this event if defined\n    if(angular.isDefined(eventBlocks) && angular.isDefined(callback)) {\n      return $async.map(['after', 'before', 'unknown'], function (eventBlockName, callback) {\n        saveAllInBlock(eventBlocks, eventBlockName, callback);\n      }, function(err, eventBlocksArray) {\n        if(err) {\n           $log.error(err);\n          if(angular.isFunction(callback)) {\n            return callback(err);\n          }\n        }\n        var allEvents = merge(eventBlocksArray[0], eventBlocksArray[1], eventBlocksArray[2]);\n        eventBlocks = transform(allEvents);\n        return callback(null, eventBlocks);\n      });\n    }\n    $log.error(errors[0]);\n    if(angular.isFunction(callback)) {\n      return callback(errors[0]);\n    }\n  };\n\n  var resolve = function(page) {\n    return $sailsSocket.get('/timeline').then (function (data) {\n      // $log.debug(data);\n      return transform(data.data);\n    }, function error (resp){\n      $log.error(\"Error on resolve \"+page, resp);\n    });\n  };\n\n  var subscribe = function () {\n    $sailsSocket.subscribe('timeline', function(msg){\n      $log.debug(msg);\n      switch(msg.verb) {\n        case 'updated':\n          if($rootScope.authenticated) {\n            $rootScope.pop('success', 'Ein Ereignis wurde aktualisiert', msg.data.title);\n          }\n          findEvent(msg.id, function(error, event, eventBlock, index) {\n            if(error) {\n              $log.debug(error);\n              return error;\n            }\n            event = msg.data;\n            $scope.refresh();\n          });\n        break;\n        case 'created':\n          if($rootScope.authenticated) {\n            $rootScope.pop('success', 'Ein Ereignis wurde erstellt', msg.data.title);\n          }\n          $scope.events.before.push(msg.data);\n          $scope.refresh();\n        break;\n        case 'removedFrom':\n          if($rootScope.authenticated) {\n            $rootScope.pop('success', 'Ein Ereignis wurde entfernt', msg.data.title);\n          }\n          findEvent(msg.id, function(error, event, eventBlock, index) {\n            if(error) {\n              $log.debug(error);\n              return error;\n            }\n            EventService.removeFromClient($scope.events, event, eventBlock);\n          });\n        break;\n        case 'destroyed':\n          if($rootScope.authenticated) {\n            $rootScope.pop('success', 'Ein Ereignis wurde gelöscht', msg.data.title);\n          }\n          findEvent(msg.id, function(error, event, eventBlock, index) {\n            if(error) {\n              $log.debug(error);\n              return error;\n            }\n            EventService.removeFromClient($scope.events, event, eventBlock);\n          });\n        break;\n        case 'addedTo':\n          if($rootScope.authenticated) {\n            $rootScope.pop('success', 'Ein Ereignis wurde hinzugefügt', msg.data.title);\n          }\n        break;\n      }\n    });\n  };\n\n  return {\n    subscribe: subscribe,\n    split: split,\n    merge: merge,\n    append: append,\n    transform: transform,\n    saveOne: saveOne,\n    saveAllInBlock: saveAllInBlock,\n    saveBlocks: saveBlocks,\n    edit: edit,\n    createEdit: createEdit,\n    fixEach: fixEach,\n    resolve: resolve,\n    setModals: setModals,\n    refresh: refresh,\n    openTypeChooserModal: openTypeChooserModal,\n    chooseType: chooseType,\n    removeFromClient: removeFromClient,\n    remove: remove\n  };\n});","angular.module('jumplink.cms.fallback', [\n])\n.service('FallbackService', function ($window, $location, $log) {\n\n  var go = function(path) {\n    var protocol = $location.protocol();\n    var host = $location.host();\n    if(!angular.isString(path)) {\n      path = \"/fallback\";\n    } else {\n      if(path.charAt(0) !== '/') {\n        path = '/'+path;\n      }\n    }\n    var url = protocol+\"://\"+host+path+\"?force=fallback\";\n    $log.debug(\"Go to fallback url: \"+url);\n    // $window.location.href = url;\n  };\n\n  return {\n    go: go\n  };\n});","angular.module('ngFocus', [])\n// Source and Copyright: http://stackoverflow.com/questions/25596399/set-element-focus-in-angular-way\n.factory('focus', function($timeout, $window) {\n  return function(id) {\n    // timeout makes sure that it is invoked after any other event has been triggered.\n    // e.g. click events that need to run before the focus or\n    // inputs elements that are in a disabled state but are enabled when those events\n    // are triggered.\n    $timeout(function() {\n      var element = $window.document.getElementById(id);\n      if(element) {\n        element.focus();\n      }\n    });\n  };\n})\n.directive('eventFocus', function(focus) {\n  return function(scope, elem, attr) {\n    elem.on(attr.eventFocus, function() {\n      focus(attr.eventFocusId);\n    });\n\n    // Removes bound events in the element itself\n    // when the scope is destroyed\n    scope.$on('$destroy', function() {\n      elem.off(attr.eventFocus);\n    });\n  };\n});","angular.module('jumplink.cms.gallery', [\n  'mgcrea.ngStrap',\n  'ngAsync',\n  'angular-medium-editor',\n  'FBAngular',\n  'sails.io',\n  'angularFileUpload',\n  'jumplink.cms.sortable',\n  'jumplink.cms.content',\n])\n.service('GalleryService', function ($rootScope, $sailsSocket, $async, $filter, Fullscreen, SortableService, ContentService, FileUploader, $modal, $log) {\n\n  var editModal = null;\n  uploadModal = null;\n  fullscreenImage = null;\n\n  var dropdown = [\n    {\n      \"text\": \"<i class=\\\"fa fa-eye\\\"></i>&nbsp;Anzeigen\",\n      \"click\": \"goToImage(image)\"\n    },\n    {\n      \"text\": \"<i class=\\\"fa fa-edit\\\"></i>&nbsp;Bearbeiten\",\n      \"click\": \"editImage(image)\"\n    },\n    {\n      \"text\": \"<i class=\\\"fa fa-trash\\\"></i>&nbsp;Löschen\",\n      \"click\": \"$dropdown.hide();$dropdown.destroy();removeImage(image);\" // TODO delay\n    },\n    {\n      \"text\": \"<i class=\\\"fa fa-floppy-o\\\"></i>&nbsp;Speichern\",\n      \"click\": \"saveImage(image)\"\n    }\n  ];\n\n  var getDropdown = function () {\n    return dropdown;\n  };\n\n  var setEditModal = function($scope) {\n    editModal = $modal({scope: $scope, title: 'Bild bearbeiten', templateUrl: '/views/modern/gallery/editmodal.jade', show: false});\n    return getEditModal();\n  };\n\n  var getEditModal = function() {\n    return editModal;\n  };\n\n  var prepairUploadModal = function (uploadModal, imageBlocks, contentBlocks) {\n    \n    uploadModal.$scope.imageBlocks = imageBlocks;\n    uploadModal.$scope.selects = getSelects(imageBlocks, contentBlocks);\n    if(uploadModal.$scope.selects.length > 0) {\n      $rootScope.selectedContentBlock = uploadModal.$scope.selects[0].value;\n    }\n\n    $rootScope.$watch('selectedContentBlock', function(newValue, oldValue) {\n      $log.debug(\"selected changed to\", newValue);\n    });\n\n    return uploadModal;\n  };\n\n  var setUploadModal = function($scope, imageBlocks, contentBlocks, options, callback, onCompleteCallback) {\n\n    // if options not set, set to default values\n    if(angular.isUndefined(options)) {\n      options = {\n        thumbnail: {\n          width: 300,\n        },\n        rescrop: {\n          width: 1200,\n          cropwidth: 1200,\n          cropheight: 1200,\n        }\n      };\n    }\n\n    var uploadOptions = {\n      url: 'gallery/upload',\n      removeAfterUpload: true,\n      // WARN: headers HTML5 only\n      headers: {\n        options: JSON.stringify(options)\n      }\n    };\n\n    $scope.uploader = new FileUploader(uploadOptions);\n    $scope.uploader.filters.push({\n      name: 'imageFilter',\n      fn: function(item /*{File|FileLikeObject}*/, options) {\n        var type = '|' + item.type.slice(item.type.lastIndexOf('/') + 1) + '|';\n        return '|jpg|png|jpeg|bmp|gif|'.indexOf(type) !== -1;\n      }\n    });\n\n    if(angular.isFunction(onCompleteCallback)) {\n      $scope.uploader.onComplete = onCompleteCallback;\n    }\n\n    $scope.uploader.onCompleteItem = function(fileItem, response, status, headers) {\n      //fileItem.member.image = response.files[0].uploadedAs;\n      $log.debug(\"[GalleryService.uploader.onCompleteItem]\",fileItem, response, status, headers);\n      // WORKAROUND until the socket method works\n      response.files.forEach(function (file, index, files) {\n\n        var selected = $rootScope.selectedContentBlock;\n        var imageBlocks = uploadModal.$scope.imageBlocks;\n        var currentImages = imageBlocks[selected];\n\n        $log.debug(\"[GalleryService.$scope.uploader.onCompleteItem] selected\", selected, \"imageBlocks\", imageBlocks, \"currentImages\", currentImages);\n\n        var last_position = 0;\n        if(currentImages.length > 0) {\n          last_position = currentImages[currentImages.length-1].position;\n        }\n        if($rootScope.authenticated) {\n          $rootScope.pop('success', 'Ein Bild wurde hochgeladen', file.original.name);\n        }\n        if(typeof file.position === 'undefined') {\n          last_position++;\n          file.position = last_position;\n          file.content = selected;\n        }\n\n        $log.debug(\"[GalleryService.$scope.uploader.onCompleteItem] file\", file);\n        \n        currentImages.push(file);\n      });\n    };\n\n    $scope.upload = function(fileItem, image) {\n      fileItem.image = image;\n      fileItem.upload();\n    };\n\n    uploadModal = $modal({scope: $scope, title: 'Bilder hinzufügen', uploader: $scope.uploader, templateUrl: '/views/modern/gallery/uploadimagesmodal.jade', show: false});\n    uploadModal = prepairUploadModal(uploadModal, imageBlocks, contentBlocks);\n\n    if(angular.isFunction(callback)) {\n      return callback(getUploadModal());\n    }\n    return getUploadModal();\n  };\n\n  var getSelects = function (imageBlocks, contentBlocks) {\n    var blockNames = Object.keys(imageBlocks);\n    var result = [];\n    // console.log(\"contentBlocks\", contentBlocks);\n    blockNames.forEach(function (blockName, index, array) {\n      var label = ContentService.getByName(contentBlocks, blockName).title || blockName; // TODO WARNING slow!\n      result.push({\n        label: label,\n        value: blockName\n      });\n    });\n    return result;\n  };\n\n  var getUploadModal = function() {\n    return uploadModal;\n  };\n\n  var fix = function(image, page, contentname, callback) {\n    if(!image.page || image.page === \"\") {\n      image.page = page;\n    }\n\n    if(!image.content || image.content === \"\") {\n      image.content = contentname;\n    }\n\n    if(angular.isFunction(callback)) {\n      return callback(null, image);\n    }\n    return image;\n  };\n\n  // var setFullScreen = function(image) {\n  //   // http://stackoverflow.com/questions/21702375/angularjs-ng-click-over-ng-click\n  //   fullscreenImage = image;\n  // }\n\n  // var closeFullScreen = function(image) {\n  //   Fullscreen.cancel();\n  // }\n\n  // Fullscreen.$on('FBFullscreen.change', function(evt, isFullscreenEnabled){\n  //   if(!isFullscreenEnabled) {\n  //     delete fullscreenImage;\n  //   }\n  //   $scope.$apply();\n  // });\n\n  // var isFullScreen = function(image) {\n  //   if(angular.isDefined($scope.fullscreenImage) && angular.isDefined($scope.fullscreenImage.original) && angular.isDefined($scope.fullscreenImage.original.name) && $scope.fullscreenImage.original.name == image.original.name) {\n  //     return true;\n  //   } else {\n  //     return false;\n  //   }\n  // }\n\n  var saveOne = function(image, page, contentname, callback) {\n    image = fix(image, page, contentname);\n    var errors = [\n      'Bild konnte nicht gespeichert werden'\n    ];\n    $sailsSocket.put('/gallery/'+image.id, image).success(function(data, status, headers, config) {\n      if(angular.isArray(data)) {\n        data = data[0];\n      }\n      if(angular.isFunction(callback)) {\n        callback(null, data);\n      }\n    }).\n    error(function(data, status, headers, config) {\n      $log.error (errors[0], data);\n      if(angular.isFunction(callback)) {\n        callback(errors[0], data);\n      }\n    });\n  };\n\n  var saveAllBlocks = function(imageBlocks, page, callback) {\n    var blockNames = Object.keys(imageBlocks);\n    // $log.debug(\"saveAllBlocks\",\"blockNames\" , blockNames);\n\n    $async.map(blockNames,\n    function iterator(contentname, callback) {\n      saveAll(imageBlocks[contentname], page, contentname, callback);\n    }, callback);\n\n    // $async.map(images,\n    // function iterator(image, callback) {\n    //   saveOne(image, page, contentname, callback);\n    // }, callback);\n  };\n\n  var saveAll = function(images, page, contentname, callback) {\n    $async.map(images,\n    function iterator(image, callback) {\n      saveOne(image, page, contentname, callback);\n    }, callback);\n  };\n\n  var remove = function(images, index, image, page, callback) {\n    if(typeof(index) === 'undefined' || index === null) {\n      index = images.indexOf(image);\n    }\n    images = SortableService.remove(images, index, image);\n    // if image has an id it is saved on database, if not, not\n    if(image.id) {\n      // $log.debug(\"remove from server, too\" ,image);\n      $sailsSocket.delete('/gallery/'+image.id+\"?filename=\"+image.original.name+\"&page=\"+page, {id:image.id, filename:image.original.name, page: page}).success(function(data, status, headers, config) {\n        if(angular.isFunction(callback)) {\n          callback(null, images);\n        }\n      }).\n      error(function(data, status, headers, config) {\n        $log.error (errors[0], data);\n        if(angular.isFunction(callback)) {\n          callback(data);\n        }\n      });\n    } else {\n      if(angular.isFunction(callback)) {\n        callback(null, images);\n      }\n    }\n  };\n\n  var add = function(imageBlocks, contentBlocks, callback) {\n    // $log.debug(\"add\");\n    uploadModal.$promise.then(uploadModal.show);\n\n    uploadModal = prepairUploadModal(uploadModal, imageBlocks, contentBlocks);\n\n    uploadModal.$scope.$on('modal.hide',function(){\n      $log.debug(\"upload modal closed\");\n      if(angular.isFunction(callback)) {\n        callback(null);\n      }\n    });\n  };\n\n  // Images for Content\n  var addBlock = function(imageBlocks, content, callback) {\n    imageBlocks[content.name] = [];\n    if(angular.isFunction(callback)) {\n      return callback(null, imageBlocks[content.name]);\n    }\n    return imageBlocks[content.name];\n  };\n\n  var edit = function(image, callback) {\n    $log.debug(\"edit\", image);\n    editModal.$scope.image = image;\n    //- Show when some event occurs (use $promise property to ensure the template has been loaded)\n    editModal.$promise.then(editModal.show);\n\n    editModal.$scope.$on('modal.hide',function(){\n      $log.debug(\"edit closed\");\n      if(angular.isFunction(callback)) {\n        callback(null, editModal.$scope.image);\n      }\n    });\n  };\n\n  var aspect = function (image, width)  {\n    var height, scale, aspectRatio, win, paddingTopBottom = 0, paddingLeftRight = 0;\n    if($scope.isFullScreen(image)) {\n      // customised jQuery Method of http://css-tricks.com/perfect-full-page-background-image/\n      aspectRatio = image.original.width / image.original.height;\n      win = $rootScope.getWindowDimensions();\n      if(win.width / win.height < aspectRatio) {\n        width = win.width; // width 100%\n        scale = image.original.width / width;\n        height = image.original.height / scale;\n        paddingTopBottom = (win.height - height) / 2;\n        height = win.height;\n      } else {\n        height = win.height;  // height 100%\n        scale = image.original.height / height;\n        width = image.original.width / scale;\n        paddingLeftRight = (win.width - width) / 2;\n        width = win.width;\n      }\n      return {width: width+'px', height: height+'px', 'padding-right': paddingLeftRight+\"px\", 'padding-left': paddingLeftRight+\"px\", 'padding-top': paddingTopBottom+\"px\", 'padding-bottom': paddingTopBottom+\"px\" };\n    } else {\n      scale = image.original.width / width;\n      height =  image.original.height / scale;\n      return {width: width+'px', height: height+'px'};\n    }\n  };\n\n  var subscribe = function () {\n    $sailsSocket.subscribe('gallery', function(msg) {\n      $log.debug(msg);\n      switch(msg.verb) {\n        case 'updated':\n          if($rootScope.authenticated) {\n            $log.debug('success', 'Ein Bild wurde aktualisiert', msg.data.original.name);\n            // $rootScope.pop('success', 'Ein Bild wurde aktualisiert', msg.data.original.name);\n          }\n        break;\n        case 'created':\n          // TODO not broadcast / fired why?!\n          if($rootScope.authenticated) {\n            $rootScope.pop('success', 'Ein Bild wurde hochgeladen', msg.data.original.name);\n          }\n          $scope.images.push(msg.data);\n        break;\n        case 'removedFrom':\n          if($rootScope.authenticated) {\n            $rootScope.pop('success', 'Ein Bild wurde entfernt', \"\");\n          }\n          $log.debug(msg.data);\n        break;\n        case 'destroyed':\n          // if($rootScope.authenticated) {\n          //   $rootScope.pop('success', 'Ein Bild wurde gelöscht', \"\");\n          // }\n          $log.debug(msg.data);\n        break;\n        case 'addedTo':\n          if($rootScope.authenticated) {\n            $rootScope.pop('success', 'Ein Bild wurde hinzugefügt', \"\");\n          }\n          $log.debug(msg.data);\n        break;\n      }\n    });\n  };\n\n  var resolve = function(page, content) {\n    var url = '/gallery?limit=0&page='+page;\n    if(content) {\n      url = url+'&content='+content;\n    }\n    return $sailsSocket.get(url).then (function (data) {\n      return $filter('orderBy')(data.data, 'position');\n    }, function error (resp) {\n      $log.error(resp);\n    });\n  };\n\n  return {\n    getDropdown: getDropdown,\n    setEditModal: setEditModal,\n    getEditModal: getEditModal,\n    setUploadModal: setUploadModal,\n    getUploadModal: getUploadModal,\n    saveOne: saveOne,\n    saveAll: saveAll,\n    saveAllBlocks: saveAllBlocks,\n    remove: remove,\n    add: add,\n    addBlock: addBlock,\n    edit: edit,\n    aspect: aspect,\n    subscribe: subscribe,\n    resolve: resolve\n  };\n});","angular.module('jumplink.cms.history', [\n  'ui.router',\n])\n/**\n * @see: https://github.com/angular-ui/ui-router/issues/92\n */\n.service('HistoryService', function ($window, $location, $state, $anchorScroll, $timeout, $log) {\n  var history = [];\n  var push = function(state, params) {\n    history.push({ state: state, params: params });\n  };\n\n  var all = function() {\n    return history;\n  };\n\n  var go = function(step) {\n    $log.debug('[jumplink.cms.history.HistoryService], history.length', history.length, 'step', step, 'history.length + step =', history.length + step);\n    // If the past has not been saved as far as the steps that we want to go back, then go to the beginning of time\n    if(history.length + step <= 0) {\n     return $location.path('/');\n    }\n    // TODOlocation    // (1) Determine # of states in stack with URLs, attempt to\n    //    shell out to $window.history when possible\n    // (2) Attempt to figure out some algorthim for reversing that,\n    //     so you can also go forward\n    var prev = this.previous(step || -1);\n    return $state.go(prev.state, prev.params);\n  };\n\n  var previous = function(step) {\n    return history[history.length - Math.abs(step || 1)];\n  };\n\n  var back = function() {\n    return this.go(-1);\n  };\n\n  var goToHashPosition = function (hash) {\n    // $log.debug(\"go to hash\", hash);\n    $location.hash(hash);\n    $anchorScroll.yOffset = 60;\n    $anchorScroll();\n  };\n\n  var autoScroll = function () {\n    var hash = $location.hash();\n    // $log.debug(\"hash\", hash);\n    if(hash) {\n      // WORKAROUND\n      $timeout(function(){ goToHashPosition(hash); }, 1000); // TODO smooth?\n    } else {\n      $anchorScroll();\n    }    \n  };\n\n  return {\n    push: push,\n    all: all,\n    go: go,\n    previous: previous,\n    back: back,\n    goToHashPosition: goToHashPosition,\n    autoScroll: autoScroll\n  };\n\n})\n.run(function(HistoryService, $state, $rootScope) {\n\n  $rootScope.$on(\"$stateChangeSuccess\", function(event, to, toParams, from, fromParams) {\n    if (!from.abstract) {\n      HistoryService.push(from, fromParams);\n    }\n  });\n  console.log(HistoryService);\n  HistoryService.push($state.current, $state.params);\n\n});","angular.module('jumplink.cms.bootstrap.importexport', [\n  'jumplink.cms.importexport',\n  'jumplink.cms.bootstrap.uploader',\n  'mgcrea.ngStrap',\n  'ngFocus',\n])\n\n.service('ImportExportBootstrapService', function ($log, focus, $modal, FileUploader) {\n\n  var uploadModal = null;\n  \n\n  /**\n   * Setup the upload modal\n   */\n  var setModals = function($scope, fileOptions, onCompleteItemCallback, onImportStart, onAbort, onImportFinsih) {\n\n    uploadModal = $modal({title: 'JSON importieren', templateUrl: '/views/modern/uploadmodal.bootstrap.jade', show: false});\n    uploadModal.$scope.fileOptions = fileOptions;\n    uploadModal.$scope.imports = [];\n\n    uploadModal.$scope.ok = false;\n    uploadModal.$scope.import = function (hide) {\n      uploadModal.$scope.ok = true;\n\n      if(angular.isFunction(onImportStart)) {\n        onImportStart(uploadModal.$scope.imports, function (err, results) {\n          if(angular.isFunction(onImportFinsih)) {\n            onImportFinsih(err, results);\n          }\n          uploadModal.$scope.imports = [];\n          hide();\n        });\n      } else {\n        $log.warn(\"[ImportExportBootstrapService.abort] onImportStart is not defined!\");\n        uploadModal.$scope.imports = [];\n        hide();\n      }\n\n    };\n    uploadModal.$scope.abort = function (hide) {\n      uploadModal.$scope.ok = false;\n      uploadModal.$scope.imports = [];\n\n      if(angular.isFunction(onAbort)) {\n        onAbort(uploadModal.$scope.imports, function (err) {\n          hide();\n        });\n      } else {\n        $log.warn(\"[ImportExportBootstrapService.abort] onAbort is not defined!\");\n        hide();\n      }\n\n    };\n\n    // set default fileOptions\n    if(angular.isUndefined(uploadModal.$scope.fileOptions)) {\n      uploadModal.$scope.fileOptions = {};\n    }\n\n    uploadModal.$scope.uploadOptions = {\n      url: 'importexport/upload',\n      removeAfterUpload: true,\n      alias: 'import',\n\n      // WARN: headers HTML5 only\n      headers: {\n        options: JSON.stringify(uploadModal.$scope.fileOptions)\n      }\n    };\n\n    uploadModal.$scope.onCompleteItem = function (err, files) {\n      $log.debug(\"[ImportExportBootstrapService.onCompleteItem]\");\n      if(angular.isFunction(onCompleteItemCallback)) {\n        onCompleteItemCallback(err, files);\n      }\n    };\n    uploadModal.$scope.onCompleteAll = function (err, result) {\n      $log.debug(\"[ImportExportBootstrapService.onCompleteAll]\");\n    };\n\n    // uploadModal.$scope.uploader = new FileUploader($scope.uploadOptions);\n\n\n    uploadModal.$scope.upload = function(fileItem) {\n      fileItem.upload();\n    };\n\n    uploadModal.$scope.$on('modal.hide.before',function(modalEvent, uploadModal) {\n      $log.debug(\"edit closed\", uploadModal.$scope, uploadModal);\n      if(uploadModal.$scope.ok) {\n\n        uploadModal.$scope.callback(null, uploadModal.$scope);\n      } else {\n        if(uploadModal.$scope.callback) {\n          uploadModal.$scope.callback(\"discarded\", uploadModal.$scope);\n        }\n      }\n    });\n\n    return getModals();\n  };\n\n  var getUploadModal = function() {\n    return uploadModal;\n  };\n\n  var getModals = function() {\n    return {\n      uploadModal: getUploadModal(),\n    };\n  };\n\n  /**\n   * Show the upload modal to upload files\n   */\n  var show = function(callback) {\n    $log.debug(\"[BlogService.show]\");\n    uploadModal.$scope.callback = callback;\n    uploadModal.$scope.ok = false;\n    focus('blogposttitle');\n    //- Show when some blogPost occurs (use $promise property to ensure the template has been loaded)\n    uploadModal.$promise.then(uploadModal.show);\n  };\n\n  var setImports = function (data, options) {\n    uploadModal.$scope.imports = uploadModal.$scope.imports.concat(data);\n    for (var i = uploadModal.$scope.imports.length - 1; i >= 0; i--) {\n      uploadModal.$scope.imports[i].importOptions = {\n        doImport: true,\n        identifier: uploadModal.$scope.imports[i][options.identifierKey],\n        description: uploadModal.$scope.imports[i][options.descriptionKey],\n      };\n    }  \n  };\n\n  return {\n    show: show,\n    setModals: setModals,\n    setImports: setImports,\n  };\n});","angular.module('jumplink.cms.importexport', [\n  'jumplink.cms.attachment',\n  'ngAsync',\n  'sails.io',\n])\n\n.service('ImportExportService', function ($sailsSocket, $async, $log, $filter) {\n\n\n  return {\n\n  };\n});","angular.module('jumplink.cms.info', [\n  'sails.io',\n])\n\n.service('CmsService', function ($log, $sailsSocket) {\n\n  var info = function(url, callback) {\n    var errors = [\n      \"[CmsService] Error: On trying to get cms info, url: \"+url,\n      \"[CmsService] Error: Result is null, url: \"+url\n    ];\n    var warns = [\n      \"[CmsService] Warn: Request has more than one results, url: \"+url\n    ];\n    return $sailsSocket.get(url).then (function (data) {\n      if(angular.isUndefined(data) || angular.isUndefined(data.data)) {\n        if(angular.isFunction(callback)) {\n          return callback(errors[1]);\n        }\n        return null;\n      }\n      if (data.data instanceof Array) {\n        data.data = data.data[0];\n        $log.warn(warns[0]);\n      }\n      if(angular.isFunction(callback)) {\n        return callback(null, data.data);\n      }\n      return data.data;\n    }, function error (resp){\n      $log.error(errors[0], resp);\n      if(angular.isFunction(callback)) {\n        return callback(errors[0], resp);\n      }\n      return resp;\n    });\n  };\n\n  // CMS Info for Users\n  var infoUser = function(callback) {\n    return info('/cms/infouser', callback);\n  };\n\n  var infoAdmin = function(callback) {\n    return info('/cms/infoadmin', callback);\n  };\n\n  var restart = function(callback) {\n    return $sailsSocket.post('/cms/restart').then (function (data) {\n      $log.debug(\"[CmsService.restart]\", data);\n      return callback(null, data);\n    }, function error (resp){\n      $log.error(\"[CmsService.restart]\", resp);\n      return callback(resp);\n    });\n  };\n\n\n  /**\n   * Public functions\n   */\n  return {\n    infoUser: infoUser,\n    infoAdmin: infoAdmin,\n    restart: restart,\n  };\n});","angular.module('jumplink.cms.multisite', [\n  'sails.io',\n  'jumplink.cms.sails'\n])\n.service('MultisiteService', function ($rootScope, JLSailsService, $log) {\n\n  var resolve = function(query, callback) {\n    // $log.debug(\"[MultisiteService.resolve]\");\n    var options = {\n      method: 'get',\n      resultIsArray: true\n    };\n    return JLSailsService.resolve('/multisite/find', query, options, callback);\n  };\n\n  var resolveNames = function(query, callback) {\n    // $log.debug(\"[MultisiteService.resolveNames]\");\n    var options = {\n      method: 'get',\n      resultIsArray: true\n    };\n    return JLSailsService.resolve('/multisite/findnames', query, options, callback);\n  };\n\n  var resolveHosts = function(query, callback) {\n    // $log.debug(\"[MultisiteService.resolveNames]\");\n    var options = {\n      method: 'get',\n      resultIsArray: true\n    };\n    return JLSailsService.resolve('/multisite/findhosts', query, options, callback);\n  };\n\n  return {\n    resolve: resolve,\n    resolveNames: resolveNames,\n    resolveHosts: resolveHosts\n  };\n});","angular.module('jumplink.cms.bootstrap.routes', [\n  'jumplink.cms.routes',\n  'jumplink.cms.bootstrap.importexport',\n])\n.service('RoutesBootstrapService', function ($log, $async, ImportExportBootstrapService, UtilityService, RoutesService, SortableService) {\n  var modals = null;\n  var host = null;\n\n  var setHost = function (newHost) {\n    host = newHost;\n  };\n\n  var setupImportModal = function ($scope, onImportFinsih) {\n    var fileOptions = {};\n\n    var onCompleteFile = function (err, files) {\n      $log.debug(\"[RoutesBootstrapService.onCompleteFile]\", files);\n      var data = [];\n      for (var i = 0; i < files.length; i++) {\n        data = data.concat(files[i].data);\n      }\n      ImportExportBootstrapService.setImports(data, {identifierKey: 'objectName', descriptionKey: 'title'});\n    };\n\n    var onImportStart = function (imports, next) {\n      $log.debug(\"[RoutesBootstrapService.onImportStart]\", host);\n      $async.map(imports, function (item, callback) {\n        if(item.importOptions.doImport === true) {\n          RoutesService.updateOrCreateByHostByObjectNameAndNavbar(host, item, callback);\n        } else {\n          callback();\n        }\n        \n      }, function(err, results) {\n        $log.debug(\"[RoutesBootstrapService.onImportStart] done\", err, results);\n        results = SortableService.sort(results);\n        next(err, results);\n      });\n      \n    };\n\n    var onAbort = function (imports, next) {\n      $log.debug(\"[RoutesBootstrapService.onAbort]\");\n      next();\n    };\n\n    modals = ImportExportBootstrapService.setModals($scope, fileOptions, onCompleteFile, onImportStart, onAbort, onImportFinsih);\n  };\n\n  return {\n    setHost: setHost,\n    setupImportModal: setupImportModal,\n    showImportModal: ImportExportBootstrapService.show,\n  };\n\n});","angular.module('jumplink.cms.routes', [\n  'ui.router',                 // AngularUI Router: https://github.com/angular-ui/ui-router\n  'jumplink.cms.sails',\n  'jumplink.cms.sortable',\n  'jumplink.cms.utilities',\n  'ngDownload'\n])\n.provider('jlRoutes', function jlRoutesProvider($stateProvider, $urlRouterProvider, $locationProvider) {\n\n  this.html5Mode = $locationProvider.html5Mode;\n\n  this.otherwise = $urlRouterProvider.otherwise;\n\n  this.state = $stateProvider.state;\n\n  this.when = function (url1, url2) {\n    $urlRouterProvider.when(url1, url2);\n  };\n\n  this.setLayouts = function(layouts) {\n    for (var stateName in layouts ) {\n      this.state(stateName, layouts[stateName]);\n    }\n  };\n\n  this.setRoutes = function(routes, routeOptions) {\n    /**\n     * Load optional addional states.\n     * WARNING: Very experimental and dangerous.\n     */\n    for (var i = 0; i < routes.length; i++) {\n      // if is Main Route\n      if(routes[i].main) {\n        var options = {};\n        // set state main url\n        if(typeof(routes[i].url) === 'string' && routes[i].url.length > 0) {\n          options.url = routes[i].url;\n        }\n        // WARNING custom states are very experimental\n        if(routes[i].customstate === true) {\n          // TODO Dirty hack!\n          if(angular.isDefined(routes[i].state.resolve) && typeof(routes[i].state.resolve) === 'string' && routes[i].state.resolve.length > 0) {\n            /* jshint ignore:start */\n            eval(routes[i].state.resolve);\n            /* jshint ignore:end */\n            options.resolve = resolve;\n          }\n          // TODO Dirty hack!\n          if(angular.isDefined(routes[i].state.views) && typeof(routes[i].state.views) === 'string' && routes[i].state.views.length > 0) {\n            /* jshint ignore:start */\n            eval(routes[i].state.views);\n            /* jshint ignore:end */\n            options.views = view;\n          }\n        // states wich are defined in routeOptions\n        } else {\n          // set state options\n          if(angular.isDefined(routes[i].objectName) && angular.isDefined(routeOptions[routes[i].objectName])) {\n            // console.log(routeOptions[routes[i].objectName]);\n            if(angular.isObject(routeOptions[routes[i].objectName].resolve)) {\n              options.resolve = routeOptions[routes[i].objectName].resolve;\n            }\n            if(angular.isObject(routeOptions[routes[i].objectName].views)) {\n              options.views = routeOptions[routes[i].objectName].views;\n            }\n            \n          } else {\n            console.error(\"objectName \"+routes[i].objectName+\" not found for route \"+routes[i]);\n          } \n        }\n        // If options are set, init state\n        if(angular.isDefined(options.url) && angular.isDefined(options.views)) {\n          // console.log(\"New Route\", routes[i].state.name, options);\n          $stateProvider.state(routes[i].state.name, options);\n        }\n        //set alternative urls as redirects\n        if(angular.isArray(routes[i].alternativeUrls)) {\n          for (var a = 0; a < routes[i].alternativeUrls.length; a++) {\n            // e.g. $urlRouterProvider.when('/referenzen', '/referenzen/uebersicht');\n            console.log(\"New redirect: \"+routes[i].alternativeUrls[a]+\" -> \"+routes[i].url);\n            $urlRouterProvider.when(routes[i].alternativeUrls[a], routes[i].url);\n          }\n        }\n      } else {\n        // if route is not a main route\n        // if(typeof(routes[i].url) === 'string' && routes[i].url.length > 0) {\n        //   options.url = routes[i].url;\n        //   $urlRouterProvider.when(routes[i].alternativeUrls[a], routes[i].url);\n        // }\n        \n      }\n    }\n  };\n\n\n  this.$get = function jlRoutesFactory() {\n    // let's assume that the UnicornLauncher constructor was also changed to\n    // accept and use the useTinfoilShielding argument\n    return new jlRoutes();\n  };\n})\n.filter('showOnlyMainRoutes', function() {\n  // In the return function, we must pass in a single parameter which will be the data we will work on.\n  // We have the ability to support multiple other parameters that can be passed into the filter optionally\n  return function(routes, active) {\n    if(active !== true) {\n      return routes;\n    }\n    var result = [];\n    for (var i = 0; i < routes.length; i++) {\n      if(routes[i].main === true) {\n        result.push(routes[i]);\n      }\n    }\n    return result;\n  };\n})\n.service('RoutesService', function ($rootScope, $download, JLSailsService, $log, SortableService, UtilityService) {\n\n  var create = function(data) {\n    $log.debug(\"[RoutesService.create] data\", data);\n    if(!angular.isObject(data)) {\n      data = {};\n    }\n    if(!angular.isString(data.match)) {\n      data.match = \"\";\n    }\n    if(!angular.isString(data.title)) {\n      data.title = \"\";\n    }\n    if(data.main !== true && data.main !== false) {\n      data.main = false;\n    }\n    if(!angular.isString(data.url)) {\n      data.url = \"\";\n    }\n    if(!angular.isArray(data.alternativeUrls)) {\n      data.alternativeUrls = [];\n    }\n    if(angular.isUndefined(data.state) || !angular.isObject(data.state)) {\n      data.state = {};\n    }\n    if(!angular.isString(data.state.name)) {\n      data.state.name = \"\";\n    }\n    if(data.state.customstate !== true && data.state.customstate !== false) {\n      data.state.customstate = false;\n    }\n    if(!angular.isString(data.state.url)) {\n      data.state.url = \"\";\n    }\n    if(!angular.isString(data.state.views)) {\n      data.state.views = \"\";\n    }\n    if(!angular.isString(data.state.resolve)) {\n      data.state.resolve = \"\";\n    }\n    if(!angular.isObject(data.fallback)) {\n      data.fallback = {};\n    }\n    if(!angular.isString(data.fallback.url)) {\n      data.fallback.url = \"\";\n    }\n    return data;\n  };\n\n  var append = function(routes, data, callback) {\n    $log.debug(\"[RoutesService] data before\", data);\n    data = create(data);\n    $log.debug(\"[RoutesService] data after\", data);\n    SortableService.append(routes, data, callback);\n  };\n\n  var swap = function(routes, index_1, index_2, callback) {\n    return SortableService.swap(contents, index_1, index_2, callback);\n  };\n\n  var moveForward = function(index, routes, callback) {\n    return SortableService.moveForward(index, routes, callback);\n  };\n\n  var moveBackward = function(index, routes, callback) {\n    return SortableService.moveBackward(index, routes, callback);\n  };\n\n  var removeFromClient = function (routes, index, route, callback) {\n    if(angular.isFunction(callback)) {\n      return SortableService.remove(routes, index, route, callback);\n    }\n    return SortableService.remove(routes, index, route);\n  };\n\n  var remove = function(routes, index, route, callback) {\n    if((angular.isUndefined(route) || route === null) && angular.isDefined(index)) {\n      route = routes[index];\n    }\n    if(angular.isUndefined(index) || index === null) {\n      index = routes.indexOf(route);\n    }\n    routes = removeFromClient(routes, index, route);\n    // if route has an id it is saved on database, if not, not\n    if(route.id) {\n      $log.debug(\"[RoutesService.remove] remove from server, too\", route);\n      var options = {\n        method: 'delete',\n        resultIsArray: false\n      };\n      return JLSailsService.resolve('/routes/destroy/'+route.id, {id:route.id}, options, callback);\n    }\n  };\n\n  var find = function(query, callback) {\n    // $log.debug(\"[RoutesService.find]\");\n    var options = {\n      method: 'post',\n      resultIsArray: true\n    };\n    return JLSailsService.resolve('/routes/find', query, options, callback);\n  };\n\n  var findOne = function(query, callback) {\n    // $log.debug(\"[RoutesService.find]\");\n    var options = {\n      method: 'post',\n      resultIsArray: false\n    };\n    return JLSailsService.resolve('/routes/findOne', query, options, callback);\n  };\n\n\n  /**\n   * For superadminsd\n   */\n  var findByHost = function(query, callback) {\n    // $log.debug(\"[RoutesService.findByHost]\");\n    var options = {\n      method: 'post',\n      resultIsArray: true\n    };\n    return JLSailsService.resolve('/Routes/findByHost', query, options, callback);\n  };\n\n  /**\n   * For superadminsd\n   */\n  var exportByHost = function(host, download, callback) {\n    // $log.debug(\"[RoutesService.findByHost]\");\n    var options = {\n      method: 'post',\n      resultIsArray: true\n    };\n    \n    return JLSailsService.resolve('/Routes/exportByHost', {host: host}, options, function(err, data) {\n      $log.debug(\"[RoutesService.exportByHost]\", err, data);\n      if(err) {\n        if(download) {\n          $download(JSON.stringify(data), \"error.txt\", \"text/plain\");\n        }\n        return callback(err);\n      }\n      if(download) {\n        $download(JSON.stringify(data), \"routes.json\", \"text/json\");\n      }\n      return callback(err, data);\n    });\n  };\n\n  /**\n   * Update or create route (eg. position) for current host.\n   */\n  var updateOrCreate = function(route, callback) {\n    $log.debug(\"[RoutesService.updateOrCreate]\", route);\n    var options = {\n      method: 'post',\n      resultIsArray: false\n    };\n    return JLSailsService.resolve('/Routes/updateOrCreate', {route: route}, options, callback);\n  };\n\n  /**\n   * Update or create route for any passed host.\n   * Only for superadmins!\n   *\n   * @param req.param.host Host to save route for\n   */\n  var updateOrCreateByHostByObjectNameAndNavbar = function(host, route, callback) {\n    $log.debug(\"[RoutesService.updateOrCreateByHostByObjectNameAndNavbar]\", host, route);\n    var options = {\n      method: 'post',\n      resultIsArray: false\n    };\n    return JLSailsService.resolve('/Routes/updateOrCreateByHostByObjectNameAndNavbar', {host: host, route: route}, options, callback);\n  };\n\n  /**\n   * Update or create route (eg. position) for any passed host.\n   * Only for superadmins!\n   *\n   * @param req.param.host Host to save route for\n   */\n  var updateOrCreateByHost = function(host, route, callback) {\n    $log.debug(\"[RoutesService.updateOrCreateByHost]\", host, route);\n    var options = {\n      method: 'post',\n      resultIsArray: false\n    };\n    return JLSailsService.resolve('/Routes/updateOrCreateByHost', {host: host, route: route}, options, callback);\n  };\n\n  /**\n   * Update or create each route (eg. position) for current host.\n   */\n  var updateOrCreateEach = function(routes, callback) {\n    $log.debug(\"[RoutesService.updateOrCreateEach]\", routes);\n    var options = {\n      method: 'post',\n      resultIsArray: true\n    };\n    return JLSailsService.resolve('/Routes/updateOrCreateEach', {routes: routes}, options, callback);\n  };\n\n  /**\n   * Update or create each route (eg. position) for any passed host.\n   * Only for superadmins!\n   *\n   * @param req.param.host Host to save route for\n   */\n  var updateOrCreateEachByHost = function(host, routes, callback) {\n    $log.debug(\"[RoutesService.updateOrCreateEachByHost]\", host, routes);\n    var options = {\n      method: 'post',\n      resultIsArray: true\n    };\n    return JLSailsService.resolve('/Routes/updateOrCreateEachByHost', {host: host, routes: routes}, options, callback);\n  };\n\n  var generateObjectnameFromStatename = function (statename) {\n    $log.debug(\"[RoutesController.generateObjectnameFromStatename]\", statename);\n    var objectname = \"\";\n    var keys = statename.split('.');\n    for (var k = 0; k < keys.length; k++) {\n      objectname += UtilityService.capitalizeFirstLetter(keys[k]);\n    }\n    objectname = UtilityService.lowercaseFirstLetter(objectname);\n    return objectname;\n  };\n\n  var generateObjectnameFromUrl = function (url) {\n    var objectname = \"\";\n    var keys = url.split('/');\n    for (var k = 0; k < keys.length; k++) {\n      objectname += UtilityService.capitalizeFirstLetter(keys[k]);\n    }\n    objectname = UtilityService.lowercaseFirstLetter(objectname);\n    $log.debug(\"[RoutesController.generateObjectnameFromUrl]\", url, keys, objectname, objectname.length);\n    return objectname;\n  };\n\n  return {\n    create: create,\n    append: append,\n    swap: swap,\n    moveForward: moveForward,\n    moveBackward: moveBackward,\n    removeFromClient: removeFromClient,\n    remove: remove,\n    destroy: remove, // Alias\n    find: find,\n    findOne: findOne,\n    findByHost: findByHost,\n    exportByHost: exportByHost,\n    updateOrCreate: updateOrCreate,\n    updateOrCreateByHostByObjectNameAndNavbar: updateOrCreateByHostByObjectNameAndNavbar,\n    updateOrCreateByHost: updateOrCreateByHost,\n    updateOrCreateEach: updateOrCreateEach,\n    updateOrCreateEachByHost: updateOrCreateEachByHost,\n    saveEachByHost: updateOrCreateEachByHost, // Alias\n    generateObjectnameFromStatename: generateObjectnameFromStatename,\n    generateObjectnameFromUrl: generateObjectnameFromUrl,\n  };\n});","angular.module('jumplink.cms.sails', [\n    'sails.io',\n  ])\n\n  .service('JLSailsService', function ($rootScope, $sailsSocket, $q, $log) {\n\n    var resolve = function(url, query, options, callback, next) {\n      var deferred = $q.defer();\n      var errors = [\n        \"On trying to resolve \"+url,\n        \"Request has more than one results\",\n        \"No result\"\n      ];\n      if(angular.isUndefined(options)) {\n        options = {};\n      }\n      if(angular.isUndefined(options.method)) {\n        options.method = 'get';\n      }\n      if(angular.isUndefined(options.resultIsArray)) {\n        options.resultIsArray = false;\n      }\n      if(angular.isUndefined(query)) {\n        query = {};\n      }\n      // $log.debug(\"[JLSailsService.resolve]\", url, query, options);\n      $sailsSocket[options.method](url, query).then (function (data) {\n        if(angular.isUndefined(data) || angular.isUndefined(data.data)) {\n          if(angular.isFunction(callback)) {\n            return callback(null, null);\n          }\n          return deferred.resolve(null);\n        }\n        if (!options.resultIsArray && angular.isArray(data.data)) {\n          data.data = data.data[0];\n          $log.warn(errors[1]);\n        }\n        // data.data.content = html_beautify(data.data.content);\n        if(next) {\n          data.data = next(data.data);\n        }\n        if(angular.isFunction(callback)) {\n          callback(null, data.data);\n        }\n        return deferred.resolve(data.data);\n      }, function error (resp){\n        $log.error(errors[0], resp);\n        if(angular.isFunction(callback)) {\n          return callback(errors[0], resp);\n        }\n        return deferred.reject(errors[0]);\n      });\n      return deferred.promise;\n    };\n    return {\n      resolve: resolve,\n    };\n  })\n;","angular.module('jumplink.cms.session', [\n  'sails.io',\n  'jumplink.cms.sails'\n])\n.service('SessionService', function ($rootScope, JLSailsService, $sailsSocket, $q, $log) {\n\n  var create = function(user, callback) {\n    $log.debug(\"[SessionService.create]\", user);\n    var options = {\n      method: 'post',\n      resultIsArray: false\n    };\n    return JLSailsService.resolve('/session/create', user, options, callback);\n  };\n\n  var destroy = function(user, callback) {\n    $log.debug(\"[SessionService.destroy]\", user);\n    var options = {\n      method: 'post',\n      resultIsArray: false\n    };\n    return JLSailsService.resolve('/session/destroy', user, options, callback);\n  };\n\n  /**\n   * Check if user is authentication in current cms session\n   * Used if you need authentication conditions\n   */\n  var isAuthenticated = function (callback) {\n    $log.log(\"[SessionService.isauthenticated]\");\n    var deferred = $q.defer();\n    return $sailsSocket.get('/session/authenticated').then (function (data) {\n      if(angular.isFunction(callback)) {\n        return callback(null, data.data);\n      }\n      return data.data;\n    });\n  };\n\n  /**\n   * Used for routes you can only visit if you are signed in, throws an error message if your are not authenticated\n   */\n  var needToBeAuthenticated = function () {\n    $log.log(\"[SessionService.needToBeAuthenticated] authenticated\");\n    var deferred = $q.defer();\n    $sailsSocket.get('/session/authenticated').then (function (data) {\n      if (data.data) {\n        $log.log(\"is authenticated\", data);\n        return deferred.resolve(data.data);\n      } else {\n        $log.log(\"is not authenticated\", data);\n        return deferred.reject('You need to be logged in');\n      }\n    });\n    return deferred.promise;\n  };\n\n  /**\n   * Check if authentifcated user is blogger or better\n   */\n  var bloggerOrBetter = function (callback) {\n    $log.log(\"[SessionService.bloggerOrBetter]\");\n    var deferred = $q.defer();\n    return $sailsSocket.get('/session/bloggerOrBetter').then (function (data) {\n      if(angular.isFunction(callback)) {\n        return callback(null, data.data);\n      }\n      return data.data;\n    });\n  };\n\n  /**\n   * Check if cms is in developer mode or session user is better than that\n   */\n  var developerOrBetter = function (callback) {\n    $log.log(\"[SessionService.developerOrBetter]\");\n    var deferred = $q.defer();\n    return $sailsSocket.get('/session/developerOrBetter').then (function (data) {\n      if(angular.isFunction(callback)) {\n        return callback(null, data.data);\n      }\n      return data.data;\n    });\n  };\n\n  /**\n   * Check if authentifcated user is siteadmin or better\n   */\n  var siteadminOrBetter = function (callback) {\n    $log.log(\"[SessionService.siteadminOrBetter]\");\n    var deferred = $q.defer();\n    return $sailsSocket.get('/session/siteadminOrBetter').then (function (data) {\n      if(angular.isFunction(callback)) {\n        return callback(null, data.data);\n      }\n      return data.data;\n    });\n  };\n\n  /**\n   * Check if authentifcated user is superadmin\n   */\n  var superadmin = function (callback) {\n    $log.log(\"[SessionService.superadmin]\");\n    var deferred = $q.defer();\n    return $sailsSocket.get('/session/superadmin').then (function (data) {\n      if(angular.isFunction(callback)) {\n        return callback(null, data.data);\n      }\n      return data.data;\n    });\n  };\n\n  /**\n   * Check if authentifcated user is an employee\n   */\n  var employee = function (callback) {\n    $log.log(\"[SessionService.employee]\");\n    var deferred = $q.defer();\n    return $sailsSocket.get('/session/employee').then (function (data) {\n      if(angular.isFunction(callback)) {\n        return callback(null, data.data);\n      }\n      return data.data;\n    });\n  };\n\n  /**\n   * Check if authentifcated user is an employee or better\n   */\n  var employeeOrBetter = function (callback) {\n    $log.log(\"[SessionService.employee]\");\n    var deferred = $q.defer();\n    return $sailsSocket.get('/session/employeeOrBetter').then (function (data) {\n      if(angular.isFunction(callback)) {\n        return callback(null, data.data);\n      }\n      return data.data;\n    });\n  };\n\n  /**\n   * Used for routes you can only visit if you are signed in and user employee or better, throws an error message if your are not employee or better\n   */\n  var needToBeEmployeeOrBetter = function (callback) {\n    $log.log(\"[SessionService.authenticated] authenticated\");\n    var deferred = $q.defer();\n    $sailsSocket.get('/session/employeeOrBetter').then (function (data) {\n      if (data.data) {\n        $log.log(\"is employeeOrBetter\", data);\n        return deferred.resolve(data.data);\n      } else {\n        $log.log(\"is not employeeOrBetter\", data);\n        return deferred.reject('You must be an employee or a user with more credentials to do that');\n      }\n    });\n    return deferred.promise;\n  };\n\n  /**\n   * Used for routes you can only visit if you are signed in and user is admin or better, throws an error message if your are not employee or better\n   */\n  var needToBeSiteadminOrBetter = function (callback) {\n    $log.log(\"[SessionService.authenticated] authenticated\");\n    var deferred = $q.defer();\n    $sailsSocket.get('/session/siteadminOrBetter').then (function (data) {\n      if (data.data) {\n        $log.log(\"is siteadminOrBetter\", data);\n        return deferred.resolve(data.data);\n      } else {\n        $log.log(\"is not employeeOrBetter\", data);\n        return deferred.reject('You must be an admin or a user with more credentials to do that');\n      }\n    });\n    return deferred.promise;\n  };\n  /**\n   * \n   */\n  var getAllPolicies = function (callback) {\n    $log.log(\"[SessionService.getAllPolicies]\");\n    var deferred = $q.defer();\n    return $sailsSocket.get('/session/getAllPolicies').then (function (data) {\n      if(angular.isFunction(callback)) {\n        return callback(null, data.data);\n      }\n      return data.data;\n    });\n  };\n\n  /**\n   * Get logged in user\n   */\n  var getUser = function (callback) {\n    $log.log(\"[SessionService.getUser]\");\n    var deferred = $q.defer();\n    return $sailsSocket.get('/session/getUser').then (function (data) {\n      if(angular.isFunction(callback)) {\n        return callback(null, data.data);\n      }\n      return data.data;\n    });\n  };\n\n  return {\n    create: create,\n    destroy: destroy,\n    authenticated: needToBeAuthenticated, //alias TODO remove\n    needToBeAuthenticated: needToBeAuthenticated,\n    isAuthenticated: isAuthenticated, // TODO rename to authenticated\n    bloggerOrBetter: bloggerOrBetter,\n    developerOrBetter: developerOrBetter,\n    siteadminOrBetter: siteadminOrBetter,\n    superadmin: superadmin,\n    employee: employee,\n    employeeOrBetter: employeeOrBetter,\n    needToBeEmployeeOrBetter: needToBeEmployeeOrBetter,\n    needToBeSiteadminOrBetter: needToBeSiteadminOrBetter,\n    getAllPolicies: getAllPolicies,\n    getUser: getUser\n  };\n});","angular.module('jumplink.cms.sidebar', [\n    'mgcrea.ngStrap.aside',\n  ])\n\n  .directive('jlSidebar', function ($compile, $window) {\n\n    return {\n      restrict: 'E',\n      replace: true,\n      transclude: true,\n      templateUrl: '/views/modern/sidebar.jade',\n      scope: {\n        routes: \"=\",\n        title: \"=\" \n      },\n      link: function ($scope, $element, $attrs) {\n        \n      }\n    };\n  });","angular.module('jumplink.cms.bootstrap.signin', [\n    'mgcrea.ngStrap',\n    'jumplink.cms.signin'\n  ])\n\n  .service('SigninBootstrapService', function ($rootScope, SigninService, $log, $modal) {\n    var siginWithModal = function(title, goBackAfterSignin, extendRoles, scope, callback) {\n      $log.debug(\"[SigninBootstrapService.siginWithModal]\", title, goBackAfterSignin, extendRoles);\n\n      if(angular.isFunction(goBackAfterSignin) && !angular.isFunction(callback)) {\n        callback = goBackAfterSignin;\n        goBackAfterSignin = false;\n      }\n\n      if(angular.isFunction(extendRoles) && !angular.isFunction(callback)) {\n        callback = extendRoles;\n        extendRoles = false;\n      }\n\n      if(angular.isFunction(scope) && !angular.isFunction(callback)) {\n        callback = scope;\n        scope = null;\n      }\n\n      var signinModal = $modal({title: title, templateUrl: '/views/modern/signin.bootstrap.modal.jade', show: false});\n      signinModal.$scope.aborted = false;\n      signinModal.$scope.result = null;\n      signinModal.$scope.user = {\n        email: \"\",\n        password: \"\"\n      };\n      // signinModal.$scope.goBackAfterSignin = goBackAfterSignin === true;\n\n      signinModal.$scope.abort = function (user) {\n        signinModal.$scope.aborted = true;\n      };\n\n      signinModal.$scope.signin = function (user) {\n        $log.debug(\"[SigninBootstrapService.siginWithModal.signin]\", user);\n        SigninService.signin(user, goBackAfterSignin, extendRoles, scope, function (error, result) {\n          if(error) {\n            signinModal.$scope.error = error;\n            return signinModal.$scope.error;\n          }\n          signinModal.$scope.result = result;\n          // $rootScope.\n          $log.debug(result);\n        });\n      };\n\n      signinModal.$scope.$on('modal.hide',function(){\n        $log.debug(\"signin modal closed\");\n        if(angular.isFunction(callback)) {\n          callback(signinModal.$scope.error, signinModal.$scope.result, signinModal.$scope.user);\n        }\n      });\n\n      signinModal.$promise.then(signinModal.show);\n    };\n\n    return {\n      siginWithModal: siginWithModal\n    };\n  })\n;","angular.module('jumplink.cms.signin', [\n  'jumplink.cms.session',\n  'jumplink.cms.history',\n  'ngAsync'\n])\n.service('SigninService', function (SessionService, $log, HistoryService, $async) {\n\n\n  var getRoles = function (scope, callback) {\n    $async.parallel({\n      authenticated: function(callback) {\n        SessionService.isAuthenticated(callback);\n      },\n      bloggerOrBetter: function(callback) {\n        SessionService.bloggerOrBetter(callback);\n      },\n      siteadminOrBetter: function(callback) {\n        SessionService.siteadminOrBetter(callback);\n      },\n      employeeOrBetter: function(callback) {\n        SessionService.employeeOrBetter(callback);\n      }\n    },\n    callback);\n  };\n\n  var signin = function (user, goBackAfterSignin, extendRoles, scope, callback) {\n    if(angular.isFunction(goBackAfterSignin) && !angular.isFunction(callback)) {\n      callback = goBackAfterSignin;\n      goBackAfterSignin = false;\n    }\n\n    if(angular.isFunction(extendRoles) && !angular.isFunction(callback)) {\n      callback = extendRoles;\n      extendRoles = false;\n    }\n\n    if(angular.isFunction(scope) && !angular.isFunction(callback)) {\n      callback = scope;\n      scope = null;\n    }\n\n    $log.debug(\"[SigninService.signin]\", user);\n    // $scope.user.role = 'superadmin';\n    SessionService.create(user, function (err, result) {\n      if(err) {\n        return callback(err);\n      }\n      if(!result.authenticated) {\n        return null;\n      }\n      if(extendRoles === true) {\n        SessionService.getAllPolicies(function (err, results) {\n          if(err) {\n            return callback(err);\n          }\n          $log.debug(\"scope before extend\", scope);\n          angular.extend(scope, results);\n          $log.debug(\"scope after extend\", scope);\n          if(goBackAfterSignin === true) {\n            HistoryService.back();\n          }\n        });\n      }\n      if(goBackAfterSignin === true) {\n        HistoryService.back();\n      }\n\n      $log.debug(\"[SigninService.signin]\", user);\n      $log.debug(\"[SigninService.signin] err result\", err, result);\n      return callback(null, result);\n    });\n  };\n  return {\n    signin: signin\n  };\n});","angular.module('jumplink.cms.sortable', [\n    'jumplink.cms.utilities'\n  ])\n  .service('SortableService', function (UtilityService, $log, $filter) {\n    var resetPosition = function (array) {\n      for (var i = array.length - 1; i >= 0; i--) {\n        array[i].position = i+1;\n      }\n      return array;\n    };\n\n    var sort = function(objects) {\n      return $filter('orderBy')(objects, 'position');\n    };\n\n    /*\n     * Swap two elements within the object array (called objects) and adjust the position\n     */\n    var swap = function(objects, index_1, index_2, cb) {\n\n      var object_1 = objects[index_1];\n      var object_2 = objects[index_2];\n\n      // swap position too\n      var position_tmp = object_1.position;\n      object_1.position = object_2.position;\n      object_2.position = position_tmp;\n\n      // IMPORTANT: swap Indexes, too\n      objects[index_1] = object_2;\n      objects[index_2] = object_1;\n\n      if(angular.isFunction(cb)) {\n        return cb(null, objects);\n      }\n      return objects;\n    };\n\n    /*\n     * Insert new object to position and move the underlying objects one index back\n     * http://stackoverflow.com/questions/5306680/move-an-array-element-from-one-array-position-to-another\n     */\n    var move = function (array, old_index, new_index, cb) {\n      $log.debug(\"[SortableService] move\");\n\n      if (new_index >= array.length) {\n          var k = new_index - array.length;\n          while ((k--) + 1) {\n              array.push(undefined);\n          }\n      }\n      array.splice(new_index, 0, array.splice(old_index, 1)[0]);\n\n      array = resetPosition(array);\n\n      if(angular.isFunction(cb)) {\n        cb(null, array);\n      }\n      return array;\n    };\n\n    /*\n     * Append a new object to array, check unique key value if set\n     */\n    var append = function(objects, data, cb, unique, uniqueKey) {\n      $log.debug(\"[SortableService.append] data\", data);\n      var errors = [\n        \"Unique key '\"+uniqueKey+\"' already exist\"\n      ];\n      var new_index = objects.length;\n      var new_position = 1;\n      var new_object;\n      var uniqueIndex = -1;\n\n      var okay = function (new_object, objects, new_index, cb) {\n        // $log.debug(\"old objects\", objects);\n        objects.push(new_object);\n        // $log.debug(\"new objects\", objects);\n        if(angular.isFunction(cb)) {\n          return cb(null, objects, new_index);\n        }\n        return objects;\n      };\n\n      var error = function (error, objects, uniqueIndex, cb) {\n        if(angular.isFunction(cb)) {\n          return cb(error, objects, uniqueIndex);\n        }\n        return error;\n      };\n\n      if(new_index >= 1) {\n        new_position = objects[new_index-1].position+1;\n      }\n\n      new_object = {\n        position: new_position,\n      };\n\n      new_object = angular.extend(new_object, data);\n      $log.debug(\"[SortableService.append] new_object\", new_object);\n\n      if(unique && new_object[uniqueKey]) {\n        uniqueIndex = UtilityService.findKeyValue(objects, uniqueKey, new_object[uniqueKey]);\n        if(uniqueIndex > -1) {\n          return error(errors[0], objects, uniqueIndex, cb);\n        } else {\n          return okay(new_object, objects, new_index, cb);\n        }\n      } else {\n        return okay(new_object, objects, new_index, cb);\n      }\n    };\n\n    /*\n     * removed object from an array and adds it in another\n     */\n    var moveObjectToAnotherArray = function(object, index_from, array_from, array_to, cb, replaceData) {\n      var errors = [\n        \"[SortableService] Error: Function parameters not correctly set\"\n      ];\n\n      var errorParamsNotSet = function () {\n        $log.error(errors[0], object, index_from, array_from, array_to);\n        return cb(errors[0]);\n      };\n\n      if(object === null) {\n        object = array_from[index_from];\n      } else if (index_from === null) {\n        index_from = array_from.indexOf(object);\n      } else {\n        errorParamsNotSet();\n      }\n\n      if(!angular.isArray(array_from) || !angular.isArray(array_to)) {\n        errorParamsNotSet();\n      }\n\n      append(array_to, object, function (err, array_to, index_to) {\n        if(err) {\n          return cb(err);\n        }\n        remove(array_from, index_from, object, function (err, array_from) {\n          if(err) {\n            return cb(err);\n          }\n          return cb(null, {index_from: index_from, array_from: array_from, index_to:index_to, array_to: array_to });\n        });\n      }, false );\n    };\n\n    var moveForward = function(index, objects, cb) {\n      if(index + 1 < objects.length ) {\n        return swap(objects, index, index+1, cb);\n      }\n      if(angular.isFunction(cb)) {\n        return cb(\"Can't move forward, index is the last element.\", objects);\n      }\n      return objects;\n    };\n\n    var moveBackward = function(index, objects, cb) {\n      if(index - 1 >= 0) {\n        return swap(objects, index, index-1, cb);\n      }\n      if(angular.isFunction(cb)) {\n        return cb(\"Can't move backward, index is the first element.\", objects);\n      }\n      return objects;\n    };\n\n    var remove = function (objects, index, object, cb) {\n      if(typeof(index) === 'undefined' || index === null) {\n        index = objects.indexOf(object);\n      }\n      // $log.debug(\"remove from client\", index, object);\n      if (index > -1) {\n        objects.splice(index, 1);\n      }\n      if(angular.isFunction(cb)) {\n        return cb(null, objects);\n      }\n      return objects;\n    };\n\n    /*\n     * find value by key in array\n     */\n    var findKeyValue = function (objects, key, value) {\n      // $log.debug(\"findKeyValue\", key, value);\n      var index = -1;\n      for (var i = objects.length - 1; i >= 0 && index <= -1; i--) {\n        if(objects[i][key] === value) {\n          index = i;\n        } \n      }\n      return index;\n    };\n\n    /*\n     * Function for Drag and Drop functionality.\n     * Moves an moveable element with the moveFunction (e.g. to swap or insert the obkect).\n     * Usually called when the mouse button is released over an existing moveable element.\n     */\n    var dropMove = function(objects, dropObjectIndex, dragObject, event, cb, moveFunction) {\n      if(!moveFunction) {\n        moveFunction = move; // swap | move\n      }\n      var dragObjectIndex = objects.indexOf(dragObject);\n      var dropObject = objects[dropObjectIndex];\n      $log.debug(\"[SortableService] dropMove, dragObject:\", dragObject, \"dragObjectIndex\", dragObjectIndex, \"dropObject\", dropObject, \"dropObjectIndex\", dropObjectIndex);\n      return moveFunction(objects, dragObjectIndex, dropObjectIndex, cb);\n    };\n\n    return {\n      resetPosition: resetPosition,\n      sort: sort,\n      swap: swap,\n      moveObjectToAnotherArray: moveObjectToAnotherArray,\n      move: move,\n      moveForward: moveForward,\n      moveBackward: moveBackward,\n      remove: remove,\n      append: append,\n      dropMove: dropMove,\n    };\n  })\n\n;","angular.module('jumplink.cms.subnavigation', [\n  'mgcrea.ngStrap',\n  'sails.io',\n  'jumplink.cms.sortable',\n  'ngFocus',\n  'jumplink.cms.utilities'\n])\n\n.service('SubnavigationService', function ($rootScope, $window, $log, $sailsSocket, $filter, $modal, SortableService, UtilityService, focus) {\n\n  var editModal = null;\n\n  var setEditModal = function($scope) {\n    editModal = $modal({scope: $scope, title: 'Navigation bearbeiten', templateUrl: '/views/modern/editsubnavigationmodal.jade', show: false});\n    return getEditModal();\n  };\n\n  var getEditModal = function() {\n    return editModal;\n  };\n\n  var subscribe = function() {\n    // called on content changes\n    $sailsSocket.subscribe('navigation', function(msg){\n      $log.debug(\"[SubnavigationService] Navigation event!\", msg);\n      switch(msg.verb) {\n        case 'updated':\n          if($rootScope.authenticated) {\n            $rootScope.pop('success', 'Navigation wurde aktualisiert', msg.id);\n          }\n        break;\n      }\n    });\n  };\n\n  // WORKAROUND wait until image is loaded to fix bs-sidebar\n  var resizeOnImagesLoaded = function () {\n    angular.element($window).imagesLoaded(function() {\n      angular.element($window).triggerHandler('resize');\n    });\n  };\n\n  var create = function(data) {\n    if(!data || !data.target) {\n      data.target = \"\";\n    }\n    if(!data || !data.name) {\n      data.name = \"\";\n    }\n    if(!data || !data.page) {\n      cb(\"Page not set.\");\n    }\n    return data;\n  };\n\n  var append = function(navs, data, cb) {\n\n    data = create(data);\n\n    // $log.debug(\"[SubnavigationService] data\", data);\n\n    SortableService.append(navs, data, cb);\n  };\n\n  var swap = function(navs, index_1, index_2, cb) {\n    return SortableService.swap(contents, index_1, index_2, cb);\n  };\n\n  var moveForward = function(index, navs, cb) {\n    return SortableService.moveForward(index, navs, cb);\n  };\n\n  var moveBackward = function(index, navs, cb) {\n    return SortableService.moveBackward(index, navs, cb);\n  };\n\n  var edit = function(navs, cb) {\n    // $log.debug(\"[SubnavigationService] edit subnavigations\", navs);\n    editModal.$scope.navs = navs;\n    //- Show when some event occurs (use $promise property to ensure the template has been loaded)\n    editModal.$promise.then(editModal.show);\n\n    if(angular.isDefined(editModal.$scope.navs) && editModal.$scope.navs.length > 0) {\n      var index = Number(editModal.$scope.navs.length-1);\n      // $log.debug(\"[SubnavigationService] focus last subnavigationeditname\", index);\n      focus('subnavigationeditname'+index);\n    }\n\n    editModal.$scope.$on('modal.hide',function(){\n      // $log.debug(\"[SubnavigationService] edit navigation modal closed\");\n      cb(null, editModal.$scope.navs);\n    });\n  };\n\n  var removeFromClient = function (navs, index, nav, cb) {\n    if(angular.isFunction(cb)) {\n      return SortableService.remove(navs, index, nav, cb);\n    }\n    return SortableService.remove(navs, index, nav);\n  };\n\n  var remove = function(navs, index, nav, page, cb) {\n\n    if((angular.isUndefined(nav) || nav === null) && angular.isDefined(index)) {\n      nav = navs[index];\n    }\n\n    if(angular.isUndefined(index) || index === null) {\n      index = navs.indexOf(nav);\n    }\n\n    navs = removeFromClient(navs, index, nav);\n    // if nav has an id it is saved on database, if not, not\n    if(nav.id) {\n      $log.debug(\"[SubnavigationService] remove from server, too\" ,nav);\n      $sailsSocket.delete('/navigation/'+nav.id+\"?page=\"+page, {id:nav.id, page: page}).success(function(data, status, headers, config) {\n        if(angular.isFunction(cb)) {\n          return cb(null, navs);\n        }\n      }).\n      error(function(data, status, headers, config) {\n        $log.error (errors[0], data);\n        if(angular.isFunction(cb)) {\n          return cb(data);\n        }\n      });\n    }\n  };\n\n  var removeByTarget = function (navs, target, page, cb) {\n    $log.debug(\"[SubnavigationService] remove subnavigation by target \"+target);\n    var index = UtilityService.findKeyValue(navs, 'target', target);\n    if(index > -1) {\n      $log.debug(\"[SubnavigationService] subnavigation found \"+index);\n      remove(navs, index, null, page, cb);\n    } else {\n      if(angular.isFunction(cb)) {\n        cb(\"Subnavigation not found\");\n      }\n    }\n  };\n\n  var fix = function(fixed, object, index, cb) {\n    if(angular.isDefined(object.name) && angular.isString(object.name) && object.name !== \"\") {\n      fixed.push(object);\n    } else {\n      $log.warn(\"Name not set, remove Subnavigation\");\n    }\n    if(angular.isFunction(cb)) {\n      return cb(null, fixed);\n    }\n    return fixed;\n  };\n\n  var fixEach = function(objects, cb) {\n    var fixed = [];\n    for (var i = objects.length - 1; i >= 0; i--) {\n      fixed = fix(fixed, objects[i], i);\n    }\n    if(angular.isFunction(cb)) {\n      return cb(null, fixed);\n    }\n    return fixed;\n  };\n\n  var save = function(navs, page, cb) {\n    fixEach(navs, function(err, navs) {\n      $sailsSocket.put('/navigation/replaceall', {navs: navs, page: page}).success(function(data, status, headers, config) {\n        if(data !== null && typeof(data) !== \"undefined\") {\n          // WORKAROUND until socket event works\n          navs = $filter('orderBy')(data, 'position');\n          if(angular.isFunction(cb)) {\n            cb(null, navs);\n          }\n        } else {\n          var err = 'Navigation konnte nicht gespeichert werden';\n          $rootScope.pop('error', err, \"\");\n          if(angular.isFunction(cb)) {\n            cb(err, navs);\n          } \n        }\n      });\n    });\n  };\n\n  var resolve = function(page) {\n    var statename = 'layout.gallery';\n    return $sailsSocket.get('/navigation?page='+page, {page: page}).then (function (data) {\n      if(angular.isUndefined(data) || angular.isUndefined(data.data)) {\n        $log.warn(\"Warn: On trying to resolve \"+page+\" navs!\", \"Not found, navigation is empty!\");\n        return null;\n      }\n      data.data = $filter('orderBy')(data.data, 'position');\n      $log.debug(\"[SubnavigationService]\", data);\n      return data.data;\n    }, function error (resp){\n      $log.error(\"[SubnavigationService] Error: On trying to resolve \"+page+\" navs!\", resp);\n    });\n  };\n\n  return {\n    resizeOnImagesLoaded: resizeOnImagesLoaded,\n    subscribe: subscribe,\n    setEditModal: setEditModal,\n    getEditModal: getEditModal,\n    create: create,\n    append: append,\n    add: append,\n    swap: swap,\n    moveForward: moveForward,\n    moveBackward: moveBackward,\n    edit: edit,\n    removeFromClient: removeFromClient,\n    remove: remove,\n    removeByTarget: removeByTarget,\n    save: save,\n    resolve: resolve\n  };\n})\n\n.directive('jlSubnavigation', function ($compile, $window, SubnavigationService, HistoryService) {\n\n  return {\n    restrict: 'E',\n    templateUrl: '/views/modern/subnavigation.bootstrap.jade',\n    scope: {\n      authenticated : \"=\",\n      navs: \"=\",\n      afterSave: \"=?\",\n      afterRemove: \"=?\",\n      afterEdit: \"=?\",\n      afterAdd: \"=?\",\n      logger: \"=\",\n      page: \"=?\"\n\n    },\n    link: function ($scope, $element, $attrs) {\n    },\n    controller: function ($rootScope, $scope, ContentService, $log, $state) {\n\n      SubnavigationService.setEditModal($scope);\n      $scope.goTo = HistoryService.goToHashPosition;\n      SubnavigationService.subscribe();\n      // SubnavigationService.resizeOnImagesLoaded();\n\n      if(angular.isUndefined($scope.page)) {\n        $scope.page = $state.current.name;\n      }\n\n      if(angular.isUndefined($scope.afterSave)) {\n        $scope.afterSave = function (err, result) {\n          if(err) {\n            return $scope.logger('error', \"Navigation wurde nicht gespeichert!\", err);\n          }\n          $scope.logger('success', \"Navigation gespeichert!\", result.title);\n        };\n      }\n\n      if(angular.isUndefined($scope.afterRemove)) {\n        $scope.afterRemove = function (err, result) {\n          if(err) {\n            return $scope.logger('error', \"Navigation wurde nicht entfernt!\", err);\n          }\n          $scope.logger('success', \"Navigation entfernt!\", result.title);\n        };\n      }\n\n      if(angular.isUndefined($scope.afterEdit)) {\n        $scope.afterEdit = function (err, result) {\n          if(err) {\n            return $scope.logger('error', \"Navigation wurde nicht bearbeitet!\", err);\n          }\n          $scope.logger('success', \"Navigation bearbeitet!\", result.title);\n        };\n      }\n\n      if(angular.isUndefined($scope.afterAdd)) {\n        $scope.afterAdd = function (err, result) {\n          if(err) {\n            return $scope.logger('error', \"Navigation wurde nicht hinzugefügt!\", err);\n          }\n          $scope.logger('success', \"Navigation hinzugefügt!\", result.title);\n        };\n      }\n\n      $scope.add = function() {\n        if(!$scope.authenticated) {\n          return false;\n        }\n        SubnavigationService.add($scope.navs, {page:page}, $scope.afterAdd);\n      };\n      $scope.addNav = $scope.add; // alias\n\n      $scope.moveForward = function(index, nav) {\n        SortableService.moveForward(index, $scope.navs, function(err, navs) {\n          if(err) {\n            $log.error(\"Error: On move subnavigation forward!\", err);\n            return err;\n          }\n          $scope.navs = navs;\n        });\n      };\n      $scope.moveForwardNav = $scope.moveForward; // alias\n\n      $scope.moveBackward = function(index, nav) {\n        SortableService.moveBackward(index, $scope.navs, function(err, navs) {\n          if(err) {\n            $log.error(\"Error: On move content backward!\", err);\n            return err;\n          }\n          $scope.navs = navs;\n        });\n      };\n      $scope.moveBackwardNav = $scope.moveBackward; // alias\n\n      $scope.edit = function(navs) {\n        if(!$scope.authenticated) {\n          return false;\n        }\n        SubnavigationService.edit(navs, $scope.afterEdit);\n      };\n      $scope.editNavs = $scope.edit; // alias\n\n      $scope.remove = function(index, nav) {\n        if(!$scope.authenticated) {\n          return false;\n        }\n        SubnavigationService.remove($scope.navs, index, nav, page, $scope.afterRemove);\n      };\n      $scope.removeNav = remove; // alias\n\n      $scope.save = function () {\n        SubnavigationService.save($scope.navs, page, $scope.afterSave);\n      };\n\n\n      // TODO move to own drag and drops sortable navigation directive \n      $scope.onDragOnComplete = function(index, nav, evt) {\n        if(nav === null) {\n          $log.debug(\"*click*\", index);\n        }\n        $log.debug(\"onDragOnComplete, nav:\", nav, \"index\", index);\n      };\n      $scope.onDragOnNavComplete = $scope.onDragOnComplete; // alias\n\n      $scope.onDropOnComplete = function(dropnavindex, dragnav, event) {\n        SortableService.dropMove($scope.navs, dropnavindex, dragnav, event, function(err, navs) {\n          $scope.navs = navs;\n        });\n      };\n      $scope.onDropOnNavComplete = $scope.onDropOnComplete; // alias\n\n      $scope.onDropOnAreaComplete = function(nav, evt) {\n        var index = $scope.navs.indexOf(nav);\n      };\n\n    }\n  };\n});","angular.module('jumplink.cms.theme', [\n  'sails.io',\n  'ngAsync',\n  'jumplink.cms.sails',\n])\n\n.service('ThemeService', function ($rootScope, $sailsSocket, $log, $async, JLSailsService) {\n  var isSubscribed = false;\n\n  /**\n   * find themes for current host from database and isert priority from database (or from local.json if no priority is set).\n   * @see CMS.ThemesController.find\n   */\n  var find = function(query, callback) {\n    $log.debug(\"[ThemeService.find]\", query);\n    var options = {\n      method: 'get',\n      resultIsArray: true\n    };\n    return JLSailsService.resolve('/theme/find', query, options, callback);\n  };\n\n  /**\n   * find themes for any host from database and isert priority from database (or from local.json if no priority is set).\n   * Only for superadmins!\n   */\n  var findByHost = function(host, callback) {\n    // $log.debug(\"[ThemeService.findByHost]\", host);\n    var options = {\n      method: 'post',\n      resultIsArray: true\n    };\n    return JLSailsService.resolve('/theme/findbyhost', {host: host}, options, callback);\n  };\n\n  var save = function (themes, callback) {\n    updateOrCreateEach(themes, function (err, result) {\n      if(angular.isDefined(callback)) {\n        callback(err, result);\n      }\n    });\n  };\n  \n  var updateOrCreateEach = function(themes, callback) {\n    $log.debug(\"[ThemeService.updateOrCreateEach]\", themes);\n    // $sailsSocket.put('/Theme/updateOrCreateEach', {themes: themes}).success(function(data, status, headers, config) {\n    //   $log.debug(data, status, headers, config);\n    //   callback(data, status, headers, config)\n    // });\n    var options = {\n      method: 'post',\n      resultIsArray: true\n    };\n    return JLSailsService.resolve('/Theme/updateOrCreateEach', {themes: themes}, options, callback);\n  };\n\n  var updateOrCreateEachByHost = function(host, themes, callback) {\n    // $log.debug(\"[ThemeService.updateOrCreateEachByHost]\", host, themes);\n    var options = {\n      method: 'post',\n      resultIsArray: true\n    };\n    return JLSailsService.resolve('/Theme/updateOrCreateEachByHost', {host: host, themes: themes}, options, callback);\n  };\n\n  // TODO\n  var subscribe = function () {\n    if(!isSubscribed) {\n      $sailsSocket.subscribe('theme', function(msg){\n        if($rootScope.authenticated) {\n          $log.debug(msg);\n        }\n        switch(msg.verb) {\n          case 'updated':\n            if($rootScope.authenticated) {\n              $rootScope.pop('success', 'Themeeinstellungen wurdne aktualisiert', msg.data);\n            }\n          break;\n          case 'created':\n            if($rootScope.authenticated) {\n              $rootScope.pop('success', 'Themeeinstellungen wurden erstellt', msg.data);\n            }\n          break;\n          case 'removedFrom':\n            if($rootScope.authenticated) {\n              $rootScope.pop('success', 'Themeeinstellungen wurden entfernt', \"\");\n            }\n          break;\n          case 'destroyed':\n            if($rootScope.authenticated) {\n              $rootScope.pop('success', 'Themeeinstellungen wurden gelöscht', \"\");\n            }\n          break;\n          case 'addedTo':\n            if($rootScope.authenticated) {\n              $rootScope.pop('success', 'Themeeinstellungen wurden hinzugefügt', \"\");\n            }\n          break;\n        }\n      });\n      isSubscribed = true;\n    }\n  };\n\n  return {\n    find: find,\n    findByHost: findByHost,\n    save: save,\n    updateOrCreateEach: updateOrCreateEach,\n    updateOrCreateEachByHost: updateOrCreateEachByHost,\n    subscribe: subscribe\n  };\n});","angular.module('jumplink.cms.toolbar', [\n  'FBAngular'\n])\n.directive('jlToolbar', function ($compile, $window) {\n\n  return {\n    restrict: 'E',\n    templateUrl: '/views/modern/toolbar.jade',\n    scope: {\n      routes: \"=\",\n      title: \"=\",\n      shorttitle: \"=\",\n      fluid: \"=\",\n      position: \"=\",\n      filter: \"=\",\n      subnavigation: \"=?\",\n    },\n    link: function ($scope, $element, $attrs) {\n\n    },\n    controller: function ($scope, $log, Fullscreen) {\n      $scope.fullscreenIsSupported = Fullscreen.isSupported();\n      $scope.isFullscreen = false;\n      $log.debug(\"[jumplink.cms.toolbar.jlToolbar.controller]\", $scope);\n      Fullscreen.$on('FBFullscreen.change', function(evt, isFullscreenEnabled){\n        $scope.isFullscreen = isFullscreenEnabled === true;\n        // $scope.$apply();\n      });\n\n      $scope.toggleFullscreen = function () {\n        if (Fullscreen.isEnabled()) {\n          Fullscreen.cancel();\n        } else {\n          Fullscreen.all();\n        }\n      };\n    }\n  };\n});","angular.module('jumplink.cms.bootstrap.uploader', [\n  'angularFileUpload',\n])\n.directive('jlUploader', function () {\n\n  return {\n    restrict: 'E',\n    templateUrl: '/views/modern/uploader.bootstrap.jade',\n    scope: {\n      label : \"@\",\n      labelFiles : \"@\",\n      uploadOptions: \"=\",\n      fileOptions: \"=\",\n      onCompleteAll: \"=\",\n      onCompleteItem: \"=\",\n    },\n    link: function ($scope, $element, $attrs) {\n    },\n    controller: function ($rootScope, $scope, $log, FileUploader) {\n      $scope.files = [];\n      if(angular.isUndefined($scope.fileOptions)) {\n        $scope.fileOptions = {};\n      }\n      $scope.uploader = new FileUploader($scope.uploadOptions);\n      $log.debug(\"[jlUploader] uploadOptions\", $scope.uploadOptions);\n      $log.debug(\"[jlUploader] uploader\", $scope.uploader);\n      $log.debug(\"[jlUploader] onCompleteAll\", $scope.onCompleteAll);\n      $log.debug(\"[jlUploader] onCompleteItem\", $scope.onCompleteItem);\n\n      $scope.uploader.onCompleteItem = function(fileItem, response, status, headers) {\n        $log.debug(\"[jlUploader.onCompleteItem] status\", status);\n        for (var i = 0; i < response.files.length; i++) {\n          $log.debug(\"[jlUploader.onCompleteItem] response.files[i]\", response.files[i]);\n        }\n        $scope.files = $scope.files.concat(response.files);\n        if(angular.isFunction($scope.onCompleteItem)) {\n          $scope.onCompleteItem(null, $scope.files); // TODO detect error\n        }\n      };\n      \n      $scope.uploader.onCompleteAll = function() {\n        $log.debug(\"[jlUploader.onCompleteAll]\");\n        if(angular.isFunction($scope.onCompleteAll)) {\n          $scope.onCompleteAll(null, $scope.files);\n        }\n      };\n\n      $scope.upload = function(fileItem) {\n        fileItem.upload();\n      };\n\n      $scope.uploader.onProgressItem = function(fileItem, progress) {\n        $log.debug('[jlUploader.onProgressItem]', fileItem, progress);\n      };\n      \n\n    }\n  };\n});","angular.module('jumplink.cms.user', [\n    'sails.io',\n    'jumplink.cms.sails',\n  ])\n\n  .service('UserService', function ($rootScope, $sailsSocket, $log, JLSailsService) {\n    var isSubscribed = false;\n\n    var save = function(user, callback) {\n      if(!angular.isString(user.role)) {\n        user.role = \"siteadmin\";\n      }\n      \n      // update user\n      if(angular.isDefined(user.id)) {\n        $log.debug(\"update user: sailsSocket.put('/user/\"+user.id+\"..'\");\n        $sailsSocket.put('/user/'+user.id, user).success(function(data, status, headers, config) {\n          $log.debug(data, status, headers, config);\n          if(angular.isDefined(data) && angular.isDefined(data.password)) {\n            delete data.password;\n          }\n          callback(null, data, status, headers, config);\n        });\n      } else {\n        // create user\n        $log.debug(\"create user: sailsSocket.post('/user..\");\n        $sailsSocket.post('/user', user).success(function(data, status, headers, config) {\n          // TODO FIXME data ist not the request result ?!\n          $log.debug(\"data\", data, \"status\", status, \"headers\", headers, \"config\", config);\n          if(angular.isDefined(data) && angular.isDefined(data.password)) {\n            delete data.password;\n          }\n          callback(null, data, status, headers, config);\n        });\n      }\n    };\n\n    var subscribe = function () {\n      if(!isSubscribed) {\n        $sailsSocket.subscribe('user', function(msg){\n          if($rootScope.authenticated) {\n            $log.debug(msg);\n          }\n          switch(msg.verb) {\n            case 'updated':\n              if($rootScope.authenticated) {\n                $rootScope.pop('success', 'Ein Benutzer wurde aktualisiert', msg.data.name);\n              }\n            break;\n            case 'created':\n              if($rootScope.authenticated) {\n                $rootScope.pop('success', 'Ein Benutzer wurde erstellt', msg.data.name);\n              }\n            break;\n            case 'removedFrom':\n              if($rootScope.authenticated) {\n                $rootScope.pop('success', 'Ein Benutzer wurde entfernt', \"\");\n              }\n            break;\n            case 'destroyed':\n              if($rootScope.authenticated) {\n                $rootScope.pop('success', 'Ein Benutzer wurde gelöscht', \"\");\n              }\n            break;\n            case 'addedTo':\n              if($rootScope.authenticated) {\n                $rootScope.pop('success', 'Ein Benutzer wurde hinzugefügt', \"\");\n              }\n            break;\n          }\n        });\n        isSubscribed = true;\n      }\n    };\n\n    var removeFromClient = function (users, user) {\n      var index = users.indexOf(user);\n      $log.debug(\"removeFromClient\", user, index);\n      if (index > -1) {\n        users.splice(index, 1);\n      }\n    };\n\n    var remove = function(users, user) {\n      $log.debug(\"$scope.remove\", user);\n      if($rootScope.authenticated) {\n        if(users.length <= 1) {\n          $log.error('Der letzte Benutzer kann nicht gelöscht werden.');\n        } else {\n          removeFromClient(users, user);\n          if(user.id) {\n            $sailsSocket.delete('/user/'+user.id, {id:user.id}).success(function(data, status, headers, config) {\n              $log.debug(\"user delete request\", data, status, headers, config);\n            });\n          }\n        }\n      }\n    };\n\n    /**\n     * find users for any host from database and isert priority from database (or from local.json if no priority is set).\n     * Only for superadmins!\n     */\n    var findByHost = function(host, callback) {\n      // $log.debug(\"[ThemeService.findByHost]\", host);\n      var options = {\n        method: 'post',\n        resultIsArray: true\n      };\n      return JLSailsService.resolve('/user/findbyhost', {host: host}, options, callback);\n    };\n\n    var updateOrCreateByHost = function(host, user, callback) {\n      $log.debug(\"[UserService.updateOrCreateByHost]\", host, routes);\n      var options = {\n        method: 'post',\n        resultIsArray: false\n      };\n      return JLSailsService.resolve('/user/updateOrCreateByHost', {host: host, user: user}, options, callback);\n    };\n\n    return {\n      save: save,\n      subscribe: subscribe,\n      remove: remove,\n      findByHost: findByHost,\n      updateOrCreateByHost: updateOrCreateByHost\n    };\n  })\n;","angular.module('jumplink.cms.utilities', [\n  ])\n  .service('UtilityService', function ($log) {\n    var invertOrder = function (array) {\n      var result = [];\n      for (var i = array.length - 1; i >= 0; i--) {\n        result.push(array[i]);\n      }\n      return result;\n    };\n\n    /**\n     * find value by key in array\n     */\n    var findKeyValue = function (objects, key, value) {\n      // $log.debug(\"findKeyValue\", key, value);\n      var index = -1;\n      for (var i = objects.length - 1; i >= 0 && index <= -1; i--) {\n        if(objects[i][key] === value) {\n          index = i;\n        } \n      }\n      return index;\n    };\n\n    /**\n     * @see: http://stackoverflow.com/questions/3068534/getting-javascript-object-key-list\n     */\n    var getKeys = function (obj) {\n      var keys = [];\n      if(!angular.isObject(obj)) {\n        console.error(\"[UtilityService.getKeys] is not an Object\", obj);\n        return keys;\n      }\n      for(var k in obj) {\n        keys.push(k);\n      }\n      return keys;\n    };\n\n    /**\n     * Capitalize the first character of a string, but not change the case of any of the other letters.\n     *\n     * @see http://stackoverflow.com/questions/1026069/capitalize-the-first-letter-of-string-in-javascript\n     */\n    var capitalizeFirstLetter = function (string) {\n      return string.charAt(0).toUpperCase() + string.slice(1).toLowerCase();\n    };\n\n    var lowercaseFirstLetter = function (string) {\n      return string.charAt(0).toLowerCase() + string.slice(1);\n    };\n\n    return {\n      invertOrder: invertOrder,\n      findKeyValue: findKeyValue,\n      getKeys: getKeys,\n      capitalizeFirstLetter: capitalizeFirstLetter,\n      lowercaseFirstLetter: lowercaseFirstLetter,\n    };\n  });","angular.module('jumplink.cms.bootstrap.validation', [\n  'jumplink.cms.validation',\n])\n.provider('jlValidationBootstrap', function jlValidationBootstrapProvider(jlValidationProvider, $validationProvider) {\n  this.setup = function () {\n    $validationProvider.setErrorHTML(function (msg) {\n      return \"<span ng-show='form.name.$error.required' class='form-control-feedback'><i class='fa fa-exclamation-triangle'></i></span><label class=\\\"control-label has-error absolute-control-label-bottom\\\">\" + msg + \"</label>\";\n    });\n    $validationProvider.setSuccessHTML(function (msg) {\n      return \"<span class='form-control-feedback'><i class='fa fa-check'></i></span><label class=\\\"control-label has-success absolute-control-label-bottom\\\">\" + msg + \"</label>\";\n    });\n    angular.extend($validationProvider, {\n      validCallback: function (element){\n        $(element).parents('.form-group:first').removeClass('has-error').addClass('has-success');\n      },\n      invalidCallback: function (element) {\n        $(element).parents('.form-group:first').removeClass('has-success').addClass('has-error');\n      }\n    });\n  };\n  this.getLocale = jlValidationProvider.getLocale;\n  this.changeLocale = jlValidationProvider.changeLocale;\n  this.$get = function jlValidationBootstrapFactory() {\n    // let's assume that the UnicornLauncher constructor was also changed to\n    // accept and use the useTinfoilShielding argument\n    return new jlValidationBootstrap();\n  };\n});","angular.module('jumplink.cms.validation', [\n  'validation',                               // https://github.com/huei90/angular-validation\n  'validation.rule',                          // https://github.com/huei90/angular-validation\n])\n.provider('jlValidation', function jlValidationProvider($validationProvider) {\n  this.getLocale = function () {\n    var defaultMsg = {\n      \"minlength\": $validationProvider.getDefaultMsg('minlength'),\n      \"maxlength\": $validationProvider.getDefaultMsg('maxlength'),\n      \"required\": $validationProvider.getDefaultMsg('required'),\n      \"email\": $validationProvider.getDefaultMsg('email'),\n      \"number\": $validationProvider.getDefaultMsg('number'),\n      \"url\": $validationProvider.getDefaultMsg('url'),\n    };\n    return defaultMsg;\n  };\n  this.changeLocale = function (lang) {\n    var defaultMsg = {};\n    switch(lang) {\n      case 'de':\n        defaultMsg = {\n          'minlength': {\n            error: \"Eingabe muss länger sein!\",\n            success: \"Eingabe lang genug\"\n          },\n          'maxlength': {\n            error: \"Eingabe muss kürzer sein!\",\n            success: \"Eingabe kurz genug\"\n          },\n          'required': {\n            error: \"Eine Eingabe ist erforderlich!\",\n            success: \"Okay\"\n          },\n          'email': {\n            error: \"Eingabe muss einer E-Mail entsprechen!\",\n            success: \"Eingabe ist eine E-Mail\"\n          },\n          'number': {\n            error: \"Eingabe darf nur Zahlen enthalten!\",\n            success: \"Eingabe enthält nur Zahlen\"\n          },\n          'url': {\n            error: \"Eingabe muss einer URL entsprechen!\",\n            success: \"Eingabe entspricht einer URL\"\n          },\n        };\n      break;\n      case 'en':\n      break;\n      default:\n      break;\n    }\n    switch(lang) {\n      case 'de':\n        $validationProvider.setDefaultMsg(defaultMsg);\n      break;\n      case 'en':\n        // do nothing\n      break;\n      default:\n        // do nothing\n      break;\n    }\n  };\n  this.$get = function jlValidationFactory() {\n    // let's assume that the UnicornLauncher constructor was also changed to\n    // accept and use the useTinfoilShielding argument\n    return new jlValidation();\n  };\n});"],"sourceRoot":"/source/"}
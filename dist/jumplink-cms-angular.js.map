{"version":3,"sources":["general/general.js","admin/admin.js","blog/blog.bootstrap.js","blog/blog.js","async/async.js","attachment/attachment.bootstrap.js","attachment/attachment.js","browser/browser.js","config/config.js","content/content.js","content/content.medium.js","crossbrowser/crossbrowser.js","event/event.js","focus/focus.js","gallery/gallery.js","history/history.js","info/info.js","multisite/multisite.js","routes/routes.js","sails/sails.js","session/session.js","sidebar/sidebar.js","sortable/sortable.js","signin/signin.bootstrap.js","signin/signin.js","subnavigation/subnavigation.js","theme/theme.js","toolbar/toolbar.js","user/user.js","utilities/utilities.js"],"names":["angular","module","directive","$compile","$window","$sailsSocket","$state","restrict","templateUrl","scope","download","toogleHtml","refresh","save","add","addDropdown","addDropdownActions","adminSettingDropdown","authenticated","allowActions","link","$scope","$element","$attrs","goToState","go","isUndefined","text","click","service","$log","focus","BlogService","$modal","FileUploader","editModal","typeModal","page","openTypeChooserModal","blogPost","$promise","then","show","setModals","fileOptions","pageString","onFileCompleteCallback","isString","title","ok","accept","hide","abort","path","thumbnail","width","rescrop","cropwidth","cropheight","uploadOptions","url","removeAfterUpload","headers","options","JSON","stringify","uploader","isFunction","onComplete","onCompleteItem","fileItem","response","status","debug","isArray","attachments","i","files","length","push","onProgressItem","progress","upload","chooseType","$on","modalEvent","validate","callback","getModals","getTypeModal","edit","cb","createEdit","blogPosts","create","update","moment","$async","$filter","AttachmentService","types","deleteAttachment","destroyLocally","destroyExternally","destroy","fix","type","removeFromClient","index","indexOf","splice","id","success","users","config","sort","reverse","transform","append","moreBlogPosts","apply","prepent","unshift","data","createdAt","content","author","object","name","toLowerCase","replace","fixEach","objects","saveOne","errors","isDefined","post","error","put","saveBlocks","map","err","blogPostsArray","find","limit","skip","resp","count","subscribe","msg","verb","$rootScope","pop","findEvent","blogPostBlock","resolve","remove","destroyAttachment","async","objectMap","obj","func","arr","keys","Object","wrapper","this","res","mediumOptions","attachment","attachmentIndex","parent","centerImage","console","log","controller","open","target","postIndex","blogPostID","attachmentUploadedAs","uploadedAs","force","get","SortableService","UtilityService","showHtml","getShowHtml","setEditModal","changeName","$watch","newValue","oldValue","generateName","event","validateContent","getEditModal","toogleShowHtml","contents","beautifyEach","beautify","html_beautify","getByName","findKeyValue","swap","index_1","index_2","moveForward","moveBackward","isNumber","position","warn","findOne","next","query","Array","findAll","findAllWithImage","images","resolveOne","resolveAll","resolveAllWithImage","value","buttonLabels","toolbar","buttons","Imager","button","document","createElement","className","innerText","innerHTML","onclick","onClick","bind","prototype","classApplier","toggleSelection","getButton","checkState","node","tagName","classList","ContentMediumService","html","mediumBindOptions","extensions","image","Date","now","getTime","vendors","window","requestAnimationFrame","vp","cancelAnimationFrame","test","navigator","userAgent","lastTime","nextTime","Math","max","setTimeout","clearTimeout","info","eventBlockName","split","events","unknown","before","after","to","from","isAfter","invertOrder","merge","concat","allEvents","minutes","person","place","eventBlocks","saveAllInBlock","eventBlocksArray","eventBlock","EventService","factory","$timeout","element","getElementById","elem","attr","on","eventFocus","eventFocusId","off","Fullscreen","ContentService","uploadModal","fullscreenImage","dropdown","getDropdown","prepairUploadModal","imageBlocks","contentBlocks","selects","getSelects","selectedContentBlock","setUploadModal","onCompleteCallback","filters","fn","item","slice","lastIndexOf","forEach","file","selected","currentImages","last_position","original","getUploadModal","blockNames","result","blockName","array","label","contentname","saveAllBlocks","saveAll","filename","addBlock","aspect","height","scale","aspectRatio","win","paddingTopBottom","paddingLeftRight","isFullScreen","getWindowDimensions","padding-right","padding-left","padding-top","padding-bottom","jumplink","$location","$anchorScroll","history","state","params","all","step","prev","previous","abs","back","goToHashPosition","hash","yOffset","autoScroll","run","HistoryService","toParams","fromParams","current","warns","infoUser","infoAdmin","JLSailsService","method","resultIsArray","resolveNames","resolveHosts","filter","routes","active","main","match","alternativeUrls","customstate","views","fallback","route","findByHost","updateOrCreate","updateOrCreateByHost","host","updateOrCreateEach","updateOrCreateEachByHost","saveEachByHost","$q","deferred","defer","reject","promise","user","isAuthenticated","needToBeAuthenticated","bloggerOrBetter","developerOrBetter","siteadminOrBetter","superadmin","employee","employeeOrBetter","needToBeEmployeeOrBetter","needToBeSiteadminOrBetter","getAllPolicies","getUser","transclude","resetPosition","object_1","object_2","position_tmp","move","old_index","new_index","k","undefined","unique","uniqueKey","new_object","new_position","uniqueIndex","okay","extend","moveObjectToAnotherArray","index_from","array_from","array_to","replaceData","errorParamsNotSet","index_to","dropMove","dropObjectIndex","dragObject","moveFunction","dragObjectIndex","dropObject","SigninService","siginWithModal","goBackAfterSignin","extendRoles","signinModal","aborted","email","password","signin","SessionService","results","resizeOnImagesLoaded","imagesLoaded","triggerHandler","navs","Number","nav","removeByTarget","fixed","isSubscribed","themes","shorttitle","fluid","fullscreenIsSupported","isSupported","isFullscreen","evt","isFullscreenEnabled","toggleFullscreen","isEnabled","cancel","role","key","capitalizeFirstLetter","string","charAt","toUpperCase","lowercaseFirstLetter"],"mappings":"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","file":"jumplink-cms-angular.js","sourcesContent":["if (typeof jumplink === 'undefined') {\n  var jumplink = {};\n}","angular.module('jumplink.cms.admin', [\n    'sails.io',\n  ])\n\n  .directive('adminbar', function ($compile, $window, $sailsSocket, $state) {\n\n    return {\n      restrict: 'E',\n      templateUrl: '/views/modern/adminbar.jade',\n      scope: {\n        download : \"=?\",\n        toogleHtml: \"=?\",\n        refresh: \"=?\",\n        save: \"=?\",\n        add: \"=?\",\n        addDropdown: \"=?\",\n        addDropdownActions: \"=?\",\n        adminSettingDropdown: \"=?\",\n        authenticated: \"=?\",\n        allowActions: \"=?\",\n      },\n      link: function ($scope, $element, $attrs) {\n\n        $scope.goToState = $state.go;\n\n        if(angular.isUndefined($scope.adminSettingDropdown)) {\n          $scope.adminSettingDropdown = [\n            {\n              \"text\": \"<i class=\\\"fa fa-list\\\"></i>&nbsp;Übersicht\",\n              \"click\": \"goToState('layout.administration')\"\n            },\n            {\n              \"text\": \"<i class=\\\"fa fa-users\\\"></i>&nbsp;Benutzer\",\n              \"click\": \"goToState('layout.users')\"\n            },\n            {\n              \"text\": \"<i class=\\\"fa fa-sign-out\\\"></i>&nbsp;Abmelden\",\n              \"click\": \"$root.logout()\"\n            }\n          ];\n        }\n      }\n    };\n  })\n\n;","angular.module('jumplink.cms.bootstrap.blog', [\n  'jumplink.cms.blog',\n  'mgcrea.ngStrap',\n  'angular-medium-editor',\n  'angularFileUpload',\n  'ngFocus',\n])\n\n.service('BlogBootstrapService', function ($log, focus, BlogService, $modal, FileUploader) {\n\n  var editModal = null;\n  var typeModal = null;\n  var page = null;\n\n  var openTypeChooserModal = function(blogPost) {\n    typeModal.$scope.blogPost = blogPost;\n    //- Show when some blogPost occurs (use $promise property to ensure the template has been loaded)\n    typeModal.$promise.then(typeModal.show);\n  };\n\n  var setModals = function($scope, fileOptions, pageString, onFileCompleteCallback) {\n\n    if(!angular.isString(page)) {\n      page = pageString;\n    }\n\n    editModal = $modal({title: 'Blogpost bearbeiten', templateUrl: '/views/modern/blog/editmodal.bootstrap.jade', show: false});\n    editModal.$scope.ok = false;\n    editModal.$scope.accept = function (hide) {\n      editModal.$scope.ok = true;\n      hide();\n    };\n    editModal.$scope.abort = function (hide) {\n      editModal.$scope.ok = false;\n      hide();\n    };\n\n    // set default fileOptions\n    if(angular.isUndefined(fileOptions)) {\n      fileOptions = {\n        path: 'assets/files/blog', // TODO get path from config\n        thumbnail: {\n          width: 300,\n          path: 'assets/files/blog' // TODO get path from config\n        },\n        rescrop: {\n          width: 1200,\n          cropwidth: 1200,\n          cropheight: 1200,\n        }\n      };\n    }\n\n    var uploadOptions = {\n      url: 'blog/upload',\n      removeAfterUpload: true,\n      // WARN: headers HTML5 only\n      headers: {\n        options: JSON.stringify(fileOptions)\n      }\n    };\n\n    editModal.$scope.uploader = new FileUploader(uploadOptions);\n    editModal.$scope.openTypeChooserModal = openTypeChooserModal;\n\n    if(angular.isFunction(onFileCompleteCallback)) {\n      $scope.uploader.onComplete = onFileCompleteCallback;\n    }\n\n    editModal.$scope.uploader.onCompleteItem = function(fileItem, response, status, headers) {\n      $log.debug(\"[BlogBootstrapService.onCompleteItem] fileItem\", fileItem, \"response\", response);\n      if(!angular.isArray(fileItem.blogPost.attachments)) {\n        fileItem.blogPost.attachments = [];\n      }\n      for (var i = 0; i < response.files.length; i++) {\n        fileItem.blogPost.attachments.push(response.files[i]);\n      }\n    };\n\n    editModal.$scope.uploader.onProgressItem = function(fileItem, progress) {\n      $log.debug('[BlogBootstrapService.onProgressItem]', fileItem, progress);\n    };\n\n    editModal.$scope.upload = function(fileItem, blogPost) {\n      fileItem.blogPost = blogPost;\n      fileItem.upload();\n    };\n\n    typeModal = $modal({title: 'Typ wählen', templateUrl: '/views/modern/blog/typechoosermodal.bootstrap.jade', show: false});\n    typeModal.$scope.chooseType = BlogService.chooseType;\n\n    editModal.$scope.$on('modal.hide.before',function(modalEvent, editModal) {\n      $log.debug(\"edit closed\", editModal.$scope.blogPost, editModal);\n      if(editModal.$scope.ok) {\n        // BlogService.saveOne(null, editModal.$scope.blogPost, null, page, function (err, result) {\n        //   editModal.$scope.blogPost = result\n        //   return BlogService.validate(editModal.$scope.blogPost, null, editModal.$scope.callback);\n        // });\n        return BlogService.validate(editModal.$scope.blogPost, null, editModal.$scope.callback);\n      } else {\n        if(editModal.$scope.callback) {\n          editModal.$scope.callback(\"discarded\", editModal.$scope.blogPost);\n        }\n      }\n    });\n\n    return getModals();\n  };\n\n  var getEditModal = function() {\n    return editModal;\n  };\n\n  var getTypeModal = function() {\n    return typeModal;\n  };\n\n  var getModals = function() {\n    return {\n      editModal: getTypeModal(),\n      typeModal: getTypeModal()\n    };\n  };\n\n  var edit = function(blogPost, cb) {\n    $log.debug(\"[BlogService.edit]\", blogPost);\n    editModal.$scope.blogPost = blogPost;\n    editModal.$scope.callback = cb;\n    editModal.$scope.ok = false;\n\n    focus('blogposttitle');\n    //- Show when some blogPost occurs (use $promise property to ensure the template has been loaded)\n    editModal.$promise.then(editModal.show);\n  };\n\n  var createEdit = function(blogPosts, blogPost, cb) {\n    blogPost = BlogService.create(blogPost); \n    edit(blogPost, cb);\n  };\n\n  return {\n    edit: edit,\n    update: edit, // alias\n    createEdit: createEdit,\n    setModals: setModals,\n    openTypeChooserModal: openTypeChooserModal,\n  };\n});","angular.module('jumplink.cms.blog', [\n  'jumplink.cms.attachment',\n  'angularMoment',\n  'ngAsync',\n  'sails.io',\n])\n\n.service('BlogService', function (moment, $sailsSocket, $async, $log, $filter, AttachmentService) {\n\n  var types = ['news', 'other'];\n\n  /**\n   * delete attachment on local / client / browser\n   */\n  var deleteAttachmentLocally = AttachmentService.destroyLocally;\n\n  /**\n   * delete attachment extern / server\n   */\n  var deleteAttachmentExternally = AttachmentService.destroyExternally;\n\n  var deleteAttachment = AttachmentService.destroy;\n\n  var validate = function (blogPost, page, callback) {\n    if(blogPost.title) {\n      return fix(blogPost, page, callback);\n    }\n    if(angular.isFunction(callback)) {\n      return callback(\"Title not set\", blogPost);\n    }\n    return null;\n  };\n\n  var chooseType = function(blogPost, type) {\n    blogPost.type = type;\n  };\n\n  var removeFromClient = function (blogPosts, blogPost, callback) {\n    // $log.debug(\"removeFromClient\", blogPost);\n    var index = blogPosts.indexOf(blogPost);\n    if (index > -1) {\n      blogPosts.splice(index, 1);\n      if(angular.isFunction(callback)) {\n        callback(null, blogPosts);\n      }\n    } else {\n      if(angular.isFunction(callback)) {\n        callback(\"no blogPost on client site found to remove\", blogPosts);\n      }\n    }\n  };\n\n  var destroy = function(blogPosts, blogPost, callback) {\n    // $log.debug(\"remove blogPost\", blogPost);\n    if(blogPost.id) {\n      $log.debug(\"[jumplink.cms.blog.BlogService.destroy]\", blogPost);\n      $sailsSocket.delete('/blog/'+blogPost.id).success(function(users, status, headers, config) {\n        removeFromClient(blogPosts, blogPost, callback);\n      });\n    } else {\n      removeFromClient(blogPosts, blogPost, callback);\n    }\n  };\n\n  var sort = function(blogPosts) {\n    var reverse = true;\n    return $filter('orderBy')(blogPosts, 'createdAt', reverse);\n  };\n\n  var transform = function(blogPosts) {\n    blogPosts = sort(blogPosts);\n    return blogPosts;\n  };\n\n  var append = function(blogPosts, moreBlogPosts, callback) {\n    blogPosts.push.apply(blogPosts, moreBlogPosts);\n    blogPosts = transform(blogPosts);\n    if(angular.isFunction(callback)) {\n      return callback(null, blogPosts);\n    }\n    return blogPosts;\n  };\n\n  var prepent = function(blogPosts, blogPost, callback) {\n    blogPosts.unshift(blogPost);\n    blogPosts = transform(blogPosts);\n    if(angular.isFunction(callback)) {\n      return callback(null, blogPosts);\n    }\n    return blogPosts;\n  };\n\n  var create = function(data) {\n    if(!data || !data.createdAt) {\n      data.createdAt = moment();\n    }\n    // if(!data || !data.updatedAt) data.createdAt = moment();\n    if(!data || !data.title) {\n      data.title = \"\";\n    }\n    if(!data || !data.content) {\n      data.content = \"\";\n    }\n    if(!data || !data.author) {\n      data.author = \"\";\n    }\n    if(!data || !data.page) {\n      callback(\"Page not set.\");\n    }\n    if(!data || !data.type) {\n      data.type = types[0]; // news\n    }\n    $log.debug(\"[BlogService,create]\", data);\n    return data;\n  };\n\n  var createEdit = function(blogPosts, blogPost, callback) {\n    blogPost = create(blogPost); \n    edit(blogPost, callback);\n  };\n\n  var fix = function(object, page, callback) {\n    if(angular.isUndefined(object.page) && page !== null) {\n      object.page = page;\n    }\n    if(!object.name || object.name === \"\") {\n      // Set object.name to object.title but only the letters in lower case\n      object.name = object.title.toLowerCase().replace(/[^a-z]+/g, '');\n      // $log.debug(\"set object.name to\", object.name);\n    }\n    if(angular.isFunction(callback)) {\n      return callback(null, object);\n    }\n    return object;\n  };\n\n  var fixEach = function(objects, page, callback) {\n    for (var i = objects.length - 1; i >= 0; i--) {\n      objects[i] = fix(objects[i], page);\n    }\n    if(angular.isFunction(callback)) {\n      return callback(null, objects);\n    }\n    return objects;\n  };\n\n  var refresh = function(blogPosts, callback) {\n    $log.debug(\"[jumplink.cms.blog.BlogService.refresh]\");\n    blogPosts = transform(blogPosts);\n    if(angular.isFunction(callback)) {\n      return callback(null, blogPosts);\n    }\n    return blogPosts;\n  };\n\n  var saveOne = function (blogPosts, blogPost, index, page, callback) {\n    var errors = [\n      \"BlogService: Can't save blogPost.\",\n      \"BlogService: Can't save blogPost, blogPost to update not found.\",\n      \"BlogService: Can't save blogPost, parameters undefind.\",\n    ];\n    $log.debug(\"[BlogService.saveOne]\", blogPost);\n    if(angular.isDefined(blogPost) && angular.isDefined(callback)) {\n      blogPost = fix(blogPost, page);\n      if(angular.isUndefined(blogPost.id)) {\n        // create because id is undefined\n        $sailsSocket.post('/blog', blogPost).success(function(data, status, headers, config) {\n          if(angular.isArray(data)) {\n            data = data[0];\n          }\n          callback(null, data);\n        }).error(function (data, status, headers, config) {\n          if(angular.isArray(data)) {\n            data = data[0];\n          }\n          $log.error(data, status, headers, config);\n          return callback(errors[0]);\n        });\n      } else {\n        // update because id is defined\n        $sailsSocket.put('/blog/'+blogPost.id, blogPost).success(function(data, status, headers, config) {\n          if(angular.isArray(data)) {\n            data = data[0];\n          }\n          return callback(null, data);\n        }).error(function (data, status, headers, config) {\n          $log.error(data, status, headers, config);\n          return callback(errors[0]);\n        });\n      }\n    } else {\n      return callback(errors[2]);\n    }\n  };\n\n  var saveBlocks = function(blogPosts, page, callback) {\n    var errors = [\n      \"[BlogService.saveBlocks] Can't save blogPosts, parameters undefind.\"\n    ];\n    // save just this blogPost if defined\n    if(angular.isDefined(blogPosts) && angular.isDefined(callback)) {\n      $async.map(blogPosts, function (blogPost, callback) {\n        saveOne(blogPosts, blogPost, null, page, callback);\n      }, function(err, blogPostsArray) {\n        if(err) {\n          return callback(err);\n        }\n        blogPosts = transform(blogPosts);\n        return callback(null, blogPosts);\n      });\n    } else {\n      $log.error(errors[0]);\n      if(angular.isFunction(callback)) {\n        return callback(errors[0]);\n      }\n    }\n  };\n\n  var save = function(blogPosts, blogPost, index, page, callback) {\n    // save just this blogPost if defined\n    if(angular.isDefined(blogPost)) {\n      saveOne(blogPosts, blogPost, index, page, callback);\n    } else { // save all blogPostBlocks\n      saveBlocks(blogPosts, page, callback);\n    }\n  };\n\n  var find = function(page, limit, skip, callback) {\n    return $sailsSocket.put('/blog/find', {page:page, limit:limit, skip:skip}).then (function (data) {\n      data.data = transform(data.data);\n      if(angular.isFunction(callback)) {\n        return callback(null, data.data);\n      }\n      return data.data;\n    }, function error (resp){\n      $log.error(\"Error on find \"+page, resp);\n      if(angular.isFunction(callback)) {\n        return callback(resp);\n      }\n      return null;\n    });\n  };\n\n  var count = function(page, limit, skip, callback) {\n    return $sailsSocket.put('/blog/count', {page:page}).then (function (data) {\n      // $log.debug(data);\n      if(angular.isFunction(callback)) {\n        return callback(null, data.data.count);\n      }\n      return data.data.count;\n    }, function error (resp){\n      $log.error(\"Error on resolve \"+page, resp);\n      if(angular.isFunction(callback)) {\n        return callback(resp);\n      }\n      return null;\n    });\n  };\n\n  var subscribe = function () {\n    $sailsSocket.subscribe('blog', function(msg){\n      $log.debug(msg);\n      switch(msg.verb) {\n        case 'updated':\n          if($rootScope.authenticated) {\n            $rootScope.pop('success', 'Ein Blogpost wurde aktualisiert', msg.data.title);\n          }\n          findEvent(msg.id, function(error, blogPost, blogPostBlock, index) {\n            if(error) {\n              $log.debug(error);\n            }\n            else {\n              blogPost = msg.data;\n            }\n            $scope.refresh();\n          });\n        break;\n        case 'created':\n          if($rootScope.authenticated) {\n            $rootScope.pop('success', 'Ein Blogpost wurde erstellt', msg.data.title);\n          }\n          $scope.blogPosts.push(msg.data);\n          $scope.refresh();\n        break;\n        case 'removedFrom':\n          if($rootScope.authenticated) {\n            $rootScope.pop('success', 'Ein Blogpost wurde entfernt', msg.data.title);\n          }\n          findEvent(msg.id, function(error, blogPost, blogPostBlock, index) {\n            if(error) {\n              $log.debug(error);\n            }\n            else {\n              BlogService.removeFromClient($scope.blogPosts, blogPost, blogPostBlock);\n            }\n          });\n        break;\n        case 'destroyed':\n          if($rootScope.authenticated) {\n            $rootScope.pop('success', 'Ein Blogpost wurde gelöscht', msg.data.title);\n          }\n          findEvent(msg.id, function(error, blogPost, blogPostBlock, index) {\n            if(error) {\n              $log.debug(error);\n              return error;\n            }\n            else {\n              BlogService.removeFromClient($scope.blogPosts, blogPost, blogPostBlock);\n            }\n          });\n        break;\n        case 'addedTo':\n          if($rootScope.authenticated) {\n            $rootScope.pop('success', 'Ein Blogpost wurde hinzugefügt', msg.data.title);\n          }\n        break;\n      }\n    });\n  };\n\n  return {\n    validate: validate,\n    subscribe: subscribe,\n    append: append,\n    prepent: prepent,\n    sort: sort,\n    transform: transform,\n    saveOne: saveOne,\n    saveBlocks: saveBlocks,\n    save: save,\n    fixEach: fixEach,\n    find: find,\n    resolve: find, // alias\n    count: count,\n    refresh: refresh,\n    chooseType: chooseType,\n    removeFromClient: removeFromClient,\n    remove: destroy, // alias\n    destroy: destroy,\n    deleteAttachment: deleteAttachment,\n    destroyAttachment: deleteAttachment, // alias\n    create: create\n  };\n});","angular.module('ngAsync', [])\n.service('$async', function () {\n  // https://github.com/caolan/async/issues/374#issuecomment-27498818\n  async.objectMap = function ( obj, func, cb ) {\n    var i, arr = [], keys = Object.keys( obj );\n    for ( i = 0; i < keys.length; i += 1 ) {\n      var wrapper = {};\n      wrapper[keys[i]] = obj[keys[i]];\n      arr[i] = wrapper;\n    }\n    this.map( arr, func, function( err, data ) {\n      if ( err ) { return cb( err ); }\n      var res = {};\n      for ( i = 0; i < data.length; i += 1 ) {\n          res[keys[i]] = data[i];\n      }\n      return cb( err, res );\n    });\n  };\n  return async;\n});","angular.module('jumplink.cms.bootstrap.attachment', [\n  'jumplink.cms.attachment',\n])\n.directive('jlAttachmentBootstrap', function ($compile, $window, mediumOptions, AttachmentService) {\n\n  return {\n    restrict: 'E',\n    templateUrl: '/views/modern/attachment.bootstrap.jade',\n    scope: {\n      attachment: \"=\",\n      attachmentIndex: \"=\",\n      parent: \"=\",\n      path: \"=\",\n      authenticated: \"=\",\n      destroy: \"=\",\n      centerImage: \"=\"\n    },\n    link: function ($scope, $element, $attrs) {\n      console.log(\"[jlAttachmentBootstrap.link]\", $scope);\n    },\n    controller: function ($scope, AttachmentService) {\n      $scope.open = AttachmentService.open;\n    }\n  };\n});","angular.module('jumplink.cms.attachment', [\n  'sails.io',\n])\n\n.service('AttachmentService', function (moment, $sailsSocket, $async, $log, $window) {\n\n  var open = function (url, target) {\n    $window.open(url, target);\n  };\n\n  /**\n   * delete attachment on local / client / browser\n   */\n  var destroyLocally = function (blogPosts, postIndex, attachmentIndex, cb) {\n    if(blogPosts[postIndex].attachments.length > 0) {\n      blogPosts[postIndex].attachments.splice(attachmentIndex, 1);\n    }\n    return cb(null, blogPosts, postIndex, attachmentIndex);\n  };\n\n  /**\n   * delete attachment extern / server\n   */\n  var destroyExternally = function (blogPosts, postIndex, attachmentIndex, cb) {\n    $sailsSocket.put('/blog/destroyAttachment', {blogPostID: blogPosts[postIndex].id, attachmentUploadedAs: blogPosts[postIndex].attachments[attachmentIndex].uploadedAs})\n    .success(function (data, status, headers, config) {\n      $log.debug(null, data, status, headers, config);\n      cb();\n    })\n    .error(function (data, status, headers, config) {\n      $log.error(data, status, headers, config);\n      cb(\"error\", data, status, headers, config);\n    });\n  };\n\n  var destroy = function (blogPosts, post, attachmentIndex, cb) {\n    var postIndex = blogPosts.indexOf(post);\n    $log.debug(\"[BlogService.destroy]\", blogPosts[postIndex], attachmentIndex);\n    return destroyExternally(blogPosts, postIndex, attachmentIndex, function (err, data, status, headers, config) {\n      if(err) {\n        return cb(err, data, status, headers, config);\n      }\n      return destroyLocally(blogPosts, postIndex, attachmentIndex, cb);\n    });\n  };\n\n  return {\n    open: open,\n    destroyLocally: destroyLocally,\n    destroyExternally: destroyExternally,\n    destroy: destroy,\n  };\n});","angular.module('jumplink.cms.browser', [])\n.directive('jlBrowser', function ($compile, $window) {\n\n  return {\n    restrict: 'E',\n    templateUrl: '/views/modern/browser.bootstrap.jade',\n    scope: {\n      force: \"=\"\n    },\n    link: function ($scope, $element, $attrs) {\n      \n    }\n  };\n});","angular.module('jumplink.cms.config', [\n  'sails.io',\n])\n.service('ConfigService', function ($sailsSocket, $filter, $log) {\n  var resolve = function(page) {\n    return $sailsSocket.get('/config/find').then (function (data) {\n      return data.data;\n    }, function error (resp){\n      $log.error(\"Error on resolve \"+page, resp);\n    });\n  };\n  return {\n    resolve: resolve\n  };\n});","angular.module('jumplink.cms.content', [\n    'mgcrea.ngStrap',\n    'angular-medium-editor',\n    'ui.ace',\n    'sails.io',\n    'jumplink.cms.sortable',\n    'ngFocus'\n  ])\n  .service('ContentService', function ($rootScope, $log, $sailsSocket, $filter, $modal, SortableService, UtilityService, focus) {\n\n    var showHtml = false;\n    var editModal = null;\n\n    var getShowHtml = function() {\n      return showHtml;\n    };\n\n    var setEditModal = function($scope) {\n      editModal = $modal({title: 'Inhaltsblock bearbeiten', templateUrl: '/views/modern/contentmodal.jade', show: false});\n      editModal.$scope.ok = false;\n      editModal.$scope.accept = function (hide) {\n        editModal.$scope.ok = true;\n        hide();\n      };\n      editModal.$scope.abort = function (hide) {\n        editModal.$scope.ok = false;\n        hide();\n      };\n      editModal.$scope.changeName = false;\n\n      editModal.$scope.$watch('content.title', function(newValue, oldValue) {\n        // $log.debug(\"Content in Content Modal changed!\", \"new\", newValue, \"old\", oldValue);\n        if(editModal.$scope.changeName && angular.isDefined(editModal.$scope.content)) {\n          editModal.$scope.content.name = generateName(newValue);\n        }\n      });\n\n      editModal.$scope.$on('modal.hide.before',function(event, editModal) {\n        // $log.debug(\"edit closed\", event, editModal);\n        editModal.$scope.changeName = false;\n        if(editModal.$scope.ok) {\n          return validateContent(editModal.$scope.content, editModal.$scope.callback);\n        }\n        if(angular.isFunction(editModal.$scope.callback)) {\n          return editModal.$scope.callback(\"discarded\", editModal.$scope.content);\n        }\n      });\n      return getEditModal();\n    };\n\n    var getEditModal = function() {\n      return editModal;\n    };\n\n    var subscribe = function() {\n      // called on content changes\n      $sailsSocket.subscribe('content', function(msg){\n        $log.debug(\"Content event!\", msg);\n        switch(msg.verb) {\n          case 'updated':\n            if($rootScope.authenticated) {\n              $rootScope.pop('success', 'Seite wurde aktualisiert', msg.id);\n            }\n          break;\n        }\n      });\n    };\n\n    var toogleShowHtml = function(contents, callback) {\n      showHtml = !showHtml;\n      if(showHtml && contents) {\n        contents = beautifyEach(contents);\n      }\n      if(angular.isFunction(callback)) {\n        return callback(null, showHtml);\n      }\n      return showHtml;\n    };\n\n    var beautify = function(content, callback) {\n      content.content = html_beautify(content.content);\n      if(angular.isFunction(callback)) {\n        return callback(null, content);\n      }\n      return content;\n    };\n\n    var beautifyEach = function(contents, callback) {\n      for (var i = contents.length - 1; i >= 0; i--) {\n        contents[i].content = beautify(contents[i].content);\n      }\n      if(angular.isFunction(callback)) {\n        return callback(null, contents);\n      }\n      return contents;\n    };\n\n    var getByName = function (contents, name) {\n      var index = UtilityService.findKeyValue(contents, 'name', name);\n      if(index > -1) {\n        return contents[index];\n      }\n      return null;\n    };\n\n    var create = function(data) {\n      if(!data || !data.content) {\n        data.content = \"\";\n      }\n      if(!data || !data.title) {\n        data.title = \"\";\n      }\n      if(!data || !data.name) {\n        data.name = \"\";\n      }\n      if(!data || !data.type) {\n        data.type = \"dynamic\";\n      }\n      if(!data || !data.page) {\n        callback(\"Page not set.\");\n      }\n      return data;\n    };\n\n    var append = function(contents, content, callback) {\n      SortableService.append(contents, content, callback, true, 'name');\n    };\n\n    var createEdit = function(contents, page, callback) {\n      var data = create({page:page});\n      edit(data, callback, true);\n    };\n\n    var swap = function(contents, index_1, index_2, callback) {\n      return SortableService.swap(contents, index_1, index_2, callback);\n    };\n\n    var moveForward = function(index, contents, callback) {\n      return SortableService.moveForward(index, contents, callback);\n    };\n\n    var moveBackward = function(index, contents, callback) {\n      return SortableService.moveBackward(index, contents, callback);\n    };\n\n    var validateContent = function (content, callback) {\n      if(content.title) {\n        return fix(content, callback);\n      }\n      if(angular.isFunction(callback)) {\n        return callback(\"Title not set\", content);\n      }\n      return null;\n    };\n\n    var edit = function(content, callback, changeName) {\n      $log.debug(\"edit\", content);\n      editModal.$scope.content = content;\n      editModal.$scope.callback = callback;\n      if(changeName) {\n        editModal.$scope.changeName = changeName;\n      }\n      else {\n        editModal.$scope.changeName = false;\n      }\n      focus('contentedittitle');\n      //- Show when some event occurs (use $promise property to ensure the template has been loaded)\n      editModal.$promise.then(editModal.show);\n    };\n\n    var removeFromClient = function (contents, index, content, callback) {\n      return SortableService.remove(index, contents, callback);\n    };\n\n    var remove = function(contents, index, content, page, callback) {\n      var errors = [\n        'Content konnte nicht gelöscht werden.'\n      ];\n      if(typeof(index) === 'undefined' || index === null) {\n        index = contents.indexOf(content);\n      }\n      // remove from client\n      contents = SortableService.remove(contents, index, content);\n      // if content has an id it is saved on database, if not, not\n      if(content.id) {\n        $log.debug(\"remove from server, too\" ,content);\n        $sailsSocket.delete('/content/'+content.id+\"?page=\"+page, {id:content.id, page: page}).success(function(data, status, headers, config) {\n          if(angular.isFunction(callback)) {\n            return callback(null, contents);\n          }\n          return contents;\n        }).\n        error(function(data, status, headers, config) {\n          $log.error (errors[0], data);\n          if(angular.isFunction(callback)) {\n            return callback(data);\n          }\n          return data;\n        });\n      } else {\n        if(angular.isFunction(callback)) {\n          return callback(null, contents);\n        }\n        return contents;\n      }\n    };\n\n    var refresh = function(contents, callback) {\n      fixEach(contents, function(err, contents) {\n        if(err) {\n          $log.error(err);\n          if(angular.isFunction(callback)) {\n            return callback(err);\n          }\n          return err;\n        }\n        beautifyEach(contents, function(err, contents) {\n          if(err) {\n            $log.error(err);\n            if(angular.isFunction(callback)) {\n              return callback(err);\n            }\n            return err;\n          }\n          if(angular.isFunction(callback)) {\n            return callback(null, contents);\n          }\n          return contents;\n        });\n      });\n    };\n\n    var generateName = function (title) {\n      var name = \"\";\n      if(title && title !== \"\") {\n        // Set content.name to content.title but only the letters in lower case\n        name = title.toLowerCase().replace(/[^a-z1-9]+/g, '');\n        $log.debug(\"set content.name to\", name);\n      }\n      return name;\n    };\n\n    /*\n     * Validate and fix content to make it saveable\n     */\n    var fix = function(content, callback) {\n\n      if(angular.isDefined(content)) {\n        if(angular.isUndefined(content.name) || content.name === '' || content.name === null) {\n          content.name = generateName(content.title);\n        }\n\n        if(!angular.isNumber(content.position)) {\n          content.position = 0;\n        }\n\n        if(!content.type || content.type === \"\") {\n          $log.warn(\"Fix content type not set, set it to dynamic\");\n          content.type = 'fix';\n        }\n      } else {\n        if(angular.isFunction(callback)) {\n          return callback(\"content not set\");\n        }\n        return null;\n      }\n\n      if(angular.isFunction(callback)) {\n        return callback(null, content);\n      }\n      return content;\n    };\n\n    /*\n     * Validate and fix all contents to make them saveable\n     */\n    var fixEach = function(contents, callback) {\n      for (var i = contents.length - 1; i >= 0; i--) {\n        contents[i] = fix(contents[i]);\n      }\n      if(angular.isFunction(callback)) {\n        return callback(null, contents);\n      }\n      return contents;\n    };\n\n    var saveOne = function(content, page, callback) {\n      var errors = [\n        'Inhalt konnte nicht gespeichert werden'\n      ];\n      content.page = page;\n      fix(content, function(err, content) {\n        if(err) {\n          if(angular.isFunction(callback)) {\n            return callback(err);\n          }\n          return err;\n        }\n        $sailsSocket.put('/content/replace', content).success(function(data, status, headers, config) {\n          //- $log.debug (\"save response from /content/replaceall\", data, status, headers, config);\n          if(data !== null && typeof(data) !== \"undefined\") {\n            content = data;\n            // $log.debug (content);\n            if(angular.isFunction(callback)) {\n              return callback(null, content);\n            }\n            return content;\n          } else {\n            $log.error(errors[0]);\n            if(angular.isFunction(callback)) {\n              return callback(errors[0]);\n            }\n            return errors[0];\n          }\n        }).\n        error(function(data, status, headers, config) {\n          $log.error (errors[0], data);\n          if(angular.isFunction(callback)) {\n            return callback(data);\n          }\n          return data;\n        });\n      });\n    };\n\n    var save = function(contents, page, callback) {\n      var errors = [\n        'Seite konnte nicht gespeichert werden'\n      ];\n      fixEach(contents, function(err, contents) {\n        if(err) {\n          if(angular.isFunction(callback)) {\n            return callback(err);\n          }\n          return err;\n        }\n        return $sailsSocket.put('/content/replaceall', {contents: contents, page: page}).success(function(data, status, headers, config) {\n          //- $log.debug (\"save response from /content/replaceall\", data, status, headers, config);\n          if(data !== null && typeof(data) !== \"undefined\") {\n            contents = $filter('orderBy')(data, 'position');\n            // $log.debug (data);\n            if(angular.isFunction(callback)) {\n              return callback(null, contents);\n            }\n            return contents;\n          }\n          $log.error(errors[0]);\n          if(angular.isFunction(callback)) {\n            return callback(errors[0]);\n          }\n          return errors[0];\n        }).\n        error(function(data, status, headers, config) {\n          $log.error (errors[0], data);\n          if(angular.isFunction(callback)) {\n            callback(data);\n          }\n        });\n      });\n    };\n\n    var findOne = function(page, name, type, callback, next) {\n      var errors = [\n        \"Error: On trying to find one with page: \"+page+\", name: \"+name,\n        \"request has more than one results\"\n      ];\n      var query = {\n        page: page,\n        name: name\n      };\n      var url = '/content/find';\n      if(type) {\n        query.type = type;\n      }\n      return $sailsSocket.put(url, query).then (function (data) {\n        if(angular.isUndefined(data) || angular.isUndefined(data.data)) {\n          return null;\n        }\n        if(data.data instanceof Array) {\n          data.data = data.data[0];\n          $log.error(errors[1]);\n        }\n        // data.data.content = html_beautify(data.data.content);\n        if(next) {\n          data.data = next(data.data);\n        }\n        if(angular.isFunction(callback)) {\n          return callback(null, data.data);\n        }\n        return data.data;\n      }, function error (resp){\n        $log.error(errors[0], resp);\n        if(angular.isFunction(callback)) {\n          return callback(errors[0], resp);\n        }\n        return resp;\n      });\n    };\n\n    var findAll = function(page, type, callback, next) {\n      var errors = [\n        \"Error: On trying to find all with page: \"+page+\" and type: \"+type,\n        \"Warn: On trying to find all \"+page+\" contents! Not found, content is empty!\"\n      ];\n      var query = {\n        page: page,\n      };\n      var url = '/content/findall';\n      if(type) {\n        query.type = type;\n      }\n      return $sailsSocket.put(url, query).then (function (data) {\n        if(angular.isUndefined(data) || angular.isUndefined(data.data)) {\n          $log.warn(errors[1]);\n          return null;\n        }\n        // data.data.content = html_beautify(data.data.content);\n        data.data = $filter('orderBy')(data.data, 'position');\n        // $log.debug(data);\n        if(next) {\n          data.data = next(data.data);\n        }\n\n        if(angular.isFunction(callback)) {\n          callback(null, data.data);\n        } else {\n          return data.data;\n        }\n      }, function error (resp){\n        $log.error(errors[0], resp);\n        if(angular.isFunction(callback)) {\n          return callback(errors[0], resp);\n        }\n        return resp;\n      });\n    };\n\n    /*\n     * get all contents for page including images for each content.name \n     */\n    var findAllWithImage = function(page, type, callback, next) {\n      // $log.debug(\"findAllWithImage\");\n      var errors = [\n        \"Error: On trying to find all with page: \"+page+\" and type: \"+type,\n        \"Warn: On trying to find all \"+page+\" contents! Not found, content is empty!\"\n      ];\n      var query = {\n        page: page\n      };\n      var url = '/content/findAllWithImage?page='+page;\n      if(type) {\n        query.type = type;\n        url = url+'&type='+type;\n      }\n      return $sailsSocket.get(url, query).then (function (data) {\n        if(angular.isUndefined(data) || angular.isUndefined(data.data)) {\n          $log.warn(errors[1]);\n          return null;\n        }\n        // data.data.content = html_beautify(data.data.content);\n        data.data.contents = $filter('orderBy')(data.data.contents, 'position');\n        data.data.images = $filter('orderBy')(data.data.images, 'position');\n        // $log.debug(data);\n        if(next) {\n          data.data = next(data.data);\n        }\n        if(angular.isFunction(callback)) {\n          return callback(null, data.data);\n        }\n        return data.data;\n      }, function error (resp){\n        $log.error(errors[0], resp);\n        if(angular.isFunction(callback)) {\n          return callback(errors[0], resp);\n        }\n        return resp;\n      });\n    };\n\n    /**\n     * Resolve function for angular ui-router.\n     * name, callback and next parameters are optional.\n     * use next to transform the result before you get it back\n     * use callback if you want not use promise\n     */\n    var find = function(page, name, type, callback, next) {\n      //- get soecial content (one)\n      if(angular.isDefined(name)) {\n        return findOne(page, name, type, next);\n      // get all for page\n      } else {\n        return findAll(page, type, callback, next);\n      }\n    };\n\n    return {\n      subscribe: subscribe,\n      setEditModal: setEditModal,\n      getShowHtml: getShowHtml,\n      toogleShowHtml: toogleShowHtml,\n      beautify: beautify,\n      beautifyEach: beautifyEach,\n      create: create,\n      createEdit: createEdit,\n      append: append,\n      swap: swap,\n      moveForward: moveForward,\n      moveBackward: moveBackward,\n      edit: edit,\n      removeFromClient: removeFromClient,\n      remove: remove,\n      refresh: refresh,\n      fix: fix,\n      fixEach: fixEach,\n      save: save,\n      saveOne: saveOne,\n      find: find,\n      resolve: find, // alias\n      findOne: findOne,\n      resolveOne: findOne, // alias\n      findAll: findAll, \n      resolveAll: findAll, //alias\n      findAllWithImage: findAllWithImage,\n      resolveAllWithImage: findAllWithImage,  //alias\n      getByName: getByName\n    };\n  })\n;","angular.module('jumplink.cms.content.medium', [\n  'jumplink.cms.content',\n  'angular-medium-editor',\n])\n.value('mediumOptions', {\n  buttonLabels: \"fontawesome\",\n  toolbar: {\n    buttons: [\"bold\", \"italic\", \"underline\", \"anchor\", \"h2\", \"h3\", \"h4\", \"quote\", \"orderedlist\", \"unorderedlist\"]\n  }\n})\n.service('ContentMediumService', function ($rootScope, $log, $sailsSocket, $filter, $modal, SortableService, UtilityService, focus) {\n  // TODO\n  var Imager = function () {\n    this.button = document.createElement('button');\n    this.button.className = 'medium-editor-action';\n    this.button.innerText = 'Image';\n    this.button.innerHTML = '<i class=\"fa fa-picture-o\"></i>';\n    this.button.onclick = this.onClick.bind(this);\n    // this.classApplier = rangy.createCssClassApplier('highlight', {\n    //   elementTagName: 'mark',\n    //   normalize: true\n    // });\n  };\n  Imager.prototype.onClick = function() {\n    this.classApplier.toggleSelection();\n  };\n  Imager.prototype.getButton = function() {\n    return this.button;\n  };\n  Imager.prototype.checkState = function(node) {\n    if (node.tagName === 'MARK') {\n      this.button.classList.add('medium-editor-button-active');\n    }\n  };\n\n  return {\n    Imager: Imager\n  };\n})\n.directive('jlContent', function ($compile, $window, mediumOptions, ContentMediumService) {\n\n  return {\n    restrict: 'E',\n    templateUrl: '/views/modern/content.jade',\n    scope: {\n      authenticated : \"=\",\n      html: \"=\",\n      content: \"=?\",\n      mediumOptions: \"=?\",\n      mediumBindOptions: \"=?\",\n    },\n    link: function ($scope, $element, $attrs) {\n      if(angular.isUndefined($scope.mediumOptions)) {\n        $scope.mediumOptions = mediumOptions;\n      }\n      if(angular.isUndefined($scope.mediumBindOptions)) {\n        $scope.mediumBindOptions = {\n          extensions: {\n            'image': new ContentMediumService.Imager()\n          }\n        };\n      }\n    }\n  };\n});","// window.saveAs\n// Shims the saveAs method, using saveBlob in IE10. \n// And for when Chrome and FireFox get round to implementing saveAs we have their vendor prefixes ready. \n// But otherwise this creates a object URL resource and opens it on an anchor tag which contains the \"download\" attribute (Chrome)\n// ... or opens it in a new tab (FireFox)\n// @author Andrew Dodson\n// @copyright MIT, BSD. Free to clone, modify and distribute for commercial and personal use.\n// window.saveAs || ( window.saveAs = (window.navigator.msSaveBlob ? function(b,n){ return window.navigator.msSaveBlob(b,n); } : false) || window.webkitSaveAs || window.mozSaveAs || window.msSaveAs || (function(){\n//   // URL's\n//   window.URL || (window.URL = window.webkitURL);\n//   if(!window.URL){\n//     return false;\n//   }\n//   return function(blob,name){\n//     var url = URL.createObjectURL(blob);\n//     // Test for download link support\n//     if( \"download\" in document.createElement(\"a\") ){\n//       var a = document.createElement(\"a\");\n//       a.setAttribute(\"href\", url);\n//       a.setAttribute(\"download\", name);\n//       // Create Click event\n//       var clickEvent = document.createEvent (\"MouseEvent\");\n//       clickEvent.initMouseEvent (\"click\", true, true, window, 0, \n//         clickEvent.screenX, clickEvent.screenY, clickEvent.clientX, clickEvent.clientY, \n//         clickEvent.ctrlKey, clickEvent.altKey, clickEvent.shiftKey, clickEvent.metaKey, \n//         0, null);\n//       // dispatch click event to simulate download\n//       a.dispatchEvent (clickEvent);\n//     }\n//     else{\n//       // fallover, open resource in new tab.\n//       window.open(url, \"_blank\", \"\");\n//     }\n//   };\n// })() );\n\n// Source: https://github.com/darius/requestAnimationFrame\n// Adapted from https://gist.github.com/paulirish/1579671 which derived from\n// http://paulirish.com/2011/requestanimationframe-for-smart-animating/\n// http://my.opera.com/emoller/blog/2011/12/20/requestanimationframe-for-smart-er-animating\n\n// requestAnimationFrame polyfill by Erik Möller.\n// Fixes from Paul Irish, Tino Zijdel, Andrew Mao, Klemen Slavič, Darius Bacon\n\n// MIT license\n\nif (!Date.now) {\n  Date.now = function() { return new Date().getTime(); };\n}\n\n(function() {\n    'use strict';\n\n    var vendors = ['webkit', 'moz'];\n    for (var i = 0; i < vendors.length && !window.requestAnimationFrame; ++i) {\n        var vp = vendors[i];\n        window.requestAnimationFrame = window[vp+'RequestAnimationFrame'];\n        window.cancelAnimationFrame = (window[vp+'CancelAnimationFrame'] || window[vp+'CancelRequestAnimationFrame']);\n    }\n    // iOS6 is buggy\n    if (/iP(ad|hone|od).*OS 6/.test(window.navigator.userAgent) || !window.requestAnimationFrame || !window.cancelAnimationFrame) {\n        var lastTime = 0;\n        window.requestAnimationFrame = function(callback) {\n          var now = Date.now();\n          var nextTime = Math.max(lastTime + 16, now);\n          return setTimeout(function() { callback(lastTime = nextTime); }, nextTime - now);\n        };\n        window.cancelAnimationFrame = clearTimeout;\n    }\n}());","angular.module('jumplink.cms.event', [\n  'mgcrea.ngStrap',\n  'angular-medium-editor',\n  'angularFileUpload',\n  'angularMoment',\n  'ngFocus',\n  'ngAsync',\n  'sails.io',\n  'jumplink.cms.utilities',\n])\n.service('EventService', function (moment, UtilityService, $sailsSocket, $async, $log, focus, $modal, FileUploader) {\n  var editModal = null;\n  var typeModal = null;\n  var types = ['lecture', 'panel discussion', 'travel', 'info', 'food', 'other'];\n  var page = null;\n\n  var validate = function (event, callback) {\n    if(event.title) {\n      return fix(event, callback);\n    }\n    if(angular.isFunction(callback)) {\n      return callback(\"Title not set\", event);\n    }\n    return null;\n  };\n\n  var chooseType = function(event, type, hide) {\n    event.type = type;\n    hide();\n  };\n\n  var openTypeChooserModal = function(event) {\n    typeModal.$scope.event = event;\n    //- Show when some event occurs (use $promise property to ensure the template has been loaded)\n    typeModal.$promise.then(typeModal.show);\n  };\n\n  var setModals = function($scope, fileOptions, pageString) {\n\n    if(!angular.isString(page)) {\n      page = pageString;\n    }\n    \n    editModal = $modal({title: 'Ereignis bearbeiten', templateUrl: '/views/modern/events/editmodal.jade', show: false});\n    editModal.$scope.ok = false;\n    editModal.$scope.accept = function (hide) {\n      editModal.$scope.ok = true;\n      hide();\n    };\n    editModal.$scope.abort = function (hide) {\n      editModal.$scope.ok = false;\n      hide();\n    };\n\n    // set default fileOptions\n    if(angular.isUndefined(fileOptions)) {\n      fileOptions = {};\n    }\n\n    var uploadOptions = {\n      url: 'timeline/upload',\n      removeAfterUpload: true,\n      // WARN: headers HTML5 only\n      headers: {\n        options: JSON.stringify(fileOptions)\n      }\n    };\n\n    editModal.$scope.uploader = new FileUploader(uploadOptions);\n    editModal.$scope.openTypeChooserModal = openTypeChooserModal;\n\n    editModal.$scope.uploader.onCompleteItem = function(fileItem, response, status, headers) {\n      fileItem.event.download = response.files[0].uploadedAs;\n    };\n    editModal.$scope.uploader.onProgressItem = function(fileItem, progress) {\n      console.info('onProgressItem', fileItem, progress);\n    };\n    editModal.$scope.upload = function(fileItem, event) {\n      fileItem.event = event;\n      fileItem.upload();\n    };\n    typeModal = $modal({title: 'Typ wählen', templateUrl: '/views/modern/events/typechoosermodal.jade', show: false});\n    typeModal.$scope.chooseType = chooseType;\n    editModal.$scope.$on('modal.hide.before',function(event, editModal) {\n      $log.debug(\"edit closed\", event, editModal);\n      if(editModal.$scope.ok) {\n        return validate(editModal.$scope.event, editModal.$scope.callback);\n      }\n      if(angular.isFunction(editModal.$scope.callback)) {\n        return editModal.$scope.callback(\"discarded\", editModal.$scope.event);\n      }\n    });\n    return getModals();\n  };\n\n  var getEditModal = function() {\n    return editModal;\n  };\n\n  var getTypeModal = function() {\n    return typeModal;\n  };\n\n  var getModals = function() {\n    return {\n      editModal: getTypeModal(),\n      typeModal: getTypeModal()\n    };\n  };\n\n  var edit = function(event, eventBlockName, callback) {\n    // $log.debug(\"edit\", event);\n    editModal.$scope.event = event;\n    // editModal.$scope.eventBlockName = eventBlockName;\n    editModal.$scope.callback = callback;\n    editModal.$scope.ok = false;\n    focus('eventtitle');\n    //- Show when some event occurs (use $promise property to ensure the template has been loaded)\n    editModal.$promise.then(editModal.show);\n  };\n\n  var split = function(events) {\n    var unknown = [], before = [], after = [];\n    for (var i = 0; i < events.length; i++) {\n      if(angular.isDefined(events[i].to)) {\n        events[i].to = moment(events[i].to);\n      }\n      if(angular.isDefined(events[i].from)) {\n        events[i].from = moment(events[i].from);\n        if(events[i].from.isAfter()) {\n          after.push(events[i]);\n        }\n        else {\n          before.push(events[i]);\n        }\n      } else {\n        unknown.push(events[i]);\n      }\n    }\n    return {unknown:unknown, before:before, after:after};\n  };\n\n  var removeFromClient = function (events, event, eventBlockName, callback) {\n    var errors = [\n      \"no event on client site found to remove\"\n    ];\n    var index = events[eventBlockName].indexOf(event);\n    if (index > -1) {\n      events[eventBlockName].splice(index, 1);\n      if(angular.isFunction(callback)) {\n        return callback(null, events);\n      }\n      return events;\n    }\n    if(angular.isFunction(callback)) {\n      return callback(errors[0], events);\n    }\n    return errors[0];\n  };\n\n  var remove = function(events, event, eventBlockName, callback) {\n    // $log.debug(\"remove event\", event, eventBlockName);\n    if(event.id) {\n      $log.debug(event);\n      $sailsSocket.delete('/timeline/'+event.id).success(function(users, status, headers, config) {\n        removeFromClient(events, event, eventBlockName, callback);\n      });\n    } else {\n      removeFromClient(events, event, eventBlockName, callback);\n    }\n  };\n\n  var transform = function(events) {\n    events = split(events);\n    events.before = UtilityService.invertOrder(events.before);\n    return events;\n  };\n\n  var merge = function(unknown, before, after) {\n    if(angular.isUndefined(unknown)) {\n      unknown = [];\n    }\n    if(angular.isUndefined(before)) {\n      before = [];\n    }\n    if(angular.isUndefined(after)) {\n      after = [];\n    }\n    return unknown.concat(before).concat(after);\n  };\n\n  var append = function(events, event, callback) {\n    events.unknown.push(event);\n    var allEvents = merge(events.unknown, events.before, events.after);\n    events = transform(allEvents);\n    if(angular.isFunction(callback)) {\n      return callback(null, events);\n    }\n    return events;\n  };\n\n  var create = function(data) {\n    if(!data || !data.from) {\n      data.from = moment();\n      data.from.add(1, 'hours');\n      data.from.minutes(0);\n    }\n    if(!data || !data.title) {\n      data.title = \"\";\n    }\n    if(!data || !data.person) {\n      data.person = \"\";\n    }\n    if(!data || !data.place) {\n      data.place = \"\";\n    }\n    if(!data || !data.page) {\n      callback(\"Page not set.\");\n    }\n    return data;\n  };\n\n  var createEdit = function(events, event, callback) {\n    event = create(event); \n    edit(event, null, callback);\n  };\n\n  var fix = function(object, callback) {\n    if(!object.name || object.name === \"\") {\n      // Set object.name to object.title but only the letters in lower case\n      object.name = object.title.toLowerCase().replace(/[^a-z]+/g, '');\n      // $log.debug(\"set object.name to\", object.name);\n    }\n    if(angular.isFunction(callback)) {\n      return callback(null, object);\n    }\n    return object;\n  };\n\n  var fixEach = function(objects, callback) {\n    for (var i = objects.length - 1; i >= 0; i--) {\n      objects[i] = fix(objects[i]);\n    }\n    if(angular.isFunction(callback)) {\n      return callback(null, objects);\n    }\n    return objects;\n  };\n\n  var refresh = function(eventBlocks) {\n    var allEvents = merge(eventBlocks.unknown, eventBlocks.before, eventBlocks.after);\n    // $log.debug(\"allEvents.length\", allEvents.length);\n    eventBlocks = transform(allEvents);\n    // $log.debug(\"refreshed\");\n    return eventBlocks;\n  };\n\n  var saveOne = function (eventBlocks, eventBlockName, event, callback) {\n    var errors = [\n      \"EventService: Can't save event.\",\n      \"EventService: Can't save event, event to update not found.\",\n      \"EventService: Can't save event, parameters undefind.\",\n    ];\n    if(angular.isDefined(event) && angular.isDefined(eventBlockName) && angular.isDefined(callback)) {\n      event = fix(event);\n      if(angular.isUndefined(event.id)) {\n        // create because id is undefined\n        $sailsSocket.post('/timeline', event).success(function(data, status, headers, config) {\n          if(angular.isArray(data)) {\n            data = data[0];\n          }\n          // $log.debug(\"event created\", event, data);\n          var index = eventBlocks[eventBlockName].indexOf(event);\n          if (index > -1) {\n            eventBlocks[eventBlockName][index] = data;\n            // $log.debug(eventBlocks[eventBlockName][index]);\n            callback(null, eventBlocks[eventBlockName][index]);\n          } else {\n            callback(errors[1]);\n          }\n        }).error(function (data, status, headers, config) {\n          if(angular.isArray(data)) {\n            data = data[0];\n          }\n          $log.error(data, status, headers, config);\n          callback(errors[0]);\n        });\n      } else {\n        // update because id is defined\n        $sailsSocket.put('/timeline/'+event.id, event).success(function(data, status, headers, config) {\n          if(angular.isArray(data)) {\n            data = data[0];\n          }\n          // $log.debug(\"event updated\", event, data);\n          event = data;\n          callback(null, event);\n        }).error(function (data, status, headers, config) {\n          $log.error(data, status, headers, config);\n          callback(errors[0]);\n        });\n      }\n    } else {\n      callback(errors[2]);\n    }\n  };\n\n  var saveAllInBlock = function(eventBlocks, eventBlockName, callback) {\n    $async.map(eventBlocks[eventBlockName], function (event, callback) {\n      saveOne(eventBlocks, eventBlockName, event, callback);\n    }, callback);\n  };\n\n\n  var saveBlocks = function(eventBlocks, callback) {\n    var errors = [\n      \"EventService: Can't save eventBlocks, parameters undefind.\"\n    ];\n    // save just this event if defined\n    if(angular.isDefined(eventBlocks) && angular.isDefined(callback)) {\n      return $async.map(['after', 'before', 'unknown'], function (eventBlockName, callback) {\n        saveAllInBlock(eventBlocks, eventBlockName, callback);\n      }, function(err, eventBlocksArray) {\n        if(err) {\n           $log.error(err);\n          if(angular.isFunction(callback)) {\n            return callback(err);\n          }\n        }\n        var allEvents = merge(eventBlocksArray[0], eventBlocksArray[1], eventBlocksArray[2]);\n        eventBlocks = transform(allEvents);\n        return callback(null, eventBlocks);\n      });\n    }\n    $log.error(errors[0]);\n    if(angular.isFunction(callback)) {\n      return callback(errors[0]);\n    }\n  };\n\n  var resolve = function(page) {\n    return $sailsSocket.get('/timeline').then (function (data) {\n      // $log.debug(data);\n      return transform(data.data);\n    }, function error (resp){\n      $log.error(\"Error on resolve \"+page, resp);\n    });\n  };\n\n  var subscribe = function () {\n    $sailsSocket.subscribe('timeline', function(msg){\n      $log.debug(msg);\n      switch(msg.verb) {\n        case 'updated':\n          if($rootScope.authenticated) {\n            $rootScope.pop('success', 'Ein Ereignis wurde aktualisiert', msg.data.title);\n          }\n          findEvent(msg.id, function(error, event, eventBlock, index) {\n            if(error) {\n              $log.debug(error);\n              return error;\n            }\n            event = msg.data;\n            $scope.refresh();\n          });\n        break;\n        case 'created':\n          if($rootScope.authenticated) {\n            $rootScope.pop('success', 'Ein Ereignis wurde erstellt', msg.data.title);\n          }\n          $scope.events.before.push(msg.data);\n          $scope.refresh();\n        break;\n        case 'removedFrom':\n          if($rootScope.authenticated) {\n            $rootScope.pop('success', 'Ein Ereignis wurde entfernt', msg.data.title);\n          }\n          findEvent(msg.id, function(error, event, eventBlock, index) {\n            if(error) {\n              $log.debug(error);\n              return error;\n            }\n            EventService.removeFromClient($scope.events, event, eventBlock);\n          });\n        break;\n        case 'destroyed':\n          if($rootScope.authenticated) {\n            $rootScope.pop('success', 'Ein Ereignis wurde gelöscht', msg.data.title);\n          }\n          findEvent(msg.id, function(error, event, eventBlock, index) {\n            if(error) {\n              $log.debug(error);\n              return error;\n            }\n            EventService.removeFromClient($scope.events, event, eventBlock);\n          });\n        break;\n        case 'addedTo':\n          if($rootScope.authenticated) {\n            $rootScope.pop('success', 'Ein Ereignis wurde hinzugefügt', msg.data.title);\n          }\n        break;\n      }\n    });\n  };\n\n  return {\n    subscribe: subscribe,\n    split: split,\n    merge: merge,\n    append: append,\n    transform: transform,\n    saveOne: saveOne,\n    saveAllInBlock: saveAllInBlock,\n    saveBlocks: saveBlocks,\n    edit: edit,\n    createEdit: createEdit,\n    fixEach: fixEach,\n    resolve: resolve,\n    setModals: setModals,\n    refresh: refresh,\n    openTypeChooserModal: openTypeChooserModal,\n    chooseType: chooseType,\n    removeFromClient: removeFromClient,\n    remove: remove\n  };\n});","angular.module('ngFocus', [])\n// Source and Copyright: http://stackoverflow.com/questions/25596399/set-element-focus-in-angular-way\n.factory('focus', function($timeout, $window) {\n  return function(id) {\n    // timeout makes sure that it is invoked after any other event has been triggered.\n    // e.g. click events that need to run before the focus or\n    // inputs elements that are in a disabled state but are enabled when those events\n    // are triggered.\n    $timeout(function() {\n      var element = $window.document.getElementById(id);\n      if(element) {\n        element.focus();\n      }\n    });\n  };\n})\n.directive('eventFocus', function(focus) {\n  return function(scope, elem, attr) {\n    elem.on(attr.eventFocus, function() {\n      focus(attr.eventFocusId);\n    });\n\n    // Removes bound events in the element itself\n    // when the scope is destroyed\n    scope.$on('$destroy', function() {\n      elem.off(attr.eventFocus);\n    });\n  };\n});","angular.module('jumplink.cms.gallery', [\n  'mgcrea.ngStrap',\n  'ngAsync',\n  'angular-medium-editor',\n  'FBAngular',\n  'sails.io',\n  'angularFileUpload',\n  'jumplink.cms.sortable',\n  'jumplink.cms.content',\n])\n.service('GalleryService', function ($rootScope, $sailsSocket, $async, $filter, Fullscreen, SortableService, ContentService, FileUploader, $modal, $log) {\n\n  var editModal = null;\n  uploadModal = null;\n  fullscreenImage = null;\n\n  var dropdown = [\n    {\n      \"text\": \"<i class=\\\"fa fa-eye\\\"></i>&nbsp;Anzeigen\",\n      \"click\": \"goToImage(image)\"\n    },\n    {\n      \"text\": \"<i class=\\\"fa fa-edit\\\"></i>&nbsp;Bearbeiten\",\n      \"click\": \"editImage(image)\"\n    },\n    {\n      \"text\": \"<i class=\\\"fa fa-trash\\\"></i>&nbsp;Löschen\",\n      \"click\": \"$dropdown.hide();$dropdown.destroy();removeImage(image);\" // TODO delay\n    },\n    {\n      \"text\": \"<i class=\\\"fa fa-floppy-o\\\"></i>&nbsp;Speichern\",\n      \"click\": \"saveImage(image)\"\n    }\n  ];\n\n  var getDropdown = function () {\n    return dropdown;\n  };\n\n  var setEditModal = function($scope) {\n    editModal = $modal({scope: $scope, title: 'Bild bearbeiten', templateUrl: '/views/modern/gallery/editmodal.jade', show: false});\n    return getEditModal();\n  };\n\n  var getEditModal = function() {\n    return editModal;\n  };\n\n  var prepairUploadModal = function (uploadModal, imageBlocks, contentBlocks) {\n    \n    uploadModal.$scope.imageBlocks = imageBlocks;\n    uploadModal.$scope.selects = getSelects(imageBlocks, contentBlocks);\n    if(uploadModal.$scope.selects.length > 0) {\n      $rootScope.selectedContentBlock = uploadModal.$scope.selects[0].value;\n    }\n\n    $rootScope.$watch('selectedContentBlock', function(newValue, oldValue) {\n      $log.debug(\"selected changed to\", newValue);\n    });\n\n    return uploadModal;\n  };\n\n  var setUploadModal = function($scope, imageBlocks, contentBlocks, options, callback, onCompleteCallback) {\n\n    // if options not set, set to default values\n    if(angular.isUndefined(options)) {\n      options = {\n        thumbnail: {\n          width: 300,\n        },\n        rescrop: {\n          width: 1200,\n          cropwidth: 1200,\n          cropheight: 1200,\n        }\n      };\n    }\n\n    var uploadOptions = {\n      url: 'gallery/upload',\n      removeAfterUpload: true,\n      // WARN: headers HTML5 only\n      headers: {\n        options: JSON.stringify(options)\n      }\n    };\n\n    $scope.uploader = new FileUploader(uploadOptions);\n    $scope.uploader.filters.push({\n      name: 'imageFilter',\n      fn: function(item /*{File|FileLikeObject}*/, options) {\n        var type = '|' + item.type.slice(item.type.lastIndexOf('/') + 1) + '|';\n        return '|jpg|png|jpeg|bmp|gif|'.indexOf(type) !== -1;\n      }\n    });\n\n    if(angular.isFunction(onCompleteCallback)) {\n      $scope.uploader.onComplete = onCompleteCallback;\n    }\n\n    $scope.uploader.onCompleteItem = function(fileItem, response, status, headers) {\n      //fileItem.member.image = response.files[0].uploadedAs;\n      $log.debug(\"[GalleryService.uploader.onCompleteItem]\",fileItem, response, status, headers);\n      // WORKAROUND until the socket method works\n      response.files.forEach(function (file, index, files) {\n\n        var selected = $rootScope.selectedContentBlock;\n        var imageBlocks = uploadModal.$scope.imageBlocks;\n        var currentImages = imageBlocks[selected];\n\n        $log.debug(\"[GalleryService.$scope.uploader.onCompleteItem] selected\", selected, \"imageBlocks\", imageBlocks, \"currentImages\", currentImages);\n\n        var last_position = 0;\n        if(currentImages.length > 0) {\n          last_position = currentImages[currentImages.length-1].position;\n        }\n        if($rootScope.authenticated) {\n          $rootScope.pop('success', 'Ein Bild wurde hochgeladen', file.original.name);\n        }\n        if(typeof file.position === 'undefined') {\n          last_position++;\n          file.position = last_position;\n          file.content = selected;\n        }\n\n        $log.debug(\"[GalleryService.$scope.uploader.onCompleteItem] file\", file);\n        \n        currentImages.push(file);\n      });\n    };\n\n    $scope.upload = function(fileItem, image) {\n      fileItem.image = image;\n      fileItem.upload();\n    };\n\n    uploadModal = $modal({scope: $scope, title: 'Bilder hinzufügen', uploader: $scope.uploader, templateUrl: '/views/modern/gallery/uploadimagesmodal.jade', show: false});\n    uploadModal = prepairUploadModal(uploadModal, imageBlocks, contentBlocks);\n\n    if(angular.isFunction(callback)) {\n      return callback(getUploadModal());\n    }\n    return getUploadModal();\n  };\n\n  var getSelects = function (imageBlocks, contentBlocks) {\n    var blockNames = Object.keys(imageBlocks);\n    var result = [];\n    // console.log(\"contentBlocks\", contentBlocks);\n    blockNames.forEach(function (blockName, index, array) {\n      var label = ContentService.getByName(contentBlocks, blockName).title || blockName; // TODO WARNING slow!\n      result.push({\n        label: label,\n        value: blockName\n      });\n    });\n    return result;\n  };\n\n  var getUploadModal = function() {\n    return uploadModal;\n  };\n\n  var fix = function(image, page, contentname, callback) {\n    if(!image.page || image.page === \"\") {\n      image.page = page;\n    }\n\n    if(!image.content || image.content === \"\") {\n      image.content = contentname;\n    }\n\n    if(angular.isFunction(callback)) {\n      return callback(null, image);\n    }\n    return image;\n  };\n\n  // var setFullScreen = function(image) {\n  //   // http://stackoverflow.com/questions/21702375/angularjs-ng-click-over-ng-click\n  //   fullscreenImage = image;\n  // }\n\n  // var closeFullScreen = function(image) {\n  //   Fullscreen.cancel();\n  // }\n\n  // Fullscreen.$on('FBFullscreen.change', function(evt, isFullscreenEnabled){\n  //   if(!isFullscreenEnabled) {\n  //     delete fullscreenImage;\n  //   }\n  //   $scope.$apply();\n  // });\n\n  // var isFullScreen = function(image) {\n  //   if(angular.isDefined($scope.fullscreenImage) && angular.isDefined($scope.fullscreenImage.original) && angular.isDefined($scope.fullscreenImage.original.name) && $scope.fullscreenImage.original.name == image.original.name) {\n  //     return true;\n  //   } else {\n  //     return false;\n  //   }\n  // }\n\n  var saveOne = function(image, page, contentname, callback) {\n    image = fix(image, page, contentname);\n    var errors = [\n      'Bild konnte nicht gespeichert werden'\n    ];\n    $sailsSocket.put('/gallery/'+image.id, image).success(function(data, status, headers, config) {\n      if(angular.isArray(data)) {\n        data = data[0];\n      }\n      if(angular.isFunction(callback)) {\n        callback(null, data);\n      }\n    }).\n    error(function(data, status, headers, config) {\n      $log.error (errors[0], data);\n      if(angular.isFunction(callback)) {\n        callback(errors[0], data);\n      }\n    });\n  };\n\n  var saveAllBlocks = function(imageBlocks, page, callback) {\n    var blockNames = Object.keys(imageBlocks);\n    // $log.debug(\"saveAllBlocks\",\"blockNames\" , blockNames);\n\n    $async.map(blockNames,\n    function iterator(contentname, callback) {\n      saveAll(imageBlocks[contentname], page, contentname, callback);\n    }, callback);\n\n    // $async.map(images,\n    // function iterator(image, callback) {\n    //   saveOne(image, page, contentname, callback);\n    // }, callback);\n  };\n\n  var saveAll = function(images, page, contentname, callback) {\n    $async.map(images,\n    function iterator(image, callback) {\n      saveOne(image, page, contentname, callback);\n    }, callback);\n  };\n\n  var remove = function(images, index, image, page, callback) {\n    if(typeof(index) === 'undefined' || index === null) {\n      index = images.indexOf(image);\n    }\n    images = SortableService.remove(images, index, image);\n    // if image has an id it is saved on database, if not, not\n    if(image.id) {\n      // $log.debug(\"remove from server, too\" ,image);\n      $sailsSocket.delete('/gallery/'+image.id+\"?filename=\"+image.original.name+\"&page=\"+page, {id:image.id, filename:image.original.name, page: page}).success(function(data, status, headers, config) {\n        if(angular.isFunction(callback)) {\n          callback(null, images);\n        }\n      }).\n      error(function(data, status, headers, config) {\n        $log.error (errors[0], data);\n        if(angular.isFunction(callback)) {\n          callback(data);\n        }\n      });\n    } else {\n      if(angular.isFunction(callback)) {\n        callback(null, images);\n      }\n    }\n  };\n\n  var add = function(imageBlocks, contentBlocks, callback) {\n    // $log.debug(\"add\");\n    uploadModal.$promise.then(uploadModal.show);\n\n    uploadModal = prepairUploadModal(uploadModal, imageBlocks, contentBlocks);\n\n    uploadModal.$scope.$on('modal.hide',function(){\n      $log.debug(\"upload modal closed\");\n      if(angular.isFunction(callback)) {\n        callback(null);\n      }\n    });\n  };\n\n  // Images for Content\n  var addBlock = function(imageBlocks, content, callback) {\n    imageBlocks[content.name] = [];\n    if(angular.isFunction(callback)) {\n      return callback(null, imageBlocks[content.name]);\n    }\n    return imageBlocks[content.name];\n  };\n\n  var edit = function(image, callback) {\n    $log.debug(\"edit\", image);\n    editModal.$scope.image = image;\n    //- Show when some event occurs (use $promise property to ensure the template has been loaded)\n    editModal.$promise.then(editModal.show);\n\n    editModal.$scope.$on('modal.hide',function(){\n      $log.debug(\"edit closed\");\n      if(angular.isFunction(callback)) {\n        callback(null, editModal.$scope.image);\n      }\n    });\n  };\n\n  var aspect = function (image, width)  {\n    var height, scale, aspectRatio, win, paddingTopBottom = 0, paddingLeftRight = 0;\n    if($scope.isFullScreen(image)) {\n      // customised jQuery Method of http://css-tricks.com/perfect-full-page-background-image/\n      aspectRatio = image.original.width / image.original.height;\n      win = $rootScope.getWindowDimensions();\n      if(win.width / win.height < aspectRatio) {\n        width = win.width; // width 100%\n        scale = image.original.width / width;\n        height = image.original.height / scale;\n        paddingTopBottom = (win.height - height) / 2;\n        height = win.height;\n      } else {\n        height = win.height;  // height 100%\n        scale = image.original.height / height;\n        width = image.original.width / scale;\n        paddingLeftRight = (win.width - width) / 2;\n        width = win.width;\n      }\n      return {width: width+'px', height: height+'px', 'padding-right': paddingLeftRight+\"px\", 'padding-left': paddingLeftRight+\"px\", 'padding-top': paddingTopBottom+\"px\", 'padding-bottom': paddingTopBottom+\"px\" };\n    } else {\n      scale = image.original.width / width;\n      height =  image.original.height / scale;\n      return {width: width+'px', height: height+'px'};\n    }\n  };\n\n  var subscribe = function () {\n    $sailsSocket.subscribe('gallery', function(msg) {\n      $log.debug(msg);\n      switch(msg.verb) {\n        case 'updated':\n          if($rootScope.authenticated) {\n            $log.debug('success', 'Ein Bild wurde aktualisiert', msg.data.original.name);\n            // $rootScope.pop('success', 'Ein Bild wurde aktualisiert', msg.data.original.name);\n          }\n        break;\n        case 'created':\n          // TODO not broadcast / fired why?!\n          if($rootScope.authenticated) {\n            $rootScope.pop('success', 'Ein Bild wurde hochgeladen', msg.data.original.name);\n          }\n          $scope.images.push(msg.data);\n        break;\n        case 'removedFrom':\n          if($rootScope.authenticated) {\n            $rootScope.pop('success', 'Ein Bild wurde entfernt', \"\");\n          }\n          $log.debug(msg.data);\n        break;\n        case 'destroyed':\n          // if($rootScope.authenticated) {\n          //   $rootScope.pop('success', 'Ein Bild wurde gelöscht', \"\");\n          // }\n          $log.debug(msg.data);\n        break;\n        case 'addedTo':\n          if($rootScope.authenticated) {\n            $rootScope.pop('success', 'Ein Bild wurde hinzugefügt', \"\");\n          }\n          $log.debug(msg.data);\n        break;\n      }\n    });\n  };\n\n  var resolve = function(page, content) {\n    var url = '/gallery?limit=0&page='+page;\n    if(content) {\n      url = url+'&content='+content;\n    }\n    return $sailsSocket.get(url).then (function (data) {\n      return $filter('orderBy')(data.data, 'position');\n    }, function error (resp) {\n      $log.error(resp);\n    });\n  };\n\n  return {\n    getDropdown: getDropdown,\n    setEditModal: setEditModal,\n    getEditModal: getEditModal,\n    setUploadModal: setUploadModal,\n    getUploadModal: getUploadModal,\n    saveOne: saveOne,\n    saveAll: saveAll,\n    saveAllBlocks: saveAllBlocks,\n    remove: remove,\n    add: add,\n    addBlock: addBlock,\n    edit: edit,\n    aspect: aspect,\n    subscribe: subscribe,\n    resolve: resolve\n  };\n});","angular.module('jumplink.cms.history', [\n  'ui.router',\n])\n/**\n * @see: https://github.com/angular-ui/ui-router/issues/92\n */\n.service('HistoryService', function ($window, $location, $state, $anchorScroll, $timeout, $log) {\n  var history = [];\n  var push = function(state, params) {\n    history.push({ state: state, params: params });\n  };\n\n  var all = function() {\n    return history;\n  };\n\n  var go = function(step) {\n    $log.debug('[jumplink.cms.history.HistoryService], history.length', history.length, 'step', step, 'history.length + step =', history.length + step);\n    // If the past has not been saved as far as the steps that we want to go back, then go to the beginning of time\n    if(history.length + step <= 0) {\n     return $location.path('/');\n    }\n    // TODOlocation    // (1) Determine # of states in stack with URLs, attempt to\n    //    shell out to $window.history when possible\n    // (2) Attempt to figure out some algorthim for reversing that,\n    //     so you can also go forward\n    var prev = this.previous(step || -1);\n    return $state.go(prev.state, prev.params);\n  };\n\n  var previous = function(step) {\n    return history[history.length - Math.abs(step || 1)];\n  };\n\n  var back = function() {\n    return this.go(-1);\n  };\n\n  var goToHashPosition = function (hash) {\n    // $log.debug(\"go to hash\", hash);\n    $location.hash(hash);\n    $anchorScroll.yOffset = 60;\n    $anchorScroll();\n  };\n\n  var autoScroll = function () {\n    var hash = $location.hash();\n    // $log.debug(\"hash\", hash);\n    if(hash) {\n      // WORKAROUND\n      $timeout(function(){ goToHashPosition(hash); }, 1000); // TODO smooth?\n    } else {\n      $anchorScroll();\n    }    \n  };\n\n  return {\n    push: push,\n    all: all,\n    go: go,\n    previous: previous,\n    back: back,\n    goToHashPosition: goToHashPosition,\n    autoScroll: autoScroll\n  };\n\n})\n.run(function(HistoryService, $state, $rootScope) {\n\n  $rootScope.$on(\"$stateChangeSuccess\", function(event, to, toParams, from, fromParams) {\n    if (!from.abstract) {\n      HistoryService.push(from, fromParams);\n    }\n  });\n  console.log(HistoryService);\n  HistoryService.push($state.current, $state.params);\n\n});","angular.module('jumplink.cms.info', [\n  'sails.io',\n])\n\n.service('CmsService', function ($log, $sailsSocket) {\n\n  var info = function(url, callback) {\n    var errors = [\n      \"[CmsService] Error: On trying to get cms info, url: \"+url,\n      \"[CmsService] Error: Result is null, url: \"+url\n    ];\n    var warns = [\n      \"[CmsService] Warn: Request has more than one results, url: \"+url\n    ];\n    return $sailsSocket.get(url).then (function (data) {\n      if(angular.isUndefined(data) || angular.isUndefined(data.data)) {\n        if(angular.isFunction(callback)) {\n          return callback(errors[1]);\n        }\n        return null;\n      }\n      if (data.data instanceof Array) {\n        data.data = data.data[0];\n        $log.warn(warns[0]);\n      }\n      if(angular.isFunction(callback)) {\n        return callback(null, data.data);\n      }\n      return data.data;\n    }, function error (resp){\n      $log.error(errors[0], resp);\n      if(angular.isFunction(callback)) {\n        return callback(errors[0], resp);\n      }\n      return resp;\n    });\n  };\n\n  // CMS Info for Users\n  var infoUser = function(callback) {\n    return info('/cms/infouser', callback);\n  };\n\n  var infoAdmin = function(callback) {\n    return info('/cms/infoadmin', callback);\n  };\n\n  return {\n    infoUser: infoUser,\n    infoAdmin: infoAdmin\n  };\n});","angular.module('jumplink.cms.multisite', [\n  'sails.io',\n  'jumplink.cms.sails'\n])\n.service('MultisiteService', function ($rootScope, JLSailsService, $log) {\n\n  var resolve = function(query, callback) {\n    // $log.debug(\"[MultisiteService.resolve]\");\n    var options = {\n      method: 'get',\n      resultIsArray: true\n    };\n    return JLSailsService.resolve('/multisite/find', query, options, callback);\n  };\n\n  var resolveNames = function(query, callback) {\n    // $log.debug(\"[MultisiteService.resolveNames]\");\n    var options = {\n      method: 'get',\n      resultIsArray: true\n    };\n    return JLSailsService.resolve('/multisite/findnames', query, options, callback);\n  };\n\n  var resolveHosts = function(query, callback) {\n    // $log.debug(\"[MultisiteService.resolveNames]\");\n    var options = {\n      method: 'get',\n      resultIsArray: true\n    };\n    return JLSailsService.resolve('/multisite/findhosts', query, options, callback);\n  };\n\n  return {\n    resolve: resolve,\n    resolveNames: resolveNames,\n    resolveHosts: resolveHosts\n  };\n});","angular.module('jumplink.cms.routes', [\n    'sails.io',\n    'jumplink.cms.sails',\n    'mgcrea.ngStrap',\n    'jumplink.cms.sortable',\n    'ngFocus',\n    'jumplink.cms.utilities'\n  ])\n\n  .filter('showOnlyMainRoutes', function() {\n    // In the return function, we must pass in a single parameter which will be the data we will work on.\n    // We have the ability to support multiple other parameters that can be passed into the filter optionally\n    return function(routes, active) {\n      if(active !== true) {\n        return routes;\n      }\n      var result = [];\n      for (var i = 0; i < routes.length; i++) {\n        if(routes[i].main === true) {\n          result.push(routes[i]);\n        }\n      }\n      return result;\n    };\n  })\n  .service('RoutesService', function ($rootScope, JLSailsService, $log, SortableService) {\n    var create = function(data) {\n      if(!data || !data.match) {\n        data.match = \"\";\n      }\n      if(!data || !data.title) {\n        data.title = \"\";\n      }\n      if(!data.main) {\n        data.main = false;\n      }\n      if(!data || !data.state) {\n        data.state = {};\n      }\n      if(!data || !data.url) {\n        data.url = \"\";\n      }\n      if(!data || !data.alternativeUrls) {\n        data.alternativeUrls = [];\n      }\n      if(!data.state.name) {\n        data.state.name = \"\";\n      }\n      if(!data.state.customstate) {\n        data.state.customstate = false;\n      }\n      if(!data.state.url) {\n        data.state.url = \"\";\n      }\n      if(!data.state.views) {\n        data.state.views = \"\";\n      }\n      if(!data.state.resolve) {\n        data.state.resolve = \"\";\n      }\n      if(!data || !data.fallback) {\n        data.fallback = {};\n      }\n      if(!data.fallback.url) {\n        data.fallback.url = \"\";\n      }\n      return data;\n    };\n\n    var append = function(routes, data, callback) {\n      data = create(data);\n      $log.debug(\"[RoutesService] data\", data);\n      SortableService.append(routes, data, callback);\n    };\n\n    var swap = function(routes, index_1, index_2, callback) {\n      return SortableService.swap(contents, index_1, index_2, callback);\n    };\n\n    var moveForward = function(index, routes, callback) {\n      return SortableService.moveForward(index, routes, callback);\n    };\n\n    var moveBackward = function(index, routes, callback) {\n      return SortableService.moveBackward(index, routes, callback);\n    };\n\n    var removeFromClient = function (routes, index, route, callback) {\n      if(angular.isFunction(callback)) {\n        return SortableService.remove(routes, index, route, callback);\n      }\n      return SortableService.remove(routes, index, route);\n    };\n\n    var remove = function(routes, index, route, callback) {\n      if((angular.isUndefined(route) || route === null) && angular.isDefined(index)) {\n        route = routes[index];\n      }\n      if(angular.isUndefined(index) || index === null) {\n        index = routes.indexOf(route);\n      }\n      routes = removeFromClient(routes, index, route);\n      // if route has an id it is saved on database, if not, not\n      if(route.id) {\n        $log.debug(\"[RoutesService.remove] remove from server, too\", route);\n        var options = {\n          method: 'delete',\n          resultIsArray: false\n        };\n        return JLSailsService.resolve('/routes/destroy/'+route.id, {id:route.id}, options, callback);\n      }\n    };\n\n    var find = function(query, callback) {\n      // $log.debug(\"[RoutesService.find]\");\n      var options = {\n        method: 'post',\n        resultIsArray: true\n      };\n      return JLSailsService.resolve('/routes/find', query, options, callback);\n    };\n\n    var findByHost = function(query, callback) {\n      // $log.debug(\"[RoutesService.findByHost]\");\n      var options = {\n        method: 'post',\n        resultIsArray: true\n      };\n      return JLSailsService.resolve('/Routes/findByHost', query, options, callback);\n    };\n\n    var updateOrCreate = function(route, callback) {\n      $log.debug(\"[RoutesService.updateOrCreate]\", route);\n      var options = {\n        method: 'post',\n        resultIsArray: false\n      };\n      return JLSailsService.resolve('/Routes/updateOrCreate', {route: route}, options, callback);\n    };\n\n    var updateOrCreateByHost = function(host, route, callback) {\n      $log.debug(\"[RoutesService.updateOrCreateByHost]\", host, route);\n      var options = {\n        method: 'post',\n        resultIsArray: false\n      };\n      return JLSailsService.resolve('/Routes/updateOrCreateByHost', {host: host, route: route}, options, callback);\n    };\n\n    var updateOrCreateEach = function(routes, callback) {\n      $log.debug(\"[RoutesService.updateOrCreateEach]\", routes);\n      var options = {\n        method: 'post',\n        resultIsArray: true\n      };\n      return JLSailsService.resolve('/Routes/updateOrCreateEach', {routes: routes}, options, callback);\n    };\n\n    var updateOrCreateEachByHost = function(host, routes, callback) {\n      $log.debug(\"[RoutesService.updateOrCreateEachByHost]\", host, routes);\n      var options = {\n        method: 'post',\n        resultIsArray: true\n      };\n      return JLSailsService.resolve('/Routes/updateOrCreateEachByHost', {host: host, routes: routes}, options, callback);\n    };\n\n    return {\n      create: create,\n      append: append,\n      swap: swap,\n      moveForward: moveForward,\n      moveBackward: moveBackward,\n      removeFromClient: removeFromClient,\n      remove: remove,\n      destroy: remove, // Alias\n      find: find,\n      findByHost: findByHost,\n      updateOrCreate: updateOrCreate,\n      updateOrCreateByHost: updateOrCreateByHost,\n      updateOrCreateEach: updateOrCreateEach,\n      updateOrCreateEachByHost: updateOrCreateEachByHost,\n      saveEachByHost: updateOrCreateEachByHost, // Alias\n    };\n  })\n;","angular.module('jumplink.cms.sails', [\n    'sails.io',\n  ])\n\n  .service('JLSailsService', function ($rootScope, $sailsSocket, $q, $log) {\n\n    var resolve = function(url, query, options, callback, next) {\n      var deferred = $q.defer();\n      var errors = [\n        \"On trying to resolve \"+url,\n        \"Request has more than one results\",\n        \"No result\"\n      ];\n      if(angular.isUndefined(options)) {\n        options = {};\n      }\n      if(angular.isUndefined(options.method)) {\n        options.method = 'get';\n      }\n      if(angular.isUndefined(options.resultIsArray)) {\n        options.resultIsArray = false;\n      }\n      if(angular.isUndefined(query)) {\n        query = {};\n      }\n      // $log.debug(\"[JLSailsService.resolve]\", url, query, options);\n      $sailsSocket[options.method](url, query).then (function (data) {\n        if(angular.isUndefined(data) || angular.isUndefined(data.data)) {\n          if(angular.isFunction(callback)) {\n            return callback(null, null);\n          }\n          return deferred.resolve(null);\n        }\n        if (!options.resultIsArray && data.data instanceof Array) {\n          data.data = data.data[0];\n          $log.warn(errors[1]);\n        }\n        // data.data.content = html_beautify(data.data.content);\n        if(next) {\n          data.data = next(data.data);\n        }\n        if(angular.isFunction(callback)) {\n          callback(null, data.data);\n        }\n        return deferred.resolve(data.data);\n      }, function error (resp){\n        $log.error(errors[0], resp);\n        if(angular.isFunction(callback)) {\n          return callback(errors[0], resp);\n        }\n        return deferred.reject(errors[0]);\n      });\n      return deferred.promise;\n    };\n    return {\n      resolve: resolve\n    };\n  })\n;","angular.module('jumplink.cms.session', [\n  'sails.io',\n  'jumplink.cms.sails'\n])\n.service('SessionService', function ($rootScope, JLSailsService, $sailsSocket, $q, $log) {\n\n  var create = function(user, callback) {\n    $log.debug(\"[SessionService.create]\", user);\n    var options = {\n      method: 'post',\n      resultIsArray: false\n    };\n    return JLSailsService.resolve('/session/create', user, options, callback);\n  };\n\n  var destroy = function(user, callback) {\n    $log.debug(\"[SessionService.destroy]\", user);\n    var options = {\n      method: 'post',\n      resultIsArray: false\n    };\n    return JLSailsService.resolve('/session/destroy', user, options, callback);\n  };\n\n  /**\n   * Check if user is authentication in current cms session\n   * Used if you need authentication conditions\n   */\n  var isAuthenticated = function (callback) {\n    $log.log(\"[SessionService.isauthenticated]\");\n    var deferred = $q.defer();\n    return $sailsSocket.get('/session/authenticated').then (function (data) {\n      if(angular.isFunction(callback)) {\n        return callback(null, data.data);\n      }\n      return data.data;\n    });\n  };\n\n  /**\n   * Used for routes you can only visit if you are signed in, throws an error message if your are not authenticated\n   */\n  var needToBeAuthenticated = function () {\n    $log.log(\"[SessionService.needToBeAuthenticated] authenticated\");\n    var deferred = $q.defer();\n    $sailsSocket.get('/session/authenticated').then (function (data) {\n      if (data.data) {\n        $log.log(\"is authenticated\", data);\n        return deferred.resolve(data.data);\n      } else {\n        $log.log(\"is not authenticated\", data);\n        return deferred.reject('You need to be logged in');\n      }\n    });\n    return deferred.promise;\n  };\n\n  /**\n   * Check if authentifcated user is blogger or better\n   */\n  var bloggerOrBetter = function (callback) {\n    $log.log(\"[SessionService.bloggerOrBetter]\");\n    var deferred = $q.defer();\n    return $sailsSocket.get('/session/bloggerOrBetter').then (function (data) {\n      if(angular.isFunction(callback)) {\n        return callback(null, data.data);\n      }\n      return data.data;\n    });\n  };\n\n  /**\n   * Check if cms is in developer mode or session user is better than that\n   */\n  var developerOrBetter = function (callback) {\n    $log.log(\"[SessionService.developerOrBetter]\");\n    var deferred = $q.defer();\n    return $sailsSocket.get('/session/developerOrBetter').then (function (data) {\n      if(angular.isFunction(callback)) {\n        return callback(null, data.data);\n      }\n      return data.data;\n    });\n  };\n\n  /**\n   * Check if authentifcated user is siteadmin or better\n   */\n  var siteadminOrBetter = function (callback) {\n    $log.log(\"[SessionService.siteadminOrBetter]\");\n    var deferred = $q.defer();\n    return $sailsSocket.get('/session/siteadminOrBetter').then (function (data) {\n      if(angular.isFunction(callback)) {\n        return callback(null, data.data);\n      }\n      return data.data;\n    });\n  };\n\n  /**\n   * Check if authentifcated user is superadmin\n   */\n  var superadmin = function (callback) {\n    $log.log(\"[SessionService.superadmin]\");\n    var deferred = $q.defer();\n    return $sailsSocket.get('/session/superadmin').then (function (data) {\n      if(angular.isFunction(callback)) {\n        return callback(null, data.data);\n      }\n      return data.data;\n    });\n  };\n\n  /**\n   * Check if authentifcated user is an employee\n   */\n  var employee = function (callback) {\n    $log.log(\"[SessionService.employee]\");\n    var deferred = $q.defer();\n    return $sailsSocket.get('/session/employee').then (function (data) {\n      if(angular.isFunction(callback)) {\n        return callback(null, data.data);\n      }\n      return data.data;\n    });\n  };\n\n  /**\n   * Check if authentifcated user is an employee or better\n   */\n  var employeeOrBetter = function (callback) {\n    $log.log(\"[SessionService.employee]\");\n    var deferred = $q.defer();\n    return $sailsSocket.get('/session/employeeOrBetter').then (function (data) {\n      if(angular.isFunction(callback)) {\n        return callback(null, data.data);\n      }\n      return data.data;\n    });\n  };\n\n  /**\n   * Used for routes you can only visit if you are signed in and user employee or better, throws an error message if your are not employee or better\n   */\n  var needToBeEmployeeOrBetter = function (callback) {\n    $log.log(\"[SessionService.authenticated] authenticated\");\n    var deferred = $q.defer();\n    $sailsSocket.get('/session/employeeOrBetter').then (function (data) {\n      if (data.data) {\n        $log.log(\"is employeeOrBetter\", data);\n        return deferred.resolve(data.data);\n      } else {\n        $log.log(\"is not employeeOrBetter\", data);\n        return deferred.reject('You must be an employee or a user with more credentials to do that');\n      }\n    });\n    return deferred.promise;\n  };\n\n  /**\n   * Used for routes you can only visit if you are signed in and user is admin or better, throws an error message if your are not employee or better\n   */\n  var needToBeSiteadminOrBetter = function (callback) {\n    $log.log(\"[SessionService.authenticated] authenticated\");\n    var deferred = $q.defer();\n    $sailsSocket.get('/session/siteadminOrBetter').then (function (data) {\n      if (data.data) {\n        $log.log(\"is siteadminOrBetter\", data);\n        return deferred.resolve(data.data);\n      } else {\n        $log.log(\"is not employeeOrBetter\", data);\n        return deferred.reject('You must be an admin or a user with more credentials to do that');\n      }\n    });\n    return deferred.promise;\n  };\n  /**\n   * \n   */\n  var getAllPolicies = function (callback) {\n    $log.log(\"[SessionService.getAllPolicies]\");\n    var deferred = $q.defer();\n    return $sailsSocket.get('/session/getAllPolicies').then (function (data) {\n      if(angular.isFunction(callback)) {\n        return callback(null, data.data);\n      }\n      return data.data;\n    });\n  };\n\n  /**\n   * Get logged in user\n   */\n  var getUser = function (callback) {\n    $log.log(\"[SessionService.getUser]\");\n    var deferred = $q.defer();\n    return $sailsSocket.get('/session/getUser').then (function (data) {\n      if(angular.isFunction(callback)) {\n        return callback(null, data.data);\n      }\n      return data.data;\n    });\n  };\n\n  return {\n    create: create,\n    destroy: destroy,\n    authenticated: needToBeAuthenticated, //alias TODO remove\n    needToBeAuthenticated: needToBeAuthenticated,\n    isAuthenticated: isAuthenticated, // TODO rename to authenticated\n    bloggerOrBetter: bloggerOrBetter,\n    developerOrBetter: developerOrBetter,\n    siteadminOrBetter: siteadminOrBetter,\n    superadmin: superadmin,\n    employee: employee,\n    employeeOrBetter: employeeOrBetter,\n    needToBeEmployeeOrBetter: needToBeEmployeeOrBetter,\n    needToBeSiteadminOrBetter: needToBeSiteadminOrBetter,\n    getAllPolicies: getAllPolicies,\n    getUser: getUser\n  };\n});","angular.module('jumplink.cms.sidebar', [\n    'mgcrea.ngStrap.aside',\n  ])\n\n  .directive('jlSidebar', function ($compile, $window) {\n\n    return {\n      restrict: 'E',\n      replace: true,\n      transclude: true,\n      templateUrl: '/views/modern/sidebar.jade',\n      scope: {\n        routes: \"=\",\n        title: \"=\" \n      },\n      link: function ($scope, $element, $attrs) {\n        \n      }\n    };\n  });","angular.module('jumplink.cms.sortable', [\n    'jumplink.cms.utilities'\n  ])\n  .service('SortableService', function (UtilityService, $log) {\n    var resetPosition = function (array) {\n      for (var i = array.length - 1; i >= 0; i--) {\n        array[i].position = i+1;\n      }\n      return array;\n    };\n\n    /*\n     * Swap two elements within the object array (called objects) and adjust the position\n     */\n    var swap = function(objects, index_1, index_2, cb) {\n\n      var object_1 = objects[index_1];\n      var object_2 = objects[index_2];\n\n      // swap position too\n      var position_tmp = object_1.position;\n      object_1.position = object_2.position;\n      object_2.position = position_tmp;\n\n      // IMPORTANT: swap Indexes, too\n      objects[index_1] = object_2;\n      objects[index_2] = object_1;\n\n      if(angular.isFunction(cb)) {\n        return cb(null, objects);\n      }\n      return objects;\n    };\n\n    /*\n     * Insert new object to position and move the underlying objects one index back\n     * http://stackoverflow.com/questions/5306680/move-an-array-element-from-one-array-position-to-another\n     */\n    var move = function (array, old_index, new_index, cb) {\n      $log.debug(\"[SortableService] move\");\n\n      if (new_index >= array.length) {\n          var k = new_index - array.length;\n          while ((k--) + 1) {\n              array.push(undefined);\n          }\n      }\n      array.splice(new_index, 0, array.splice(old_index, 1)[0]);\n\n      array = resetPosition(array);\n\n      if(angular.isFunction(cb)) {\n        cb(null, array);\n      }\n      return array;\n    };\n\n    /*\n     * Append a new object to array, check unique key value if set\n     */\n    var append = function(objects, data, cb, unique, uniqueKey) {\n      var errors = [\n        \"Unique key '\"+uniqueKey+\"' already exist\"\n      ];\n      var new_index = objects.length;\n      var new_position = 1;\n      var new_object;\n      var uniqueIndex = -1;\n\n      var okay = function (new_object, objects, new_index, cb) {\n        // $log.debug(\"old objects\", objects);\n        objects.push(new_object);\n        // $log.debug(\"new objects\", objects);\n        if(angular.isFunction(cb)) {\n          return cb(null, objects, new_index);\n        }\n        return objects;\n      };\n\n      var error = function (error, objects, uniqueIndex, cb) {\n        if(angular.isFunction(cb)) {\n          return cb(error, objects, uniqueIndex);\n        }\n        return error;\n      };\n\n      if(new_index >= 1) {\n        new_position = objects[new_index-1].position+1;\n      }\n\n      new_object = {\n        position: new_position,\n      };\n      angular.extend(new_object, data);\n      // $log.debug(\"new_object\", new_object);\n\n      if(unique && new_object[uniqueKey]) {\n        uniqueIndex = UtilityService.findKeyValue(objects, uniqueKey, new_object[uniqueKey]);\n        if(uniqueIndex > -1) {\n          return error(errors[0], objects, uniqueIndex, cb);\n        } else {\n          return okay(new_object, objects, new_index, cb);\n        }\n      } else {\n        return okay(new_object, objects, new_index, cb);\n      }\n    };\n\n    /*\n     * removed object from an array and adds it in another\n     */\n    var moveObjectToAnotherArray = function(object, index_from, array_from, array_to, cb, replaceData) {\n      var errors = [\n        \"[SortableService] Error: Function parameters not correctly set\"\n      ];\n\n      var errorParamsNotSet = function () {\n        $log.error(errors[0], object, index_from, array_from, array_to);\n        return cb(errors[0]);\n      };\n\n      if(object === null) {\n        object = array_from[index_from];\n      } else if (index_from === null) {\n        index_from = array_from.indexOf(object);\n      } else {\n        errorParamsNotSet();\n      }\n\n      if(!angular.isArray(array_from) || !angular.isArray(array_to)) {\n        errorParamsNotSet();\n      }\n\n      append(array_to, object, function (err, array_to, index_to) {\n        if(err) {\n          return cb(err);\n        }\n        remove(array_from, index_from, object, function (err, array_from) {\n          if(err) {\n            return cb(err);\n          }\n          return cb(null, {index_from: index_from, array_from: array_from, index_to:index_to, array_to: array_to });\n        });\n      }, false );\n    };\n\n    var moveForward = function(index, objects, cb) {\n      if(index + 1 < objects.length ) {\n        return swap(objects, index, index+1, cb);\n      }\n      if(angular.isFunction(cb)) {\n        return cb(\"Can't move forward, index is the last element.\", objects);\n      }\n      return objects;\n    };\n\n    var moveBackward = function(index, objects, cb) {\n      if(index - 1 >= 0) {\n        return swap(objects, index, index-1, cb);\n      }\n      if(angular.isFunction(cb)) {\n        return cb(\"Can't move backward, index is the first element.\", objects);\n      }\n      return objects;\n    };\n\n    var remove = function (objects, index, object, cb) {\n      if(typeof(index) === 'undefined' || index === null) {\n        index = objects.indexOf(object);\n      }\n      // $log.debug(\"remove from client\", index, object);\n      if (index > -1) {\n        objects.splice(index, 1);\n      }\n      if(angular.isFunction(cb)) {\n        return cb(null, objects);\n      }\n      return objects;\n    };\n\n    /*\n     * find value by key in array\n     */\n    var findKeyValue = function (objects, key, value) {\n      // $log.debug(\"findKeyValue\", key, value);\n      var index = -1;\n      for (var i = objects.length - 1; i >= 0 && index <= -1; i--) {\n        if(objects[i][key] === value) {\n          index = i;\n        } \n      }\n      return index;\n    };\n\n    /*\n     * Function for Drag and Drop functionality.\n     * Moves an moveable element with the moveFunction (e.g. to swap or insert the obkect).\n     * Usually called when the mouse button is released over an existing moveable element.\n     */\n    var dropMove = function(objects, dropObjectIndex, dragObject, event, cb, moveFunction) {\n      if(!moveFunction) {\n        moveFunction = move; // swap | move\n      }\n      var dragObjectIndex = objects.indexOf(dragObject);\n      var dropObject = objects[dropObjectIndex];\n      $log.debug(\"[SortableService] dropMove, dragObject:\", dragObject, \"dragObjectIndex\", dragObjectIndex, \"dropObject\", dropObject, \"dropObjectIndex\", dropObjectIndex);\n      return moveFunction(objects, dragObjectIndex, dropObjectIndex, cb);\n    };\n\n    return {\n      resetPosition: resetPosition,\n      swap: swap,\n      moveObjectToAnotherArray: moveObjectToAnotherArray,\n      move: move,\n      moveForward: moveForward,\n      moveBackward: moveBackward,\n      remove: remove,\n      append: append,\n      dropMove: dropMove,\n    };\n  })\n\n;","angular.module('jumplink.cms.bootstrap.signin', [\n    'mgcrea.ngStrap',\n    'jumplink.cms.signin'\n  ])\n\n  .service('SigninBootstrapService', function ($rootScope, SigninService, $log, $modal) {\n    var siginWithModal = function(title, goBackAfterSignin, extendRoles, scope, callback) {\n      $log.debug(\"[SigninBootstrapService.siginWithModal]\", title, goBackAfterSignin, extendRoles);\n\n      if(angular.isFunction(goBackAfterSignin) && !angular.isFunction(callback)) {\n        callback = goBackAfterSignin;\n        goBackAfterSignin = false;\n      }\n\n      if(angular.isFunction(extendRoles) && !angular.isFunction(callback)) {\n        callback = extendRoles;\n        extendRoles = false;\n      }\n\n      if(angular.isFunction(scope) && !angular.isFunction(callback)) {\n        callback = scope;\n        scope = null;\n      }\n\n      var signinModal = $modal({title: title, templateUrl: '/views/modern/signin.bootstrap.modal.jade', show: false});\n      signinModal.$scope.aborted = false;\n      signinModal.$scope.result = null;\n      signinModal.$scope.user = {\n        email: \"\",\n        password: \"\"\n      };\n      // signinModal.$scope.goBackAfterSignin = goBackAfterSignin === true;\n\n      signinModal.$scope.abort = function (user) {\n        signinModal.$scope.aborted = true;\n      };\n\n      signinModal.$scope.signin = function (user) {\n        $log.debug(\"[SigninBootstrapService.siginWithModal.signin]\", user);\n        SigninService.signin(user, goBackAfterSignin, extendRoles, scope, function (error, result) {\n          if(error) {\n            signinModal.$scope.error = error;\n            return signinModal.$scope.error;\n          }\n          signinModal.$scope.result = result;\n          // $rootScope.\n          $log.debug(result);\n        });\n      };\n\n      signinModal.$scope.$on('modal.hide',function(){\n        $log.debug(\"signin modal closed\");\n        if(angular.isFunction(callback)) {\n          callback(signinModal.$scope.error, signinModal.$scope.result, signinModal.$scope.user);\n        }\n      });\n\n      signinModal.$promise.then(signinModal.show);\n    };\n\n    return {\n      siginWithModal: siginWithModal\n    };\n  })\n;","angular.module('jumplink.cms.signin', [\n  'jumplink.cms.session',\n  'jumplink.cms.history',\n  'ngAsync'\n])\n.service('SigninService', function (SessionService, $log, HistoryService, $async) {\n\n\n  var getRoles = function (scope, callback) {\n    $async.parallel({\n      authenticated: function(callback) {\n        SessionService.isAuthenticated(callback);\n      },\n      bloggerOrBetter: function(callback) {\n        SessionService.bloggerOrBetter(callback);\n      },\n      siteadminOrBetter: function(callback) {\n        SessionService.siteadminOrBetter(callback);\n      },\n      employeeOrBetter: function(callback) {\n        SessionService.employeeOrBetter(callback);\n      }\n    },\n    callback);\n  };\n\n  var signin = function (user, goBackAfterSignin, extendRoles, scope, callback) {\n    if(angular.isFunction(goBackAfterSignin) && !angular.isFunction(callback)) {\n      callback = goBackAfterSignin;\n      goBackAfterSignin = false;\n    }\n\n    if(angular.isFunction(extendRoles) && !angular.isFunction(callback)) {\n      callback = extendRoles;\n      extendRoles = false;\n    }\n\n    if(angular.isFunction(scope) && !angular.isFunction(callback)) {\n      callback = scope;\n      scope = null;\n    }\n\n    $log.debug(\"[SigninService.signin]\", user);\n    // $scope.user.role = 'superadmin';\n    SessionService.create(user, function (err, result) {\n      if(err) {\n        return callback(err);\n      }\n      if(!result.authenticated) {\n        return null;\n      }\n      if(extendRoles === true) {\n        SessionService.getAllPolicies(function (err, results) {\n          if(err) {\n            return callback(err);\n          }\n          $log.debug(\"scope before extend\", scope);\n          angular.extend(scope, results);\n          $log.debug(\"scope after extend\", scope);\n          if(goBackAfterSignin === true) {\n            HistoryService.back();\n          }\n        });\n      }\n      if(goBackAfterSignin === true) {\n        HistoryService.back();\n      }\n\n      $log.debug(\"[SigninService.signin]\", user);\n      $log.debug(\"[SigninService.signin] err result\", err, result);\n      return callback(null, result);\n    });\n  };\n  return {\n    signin: signin\n  };\n});","angular.module('jumplink.cms.subnavigation', [\n  'mgcrea.ngStrap',\n  'sails.io',\n  'jumplink.cms.sortable',\n  'ngFocus',\n  'jumplink.cms.utilities'\n])\n\n.service('SubnavigationService', function ($rootScope, $window, $log, $sailsSocket, $filter, $modal, SortableService, UtilityService, focus) {\n\n  var editModal = null;\n\n  var setEditModal = function($scope) {\n    editModal = $modal({scope: $scope, title: 'Navigation bearbeiten', templateUrl: '/views/modern/editsubnavigationmodal.jade', show: false});\n    return getEditModal();\n  };\n\n  var getEditModal = function() {\n    return editModal;\n  };\n\n  var subscribe = function() {\n    // called on content changes\n    $sailsSocket.subscribe('navigation', function(msg){\n      $log.debug(\"[SubnavigationService] Navigation event!\", msg);\n      switch(msg.verb) {\n        case 'updated':\n          if($rootScope.authenticated) {\n            $rootScope.pop('success', 'Navigation wurde aktualisiert', msg.id);\n          }\n        break;\n      }\n    });\n  };\n\n  // WORKAROUND wait until image is loaded to fix bs-sidebar\n  var resizeOnImagesLoaded = function () {\n    angular.element($window).imagesLoaded(function() {\n      angular.element($window).triggerHandler('resize');\n    });\n  };\n\n  var create = function(data) {\n    if(!data || !data.target) {\n      data.target = \"\";\n    }\n    if(!data || !data.name) {\n      data.name = \"\";\n    }\n    if(!data || !data.page) {\n      cb(\"Page not set.\");\n    }\n    return data;\n  };\n\n  var append = function(navs, data, cb) {\n\n    data = create(data);\n\n    // $log.debug(\"[SubnavigationService] data\", data);\n\n    SortableService.append(navs, data, cb);\n  };\n\n  var swap = function(navs, index_1, index_2, cb) {\n    return SortableService.swap(contents, index_1, index_2, cb);\n  };\n\n  var moveForward = function(index, navs, cb) {\n    return SortableService.moveForward(index, navs, cb);\n  };\n\n  var moveBackward = function(index, navs, cb) {\n    return SortableService.moveBackward(index, navs, cb);\n  };\n\n  var edit = function(navs, cb) {\n    // $log.debug(\"[SubnavigationService] edit subnavigations\", navs);\n    editModal.$scope.navs = navs;\n    //- Show when some event occurs (use $promise property to ensure the template has been loaded)\n    editModal.$promise.then(editModal.show);\n\n    if(angular.isDefined(editModal.$scope.navs) && editModal.$scope.navs.length > 0) {\n      var index = Number(editModal.$scope.navs.length-1);\n      // $log.debug(\"[SubnavigationService] focus last subnavigationeditname\", index);\n      focus('subnavigationeditname'+index);\n    }\n\n    editModal.$scope.$on('modal.hide',function(){\n      // $log.debug(\"[SubnavigationService] edit navigation modal closed\");\n      cb(null, editModal.$scope.navs);\n    });\n  };\n\n  var removeFromClient = function (navs, index, nav, cb) {\n    if(angular.isFunction(cb)) {\n      return SortableService.remove(navs, index, nav, cb);\n    }\n    return SortableService.remove(navs, index, nav);\n  };\n\n  var remove = function(navs, index, nav, page, cb) {\n\n    if((angular.isUndefined(nav) || nav === null) && angular.isDefined(index)) {\n      nav = navs[index];\n    }\n\n    if(angular.isUndefined(index) || index === null) {\n      index = navs.indexOf(nav);\n    }\n\n    navs = removeFromClient(navs, index, nav);\n    // if nav has an id it is saved on database, if not, not\n    if(nav.id) {\n      $log.debug(\"[SubnavigationService] remove from server, too\" ,nav);\n      $sailsSocket.delete('/navigation/'+nav.id+\"?page=\"+page, {id:nav.id, page: page}).success(function(data, status, headers, config) {\n        if(angular.isFunction(cb)) {\n          return cb(null, navs);\n        }\n      }).\n      error(function(data, status, headers, config) {\n        $log.error (errors[0], data);\n        if(angular.isFunction(cb)) {\n          return cb(data);\n        }\n      });\n    }\n  };\n\n  var removeByTarget = function (navs, target, page, cb) {\n    $log.debug(\"[SubnavigationService] remove subnavigation by target \"+target);\n    var index = UtilityService.findKeyValue(navs, 'target', target);\n    if(index > -1) {\n      $log.debug(\"[SubnavigationService] subnavigation found \"+index);\n      remove(navs, index, null, page, cb);\n    } else {\n      if(angular.isFunction(cb)) {\n        cb(\"Subnavigation not found\");\n      }\n    }\n  };\n\n  var fix = function(fixed, object, index, cb) {\n    if(angular.isDefined(object.name) && angular.isString(object.name) && object.name !== \"\") {\n      fixed.push(object);\n    } else {\n      $log.warn(\"Name not set, remove Subnavigation\");\n    }\n    if(angular.isFunction(cb)) {\n      return cb(null, fixed);\n    }\n    return fixed;\n  };\n\n  var fixEach = function(objects, cb) {\n    var fixed = [];\n    for (var i = objects.length - 1; i >= 0; i--) {\n      fixed = fix(fixed, objects[i], i);\n    }\n    if(angular.isFunction(cb)) {\n      return cb(null, fixed);\n    }\n    return fixed;\n  };\n\n  var save = function(navs, page, cb) {\n    fixEach(navs, function(err, navs) {\n      $sailsSocket.put('/navigation/replaceall', {navs: navs, page: page}).success(function(data, status, headers, config) {\n        if(data !== null && typeof(data) !== \"undefined\") {\n          // WORKAROUND until socket event works\n          navs = $filter('orderBy')(data, 'position');\n          if(angular.isFunction(cb)) {\n            cb(null, navs);\n          }\n        } else {\n          var err = 'Navigation konnte nicht gespeichert werden';\n          $rootScope.pop('error', err, \"\");\n          if(angular.isFunction(cb)) {\n            cb(err, navs);\n          } \n        }\n      });\n    });\n  };\n\n  var resolve = function(page) {\n    var statename = 'layout.gallery';\n    return $sailsSocket.get('/navigation?page='+page, {page: page}).then (function (data) {\n      if(angular.isUndefined(data) || angular.isUndefined(data.data)) {\n        $log.warn(\"Warn: On trying to resolve \"+page+\" navs!\", \"Not found, navigation is empty!\");\n        return null;\n      }\n      data.data = $filter('orderBy')(data.data, 'position');\n      $log.debug(\"[SubnavigationService]\", data);\n      return data.data;\n    }, function error (resp){\n      $log.error(\"[SubnavigationService] Error: On trying to resolve \"+page+\" navs!\", resp);\n    });\n  };\n\n  return {\n    resizeOnImagesLoaded: resizeOnImagesLoaded,\n    subscribe: subscribe,\n    setEditModal: setEditModal,\n    getEditModal: getEditModal,\n    create: create,\n    append: append,\n    add: append,\n    swap: swap,\n    moveForward: moveForward,\n    moveBackward: moveBackward,\n    edit: edit,\n    removeFromClient: removeFromClient,\n    remove: remove,\n    removeByTarget: removeByTarget,\n    save: save,\n    resolve: resolve\n  };\n});","angular.module('jumplink.cms.theme', [\n  'sails.io',\n  'ngAsync',\n  'jumplink.cms.sails',\n])\n\n.service('ThemeService', function ($rootScope, $sailsSocket, $log, $async, JLSailsService) {\n  var isSubscribed = false;\n\n  /**\n   * find themes for current host from database and isert priority from database (or from local.json if no priority is set).\n   * @see CMS.ThemesController.find\n   */\n  var find = function(query, callback) {\n    $log.debug(\"[ThemeService.find]\", query);\n    var options = {\n      method: 'get',\n      resultIsArray: true\n    };\n    return JLSailsService.resolve('/theme/find', query, options, callback);\n  };\n\n  /**\n   * find themes for any host from database and isert priority from database (or from local.json if no priority is set).\n   * Only for superadmins!\n   */\n  var findByHost = function(host, callback) {\n    // $log.debug(\"[ThemeService.findByHost]\", host);\n    var options = {\n      method: 'post',\n      resultIsArray: true\n    };\n    return JLSailsService.resolve('/theme/findbyhost', {host: host}, options, callback);\n  };\n\n  var save = function (themes, callback) {\n    updateOrCreateEach(themes, function (err, result) {\n      if(angular.isDefined(callback)) {\n        callback(err, result);\n      }\n    });\n  };\n  \n  var updateOrCreateEach = function(themes, callback) {\n    $log.debug(\"[ThemeService.updateOrCreateEach]\", themes);\n    // $sailsSocket.put('/Theme/updateOrCreateEach', {themes: themes}).success(function(data, status, headers, config) {\n    //   $log.debug(data, status, headers, config);\n    //   callback(data, status, headers, config)\n    // });\n    var options = {\n      method: 'post',\n      resultIsArray: true\n    };\n    return JLSailsService.resolve('/Theme/updateOrCreateEach', {themes: themes}, options, callback);\n  };\n\n  var updateOrCreateEachByHost = function(host, themes, callback) {\n    // $log.debug(\"[ThemeService.updateOrCreateEachByHost]\", host, themes);\n    var options = {\n      method: 'post',\n      resultIsArray: true\n    };\n    return JLSailsService.resolve('/Theme/updateOrCreateEachByHost', {host: host, themes: themes}, options, callback);\n  };\n\n  // TODO\n  var subscribe = function () {\n    if(!isSubscribed) {\n      $sailsSocket.subscribe('theme', function(msg){\n        if($rootScope.authenticated) {\n          $log.debug(msg);\n        }\n        switch(msg.verb) {\n          case 'updated':\n            if($rootScope.authenticated) {\n              $rootScope.pop('success', 'Themeeinstellungen wurdne aktualisiert', msg.data);\n            }\n          break;\n          case 'created':\n            if($rootScope.authenticated) {\n              $rootScope.pop('success', 'Themeeinstellungen wurden erstellt', msg.data);\n            }\n          break;\n          case 'removedFrom':\n            if($rootScope.authenticated) {\n              $rootScope.pop('success', 'Themeeinstellungen wurden entfernt', \"\");\n            }\n          break;\n          case 'destroyed':\n            if($rootScope.authenticated) {\n              $rootScope.pop('success', 'Themeeinstellungen wurden gelöscht', \"\");\n            }\n          break;\n          case 'addedTo':\n            if($rootScope.authenticated) {\n              $rootScope.pop('success', 'Themeeinstellungen wurden hinzugefügt', \"\");\n            }\n          break;\n        }\n      });\n      isSubscribed = true;\n    }\n  };\n\n  return {\n    find: find,\n    findByHost: findByHost,\n    save: save,\n    updateOrCreateEach: updateOrCreateEach,\n    updateOrCreateEachByHost: updateOrCreateEachByHost,\n    subscribe: subscribe\n  };\n});","angular.module('jumplink.cms.toolbar', [\n  'FBAngular'\n])\n.directive('jlToolbar', function ($compile, $window) {\n\n  return {\n    restrict: 'E',\n    templateUrl: '/views/modern/toolbar.jade',\n    scope: {\n      routes: \"=\",\n      title: \"=\",\n      shorttitle: \"=\",\n      fluid: \"=\",\n      position: \"=\",\n      filter: \"=\", \n    },\n    link: function ($scope, $element, $attrs) {\n\n    },\n    controller: function ($scope, $log, Fullscreen) {\n      $scope.fullscreenIsSupported = Fullscreen.isSupported();\n      $scope.isFullscreen = false;\n      $log.debug(\"[jumplink.cms.toolbar.jlToolbar.controller]\", $scope);\n      Fullscreen.$on('FBFullscreen.change', function(evt, isFullscreenEnabled){\n        $scope.isFullscreen = isFullscreenEnabled === true;\n        // $scope.$apply();\n      });\n\n      $scope.toggleFullscreen = function () {\n        if (Fullscreen.isEnabled()) {\n          Fullscreen.cancel();\n        } else {\n          Fullscreen.all();\n        }\n      };\n    }\n  };\n});","angular.module('jumplink.cms.user', [\n    'sails.io',\n    'jumplink.cms.sails',\n  ])\n\n  .service('UserService', function ($rootScope, $sailsSocket, $log, JLSailsService) {\n    var isSubscribed = false;\n\n    var save = function(user, callback) {\n      if(!angular.isString(user.role)) {\n        user.role = \"siteadmin\";\n      }\n      \n      // update user\n      if(angular.isDefined(user.id)) {\n        $log.debug(\"update user: sailsSocket.put('/user/\"+user.id+\"..'\");\n        $sailsSocket.put('/user/'+user.id, user).success(function(data, status, headers, config) {\n          $log.debug(data, status, headers, config);\n          if(angular.isDefined(data) && angular.isDefined(data.password)) {\n            delete data.password;\n          }\n          callback(null, data, status, headers, config);\n        });\n      } else {\n        // create user\n        $log.debug(\"create user: sailsSocket.post('/user..\");\n        $sailsSocket.post('/user', user).success(function(data, status, headers, config) {\n          // TODO FIXME data ist not the request result ?!\n          $log.debug(\"data\", data, \"status\", status, \"headers\", headers, \"config\", config);\n          if(angular.isDefined(data) && angular.isDefined(data.password)) {\n            delete data.password;\n          }\n          callback(null, data, status, headers, config);\n        });\n      }\n    };\n\n    var subscribe = function () {\n      if(!isSubscribed) {\n        $sailsSocket.subscribe('user', function(msg){\n          if($rootScope.authenticated) {\n            $log.debug(msg);\n          }\n          switch(msg.verb) {\n            case 'updated':\n              if($rootScope.authenticated) {\n                $rootScope.pop('success', 'Ein Benutzer wurde aktualisiert', msg.data.name);\n              }\n            break;\n            case 'created':\n              if($rootScope.authenticated) {\n                $rootScope.pop('success', 'Ein Benutzer wurde erstellt', msg.data.name);\n              }\n            break;\n            case 'removedFrom':\n              if($rootScope.authenticated) {\n                $rootScope.pop('success', 'Ein Benutzer wurde entfernt', \"\");\n              }\n            break;\n            case 'destroyed':\n              if($rootScope.authenticated) {\n                $rootScope.pop('success', 'Ein Benutzer wurde gelöscht', \"\");\n              }\n            break;\n            case 'addedTo':\n              if($rootScope.authenticated) {\n                $rootScope.pop('success', 'Ein Benutzer wurde hinzugefügt', \"\");\n              }\n            break;\n          }\n        });\n        isSubscribed = true;\n      }\n    };\n\n    var removeFromClient = function (users, user) {\n      var index = users.indexOf(user);\n      $log.debug(\"removeFromClient\", user, index);\n      if (index > -1) {\n        users.splice(index, 1);\n      }\n    };\n\n    var remove = function(users, user) {\n      $log.debug(\"$scope.remove\", user);\n      if($rootScope.authenticated) {\n        if(users.length <= 1) {\n          $log.error('Der letzte Benutzer kann nicht gelöscht werden.');\n        } else {\n          removeFromClient(users, user);\n          if(user.id) {\n            $sailsSocket.delete('/user/'+user.id, {id:user.id}).success(function(data, status, headers, config) {\n              $log.debug(\"user delete request\", data, status, headers, config);\n            });\n          }\n        }\n      }\n    };\n\n    /**\n     * find users for any host from database and isert priority from database (or from local.json if no priority is set).\n     * Only for superadmins!\n     */\n    var findByHost = function(host, callback) {\n      // $log.debug(\"[ThemeService.findByHost]\", host);\n      var options = {\n        method: 'post',\n        resultIsArray: true\n      };\n      return JLSailsService.resolve('/user/findbyhost', {host: host}, options, callback);\n    };\n\n    var updateOrCreateByHost = function(host, user, callback) {\n      $log.debug(\"[UserService.updateOrCreateByHost]\", host, routes);\n      var options = {\n        method: 'post',\n        resultIsArray: false\n      };\n      return JLSailsService.resolve('/user/updateOrCreateByHost', {host: host, user: user}, options, callback);\n    };\n\n    return {\n      save: save,\n      subscribe: subscribe,\n      remove: remove,\n      findByHost: findByHost,\n      updateOrCreateByHost: updateOrCreateByHost\n    };\n  })\n;","angular.module('jumplink.cms.utilities', [\n  ])\n  .service('UtilityService', function ($log) {\n    var invertOrder = function (array) {\n      var result = [];\n      for (var i = array.length - 1; i >= 0; i--) {\n        result.push(array[i]);\n      }\n      return result;\n    };\n\n    /**\n     * find value by key in array\n     */\n    var findKeyValue = function (objects, key, value) {\n      // $log.debug(\"findKeyValue\", key, value);\n      var index = -1;\n      for (var i = objects.length - 1; i >= 0 && index <= -1; i--) {\n        if(objects[i][key] === value) {\n          index = i;\n        } \n      }\n      return index;\n    };\n\n    /**\n     * Capitalize the first character of a string, but not change the case of any of the other letters.\n     *\n     * @see http://stackoverflow.com/questions/1026069/capitalize-the-first-letter-of-string-in-javascript\n     */\n    var capitalizeFirstLetter = function (string) {\n      return string.charAt(0).toUpperCase() + string.slice(1).toLowerCase();\n    };\n\n    var lowercaseFirstLetter = function (string) {\n      return string.charAt(0).toLowerCase() + string.slice(1);\n    };\n\n    return {\n      invertOrder: invertOrder,\n      findKeyValue: findKeyValue,\n      capitalizeFirstLetter: capitalizeFirstLetter,\n      lowercaseFirstLetter: lowercaseFirstLetter,\n    };\n  });"],"sourceRoot":"/source/"}
if(angular.module("jumplink.cms.admin",["sails.io"]).directive("adminbar",["$compile","$window","$sailsSocket","$state",function(e,n,t,r){return{restrict:"E",templateUrl:"/views/modern/adminbar.bootstrap.jade",scope:{upload:"=?",download:"=?",toogleHtml:"=?",refresh:"=?",save:"=?",add:"=?",addDropdown:"=?",addDropdownActions:"=?",adminSettingDropdown:"=?",authenticated:"=?",allowActions:"=?"},link:function(e,n,t){e.goToState=r.go,angular.isUndefined(e.adminSettingDropdown)&&(e.adminSettingDropdown=[{text:'<i class="fa fa-list"></i>&nbsp;Übersicht',click:"goToState('layout.administration')"},{text:'<i class="fa fa-users"></i>&nbsp;Benutzer',click:"goToState('layout.users')"},{text:'<i class="fa fa-sign-out"></i>&nbsp;Abmelden',click:"$root.logout()"}])}}}]),angular.module("ngAsync",[]).service("$async",function(){return async.objectMap=function(e,n,t){var r,o=[],i=Object.keys(e);for(r=0;r<i.length;r+=1){var a={};a[i[r]]=e[i[r]],o[r]=a}this.map(o,n,function(e,n){if(e)return t(e);var o={};for(r=0;r<n.length;r+=1)o[i[r]]=n[r];return t(e,o)})},async}),angular.module("jumplink.cms.attachment",["sails.io"]).service("AttachmentService",["moment","$sailsSocket","$async","$log","$window",function(e,n,t,r,o){var i=function(e,n){o.open(e,n)},a=function(e,n,t,r){return e[n].attachments.length>0&&e[n].attachments.splice(t,1),r(null,e,n,t)},u=function(e,t,o,i){n.put("/blog/destroyAttachment",{blogPostID:e[t].id,attachmentUploadedAs:e[t].attachments[o].uploadedAs}).success(function(e,n,t,o){r.debug(null,e,n,t,o),i()}).error(function(e,n,t,o){r.error(e,n,t,o),i("error",e,n,t,o)})},s=function(e,n,t,o){var i=e.indexOf(n);return r.debug("[BlogService.destroy]",e[i],t),u(e,i,t,function(n,r,u,s,l){return n?o(n,r,u,s,l):a(e,i,t,o)})};return{open:i,destroyLocally:a,destroyExternally:u,destroy:s}}]),angular.module("jumplink.cms.blog",["jumplink.cms.attachment","angularMoment","ngAsync","sails.io"]).service("BlogService",["moment","$sailsSocket","$async","$log","$filter","AttachmentService",function(e,n,t,r,o,i){var a=["news","other"],u=(i.destroyLocally,i.destroyExternally,i.destroy),s=function(e,n,t){return e.title?h(e,n,t):angular.isFunction(t)?t("Title not set",e):null},l=function(e,n){e.type=n},c=function(e,n,t){var r=e.indexOf(n);r>-1?(e.splice(r,1),angular.isFunction(t)&&t(null,e)):angular.isFunction(t)&&t("no blogPost on client site found to remove",e)},d=function(e,t,o){t.id?(r.debug("[jumplink.cms.blog.BlogService.destroy]",t),n["delete"]("/blog/"+t.id).success(function(n,r,i,a){c(e,t,o)})):c(e,t,o)},g=function(e){var n=!0;return o("orderBy")(e,"createdAt",n)},f=function(e){return e=g(e)},p=function(e,n,t){return e.push.apply(e,n),e=f(e),angular.isFunction(t)?t(null,e):e},m=function(e,n,t){return e.unshift(n),e=f(e),angular.isFunction(t)?t(null,e):e},v=function(n){return n&&n.createdAt||(n.createdAt=e()),n&&n.title||(n.title=""),n&&n.content||(n.content=""),n&&n.author||(n.author=""),n&&n.page||callback("Page not set."),n&&n.type||(n.type=a[0]),r.debug("[BlogService,create]",n),n},h=function(e,n,t){return angular.isUndefined(e.page)&&null!==n&&(e.page=n),e.name&&""!==e.name||(e.name=e.title.toLowerCase().replace(/[^a-z]+/g,"")),angular.isFunction(t)?t(null,e):e},b=function(e,n,t){for(var r=e.length-1;r>=0;r--)e[r]=h(e[r],n);return angular.isFunction(t)?t(null,e):e},S=function(e,n){return r.debug("[jumplink.cms.blog.BlogService.refresh]"),e=f(e),angular.isFunction(n)?n(null,e):e},y=function(e,t,o,i,a){var u=["BlogService: Can't save blogPost.","BlogService: Can't save blogPost, blogPost to update not found.","BlogService: Can't save blogPost, parameters undefind."];return r.debug("[BlogService.saveOne]",t),angular.isDefined(t)&&angular.isDefined(a)?(t=h(t,i),void(angular.isUndefined(t.id)?n.post("/blog",t).success(function(e,n,t,r){angular.isArray(e)&&(e=e[0]),a(null,e)}).error(function(e,n,t,o){return angular.isArray(e)&&(e=e[0]),r.error(e,n,t,o),a(u[0])}):n.put("/blog/"+t.id,t).success(function(e,n,t,r){return angular.isArray(e)&&(e=e[0]),a(null,e)}).error(function(e,n,t,o){return r.error(e,n,t,o),a(u[0])}))):a(u[2])},w=function(e,n,o){var i=["[BlogService.saveBlocks] Can't save blogPosts, parameters undefind."];if(angular.isDefined(e)&&angular.isDefined(o))t.map(e,function(t,r){y(e,t,null,n,r)},function(n,t){return n?o(n):(e=f(e),o(null,e))});else if(r.error(i[0]),angular.isFunction(o))return o(i[0])},$=function(e,n,t,r,o){angular.isDefined(n)?y(e,n,t,r,o):w(e,r,o)},k=function(e,t,o,i){return n.put("/blog/find",{page:e,limit:t,skip:o}).then(function(e){return e.data=f(e.data),angular.isFunction(i)?i(null,e.data):e.data},function(n){return r.error("Error on find "+e,n),angular.isFunction(i)?i(n):null})},F=function(e,t,o,i){return n.put("/blog/count",{page:e}).then(function(e){return angular.isFunction(i)?i(null,e.data.count):e.data.count},function(n){return r.error("Error on resolve "+e,n),angular.isFunction(i)?i(n):null})},B=function(){n.subscribe("blog",function(e){switch(r.debug(e),e.verb){case"updated":$rootScope.authenticated&&$rootScope.pop("success","Ein Blogpost wurde aktualisiert",e.data.title),findEvent(e.id,function(n,t,o,i){n?r.debug(n):t=e.data,$scope.refresh()});break;case"created":$rootScope.authenticated&&$rootScope.pop("success","Ein Blogpost wurde erstellt",e.data.title),$scope.blogPosts.push(e.data),$scope.refresh();break;case"removedFrom":$rootScope.authenticated&&$rootScope.pop("success","Ein Blogpost wurde entfernt",e.data.title),findEvent(e.id,function(e,n,t,o){e?r.debug(e):BlogService.removeFromClient($scope.blogPosts,n,t)});break;case"destroyed":$rootScope.authenticated&&$rootScope.pop("success","Ein Blogpost wurde gelöscht",e.data.title),findEvent(e.id,function(e,n,t,o){return e?(r.debug(e),e):void BlogService.removeFromClient($scope.blogPosts,n,t)});break;case"addedTo":$rootScope.authenticated&&$rootScope.pop("success","Ein Blogpost wurde hinzugefügt",e.data.title)}})};return{validate:s,subscribe:B,append:p,prepent:m,sort:g,transform:f,saveOne:y,saveBlocks:w,save:$,fixEach:b,find:k,resolve:k,count:F,refresh:S,chooseType:l,removeFromClient:c,remove:d,destroy:d,deleteAttachment:u,destroyAttachment:u,create:v}}]),angular.module("jumplink.cms.browser",[]).directive("jlBrowser",["$compile","$window",function(e,n){return{restrict:"E",templateUrl:"/views/modern/browser.bootstrap.jade",scope:{force:"="},link:function(e,n,t){}}}]),angular.module("jumplink.cms.config",["sails.io"]).service("ConfigService",["$sailsSocket","$filter","$log",function(e,n,t){var r=function(n){return e.get("/config/find").then(function(e){return e.data},function(e){t.error("Error on resolve "+n,e)})};return{resolve:r}}]),angular.module("jumplink.cms.content",["mgcrea.ngStrap","angular-medium-editor","ui.ace","sails.io","jumplink.cms.sortable","ngFocus","jumplink.cms.utilities"]).service("ContentService",["$rootScope","$log","$sailsSocket","$filter","$modal","$download","JLSailsService","SortableService","UtilityService","focus","$async",function(e,n,t,r,o,i,a,u,s,l,c){var d=!1,g=null,f=function(){return d},p=function(e){return g=o({title:"Inhaltsblock bearbeiten",templateUrl:"/views/modern/contentmodal.jade",show:!1}),g.$scope.ok=!1,g.$scope.accept=function(e){g.$scope.ok=!0,e()},g.$scope.abort=function(e){g.$scope.ok=!1,e()},g.$scope.changeName=!1,g.$scope.$watch("content.title",function(e,n){g.$scope.changeName&&angular.isDefined(g.$scope.content)&&(g.$scope.content.name=I(e))}),g.$scope.$on("modal.hide.before",function(e,n){return n.$scope.changeName=!1,n.$scope.ok?j(n.$scope.content,n.$scope.callback):angular.isFunction(n.$scope.callback)?n.$scope.callback("discarded",n.$scope.content):void 0}),m()},m=function(){return g},v=function(){t.subscribe("content",function(t){switch(n.debug("Content event!",t),t.verb){case"updated":e.authenticated&&e.pop("success","Seite wurde aktualisiert",t.id)}})},h=function(e,n){return d=!d,d&&e&&(e=S(e)),angular.isFunction(n)?n(null,d):d},b=function(e,n){return e.content=html_beautify(e.content),angular.isFunction(n)?n(null,e):e},S=function(e,n){for(var t=e.length-1;t>=0;t--)e[t].content=b(e[t].content);return angular.isFunction(n)?n(null,e):e},y=function(e,n){var t=s.findKeyValue(e,"name",n);return t>-1?e[t]:null},w=function(e){return e&&e.content||(e.content=""),e&&e.title||(e.title=""),e&&e.name||(e.name=""),e&&e.type||(e.type="dynamic"),e&&e.page||n.error("[ContentService] Page not set."),e},$=function(e,n,t){u.append(e,n,t,!0,"name")},k=function(e,n,t){var r=w({page:n});E(r,t,!0)},F=function(e,n,t,r){return u.swap(e,n,t,r)},B=function(e,n,t){return u.moveForward(e,n,t)},O=function(e,n,t){return u.moveBackward(e,n,t)},j=function(e,n){return e.title?x(e,n):angular.isFunction(n)?n("Title not set",e):null},E=function(e,t,r){n.debug("edit",e),g.$scope.content=e,g.$scope.callback=t,r?g.$scope.changeName=r:g.$scope.changeName=!1,l("contentedittitle"),g.$promise.then(g.show)},A=function(e,n,t,r){return u.remove(n,e,r)},C=function(e,r,o,i,a){var s=["Content konnte nicht gelöscht werden."];return("undefined"==typeof r||null===r)&&(r=e.indexOf(o)),e=u.remove(e,r,o),o.id?(n.debug("remove from server, too",o),void t["delete"]("/content/"+o.id+"?page="+i,{id:o.id,page:i}).success(function(n,t,r,o){return angular.isFunction(a)?a(null,e):e}).error(function(e,t,r,o){return n.error(s[0],e),angular.isFunction(a)?a(e):e})):angular.isFunction(a)?a(null,e):e},U=function(e,t){D(e,function(e,r){return e?(n.error(e),angular.isFunction(t)?t(e):e):void S(r,function(e,r){return e?(n.error(e),angular.isFunction(t)?t(e):e):angular.isFunction(t)?t(null,r):r})})},I=function(e){var t="";return e&&""!==e&&(t=e.toLowerCase().replace(/[^a-z1-9]+/g,""),n.debug("set content.name to",t)),t},x=function(e,t){return angular.isDefined(e)?((angular.isUndefined(e.name)||""===e.name||null===e.name)&&(e.name=I(e.title)),angular.isNumber(e.position)||(e.position=0),e.type&&""!==e.type||(n.warn("Fix content type not set, set it to dynamic"),e.type="fix"),angular.isFunction(t)?t(null,e):e):angular.isFunction(t)?t("content not set"):null},D=function(e,n){for(var t=e.length-1;t>=0;t--)e[t]=x(e[t]);return angular.isFunction(n)?n(null,e):e},N=function(e,r,o){var i=["Inhalt konnte nicht gespeichert werden"];e.page=r,x(e,function(e,r){return e?angular.isFunction(o)?o(e):e:void t.put("/content/replace",r).success(function(e,t,a,u){return null!==e&&"undefined"!=typeof e?(r=e,angular.isFunction(o)?o(null,r):r):(n.error(i[0]),angular.isFunction(o)?o(i[0]):i[0])}).error(function(e,t,r,a){return n.error(i[0],e),angular.isFunction(o)?o(e):e})})},M=function(e,o,i){var a=["Seite konnte nicht gespeichert werden"];D(e,function(e,u){return e?angular.isFunction(i)?i(e):e:t.put("/content/replaceall",{contents:u,page:o}).success(function(e,t,o,s){return null!==e&&"undefined"!=typeof e?(u=r("orderBy")(e,"position"),angular.isFunction(i)?i(null,u):u):(n.error(a[0]),angular.isFunction(i)?i(a[0]):a[0])}).error(function(e,t,r,o){n.error(a[0],e),angular.isFunction(i)&&i(e)})})},R=function(e,t,r,o,i){c.parallel(o,function(e,o){return e?(n.error("Error: On save content!",e),t("error","Seiteninhalt konnte nichtgespeichert werden",e),angular.isFunction(i)?i(e):e):(r.applyResults&&(r.scope=angular.extend(r.scope,o)),t("success","Seiteninhalt wurde gespeichert",""),angular.isFunction(i)?i(null,o):o)})},T=function(e,r,o,i,a){var u=["Error: On trying to find one with page: "+e+", name: "+r,"request has more than one results"],s={page:e,name:r},l="/content/find";return angular.isDefined(o)&&null!==o&&(s.type=o),t.put(l,s).then(function(e){return angular.isUndefined(e)||angular.isUndefined(e.data)?null:(e.data instanceof Array&&(e.data=e.data[0],n.error(u[1])),a&&(e.data=a(e.data)),angular.isFunction(i)?i(null,e.data):e.data)},function(e){return n.error(u[0],e),angular.isFunction(i)?i(u[0],e):e})},H=function(e,o,i,a){var u=["Error: On trying to find all with page: "+e+" and type: "+o,"Warn: On trying to find all "+e+" contents! Not found, content is empty!"],s={},l="/content/findall";return angular.isDefined(e)&&null!==e&&(s.page=e),angular.isDefined(o)&&null!==o&&(s.type=o),t.put(l,s).then(function(e){return angular.isUndefined(e)||angular.isUndefined(e.data)?(n.warn(u[1]),null):(e.data=r("orderBy")(e.data,"position"),a&&(e.data=a(e.data)),angular.isFunction(i)?void i(null,e.data):e.data)},function(e){return n.error(u[0],e),angular.isFunction(i)?i(u[0],e):e})},P=function(e,n){var t={method:"post",resultIsArray:!0};return a.resolve("/Content/findByHost",e,t,n)},L=function(e,t,r){var o={method:"post",resultIsArray:!0};return a.resolve("/Content/exportByHost",{host:e},o,function(e,o){return n.debug("[ContentService.exportByHost]",e,o),e?(t&&i(JSON.stringify(o),"error.txt","text/plain"),r(e)):(t&&i(JSON.stringify(o),"content.json","text/json"),r(e,o))})},z=function(e,t,r){n.debug("[contentsService.updateOrCreateByHostByTitleAndPage]",e,t);var o={method:"post",resultIsArray:!1};return a.resolve("/Content/updateOrCreateByHostByTitleAndPage",{host:e,content:t},o,r)},q=function(e,o,i,a){var u=["Error: On trying to find all with page: "+e+" and type: "+o,"Warn: On trying to find all "+e+" contents! Not found, content is empty!"],s={page:e},l="/content/findAllWithImage?page="+e;return o&&(s.type=o,l=l+"&type="+o),t.get(l,s).then(function(e){return angular.isUndefined(e)||angular.isUndefined(e.data)?(n.warn(u[1]),null):(e.data.contents=r("orderBy")(e.data.contents,"position"),e.data.images=r("orderBy")(e.data.images,"position"),a&&(e.data=a(e.data)),angular.isFunction(i)?i(null,e.data):e.data)},function(e){return n.error(u[0],e),angular.isFunction(i)?i(u[0],e):e})},J=function(e,n,t,r,o){return angular.isDefined(n)?T(e,n,t,o):H(e,t,r,o)};return{subscribe:v,setEditModal:p,getShowHtml:f,toogleShowHtml:h,beautify:b,beautifyEach:S,create:w,createEdit:k,append:$,swap:F,moveForward:B,moveBackward:O,edit:E,removeFromClient:A,remove:C,refresh:U,fix:x,fixEach:D,save:M,saveOne:N,saveParallel:R,find:J,resolve:J,findOne:T,resolveOne:T,findAll:H,resolveAll:H,findByHost:P,exportByHost:L,updateOrCreateByHostByTitleAndPage:z,findAllWithImage:q,resolveAllWithImage:q,getByName:y}}]),Date.now||(Date.now=function(){return(new Date).getTime()}),function(){"use strict";for(var e=["webkit","moz"],n=0;n<e.length&&!window.requestAnimationFrame;++n){var t=e[n];window.requestAnimationFrame=window[t+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t+"CancelAnimationFrame"]||window[t+"CancelRequestAnimationFrame"]}if(/iP(ad|hone|od).*OS 6/.test(window.navigator.userAgent)||!window.requestAnimationFrame||!window.cancelAnimationFrame){var r=0;window.requestAnimationFrame=function(e){var n=Date.now(),t=Math.max(r+16,n);return setTimeout(function(){e(r=t)},t-n)},window.cancelAnimationFrame=clearTimeout}}(),angular.module("ngDownload",[]).service("$download",["$log",function(e){return angular.isDefined(download)?download:(e.error("[ngDownload] download is not defined, please install it from https://github.com/rndme/download"),null)}]),angular.module("jumplink.cms.event",["mgcrea.ngStrap","angular-medium-editor","angularFileUpload","angularMoment","ngFocus","ngAsync","sails.io","jumplink.cms.utilities"]).service("EventService",["moment","UtilityService","$sailsSocket","$async","$log","focus","$modal","FileUploader",function(e,n,t,r,o,i,a,u){var s=null,l=null,c=null,d=function(e,n){return e.title?O(e,n):angular.isFunction(n)?n("Title not set",e):null},g=function(e,n,t){e.type=n,t()},f=function(e){l.$scope.event=e,l.$promise.then(l.show)},p=function(e,n,t){angular.isString(c)||(c=t),s=a({title:"Ereignis bearbeiten",templateUrl:"/views/modern/events/editmodal.jade",show:!1}),s.$scope.ok=!1,s.$scope.accept=function(e){s.$scope.ok=!0,e()},s.$scope.abort=function(e){s.$scope.ok=!1,e()},angular.isUndefined(n)&&(n={});var r={url:"timeline/upload",removeAfterUpload:!0,headers:{options:JSON.stringify(n)}};return s.$scope.uploader=new u(r),s.$scope.openTypeChooserModal=f,s.$scope.uploader.onCompleteItem=function(e,n,t,r){e.event.download=n.files[0].uploadedAs},s.$scope.uploader.onProgressItem=function(e,n){console.info("onProgressItem",e,n)},s.$scope.upload=function(e,n){e.event=n,e.upload()},l=a({title:"Typ wählen",templateUrl:"/views/modern/events/typechoosermodal.jade",show:!1}),l.$scope.chooseType=g,s.$scope.$on("modal.hide.before",function(e,n){return o.debug("edit closed",e,n),n.$scope.ok?d(n.$scope.event,n.$scope.callback):angular.isFunction(n.$scope.callback)?n.$scope.callback("discarded",n.$scope.event):void 0}),v()},m=function(){return l},v=function(){return{editModal:m(),typeModal:m()}},h=function(e,n,t){s.$scope.event=e,s.$scope.callback=t,s.$scope.ok=!1,i("eventtitle"),s.$promise.then(s.show)},b=function(n){for(var t=[],r=[],o=[],i=0;i<n.length;i++)angular.isDefined(n[i].to)&&(n[i].to=e(n[i].to)),angular.isDefined(n[i].from)?(n[i].from=e(n[i].from),n[i].from.isAfter()?o.push(n[i]):r.push(n[i])):t.push(n[i]);return{unknown:t,before:r,after:o}},S=function(e,n,t,r){var o=["no event on client site found to remove"],i=e[t].indexOf(n);return i>-1?(e[t].splice(i,1),angular.isFunction(r)?r(null,e):e):angular.isFunction(r)?r(o[0],e):o[0]},y=function(e,n,r,i){n.id?(o.debug(n),t["delete"]("/timeline/"+n.id).success(function(t,o,a,u){S(e,n,r,i)})):S(e,n,r,i)},w=function(e){return e=b(e),e.before=n.invertOrder(e.before),e},$=function(e,n,t){return angular.isUndefined(e)&&(e=[]),angular.isUndefined(n)&&(n=[]),angular.isUndefined(t)&&(t=[]),e.concat(n).concat(t)},k=function(e,n,t){e.unknown.push(n);var r=$(e.unknown,e.before,e.after);return e=w(r),angular.isFunction(t)?t(null,e):e},F=function(n){return n&&n.from||(n.from=e(),n.from.add(1,"hours"),n.from.minutes(0)),n&&n.title||(n.title=""),n&&n.person||(n.person=""),n&&n.place||(n.place=""),n&&n.page||callback("Page not set."),n},B=function(e,n,t){n=F(n),h(n,null,t)},O=function(e,n){return e.name&&""!==e.name||(e.name=e.title.toLowerCase().replace(/[^a-z]+/g,"")),angular.isFunction(n)?n(null,e):e},j=function(e,n){for(var t=e.length-1;t>=0;t--)e[t]=O(e[t]);return angular.isFunction(n)?n(null,e):e},E=function(e){var n=$(e.unknown,e.before,e.after);return e=w(n)},A=function(e,n,r,i){var a=["EventService: Can't save event.","EventService: Can't save event, event to update not found.","EventService: Can't save event, parameters undefind."];angular.isDefined(r)&&angular.isDefined(n)&&angular.isDefined(i)?(r=O(r),angular.isUndefined(r.id)?t.post("/timeline",r).success(function(t,o,u,s){angular.isArray(t)&&(t=t[0]);var l=e[n].indexOf(r);l>-1?(e[n][l]=t,i(null,e[n][l])):i(a[1])}).error(function(e,n,t,r){angular.isArray(e)&&(e=e[0]),o.error(e,n,t,r),i(a[0])}):t.put("/timeline/"+r.id,r).success(function(e,n,t,o){angular.isArray(e)&&(e=e[0]),r=e,i(null,r)}).error(function(e,n,t,r){o.error(e,n,t,r),i(a[0])})):i(a[2])},C=function(e,n,t){r.map(e[n],function(t,r){A(e,n,t,r)},t)},U=function(e,n){var t=["EventService: Can't save eventBlocks, parameters undefind."];return angular.isDefined(e)&&angular.isDefined(n)?r.map(["after","before","unknown"],function(n,t){C(e,n,t)},function(t,r){if(t&&(o.error(t),angular.isFunction(n)))return n(t);var i=$(r[0],r[1],r[2]);return e=w(i),n(null,e)}):(o.error(t[0]),angular.isFunction(n)?n(t[0]):void 0)},I=function(e){return t.get("/timeline").then(function(e){return w(e.data)},function(n){o.error("Error on resolve "+e,n)})},x=function(){t.subscribe("timeline",function(e){switch(o.debug(e),e.verb){case"updated":$rootScope.authenticated&&$rootScope.pop("success","Ein Ereignis wurde aktualisiert",e.data.title),findEvent(e.id,function(n,t,r,i){return n?(o.debug(n),n):(t=e.data,void $scope.refresh())});break;case"created":$rootScope.authenticated&&$rootScope.pop("success","Ein Ereignis wurde erstellt",e.data.title),$scope.events.before.push(e.data),$scope.refresh();break;case"removedFrom":$rootScope.authenticated&&$rootScope.pop("success","Ein Ereignis wurde entfernt",e.data.title),findEvent(e.id,function(e,n,t,r){return e?(o.debug(e),e):void EventService.removeFromClient($scope.events,n,t)});break;case"destroyed":$rootScope.authenticated&&$rootScope.pop("success","Ein Ereignis wurde gelöscht",e.data.title),findEvent(e.id,function(e,n,t,r){return e?(o.debug(e),e):void EventService.removeFromClient($scope.events,n,t)});break;case"addedTo":$rootScope.authenticated&&$rootScope.pop("success","Ein Ereignis wurde hinzugefügt",e.data.title)}})};return{subscribe:x,split:b,merge:$,append:k,transform:w,saveOne:A,saveAllInBlock:C,saveBlocks:U,edit:h,createEdit:B,fixEach:j,resolve:I,setModals:p,refresh:E,openTypeChooserModal:f,chooseType:g,removeFromClient:S,remove:y}}]),angular.module("jumplink.cms.fallback",[]).service("FallbackService",["$window","$location","$log",function(e,n,t){var r=function(e){var r=n.protocol(),o=n.host();angular.isString(e)?"/"!==e.charAt(0)&&(e="/"+e):e="/fallback";var i=r+"://"+o+e+"?force=fallback";t.debug("Go to fallback url: "+i)};return{go:r}}]),angular.module("ngFocus",[]).factory("focus",["$timeout","$window",function(e,n){return function(t){e(function(){var e=n.document.getElementById(t);e&&e.focus()})}}]).directive("eventFocus",["focus",function(e){return function(n,t,r){t.on(r.eventFocus,function(){e(r.eventFocusId)}),n.$on("$destroy",function(){t.off(r.eventFocus)})}}]),angular.module("jumplink.cms.gallery",["mgcrea.ngStrap","ngAsync","angular-medium-editor","FBAngular","sails.io","angularFileUpload","jumplink.cms.sortable","jumplink.cms.content"]).service("GalleryService",["$rootScope","$sailsSocket","$async","$filter","Fullscreen","SortableService","ContentService","FileUploader","$modal","$log",function(e,n,t,r,o,i,a,u,s,l){var c=null;uploadModal=null,fullscreenImage=null;var d=[{text:'<i class="fa fa-eye"></i>&nbsp;Anzeigen',click:"goToImage(image)"},{text:'<i class="fa fa-edit"></i>&nbsp;Bearbeiten',click:"editImage(image)"},{text:'<i class="fa fa-trash"></i>&nbsp;Löschen',click:"$dropdown.hide();$dropdown.destroy();removeImage(image);"},{text:'<i class="fa fa-floppy-o"></i>&nbsp;Speichern',click:"saveImage(image)"}],g=function(){return d},f=function(e){return c=s({scope:e,title:"Bild bearbeiten",templateUrl:"/views/modern/gallery/editmodal.jade",show:!1}),p()},p=function(){return c},m=function(n,t,r){return n.$scope.imageBlocks=t,n.$scope.selects=h(t,r),n.$scope.selects.length>0&&(e.selectedContentBlock=n.$scope.selects[0].value),e.$watch("selectedContentBlock",function(e,n){l.debug("selected changed to",e)}),n},v=function(n,t,r,o,i,a){angular.isUndefined(o)&&(o={thumbnail:{width:300},rescrop:{width:1200,cropwidth:1200,cropheight:1200}});var c={url:"gallery/upload",removeAfterUpload:!0,headers:{options:JSON.stringify(o)}};return n.uploader=new u(c),n.uploader.filters.push({name:"imageFilter",fn:function(e,n){var t="|"+e.type.slice(e.type.lastIndexOf("/")+1)+"|";return-1!=="|jpg|png|jpeg|bmp|gif|".indexOf(t)}}),angular.isFunction(a)&&(n.uploader.onComplete=a),n.uploader.onCompleteItem=function(n,t,r,o){l.debug("[GalleryService.uploader.onCompleteItem]",n,t,r,o),t.files.forEach(function(n,t,r){var o=e.selectedContentBlock,i=uploadModal.$scope.imageBlocks,a=i[o];l.debug("[GalleryService.$scope.uploader.onCompleteItem] selected",o,"imageBlocks",i,"currentImages",a);var u=0;a.length>0&&(u=a[a.length-1].position),e.authenticated&&e.pop("success","Ein Bild wurde hochgeladen",n.original.name),"undefined"==typeof n.position&&(u++,n.position=u,n.content=o),l.debug("[GalleryService.$scope.uploader.onCompleteItem] file",n),a.push(n)})},n.upload=function(e,n){e.image=n,e.upload()},uploadModal=s({scope:n,title:"Bilder hinzufügen",uploader:n.uploader,templateUrl:"/views/modern/gallery/uploadimagesmodal.jade",show:!1}),uploadModal=m(uploadModal,t,r),angular.isFunction(i)?i(b()):b()},h=function(e,n){var t=Object.keys(e),r=[];return t.forEach(function(e,t,o){var i=a.getByName(n,e).title||e;r.push({label:i,value:e})}),r},b=function(){return uploadModal},S=function(e,n,t,r){return e.page&&""!==e.page||(e.page=n),e.content&&""!==e.content||(e.content=t),angular.isFunction(r)?r(null,e):e},y=function(e,t,r,o){e=S(e,t,r);var i=["Bild konnte nicht gespeichert werden"];n.put("/gallery/"+e.id,e).success(function(e,n,t,r){angular.isArray(e)&&(e=e[0]),angular.isFunction(o)&&o(null,e)}).error(function(e,n,t,r){l.error(i[0],e),angular.isFunction(o)&&o(i[0],e)})},w=function(e,n,r){var o=Object.keys(e);t.map(o,function(t,r){$(e[t],n,t,r)},r)},$=function(e,n,r,o){t.map(e,function(e,t){y(e,n,r,t)},o)},k=function(e,t,r,o,a){("undefined"==typeof t||null===t)&&(t=e.indexOf(r)),e=i.remove(e,t,r),r.id?n["delete"]("/gallery/"+r.id+"?filename="+r.original.name+"&page="+o,{id:r.id,filename:r.original.name,page:o}).success(function(n,t,r,o){angular.isFunction(a)&&a(null,e)}).error(function(e,n,t,r){l.error(errors[0],e),angular.isFunction(a)&&a(e)}):angular.isFunction(a)&&a(null,e)},F=function(e,n,t){uploadModal.$promise.then(uploadModal.show),uploadModal=m(uploadModal,e,n),uploadModal.$scope.$on("modal.hide",function(){l.debug("upload modal closed"),angular.isFunction(t)&&t(null)})},B=function(e,n,t){return e[n.name]=[],angular.isFunction(t)?t(null,e[n.name]):e[n.name]},O=function(e,n){l.debug("edit",e),c.$scope.image=e,c.$promise.then(c.show),c.$scope.$on("modal.hide",function(){l.debug("edit closed"),angular.isFunction(n)&&n(null,c.$scope.image)})},j=function(n,t){var r,o,i,a,u=0,s=0;return $scope.isFullScreen(n)?(i=n.original.width/n.original.height,a=e.getWindowDimensions(),a.width/a.height<i?(t=a.width,o=n.original.width/t,r=n.original.height/o,u=(a.height-r)/2,r=a.height):(r=a.height,o=n.original.height/r,t=n.original.width/o,s=(a.width-t)/2,t=a.width),{width:t+"px",height:r+"px","padding-right":s+"px","padding-left":s+"px","padding-top":u+"px","padding-bottom":u+"px"}):(o=n.original.width/t,r=n.original.height/o,{width:t+"px",height:r+"px"})},E=function(){n.subscribe("gallery",function(n){switch(l.debug(n),n.verb){case"updated":e.authenticated&&l.debug("success","Ein Bild wurde aktualisiert",n.data.original.name);break;case"created":e.authenticated&&e.pop("success","Ein Bild wurde hochgeladen",n.data.original.name),$scope.images.push(n.data);break;case"removedFrom":e.authenticated&&e.pop("success","Ein Bild wurde entfernt",""),l.debug(n.data);break;case"destroyed":l.debug(n.data);break;case"addedTo":e.authenticated&&e.pop("success","Ein Bild wurde hinzugefügt",""),l.debug(n.data)}})},A=function(e,t){var o="/gallery?limit=0&page="+e;return t&&(o=o+"&content="+t),n.get(o).then(function(e){return r("orderBy")(e.data,"position")},function(e){l.error(e)})};return{getDropdown:g,setEditModal:f,getEditModal:p,setUploadModal:v,getUploadModal:b,saveOne:y,saveAll:$,saveAllBlocks:w,remove:k,add:F,addBlock:B,edit:O,aspect:j,subscribe:E,resolve:A}}]),"undefined"==typeof jumplink)var jumplink={};angular.module("jumplink.cms.history",["ui.router"]).service("HistoryService",["$window","$location","$state","$anchorScroll","$timeout","$log",function(e,n,t,r,o,i){var a=[],u=function(e,n){a.push({state:e,params:n})},s=function(){return a},l=function(e){if(i.debug("[jumplink.cms.history.HistoryService], history.length",a.length,"step",e,"history.length + step =",a.length+e),a.length+e<=0)return n.path("/");var r=this.previous(e||-1);return t.go(r.state,r.params)},c=function(e){return a[a.length-Math.abs(e||1)]},d=function(){return this.go(-1)},g=function(e){n.hash(e),r.yOffset=60,r()},f=function(){var e=n.hash();e?o(function(){g(e)},1e3):r()};return{push:u,all:s,go:l,previous:c,back:d,goToHashPosition:g,autoScroll:f}}]).run(["HistoryService","$state","$rootScope",function(e,n,t){t.$on("$stateChangeSuccess",function(n,t,r,o,i){o["abstract"]||e.push(o,i)}),console.log(e),e.push(n.current,n.params)}]),angular.module("jumplink.cms.importexport",["jumplink.cms.attachment","ngAsync","sails.io"]).service("ImportExportService",["$sailsSocket","$async","$log","$filter",function(e,n,t,r){return{}}]),angular.module("jumplink.cms.info",["sails.io"]).service("CmsService",["$log","$sailsSocket",function(e,n){var t=function(t,r){var o=["[CmsService] Error: On trying to get cms info, url: "+t,"[CmsService] Error: Result is null, url: "+t],i=["[CmsService] Warn: Request has more than one results, url: "+t];return n.get(t).then(function(n){return angular.isUndefined(n)||angular.isUndefined(n.data)?angular.isFunction(r)?r(o[1]):null:(n.data instanceof Array&&(n.data=n.data[0],e.warn(i[0])),angular.isFunction(r)?r(null,n.data):n.data)},function(n){return e.error(o[0],n),angular.isFunction(r)?r(o[0],n):n})},r=function(e){return t("/cms/infouser",e)},o=function(e){return t("/cms/infoadmin",e)},i=function(t){return n.post("/cms/restart").then(function(n){return e.debug("[CmsService.restart]",n),t(null,n)},function(n){return e.error("[CmsService.restart]",n),t(n)})};return{infoUser:r,infoAdmin:o,restart:i}}]),angular.module("jumplink.cms.multisite",["sails.io","jumplink.cms.sails"]).service("MultisiteService",["$rootScope","JLSailsService","$log",function(e,n,t){var r=function(e,t){var r={method:"get",resultIsArray:!0};return n.resolve("/multisite/find",e,r,t)},o=function(e,t){var r={method:"get",resultIsArray:!0};return n.resolve("/multisite/findnames",e,r,t)},i=function(e,t){var r={method:"get",resultIsArray:!0};return n.resolve("/multisite/findhosts",e,r,t)};return{resolve:r,resolveNames:o,resolveHosts:i}}]),angular.module("jumplink.cms.routes",["ui.router","jumplink.cms.sails","jumplink.cms.sortable","jumplink.cms.utilities","ngDownload"]).provider("jlRoutes",["$stateProvider","$urlRouterProvider","$locationProvider",function jlRoutesProvider($stateProvider,$urlRouterProvider,$locationProvider){this.html5Mode=$locationProvider.html5Mode,this.otherwise=$urlRouterProvider.otherwise,this.state=$stateProvider.state,this.when=function(e,n){$urlRouterProvider.when(e,n)},this.setLayouts=function(e){for(var n in e)this.state(n,e[n])},this.setRoutes=function(routes,routeOptions){for(var i=0;i<routes.length;i++)if(routes[i].main){var options={};if("string"==typeof routes[i].url&&routes[i].url.length>0&&(options.url=routes[i].url),routes[i].customstate===!0?(angular.isDefined(routes[i].state.resolve)&&"string"==typeof routes[i].state.resolve&&routes[i].state.resolve.length>0&&(eval(routes[i].state.resolve),options.resolve=resolve),angular.isDefined(routes[i].state.views)&&"string"==typeof routes[i].state.views&&routes[i].state.views.length>0&&(eval(routes[i].state.views),options.views=view)):angular.isDefined(routes[i].objectName)&&angular.isDefined(routeOptions[routes[i].objectName])?(angular.isObject(routeOptions[routes[i].objectName].resolve)&&(options.resolve=routeOptions[routes[i].objectName].resolve),angular.isObject(routeOptions[routes[i].objectName].views)&&(options.views=routeOptions[routes[i].objectName].views)):console.error("objectName "+routes[i].objectName+" not found for route "+routes[i]),angular.isDefined(options.url)&&angular.isDefined(options.views)&&$stateProvider.state(routes[i].state.name,options),angular.isArray(routes[i].alternativeUrls))for(var a=0;a<routes[i].alternativeUrls.length;a++)console.log("New redirect: "+routes[i].alternativeUrls[a]+" -> "+routes[i].url),$urlRouterProvider.when(routes[i].alternativeUrls[a],routes[i].url)}},this.$get=function(){return new jlRoutes}}]).filter("showOnlyMainRoutes",function(){return function(e,n){if(n!==!0)return e;for(var t=[],r=0;r<e.length;r++)e[r].main===!0&&t.push(e[r]);return t}}).service("RoutesService",["$rootScope","$download","JLSailsService","$log","SortableService","UtilityService",function(e,n,t,r,o,i){var a=function(e){return r.debug("[RoutesService.create] data",e),angular.isObject(e)||(e={}),angular.isString(e.match)||(e.match=""),angular.isString(e.title)||(e.title=""),e.main!==!0&&e.main!==!1&&(e.main=!1),angular.isString(e.url)||(e.url=""),angular.isArray(e.alternativeUrls)||(e.alternativeUrls=[]),(angular.isUndefined(e.state)||!angular.isObject(e.state))&&(e.state={}),angular.isString(e.state.name)||(e.state.name=""),e.state.customstate!==!0&&e.state.customstate!==!1&&(e.state.customstate=!1),angular.isString(e.state.url)||(e.state.url=""),angular.isString(e.state.views)||(e.state.views=""),angular.isString(e.state.resolve)||(e.state.resolve=""),
angular.isObject(e.fallback)||(e.fallback={}),angular.isString(e.fallback.url)||(e.fallback.url=""),e},u=function(e,n,t){r.debug("[RoutesService] data before",n),n=a(n),r.debug("[RoutesService] data after",n),o.append(e,n,t)},s=function(e,n,t,r){return o.swap(contents,n,t,r)},l=function(e,n,t){return o.moveForward(e,n,t)},c=function(e,n,t){return o.moveBackward(e,n,t)},d=function(e,n,t,r){return angular.isFunction(r)?o.remove(e,n,t,r):o.remove(e,n,t)},g=function(e,n,o,i){if((angular.isUndefined(o)||null===o)&&angular.isDefined(n)&&(o=e[n]),(angular.isUndefined(n)||null===n)&&(n=e.indexOf(o)),e=d(e,n,o),o.id){r.debug("[RoutesService.remove] remove from server, too",o);var a={method:"delete",resultIsArray:!1};return t.resolve("/routes/destroy/"+o.id,{id:o.id},a,i)}},f=function(e,n){var r={method:"post",resultIsArray:!0};return t.resolve("/routes/find",e,r,n)},p=function(e,n){var r={method:"post",resultIsArray:!1};return t.resolve("/routes/findOne",e,r,n)},m=function(e,n){var r={method:"post",resultIsArray:!0};return t.resolve("/Routes/findByHost",e,r,n)},v=function(e,o,i){var a={method:"post",resultIsArray:!0};return t.resolve("/Routes/exportByHost",{host:e},a,function(e,t){return r.debug("[RoutesService.exportByHost]",e,t),e?(o&&n(JSON.stringify(t),"error.txt","text/plain"),i(e)):(o&&n(JSON.stringify(t),"routes.json","text/json"),i(e,t))})},h=function(e,n){r.debug("[RoutesService.updateOrCreate]",e);var o={method:"post",resultIsArray:!1};return t.resolve("/Routes/updateOrCreate",{route:e},o,n)},b=function(e,n,o){r.debug("[RoutesService.updateOrCreateByHostByObjectNameAndNavbar]",e,n);var i={method:"post",resultIsArray:!1};return t.resolve("/Routes/updateOrCreateByHostByObjectNameAndNavbar",{host:e,route:n},i,o)},S=function(e,n,o){r.debug("[RoutesService.updateOrCreateByHost]",e,n);var i={method:"post",resultIsArray:!1};return t.resolve("/Routes/updateOrCreateByHost",{host:e,route:n},i,o)},y=function(e,n){r.debug("[RoutesService.updateOrCreateEach]",e);var o={method:"post",resultIsArray:!0};return t.resolve("/Routes/updateOrCreateEach",{routes:e},o,n)},w=function(e,n,o){r.debug("[RoutesService.updateOrCreateEachByHost]",e,n);var i={method:"post",resultIsArray:!0};return t.resolve("/Routes/updateOrCreateEachByHost",{host:e,routes:n},i,o)},$=function(e){r.debug("[RoutesController.generateObjectnameFromStatename]",e);for(var n="",t=e.split("."),o=0;o<t.length;o++)n+=i.capitalizeFirstLetter(t[o]);return n=i.lowercaseFirstLetter(n)},k=function(e){for(var n="",t=e.split("/"),o=0;o<t.length;o++)n+=i.capitalizeFirstLetter(t[o]);return n=i.lowercaseFirstLetter(n),r.debug("[RoutesController.generateObjectnameFromUrl]",e,t,n,n.length),n};return{create:a,append:u,swap:s,moveForward:l,moveBackward:c,removeFromClient:d,remove:g,destroy:g,find:f,findOne:p,findByHost:m,exportByHost:v,updateOrCreate:h,updateOrCreateByHostByObjectNameAndNavbar:b,updateOrCreateByHost:S,updateOrCreateEach:y,updateOrCreateEachByHost:w,saveEachByHost:w,generateObjectnameFromStatename:$,generateObjectnameFromUrl:k}}]),angular.module("jumplink.cms.sails",["sails.io"]).service("JLSailsService",["$rootScope","$sailsSocket","$q","$log",function(e,n,t,r){var o=function(e,o,i,a,u){var s=t.defer(),l=["On trying to resolve "+e,"Request has more than one results","No result"];return angular.isUndefined(i)&&(i={}),angular.isUndefined(i.method)&&(i.method="get"),angular.isUndefined(i.resultIsArray)&&(i.resultIsArray=!1),angular.isUndefined(o)&&(o={}),n[i.method](e,o).then(function(e){return angular.isUndefined(e)||angular.isUndefined(e.data)?angular.isFunction(a)?a(null,null):s.resolve(null):(!i.resultIsArray&&angular.isArray(e.data)&&(e.data=e.data[0],r.warn(l[1])),u&&(e.data=u(e.data)),angular.isFunction(a)&&a(null,e.data),s.resolve(e.data))},function(e){return r.error(l[0],e),angular.isFunction(a)?a(l[0],e):s.reject(l[0])}),s.promise};return{resolve:o}}]),angular.module("jumplink.cms.session",["sails.io","jumplink.cms.sails"]).service("SessionService",["$rootScope","JLSailsService","$sailsSocket","$q","$log",function(e,n,t,r,o){var i=function(e,t){o.debug("[SessionService.create]",e);var r={method:"post",resultIsArray:!1};return n.resolve("/session/create",e,r,t)},a=function(e,t){o.debug("[SessionService.destroy]",e);var r={method:"post",resultIsArray:!1};return n.resolve("/session/destroy",e,r,t)},u=function(e){o.log("[SessionService.isauthenticated]");r.defer();return t.get("/session/authenticated").then(function(n){return angular.isFunction(e)?e(null,n.data):n.data})},s=function(){o.log("[SessionService.needToBeAuthenticated] authenticated");var e=r.defer();return t.get("/session/authenticated").then(function(n){return n.data?(o.log("is authenticated",n),e.resolve(n.data)):(o.log("is not authenticated",n),e.reject("You need to be logged in"))}),e.promise},l=function(e){o.log("[SessionService.bloggerOrBetter]");r.defer();return t.get("/session/bloggerOrBetter").then(function(n){return angular.isFunction(e)?e(null,n.data):n.data})},c=function(e){o.log("[SessionService.developerOrBetter]");r.defer();return t.get("/session/developerOrBetter").then(function(n){return angular.isFunction(e)?e(null,n.data):n.data})},d=function(e){o.log("[SessionService.siteadminOrBetter]");r.defer();return t.get("/session/siteadminOrBetter").then(function(n){return angular.isFunction(e)?e(null,n.data):n.data})},g=function(e){o.log("[SessionService.superadmin]");r.defer();return t.get("/session/superadmin").then(function(n){return angular.isFunction(e)?e(null,n.data):n.data})},f=function(e){o.log("[SessionService.employee]");r.defer();return t.get("/session/employee").then(function(n){return angular.isFunction(e)?e(null,n.data):n.data})},p=function(e){o.log("[SessionService.employee]");r.defer();return t.get("/session/employeeOrBetter").then(function(n){return angular.isFunction(e)?e(null,n.data):n.data})},m=function(e){o.log("[SessionService.authenticated] authenticated");var n=r.defer();return t.get("/session/employeeOrBetter").then(function(e){return e.data?(o.log("is employeeOrBetter",e),n.resolve(e.data)):(o.log("is not employeeOrBetter",e),n.reject("You must be an employee or a user with more credentials to do that"))}),n.promise},v=function(e){o.log("[SessionService.authenticated] authenticated");var n=r.defer();return t.get("/session/siteadminOrBetter").then(function(e){return e.data?(o.log("is siteadminOrBetter",e),n.resolve(e.data)):(o.log("is not employeeOrBetter",e),n.reject("You must be an admin or a user with more credentials to do that"))}),n.promise},h=function(e){o.log("[SessionService.getAllPolicies]");r.defer();return t.get("/session/getAllPolicies").then(function(n){return angular.isFunction(e)?e(null,n.data):n.data})},b=function(e){o.log("[SessionService.getUser]");r.defer();return t.get("/session/getUser").then(function(n){return angular.isFunction(e)?e(null,n.data):n.data})};return{create:i,destroy:a,authenticated:s,needToBeAuthenticated:s,isAuthenticated:u,bloggerOrBetter:l,developerOrBetter:c,siteadminOrBetter:d,superadmin:g,employee:f,employeeOrBetter:p,needToBeEmployeeOrBetter:m,needToBeSiteadminOrBetter:v,getAllPolicies:h,getUser:b}}]),angular.module("jumplink.cms.sidebar",["mgcrea.ngStrap.aside"]).directive("jlSidebar",["$compile","$window",function(e,n){return{restrict:"E",replace:!0,transclude:!0,templateUrl:"/views/modern/sidebar.jade",scope:{routes:"=",title:"="},link:function(e,n,t){}}}]),angular.module("jumplink.cms.signin",["jumplink.cms.session","jumplink.cms.history","ngAsync"]).service("SigninService",["SessionService","$log","HistoryService","$async",function(e,n,t,r){var o=function(r,o,i,a,u){angular.isFunction(o)&&!angular.isFunction(u)&&(u=o,o=!1),angular.isFunction(i)&&!angular.isFunction(u)&&(u=i,i=!1),angular.isFunction(a)&&!angular.isFunction(u)&&(u=a,a=null),n.debug("[SigninService.signin]",r),e.create(r,function(s,l){return s?u(s):l.authenticated?(i===!0&&e.getAllPolicies(function(e,r){return e?u(e):(n.debug("scope before extend",a),angular.extend(a,r),n.debug("scope after extend",a),void(o===!0&&t.back()))}),o===!0&&t.back(),n.debug("[SigninService.signin]",r),n.debug("[SigninService.signin] err result",s,l),u(null,l)):null})};return{signin:o}}]),angular.module("jumplink.cms.sortable",["jumplink.cms.utilities"]).service("SortableService",["UtilityService","$log","$filter",function(e,n,t){var r=function(e){for(var n=e.length-1;n>=0;n--)e[n].position=n+1;return e},o=function(e){return t("orderBy")(e,"position")},i=function(e,n,t,r){var o=e[n],i=e[t],a=o.position;return o.position=i.position,i.position=a,e[n]=i,e[t]=o,angular.isFunction(r)?r(null,e):e},a=function(e,t,o,i){if(n.debug("[SortableService] move"),o>=e.length)for(var a=o-e.length;a--+1;)e.push(void 0);return e.splice(o,0,e.splice(t,1)[0]),e=r(e),angular.isFunction(i)&&i(null,e),e},u=function(t,r,o,i,a){n.debug("[SortableService.append] data",r);var u,s=["Unique key '"+a+"' already exist"],l=t.length,c=1,d=-1,g=function(e,n,t,r){return n.push(e),angular.isFunction(r)?r(null,n,t):n},f=function(e,n,t,r){return angular.isFunction(r)?r(e,n,t):e};return l>=1&&(c=t[l-1].position+1),u={position:c},u=angular.extend(u,r),n.debug("[SortableService.append] new_object",u),i&&u[a]?(d=e.findKeyValue(t,a,u[a]),d>-1?f(s[0],t,d,o):g(u,t,l,o)):g(u,t,l,o)},s=function(e,t,r,o,i,a){var s=["[SortableService] Error: Function parameters not correctly set"],l=function(){return n.error(s[0],e,t,r,o),i(s[0])};null===e?e=r[t]:null===t?t=r.indexOf(e):l(),angular.isArray(r)&&angular.isArray(o)||l(),u(o,e,function(n,o,a){return n?i(n):void d(r,t,e,function(e,n){return e?i(e):i(null,{index_from:t,array_from:n,index_to:a,array_to:o})})},!1)},l=function(e,n,t){return e+1<n.length?i(n,e,e+1,t):angular.isFunction(t)?t("Can't move forward, index is the last element.",n):n},c=function(e,n,t){return e-1>=0?i(n,e,e-1,t):angular.isFunction(t)?t("Can't move backward, index is the first element.",n):n},d=function(e,n,t,r){return("undefined"==typeof n||null===n)&&(n=e.indexOf(t)),n>-1&&e.splice(n,1),angular.isFunction(r)?r(null,e):e},g=function(e,t,r,o,i,u){u||(u=a);var s=e.indexOf(r),l=e[t];return n.debug("[SortableService] dropMove, dragObject:",r,"dragObjectIndex",s,"dropObject",l,"dropObjectIndex",t),u(e,s,t,i)};return{resetPosition:r,sort:o,swap:i,moveObjectToAnotherArray:s,move:a,moveForward:l,moveBackward:c,remove:d,append:u,dropMove:g}}]),angular.module("jumplink.cms.subnavigation",["mgcrea.ngStrap","sails.io","jumplink.cms.sortable","ngFocus","jumplink.cms.utilities"]).service("SubnavigationService",["$rootScope","$window","$log","$sailsSocket","$filter","$modal","SortableService","UtilityService","focus",function(e,n,t,r,o,i,a,u,s){var l=null,c=function(e){return l=i({scope:e,title:"Navigation bearbeiten",templateUrl:"/views/modern/editsubnavigationmodal.jade",show:!1}),d()},d=function(){return l},g=function(){r.subscribe("navigation",function(n){switch(t.debug("[SubnavigationService] Navigation event!",n),n.verb){case"updated":e.authenticated&&e.pop("success","Navigation wurde aktualisiert",n.id)}})},f=function(){angular.element(n).imagesLoaded(function(){angular.element(n).triggerHandler("resize")})},p=function(e){return e&&e.target||(e.target=""),e&&e.name||(e.name=""),e&&e.page||cb("Page not set."),e},m=function(e,n,t){n=p(n),a.append(e,n,t)},v=function(e,n,t,r){return a.swap(contents,n,t,r)},h=function(e,n,t){return a.moveForward(e,n,t)},b=function(e,n,t){return a.moveBackward(e,n,t)},S=function(e,n){if(l.$scope.navs=e,l.$promise.then(l.show),angular.isDefined(l.$scope.navs)&&l.$scope.navs.length>0){var t=Number(l.$scope.navs.length-1);s("subnavigationeditname"+t)}l.$scope.$on("modal.hide",function(){n(null,l.$scope.navs)})},y=function(e,n,t,r){return angular.isFunction(r)?a.remove(e,n,t,r):a.remove(e,n,t)},w=function(e,n,o,i,a){(angular.isUndefined(o)||null===o)&&angular.isDefined(n)&&(o=e[n]),(angular.isUndefined(n)||null===n)&&(n=e.indexOf(o)),e=y(e,n,o),o.id&&(t.debug("[SubnavigationService] remove from server, too",o),r["delete"]("/navigation/"+o.id+"?page="+i,{id:o.id,page:i}).success(function(n,t,r,o){return angular.isFunction(a)?a(null,e):void 0}).error(function(e,n,r,o){return t.error(errors[0],e),angular.isFunction(a)?a(e):void 0}))},$=function(e,n,r,o){t.debug("[SubnavigationService] remove subnavigation by target "+n);var i=u.findKeyValue(e,"target",n);i>-1?(t.debug("[SubnavigationService] subnavigation found "+i),w(e,i,null,r,o)):angular.isFunction(o)&&o("Subnavigation not found")},k=function(e,n,r,o){return angular.isDefined(n.name)&&angular.isString(n.name)&&""!==n.name?e.push(n):t.warn("Name not set, remove Subnavigation"),angular.isFunction(o)?o(null,e):e},F=function(e,n){for(var t=[],r=e.length-1;r>=0;r--)t=k(t,e[r],r);return angular.isFunction(n)?n(null,t):t},B=function(n,t,i){F(n,function(n,a){r.put("/navigation/replaceall",{navs:a,page:t}).success(function(n,t,r,u){if(null!==n&&"undefined"!=typeof n)a=o("orderBy")(n,"position"),angular.isFunction(i)&&i(null,a);else{var s="Navigation konnte nicht gespeichert werden";e.pop("error",s,""),angular.isFunction(i)&&i(s,a)}})})},O=function(e){return r.get("/navigation?page="+e,{page:e}).then(function(n){return angular.isUndefined(n)||angular.isUndefined(n.data)?(t.warn("Warn: On trying to resolve "+e+" navs!","Not found, navigation is empty!"),null):(n.data=o("orderBy")(n.data,"position"),t.debug("[SubnavigationService]",n),n.data)},function(n){t.error("[SubnavigationService] Error: On trying to resolve "+e+" navs!",n)})};return{resizeOnImagesLoaded:f,subscribe:g,setEditModal:c,getEditModal:d,create:p,append:m,add:m,swap:v,moveForward:h,moveBackward:b,edit:S,removeFromClient:y,remove:w,removeByTarget:$,save:B,resolve:O}}]).directive("jlSubnavigation",["$compile","$window","SubnavigationService","HistoryService",function(e,n,t,r){return{restrict:"E",templateUrl:"/views/modern/subnavigation.bootstrap.jade",scope:{authenticated:"=",navs:"=",afterSave:"=?",afterRemove:"=?",afterEdit:"=?",afterAdd:"=?",logger:"=",page:"=?"},link:function(e,n,t){},controller:["$rootScope","$scope","ContentService","$log","$state",function(e,n,o,i,a){t.setEditModal(n),n.goTo=r.goToHashPosition,t.subscribe(),angular.isUndefined(n.page)&&(n.page=a.current.name),angular.isUndefined(n.afterSave)&&(n.afterSave=function(e,t){return e?n.logger("error","Navigation wurde nicht gespeichert!",e):void n.logger("success","Navigation gespeichert!",t.title)}),angular.isUndefined(n.afterRemove)&&(n.afterRemove=function(e,t){return e?n.logger("error","Navigation wurde nicht entfernt!",e):void n.logger("success","Navigation entfernt!",t.title)}),angular.isUndefined(n.afterEdit)&&(n.afterEdit=function(e,t){return e?n.logger("error","Navigation wurde nicht bearbeitet!",e):void n.logger("success","Navigation bearbeitet!",t.title)}),angular.isUndefined(n.afterAdd)&&(n.afterAdd=function(e,t){return e?n.logger("error","Navigation wurde nicht hinzugefügt!",e):void n.logger("success","Navigation hinzugefügt!",t.title)}),n.add=function(){return n.authenticated?void t.add(n.navs,{page:page},n.afterAdd):!1},n.addNav=n.add,n.moveForward=function(e,t){SortableService.moveForward(e,n.navs,function(e,t){return e?(i.error("Error: On move subnavigation forward!",e),e):void(n.navs=t)})},n.moveForwardNav=n.moveForward,n.moveBackward=function(e,t){SortableService.moveBackward(e,n.navs,function(e,t){return e?(i.error("Error: On move content backward!",e),e):void(n.navs=t)})},n.moveBackwardNav=n.moveBackward,n.edit=function(e){return n.authenticated?void t.edit(e,n.afterEdit):!1},n.editNavs=n.edit,n.remove=function(e,r){return n.authenticated?void t.remove(n.navs,e,r,page,n.afterRemove):!1},n.removeNav=remove,n.save=function(){t.save(n.navs,page,n.afterSave)},n.onDragOnComplete=function(e,n,t){null===n&&i.debug("*click*",e),i.debug("onDragOnComplete, nav:",n,"index",e)},n.onDragOnNavComplete=n.onDragOnComplete,n.onDropOnComplete=function(e,t,r){SortableService.dropMove(n.navs,e,t,r,function(e,t){n.navs=t})},n.onDropOnNavComplete=n.onDropOnComplete,n.onDropOnAreaComplete=function(e,t){n.navs.indexOf(e)}}]}}]),angular.module("jumplink.cms.theme",["sails.io","ngAsync","jumplink.cms.sails"]).service("ThemeService",["$rootScope","$sailsSocket","$log","$async","JLSailsService",function(e,n,t,r,o){var i=!1,a=function(e,n){t.debug("[ThemeService.find]",e);var r={method:"get",resultIsArray:!0};return o.resolve("/theme/find",e,r,n)},u=function(e,n){var t={method:"post",resultIsArray:!0};return o.resolve("/theme/findbyhost",{host:e},t,n)},s=function(e,n){l(e,function(e,t){angular.isDefined(n)&&n(e,t)})},l=function(e,n){t.debug("[ThemeService.updateOrCreateEach]",e);var r={method:"post",resultIsArray:!0};return o.resolve("/Theme/updateOrCreateEach",{themes:e},r,n)},c=function(e,n,t){var r={method:"post",resultIsArray:!0};return o.resolve("/Theme/updateOrCreateEachByHost",{host:e,themes:n},r,t)},d=function(){i||(n.subscribe("theme",function(n){switch(e.authenticated&&t.debug(n),n.verb){case"updated":e.authenticated&&e.pop("success","Themeeinstellungen wurdne aktualisiert",n.data);break;case"created":e.authenticated&&e.pop("success","Themeeinstellungen wurden erstellt",n.data);break;case"removedFrom":e.authenticated&&e.pop("success","Themeeinstellungen wurden entfernt","");break;case"destroyed":e.authenticated&&e.pop("success","Themeeinstellungen wurden gelöscht","");break;case"addedTo":e.authenticated&&e.pop("success","Themeeinstellungen wurden hinzugefügt","")}}),i=!0)};return{find:a,findByHost:u,save:s,updateOrCreateEach:l,updateOrCreateEachByHost:c,subscribe:d}}]),angular.module("jumplink.cms.toolbar",["FBAngular"]).directive("jlToolbar",["$compile","$window",function(e,n){return{restrict:"E",templateUrl:"/views/modern/toolbar.jade",scope:{routes:"=",title:"=",shorttitle:"=",fluid:"=",position:"=",filter:"=",subnavigation:"=?"},link:function(e,n,t){},controller:["$scope","$log","Fullscreen",function(e,n,t){e.fullscreenIsSupported=t.isSupported(),e.isFullscreen=!1,n.debug("[jumplink.cms.toolbar.jlToolbar.controller]",e),t.$on("FBFullscreen.change",function(n,t){e.isFullscreen=t===!0}),e.toggleFullscreen=function(){t.isEnabled()?t.cancel():t.all()}}]}}]),angular.module("jumplink.cms.user",["sails.io","jumplink.cms.sails"]).service("UserService",["$rootScope","$sailsSocket","$log","JLSailsService",function(e,n,t,r){var o=!1,i=function(e,r){angular.isString(e.role)||(e.role="siteadmin"),angular.isDefined(e.id)?(t.debug("update user: sailsSocket.put('/user/"+e.id+"..'"),n.put("/user/"+e.id,e).success(function(e,n,o,i){t.debug(e,n,o,i),angular.isDefined(e)&&angular.isDefined(e.password)&&delete e.password,r(null,e,n,o,i)})):(t.debug("create user: sailsSocket.post('/user.."),n.post("/user",e).success(function(e,n,o,i){t.debug("data",e,"status",n,"headers",o,"config",i),angular.isDefined(e)&&angular.isDefined(e.password)&&delete e.password,r(null,e,n,o,i)}))},a=function(){o||(n.subscribe("user",function(n){switch(e.authenticated&&t.debug(n),n.verb){case"updated":e.authenticated&&e.pop("success","Ein Benutzer wurde aktualisiert",n.data.name);break;case"created":e.authenticated&&e.pop("success","Ein Benutzer wurde erstellt",n.data.name);break;case"removedFrom":e.authenticated&&e.pop("success","Ein Benutzer wurde entfernt","");break;case"destroyed":e.authenticated&&e.pop("success","Ein Benutzer wurde gelöscht","");break;case"addedTo":e.authenticated&&e.pop("success","Ein Benutzer wurde hinzugefügt","")}}),o=!0)},u=function(e,n){var r=e.indexOf(n);t.debug("removeFromClient",n,r),r>-1&&e.splice(r,1)},s=function(r,o){t.debug("$scope.remove",o),e.authenticated&&(r.length<=1?t.error("Der letzte Benutzer kann nicht gelöscht werden."):(u(r,o),o.id&&n["delete"]("/user/"+o.id,{id:o.id}).success(function(e,n,r,o){t.debug("user delete request",e,n,r,o)})))},l=function(e,n){var t={method:"post",resultIsArray:!0};return r.resolve("/user/findbyhost",{host:e},t,n)},c=function(e,n,o){t.debug("[UserService.updateOrCreateByHost]",e,routes);var i={method:"post",resultIsArray:!1};return r.resolve("/user/updateOrCreateByHost",{host:e,user:n},i,o)};return{save:i,subscribe:a,remove:s,findByHost:l,updateOrCreateByHost:c}}]),angular.module("jumplink.cms.utilities",[]).service("UtilityService",["$log",function(e){var n=function(e){for(var n=[],t=e.length-1;t>=0;t--)n.push(e[t]);return n},t=function(e,n,t){for(var r=-1,o=e.length-1;o>=0&&-1>=r;o--)e[o][n]===t&&(r=o);return r},r=function(e){var n=[];if(!angular.isObject(e))return console.error("[UtilityService.getKeys] is not an Object",e),n;for(var t in e)n.push(t);return n},o=function(e){return e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()},i=function(e){return e.charAt(0).toLowerCase()+e.slice(1)};return{invertOrder:n,findKeyValue:t,getKeys:r,capitalizeFirstLetter:o,lowercaseFirstLetter:i}}]),angular.module("jumplink.cms.validation",["validation","validation.rule"]).provider("jlValidation",["$validationProvider",function(e){this.getLocale=function(){var n={minlength:e.getDefaultMsg("minlength"),maxlength:e.getDefaultMsg("maxlength"),required:e.getDefaultMsg("required"),email:e.getDefaultMsg("email"),number:e.getDefaultMsg("number"),url:e.getDefaultMsg("url")};return n},this.changeLocale=function(n){var t={};switch(n){case"de":t={minlength:{error:"Eingabe muss länger sein!",success:"Eingabe lang genug"},maxlength:{error:"Eingabe muss kürzer sein!",success:"Eingabe kurz genug"},required:{error:"Eine Eingabe ist erforderlich!",success:"Okay"},email:{error:"Eingabe muss einer E-Mail entsprechen!",success:"Eingabe ist eine E-Mail"},number:{error:"Eingabe darf nur Zahlen enthalten!",success:"Eingabe enthält nur Zahlen"},url:{error:"Eingabe muss einer URL entsprechen!",success:"Eingabe entspricht einer URL"}};break;case"en":}switch(n){case"de":e.setDefaultMsg(t);break;case"en":}},this.$get=function(){return new jlValidation}}]),angular.module("jumplink.cms.bootstrap.content",["jumplink.cms.content"]).service("ContentBootstrapService",["$log","$async","ImportExportBootstrapService","UtilityService","ContentService","SortableService",function(e,n,t,r,o,i){var a=null,u=null,s=function(e){u=e},l=function(r,s){var l={},c=function(n,r){e.debug("[ContentBootstrapService.onCompleteFile]",r);for(var o=[],i=0;i<r.length;i++)o=o.concat(r[i].data);t.setImports(o,{identifierKey:"name",descriptionKey:"title"})},d=function(t,r){e.debug("[ContentBootstrapService.onImportStart]",u),n.map(t,function(e,n){e.importOptions.doImport===!0?o.updateOrCreateByHostByTitleAndPage(u,e,n):n()},function(n,t){e.debug("[ContentBootstrapService.onImportStart] done",n,t),t=i.sort(t),r(n,t)})},g=function(n,t){e.debug("[ContentBootstrapService.onAbort]"),t()};a=t.setModals(r,l,c,d,g,s)};return{setHost:s,setupImportModal:l,showImportModal:t.show}}]),angular.module("jumplink.cms.content.medium",["jumplink.cms.content","angular-medium-editor"]).value("mediumOptions",{buttonLabels:"fontawesome",toolbar:{buttons:["bold","italic","underline","anchor","h2","h3","h4","quote","orderedlist","unorderedlist"]}}).service("ContentMediumService",["$rootScope","$log","$sailsSocket","$filter","$modal","SortableService","UtilityService","focus",function(e,n,t,r,o,i,a,u){var s=function(){this.button=document.createElement("button"),this.button.className="medium-editor-action",this.button.innerText="Image",this.button.innerHTML='<i class="fa fa-picture-o"></i>',this.button.onclick=this.onClick.bind(this)};return s.prototype.onClick=function(){this.classApplier.toggleSelection()},s.prototype.getButton=function(){return this.button},s.prototype.checkState=function(e){"MARK"===e.tagName&&this.button.classList.add("medium-editor-button-active")},{Imager:s}}]),angular.module("jumplink.cms.content.medium").directive("jlContentBlocks",["$compile","$window","mediumOptions","ContentMediumService","SubnavigationService","HistoryService",function(e,n,t,r,o,i){return{restrict:"E",templateUrl:"/views/modern/contentBlocks.jade",scope:{authenticated:"=",html:"=",contents:"=",navs:"=?",afterRefresh:"=?",afterSave:"=?",afterRemove:"=?",afterEdit:"=?",afterAdd:"=?",subnavigation:"=?",afterSaveNav:"=?",afterRemoveNav:"=?",afterEditNav:"=?",afterAddNav:"=?",logger:"=",page:"=?",mediumOptions:"=?",mediumBindOptions:"=?"},link:function(e,n,t){},controller:["$rootScope","$scope","ContentService","$log","$state",function(e,n,t,r,a){t.setEditModal(n),o.setEditModal(n),n.goTo=i.goToHashPosition,t.subscribe(),o.subscribe(),angular.isUndefined(n.page)&&(n.page=a.current.name),angular.isUndefined(n.subnavigation)&&(n.subnavigation=!1),angular.isUndefined(n.afterRefresh)&&(n.afterRefresh=function(e,t){return e?n.logger("error","Inhaltsblock wurde nicht erneuert!",e):void n.logger("success","Inhaltsblock erneuert!","")}),angular.isUndefined(n.afterSave)&&(n.afterSave=function(e,t){return e?n.logger("error","Inhaltsblock wurde nicht gespeichert!",e):void n.logger("success","Inhaltsblock gespeichert!",t.title)}),angular.isUndefined(n.afterRemove)&&(n.afterRemove=function(e,t){return e?n.logger("error","Inhaltsblock wurde nicht entfernt!",e):void n.logger("success","Inhaltsblock entfernt!",t.title)}),angular.isUndefined(n.afterEdit)&&(n.afterEdit=function(e,t){return e?n.logger("error","Inhaltsblock wurde nicht bearbeitet!",e):void n.logger("success","Inhaltsblock bearbeitet!",t.title)}),angular.isUndefined(n.afterAdd)&&(n.afterAdd=function(e,t){return e?n.logger("error","Inhaltsblock wurde nicht hinzugefügt!",e):void n.logger("success","Inhaltsblock hinzugefügt!",t.title)}),angular.isUndefined(n.afterSaveNav)&&(n.afterSaveNav=function(e,t){return e?n.logger("error","Navigation wurde nicht gespeichert!",e):void n.logger("success","Navigation gespeichert!",t.title)}),n.add=function(){return n.authenticated?void t.createEdit(n.contents,n.page,function(e,r){return e?n.afterAdd(e):void t.append(n.contents,r,n.afterAdd)}):!1},n.moveForward=function(e,t){return n.authenticated?void SortableService.moveForward(e,n.contents,function(e,t){return e?(r.error("Error: On move content forward!",e),e):void(n.contents=t)}):!1},n.moveBackward=function(e,t){return n.authenticated?void SortableService.moveBackward(e,n.contents,function(e,t){return e?(r.error("Error: On move content backward!",e),e):void(n.contents=t)}):!1},n.edit=function(e,r){return n.authenticated?void t.edit(r,n.afterEdit):!1},n.remove=function(e,r){return n.authenticated?void t.remove(n.contents,e,r,n.page,n.afterRemove):!1},n.refresh=function(){t.refresh(n.contents,n.afterRefresh)},n.toggleHtml=function(e,n){n.html=n.html!==!0},n.save=function(){return n.authenticated?(t.save(n.contents,n.page,n.afterSave),void(n.subnavigation&&o.save(n.navs,n.page,n.afterSaveNav))):!1}}]}}]),angular.module("jumplink.cms.content.medium").directive("jlContent",["$compile","$window","mediumOptions","ContentMediumService",function(e,n,t,r){return{restrict:"E",templateUrl:"/views/modern/content.jade",scope:{authenticated:"=",html:"=",content:"=?",mediumOptions:"=?",mediumBindOptions:"=?"},link:function(e,n,o){angular.isUndefined(e.mediumOptions)&&(e.mediumOptions=t),angular.isUndefined(e.mediumBindOptions)&&(e.mediumBindOptions={extensions:{image:new r.Imager}})}}}]);
//# sourceMappingURL=jumplink-cms-angular-bootstrap.js.map

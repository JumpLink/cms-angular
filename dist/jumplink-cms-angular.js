if(angular.module("jumplink.cms.admin",["sails.io"]).directive("adminbar",["$compile","$window","$sailsSocket","$state",function(e,n,t,r){return{restrict:"E",templateUrl:"/views/modern/adminbar.jade",scope:{download:"=?",toogleHtml:"=?",refresh:"=?",save:"=?",add:"=?",addDropdown:"=?",addDropdownActions:"=?",adminSettingDropdown:"=?",authenticated:"=?",allowActions:"=?"},link:function(e,n,t){e.goToState=r.go,angular.isUndefined(e.adminSettingDropdown)&&(e.adminSettingDropdown=[{text:'<i class="fa fa-list"></i>&nbsp;Übersicht',click:"goToState('layout.administration')"},{text:'<i class="fa fa-users"></i>&nbsp;Benutzer',click:"goToState('layout.users')"},{text:'<i class="fa fa-sign-out"></i>&nbsp;Abmelden',click:"$root.logout()"}])}}}]),angular.module("jumplink.cms.bootstrap.blog",["jumplink.cms.blog","mgcrea.ngStrap","angular-medium-editor","angularFileUpload","ngFocus"]).service("BlogBootstrapService",["$log","focus","BlogService","$modal","FileUploader",function(e,n,t,r,o){var i=null,a=null,u=null,s=function(e){a.$scope.blogPost=e,a.$promise.then(a.show)},l=function(n,l,c,g){angular.isString(u)||(u=c),i=r({title:"Blogpost bearbeiten",templateUrl:"/views/modern/blog/editmodal.bootstrap.jade",show:!1}),i.$scope.ok=!1,i.$scope.accept=function(e){i.$scope.ok=!0,e()},i.$scope.abort=function(e){i.$scope.ok=!1,e()},angular.isUndefined(l)&&(l={path:"assets/files/blog",thumbnail:{width:300,path:"assets/files/blog"},rescrop:{width:1200,cropwidth:1200,cropheight:1200}});var p={url:"blog/upload",removeAfterUpload:!0,headers:{options:JSON.stringify(l)}};return i.$scope.uploader=new o(p),i.$scope.openTypeChooserModal=s,angular.isFunction(g)&&(n.uploader.onComplete=g),i.$scope.uploader.onCompleteItem=function(n,t,r,o){e.debug("[BlogBootstrapService.onCompleteItem] fileItem",n,"response",t),angular.isArray(n.blogPost.attachments)||(n.blogPost.attachments=[]);for(var i=0;i<t.files.length;i++)n.blogPost.attachments.push(t.files[i])},i.$scope.uploader.onProgressItem=function(n,t){e.debug("[BlogBootstrapService.onProgressItem]",n,t)},i.$scope.upload=function(e,n){e.blogPost=n,e.upload()},a=r({title:"Typ wählen",templateUrl:"/views/modern/blog/typechoosermodal.bootstrap.jade",show:!1}),a.$scope.chooseType=t.chooseType,i.$scope.$on("modal.hide.before",function(n,r){return e.debug("edit closed",r.$scope.blogPost,r),r.$scope.ok?t.validate(r.$scope.blogPost,null,r.$scope.callback):void(r.$scope.callback&&r.$scope.callback("discarded",r.$scope.blogPost))}),d()},c=function(){return a},d=function(){return{editModal:c(),typeModal:c()}},g=function(t,r){e.debug("[BlogService.edit]",t),i.$scope.blogPost=t,i.$scope.callback=r,i.$scope.ok=!1,n("blogposttitle"),i.$promise.then(i.show)},p=function(e,n,r){n=t.create(n),g(n,r)};return{edit:g,update:g,createEdit:p,setModals:l,openTypeChooserModal:s}}]),angular.module("jumplink.cms.blog",["jumplink.cms.attachment","angularMoment","ngAsync","sails.io"]).service("BlogService",["moment","$sailsSocket","$async","$log","$filter","AttachmentService",function(e,n,t,r,o,i){var a=["news","other"],u=(i.destroyLocally,i.destroyExternally,i.destroy),s=function(e,n,t){return e.title?h(e,n,t):angular.isFunction(t)?t("Title not set",e):null},l=function(e,n){e.type=n},c=function(e,n,t){var r=e.indexOf(n);r>-1?(e.splice(r,1),angular.isFunction(t)&&t(null,e)):angular.isFunction(t)&&t("no blogPost on client site found to remove",e)},d=function(e,t,o){t.id?(r.debug("[jumplink.cms.blog.BlogService.destroy]",t),n["delete"]("/blog/"+t.id).success(function(n,r,i,a){c(e,t,o)})):c(e,t,o)},g=function(e){var n=!0;return o("orderBy")(e,"createdAt",n)},p=function(e){return e=g(e)},f=function(e,n,t){return e.push.apply(e,n),e=p(e),angular.isFunction(t)?t(null,e):e},m=function(e,n,t){return e.unshift(n),e=p(e),angular.isFunction(t)?t(null,e):e},v=function(n){return n&&n.createdAt||(n.createdAt=e()),n&&n.title||(n.title=""),n&&n.content||(n.content=""),n&&n.author||(n.author=""),n&&n.page||callback("Page not set."),n&&n.type||(n.type=a[0]),r.debug("[BlogService,create]",n),n},h=function(e,n,t){return angular.isUndefined(e.page)&&null!==n&&(e.page=n),e.name&&""!==e.name||(e.name=e.title.toLowerCase().replace(/[^a-z]+/g,"")),angular.isFunction(t)?t(null,e):e},b=function(e,n,t){for(var r=e.length-1;r>=0;r--)e[r]=h(e[r],n);return angular.isFunction(t)?t(null,e):e},$=function(e,n){return r.debug("[jumplink.cms.blog.BlogService.refresh]"),e=p(e),angular.isFunction(n)?n(null,e):e},S=function(e,t,o,i,a){var u=["BlogService: Can't save blogPost.","BlogService: Can't save blogPost, blogPost to update not found.","BlogService: Can't save blogPost, parameters undefind."];return r.debug("[BlogService.saveOne]",t),angular.isDefined(t)&&angular.isDefined(a)?(t=h(t,i),void(angular.isUndefined(t.id)?n.post("/blog",t).success(function(e,n,t,r){angular.isArray(e)&&(e=e[0]),a(null,e)}).error(function(e,n,t,o){return angular.isArray(e)&&(e=e[0]),r.error(e,n,t,o),a(u[0])}):n.put("/blog/"+t.id,t).success(function(e,n,t,r){return angular.isArray(e)&&(e=e[0]),a(null,e)}).error(function(e,n,t,o){return r.error(e,n,t,o),a(u[0])}))):a(u[2])},y=function(e,n,o){var i=["[BlogService.saveBlocks] Can't save blogPosts, parameters undefind."];if(angular.isDefined(e)&&angular.isDefined(o))t.map(e,function(t,r){S(e,t,null,n,r)},function(n,t){return n?o(n):(e=p(e),o(null,e))});else if(r.error(i[0]),angular.isFunction(o))return o(i[0])},w=function(e,n,t,r,o){angular.isDefined(n)?S(e,n,t,r,o):y(e,r,o)},k=function(e,t,o,i){return n.put("/blog/find",{page:e,limit:t,skip:o}).then(function(e){return e.data=p(e.data),angular.isFunction(i)?i(null,e.data):e.data},function(n){return r.error("Error on find "+e,n),angular.isFunction(i)?i(n):null})},F=function(e,t,o,i){return n.put("/blog/count",{page:e}).then(function(e){return angular.isFunction(i)?i(null,e.data.count):e.data.count},function(n){return r.error("Error on resolve "+e,n),angular.isFunction(i)?i(n):null})},B=function(){n.subscribe("blog",function(e){switch(r.debug(e),e.verb){case"updated":$rootScope.authenticated&&$rootScope.pop("success","Ein Blogpost wurde aktualisiert",e.data.title),findEvent(e.id,function(n,t,o,i){n?r.debug(n):t=e.data,$scope.refresh()});break;case"created":$rootScope.authenticated&&$rootScope.pop("success","Ein Blogpost wurde erstellt",e.data.title),$scope.blogPosts.push(e.data),$scope.refresh();break;case"removedFrom":$rootScope.authenticated&&$rootScope.pop("success","Ein Blogpost wurde entfernt",e.data.title),findEvent(e.id,function(e,n,t,o){e?r.debug(e):BlogService.removeFromClient($scope.blogPosts,n,t)});break;case"destroyed":$rootScope.authenticated&&$rootScope.pop("success","Ein Blogpost wurde gelöscht",e.data.title),findEvent(e.id,function(e,n,t,o){return e?(r.debug(e),e):void BlogService.removeFromClient($scope.blogPosts,n,t)});break;case"addedTo":$rootScope.authenticated&&$rootScope.pop("success","Ein Blogpost wurde hinzugefügt",e.data.title)}})};return{validate:s,subscribe:B,append:f,prepent:m,sort:g,transform:p,saveOne:S,saveBlocks:y,save:w,fixEach:b,find:k,resolve:k,count:F,refresh:$,chooseType:l,removeFromClient:c,remove:d,destroy:d,deleteAttachment:u,destroyAttachment:u,create:v}}]),angular.module("ngAsync",[]).service("$async",function(){return async.objectMap=function(e,n,t){var r,o=[],i=Object.keys(e);for(r=0;r<i.length;r+=1){var a={};a[i[r]]=e[i[r]],o[r]=a}this.map(o,n,function(e,n){if(e)return t(e);var o={};for(r=0;r<n.length;r+=1)o[i[r]]=n[r];return t(e,o)})},async}),angular.module("jumplink.cms.bootstrap.attachment",["jumplink.cms.attachment"]).directive("jlAttachmentBootstrap",["$compile","$window","mediumOptions","AttachmentService",function(e,n,t,r){return{restrict:"E",templateUrl:"/views/modern/attachment.bootstrap.jade",scope:{attachment:"=",attachmentIndex:"=",parent:"=",path:"=",authenticated:"=",destroy:"=",centerImage:"="},link:function(e,n,t){console.log("[jlAttachmentBootstrap.link]",e)},controller:["$scope","AttachmentService",function(e,n){e.open=n.open}]}}]),angular.module("jumplink.cms.attachment",["sails.io"]).service("AttachmentService",["moment","$sailsSocket","$async","$log","$window",function(e,n,t,r,o){var i=function(e,n){o.open(e,n)},a=function(e,n,t,r){return e[n].attachments.length>0&&e[n].attachments.splice(t,1),r(null,e,n,t)},u=function(e,t,o,i){n.put("/blog/destroyAttachment",{blogPostID:e[t].id,attachmentUploadedAs:e[t].attachments[o].uploadedAs}).success(function(e,n,t,o){r.debug(null,e,n,t,o),i()}).error(function(e,n,t,o){r.error(e,n,t,o),i("error",e,n,t,o)})},s=function(e,n,t,o){var i=e.indexOf(n);return r.debug("[BlogService.destroy]",e[i],t),u(e,i,t,function(n,r,u,s,l){return n?o(n,r,u,s,l):a(e,i,t,o)})};return{open:i,destroyLocally:a,destroyExternally:u,destroy:s}}]),angular.module("jumplink.cms.browser",[]).directive("jlBrowser",["$compile","$window",function(e,n){return{restrict:"E",templateUrl:"/views/modern/browser.bootstrap.jade",scope:{force:"="},link:function(e,n,t){}}}]),angular.module("jumplink.cms.config",["sails.io"]).service("ConfigService",["$sailsSocket","$filter","$log",function(e,n,t){var r=function(n){return e.get("/config/find").then(function(e){return e.data},function(e){t.error("Error on resolve "+n,e)})};return{resolve:r}}]),angular.module("jumplink.cms.content",["mgcrea.ngStrap","angular-medium-editor","ui.ace","sails.io","jumplink.cms.sortable","ngFocus"]).service("ContentService",["$rootScope","$log","$sailsSocket","$filter","$modal","SortableService","UtilityService","focus",function(e,n,t,r,o,i,a,u){var s=!1,l=null,c=function(){return s},d=function(e){return l=o({title:"Inhaltsblock bearbeiten",templateUrl:"/views/modern/contentmodal.jade",show:!1}),l.$scope.ok=!1,l.$scope.accept=function(e){l.$scope.ok=!0,e()},l.$scope.abort=function(e){l.$scope.ok=!1,e()},l.$scope.changeName=!1,l.$scope.$watch("content.title",function(e,n){l.$scope.changeName&&angular.isDefined(l.$scope.content)&&(l.$scope.content.name=E(e))}),l.$scope.$on("modal.hide.before",function(e,n){return n.$scope.changeName=!1,n.$scope.ok?F(n.$scope.content,n.$scope.callback):angular.isFunction(n.$scope.callback)?n.$scope.callback("discarded",n.$scope.content):void 0}),g()},g=function(){return l},p=function(){t.subscribe("content",function(t){switch(n.debug("Content event!",t),t.verb){case"updated":e.authenticated&&e.pop("success","Seite wurde aktualisiert",t.id)}})},f=function(e,n){return s=!s,s&&e&&(e=v(e)),angular.isFunction(n)?n(null,s):s},m=function(e,n){return e.content=html_beautify(e.content),angular.isFunction(n)?n(null,e):e},v=function(e,n){for(var t=e.length-1;t>=0;t--)e[t].content=m(e[t].content);return angular.isFunction(n)?n(null,e):e},h=function(e,n){var t=a.findKeyValue(e,"name",n);return t>-1?e[t]:null},b=function(e){return e&&e.content||(e.content=""),e&&e.title||(e.title=""),e&&e.name||(e.name=""),e&&e.type||(e.type="dynamic"),e&&e.page||callback("Page not set."),e},$=function(e,n,t){i.append(e,n,t,!0,"name")},S=function(e,n,t){var r=b({page:n});B(r,t,!0)},y=function(e,n,t,r){return i.swap(e,n,t,r)},w=function(e,n,t){return i.moveForward(e,n,t)},k=function(e,n,t){return i.moveBackward(e,n,t)},F=function(e,n){return e.title?C(e,n):angular.isFunction(n)?n("Title not set",e):null},B=function(e,t,r){n.debug("edit",e),l.$scope.content=e,l.$scope.callback=t,r?l.$scope.changeName=r:l.$scope.changeName=!1,u("contentedittitle"),l.$promise.then(l.show)},A=function(e,n,t,r){return i.remove(n,e,r)},O=function(e,r,o,a,u){var s=["Content konnte nicht gelöscht werden."];return("undefined"==typeof r||null===r)&&(r=e.indexOf(o)),e=i.remove(e,r,o),o.id?(n.debug("remove from server, too",o),void t["delete"]("/content/"+o.id+"?page="+a,{id:o.id,page:a}).success(function(n,t,r,o){return angular.isFunction(u)?u(null,e):e}).error(function(e,t,r,o){return n.error(s[0],e),angular.isFunction(u)?u(e):e})):angular.isFunction(u)?u(null,e):e},j=function(e,t){U(e,function(e,r){return e?(n.error(e),angular.isFunction(t)?t(e):e):void v(r,function(e,r){return e?(n.error(e),angular.isFunction(t)?t(e):e):angular.isFunction(t)?t(null,r):r})})},E=function(e){var t="";return e&&""!==e&&(t=e.toLowerCase().replace(/[^a-z1-9]+/g,""),n.debug("set content.name to",t)),t},C=function(e,t){return angular.isDefined(e)?((angular.isUndefined(e.name)||""===e.name||null===e.name)&&(e.name=E(e.title)),angular.isNumber(e.position)||(e.position=0),e.type&&""!==e.type||(n.warn("Fix content type not set, set it to dynamic"),e.type="fix"),angular.isFunction(t)?t(null,e):e):angular.isFunction(t)?t("content not set"):null},U=function(e,n){for(var t=e.length-1;t>=0;t--)e[t]=C(e[t]);return angular.isFunction(n)?n(null,e):e},I=function(e,r,o){var i=["Inhalt konnte nicht gespeichert werden"];e.page=r,C(e,function(e,r){return e?angular.isFunction(o)?o(e):e:void t.put("/content/replace",r).success(function(e,t,a,u){return null!==e&&"undefined"!=typeof e?(r=e,angular.isFunction(o)?o(null,r):r):(n.error(i[0]),angular.isFunction(o)?o(i[0]):i[0])}).error(function(e,t,r,a){return n.error(i[0],e),angular.isFunction(o)?o(e):e})})},x=function(e,o,i){var a=["Seite konnte nicht gespeichert werden"];U(e,function(e,u){return e?angular.isFunction(i)?i(e):e:t.put("/content/replaceall",{contents:u,page:o}).success(function(e,t,o,s){return null!==e&&"undefined"!=typeof e?(u=r("orderBy")(e,"position"),angular.isFunction(i)?i(null,u):u):(n.error(a[0]),angular.isFunction(i)?i(a[0]):a[0])}).error(function(e,t,r,o){n.error(a[0],e),angular.isFunction(i)&&i(e)})})},T=function(e,r,o,i,a){var u=["Error: On trying to find one with page: "+e+", name: "+r,"request has more than one results"],s={page:e,name:r},l="/content/find";return o&&(s.type=o),t.put(l,s).then(function(e){return angular.isUndefined(e)||angular.isUndefined(e.data)?null:(e.data instanceof Array&&(e.data=e.data[0],n.error(u[1])),a&&(e.data=a(e.data)),angular.isFunction(i)?i(null,e.data):e.data)},function(e){return n.error(u[0],e),angular.isFunction(i)?i(u[0],e):e})},M=function(e,o,i,a){var u=["Error: On trying to find all with page: "+e+" and type: "+o,"Warn: On trying to find all "+e+" contents! Not found, content is empty!"],s={page:e},l="/content/findall";return o&&(s.type=o),t.put(l,s).then(function(e){return angular.isUndefined(e)||angular.isUndefined(e.data)?(n.warn(u[1]),null):(e.data=r("orderBy")(e.data,"position"),a&&(e.data=a(e.data)),angular.isFunction(i)?void i(null,e.data):e.data)},function(e){return n.error(u[0],e),angular.isFunction(i)?i(u[0],e):e})},D=function(e,o,i,a){var u=["Error: On trying to find all with page: "+e+" and type: "+o,"Warn: On trying to find all "+e+" contents! Not found, content is empty!"],s={page:e},l="/content/findAllWithImage?page="+e;return o&&(s.type=o,l=l+"&type="+o),t.get(l,s).then(function(e){return angular.isUndefined(e)||angular.isUndefined(e.data)?(n.warn(u[1]),null):(e.data.contents=r("orderBy")(e.data.contents,"position"),e.data.images=r("orderBy")(e.data.images,"position"),a&&(e.data=a(e.data)),angular.isFunction(i)?i(null,e.data):e.data)},function(e){return n.error(u[0],e),angular.isFunction(i)?i(u[0],e):e})},P=function(e,n,t,r,o){return angular.isDefined(n)?T(e,n,t,o):M(e,t,r,o)};return{subscribe:p,setEditModal:d,getShowHtml:c,toogleShowHtml:f,beautify:m,beautifyEach:v,create:b,createEdit:S,append:$,swap:y,moveForward:w,moveBackward:k,edit:B,removeFromClient:A,remove:O,refresh:j,fix:C,fixEach:U,save:x,saveOne:I,find:P,resolve:P,findOne:T,resolveOne:T,findAll:M,resolveAll:M,findAllWithImage:D,resolveAllWithImage:D,getByName:h}}]),angular.module("jumplink.cms.content.medium",["jumplink.cms.content","angular-medium-editor"]).value("mediumOptions",{buttonLabels:"fontawesome",toolbar:{buttons:["bold","italic","underline","anchor","h2","h3","h4","quote","orderedlist","unorderedlist"]}}).service("ContentMediumService",["$rootScope","$log","$sailsSocket","$filter","$modal","SortableService","UtilityService","focus",function(e,n,t,r,o,i,a,u){var s=function(){this.button=document.createElement("button"),this.button.className="medium-editor-action",this.button.innerText="Image",this.button.innerHTML='<i class="fa fa-picture-o"></i>',this.button.onclick=this.onClick.bind(this)};return s.prototype.onClick=function(){this.classApplier.toggleSelection()},s.prototype.getButton=function(){return this.button},s.prototype.checkState=function(e){"MARK"===e.tagName&&this.button.classList.add("medium-editor-button-active")},{Imager:s}}]).directive("jlContent",["$compile","$window","mediumOptions","ContentMediumService",function(e,n,t,r){return{restrict:"E",templateUrl:"/views/modern/content.jade",scope:{authenticated:"=",html:"=",content:"=?",mediumOptions:"=?",mediumBindOptions:"=?"},link:function(e,n,o){angular.isUndefined(e.mediumOptions)&&(e.mediumOptions=t),angular.isUndefined(e.mediumBindOptions)&&(e.mediumBindOptions={extensions:{image:new r.Imager}})}}}]),Date.now||(Date.now=function(){return(new Date).getTime()}),function(){"use strict";for(var e=["webkit","moz"],n=0;n<e.length&&!window.requestAnimationFrame;++n){var t=e[n];window.requestAnimationFrame=window[t+"RequestAnimationFrame"],window.cancelAnimationFrame=window[t+"CancelAnimationFrame"]||window[t+"CancelRequestAnimationFrame"]}if(/iP(ad|hone|od).*OS 6/.test(window.navigator.userAgent)||!window.requestAnimationFrame||!window.cancelAnimationFrame){var r=0;window.requestAnimationFrame=function(e){var n=Date.now(),t=Math.max(r+16,n);return setTimeout(function(){e(r=t)},t-n)},window.cancelAnimationFrame=clearTimeout}}(),angular.module("jumplink.cms.event",["mgcrea.ngStrap","angular-medium-editor","angularFileUpload","angularMoment","ngFocus","ngAsync","sails.io","jumplink.cms.utilities"]).service("EventService",["moment","UtilityService","$sailsSocket","$async","$log","focus","$modal","FileUploader",function(e,n,t,r,o,i,a,u){var s=null,l=null,c=null,d=function(e,n){return e.title?A(e,n):angular.isFunction(n)?n("Title not set",e):null},g=function(e,n,t){e.type=n,t()},p=function(e){l.$scope.event=e,l.$promise.then(l.show)},f=function(e,n,t){angular.isString(c)||(c=t),s=a({title:"Ereignis bearbeiten",templateUrl:"/views/modern/events/editmodal.jade",show:!1}),s.$scope.ok=!1,s.$scope.accept=function(e){s.$scope.ok=!0,e()},s.$scope.abort=function(e){s.$scope.ok=!1,e()},angular.isUndefined(n)&&(n={});var r={url:"timeline/upload",removeAfterUpload:!0,headers:{options:JSON.stringify(n)}};return s.$scope.uploader=new u(r),s.$scope.openTypeChooserModal=p,s.$scope.uploader.onCompleteItem=function(e,n,t,r){e.event.download=n.files[0].uploadedAs},s.$scope.uploader.onProgressItem=function(e,n){console.info("onProgressItem",e,n)},s.$scope.upload=function(e,n){e.event=n,e.upload()},l=a({title:"Typ wählen",templateUrl:"/views/modern/events/typechoosermodal.jade",show:!1}),l.$scope.chooseType=g,s.$scope.$on("modal.hide.before",function(e,n){return o.debug("edit closed",e,n),n.$scope.ok?d(n.$scope.event,n.$scope.callback):angular.isFunction(n.$scope.callback)?n.$scope.callback("discarded",n.$scope.event):void 0}),v()},m=function(){return l},v=function(){return{editModal:m(),typeModal:m()}},h=function(e,n,t){s.$scope.event=e,s.$scope.callback=t,s.$scope.ok=!1,i("eventtitle"),s.$promise.then(s.show)},b=function(n){for(var t=[],r=[],o=[],i=0;i<n.length;i++)angular.isDefined(n[i].to)&&(n[i].to=e(n[i].to)),angular.isDefined(n[i].from)?(n[i].from=e(n[i].from),n[i].from.isAfter()?o.push(n[i]):r.push(n[i])):t.push(n[i]);return{unknown:t,before:r,after:o}},$=function(e,n,t,r){var o=["no event on client site found to remove"],i=e[t].indexOf(n);return i>-1?(e[t].splice(i,1),angular.isFunction(r)?r(null,e):e):angular.isFunction(r)?r(o[0],e):o[0]},S=function(e,n,r,i){n.id?(o.debug(n),t["delete"]("/timeline/"+n.id).success(function(t,o,a,u){$(e,n,r,i)})):$(e,n,r,i)},y=function(e){return e=b(e),e.before=n.invertOrder(e.before),e},w=function(e,n,t){return angular.isUndefined(e)&&(e=[]),angular.isUndefined(n)&&(n=[]),angular.isUndefined(t)&&(t=[]),e.concat(n).concat(t)},k=function(e,n,t){e.unknown.push(n);var r=w(e.unknown,e.before,e.after);return e=y(r),angular.isFunction(t)?t(null,e):e},F=function(n){return n&&n.from||(n.from=e(),n.from.add(1,"hours"),n.from.minutes(0)),n&&n.title||(n.title=""),n&&n.person||(n.person=""),n&&n.place||(n.place=""),n&&n.page||callback("Page not set."),n},B=function(e,n,t){n=F(n),h(n,null,t)},A=function(e,n){return e.name&&""!==e.name||(e.name=e.title.toLowerCase().replace(/[^a-z]+/g,"")),angular.isFunction(n)?n(null,e):e},O=function(e,n){for(var t=e.length-1;t>=0;t--)e[t]=A(e[t]);return angular.isFunction(n)?n(null,e):e},j=function(e){var n=w(e.unknown,e.before,e.after);return e=y(n)},E=function(e,n,r,i){var a=["EventService: Can't save event.","EventService: Can't save event, event to update not found.","EventService: Can't save event, parameters undefind."];angular.isDefined(r)&&angular.isDefined(n)&&angular.isDefined(i)?(r=A(r),angular.isUndefined(r.id)?t.post("/timeline",r).success(function(t,o,u,s){angular.isArray(t)&&(t=t[0]);var l=e[n].indexOf(r);l>-1?(e[n][l]=t,i(null,e[n][l])):i(a[1])}).error(function(e,n,t,r){angular.isArray(e)&&(e=e[0]),o.error(e,n,t,r),i(a[0])}):t.put("/timeline/"+r.id,r).success(function(e,n,t,o){angular.isArray(e)&&(e=e[0]),r=e,i(null,r)}).error(function(e,n,t,r){o.error(e,n,t,r),i(a[0])})):i(a[2])},C=function(e,n,t){r.map(e[n],function(t,r){E(e,n,t,r)},t)},U=function(e,n){var t=["EventService: Can't save eventBlocks, parameters undefind."];return angular.isDefined(e)&&angular.isDefined(n)?r.map(["after","before","unknown"],function(n,t){C(e,n,t)},function(t,r){if(t&&(o.error(t),angular.isFunction(n)))return n(t);var i=w(r[0],r[1],r[2]);return e=y(i),n(null,e)}):(o.error(t[0]),angular.isFunction(n)?n(t[0]):void 0)},I=function(e){return t.get("/timeline").then(function(e){return y(e.data)},function(n){o.error("Error on resolve "+e,n)})},x=function(){t.subscribe("timeline",function(e){switch(o.debug(e),e.verb){case"updated":$rootScope.authenticated&&$rootScope.pop("success","Ein Ereignis wurde aktualisiert",e.data.title),findEvent(e.id,function(n,t,r,i){return n?(o.debug(n),n):(t=e.data,void $scope.refresh())});break;case"created":$rootScope.authenticated&&$rootScope.pop("success","Ein Ereignis wurde erstellt",e.data.title),$scope.events.before.push(e.data),$scope.refresh();break;case"removedFrom":$rootScope.authenticated&&$rootScope.pop("success","Ein Ereignis wurde entfernt",e.data.title),findEvent(e.id,function(e,n,t,r){return e?(o.debug(e),e):void EventService.removeFromClient($scope.events,n,t)});break;case"destroyed":$rootScope.authenticated&&$rootScope.pop("success","Ein Ereignis wurde gelöscht",e.data.title),findEvent(e.id,function(e,n,t,r){return e?(o.debug(e),e):void EventService.removeFromClient($scope.events,n,t)});break;case"addedTo":$rootScope.authenticated&&$rootScope.pop("success","Ein Ereignis wurde hinzugefügt",e.data.title)}})};return{subscribe:x,split:b,merge:w,append:k,transform:y,saveOne:E,saveAllInBlock:C,saveBlocks:U,edit:h,createEdit:B,fixEach:O,resolve:I,setModals:f,refresh:j,openTypeChooserModal:p,chooseType:g,removeFromClient:$,remove:S}}]),angular.module("ngFocus",[]).factory("focus",["$timeout","$window",function(e,n){return function(t){e(function(){var e=n.document.getElementById(t);e&&e.focus()})}}]).directive("eventFocus",["focus",function(e){return function(n,t,r){t.on(r.eventFocus,function(){e(r.eventFocusId)}),n.$on("$destroy",function(){t.off(r.eventFocus)})}}]),angular.module("jumplink.cms.gallery",["mgcrea.ngStrap","ngAsync","angular-medium-editor","FBAngular","sails.io","angularFileUpload","jumplink.cms.sortable","jumplink.cms.content"]).service("GalleryService",["$rootScope","$sailsSocket","$async","$filter","Fullscreen","SortableService","ContentService","FileUploader","$modal","$log",function(e,n,t,r,o,i,a,u,s,l){var c=null;uploadModal=null,fullscreenImage=null;var d=[{text:'<i class="fa fa-eye"></i>&nbsp;Anzeigen',click:"goToImage(image)"},{text:'<i class="fa fa-edit"></i>&nbsp;Bearbeiten',click:"editImage(image)"},{text:'<i class="fa fa-trash"></i>&nbsp;Löschen',click:"$dropdown.hide();$dropdown.destroy();removeImage(image);"},{text:'<i class="fa fa-floppy-o"></i>&nbsp;Speichern',click:"saveImage(image)"}],g=function(){return d},p=function(e){return c=s({scope:e,title:"Bild bearbeiten",templateUrl:"/views/modern/gallery/editmodal.jade",show:!1}),f()},f=function(){return c},m=function(n,t,r){return n.$scope.imageBlocks=t,n.$scope.selects=h(t,r),n.$scope.selects.length>0&&(e.selectedContentBlock=n.$scope.selects[0].value),e.$watch("selectedContentBlock",function(e,n){l.debug("selected changed to",e)}),n},v=function(n,t,r,o,i,a){angular.isUndefined(o)&&(o={thumbnail:{width:300},rescrop:{width:1200,cropwidth:1200,cropheight:1200}});var c={url:"gallery/upload",removeAfterUpload:!0,headers:{options:JSON.stringify(o)}};return n.uploader=new u(c),n.uploader.filters.push({name:"imageFilter",fn:function(e,n){var t="|"+e.type.slice(e.type.lastIndexOf("/")+1)+"|";return-1!=="|jpg|png|jpeg|bmp|gif|".indexOf(t)}}),angular.isFunction(a)&&(n.uploader.onComplete=a),n.uploader.onCompleteItem=function(n,t,r,o){l.debug("[GalleryService.uploader.onCompleteItem]",n,t,r,o),t.files.forEach(function(n,t,r){var o=e.selectedContentBlock,i=uploadModal.$scope.imageBlocks,a=i[o];l.debug("[GalleryService.$scope.uploader.onCompleteItem] selected",o,"imageBlocks",i,"currentImages",a);var u=0;a.length>0&&(u=a[a.length-1].position),e.authenticated&&e.pop("success","Ein Bild wurde hochgeladen",n.original.name),"undefined"==typeof n.position&&(u++,n.position=u,n.content=o),l.debug("[GalleryService.$scope.uploader.onCompleteItem] file",n),a.push(n)})},n.upload=function(e,n){e.image=n,e.upload()},uploadModal=s({scope:n,title:"Bilder hinzufügen",uploader:n.uploader,templateUrl:"/views/modern/gallery/uploadimagesmodal.jade",show:!1}),uploadModal=m(uploadModal,t,r),angular.isFunction(i)?i(b()):b()},h=function(e,n){var t=Object.keys(e),r=[];return t.forEach(function(e,t,o){var i=a.getByName(n,e).title||e;r.push({label:i,value:e})}),r},b=function(){return uploadModal},$=function(e,n,t,r){return e.page&&""!==e.page||(e.page=n),e.content&&""!==e.content||(e.content=t),angular.isFunction(r)?r(null,e):e},S=function(e,t,r,o){e=$(e,t,r);var i=["Bild konnte nicht gespeichert werden"];n.put("/gallery/"+e.id,e).success(function(e,n,t,r){angular.isArray(e)&&(e=e[0]),angular.isFunction(o)&&o(null,e)}).error(function(e,n,t,r){l.error(i[0],e),angular.isFunction(o)&&o(i[0],e)})},y=function(e,n,r){var o=Object.keys(e);t.map(o,function(t,r){w(e[t],n,t,r)},r)},w=function(e,n,r,o){t.map(e,function(e,t){S(e,n,r,t)},o)},k=function(e,t,r,o,a){("undefined"==typeof t||null===t)&&(t=e.indexOf(r)),e=i.remove(e,t,r),r.id?n["delete"]("/gallery/"+r.id+"?filename="+r.original.name+"&page="+o,{id:r.id,filename:r.original.name,page:o}).success(function(n,t,r,o){angular.isFunction(a)&&a(null,e)}).error(function(e,n,t,r){l.error(errors[0],e),angular.isFunction(a)&&a(e)}):angular.isFunction(a)&&a(null,e)},F=function(e,n,t){uploadModal.$promise.then(uploadModal.show),uploadModal=m(uploadModal,e,n),uploadModal.$scope.$on("modal.hide",function(){l.debug("upload modal closed"),angular.isFunction(t)&&t(null)})},B=function(e,n,t){return e[n.name]=[],angular.isFunction(t)?t(null,e[n.name]):e[n.name]},A=function(e,n){l.debug("edit",e),c.$scope.image=e,c.$promise.then(c.show),c.$scope.$on("modal.hide",function(){l.debug("edit closed"),angular.isFunction(n)&&n(null,c.$scope.image)})},O=function(n,t){var r,o,i,a,u=0,s=0;return $scope.isFullScreen(n)?(i=n.original.width/n.original.height,a=e.getWindowDimensions(),a.width/a.height<i?(t=a.width,o=n.original.width/t,r=n.original.height/o,u=(a.height-r)/2,r=a.height):(r=a.height,o=n.original.height/r,t=n.original.width/o,s=(a.width-t)/2,t=a.width),{width:t+"px",height:r+"px","padding-right":s+"px","padding-left":s+"px","padding-top":u+"px","padding-bottom":u+"px"}):(o=n.original.width/t,r=n.original.height/o,{width:t+"px",height:r+"px"})},j=function(){n.subscribe("gallery",function(n){switch(l.debug(n),n.verb){case"updated":e.authenticated&&l.debug("success","Ein Bild wurde aktualisiert",n.data.original.name);break;case"created":e.authenticated&&e.pop("success","Ein Bild wurde hochgeladen",n.data.original.name),$scope.images.push(n.data);break;case"removedFrom":e.authenticated&&e.pop("success","Ein Bild wurde entfernt",""),l.debug(n.data);break;case"destroyed":l.debug(n.data);break;case"addedTo":e.authenticated&&e.pop("success","Ein Bild wurde hinzugefügt",""),l.debug(n.data)}})},E=function(e,t){var o="/gallery?limit=0&page="+e;return t&&(o=o+"&content="+t),n.get(o).then(function(e){return r("orderBy")(e.data,"position")},function(e){l.error(e)})};return{getDropdown:g,setEditModal:p,getEditModal:f,setUploadModal:v,getUploadModal:b,saveOne:S,saveAll:w,saveAllBlocks:y,remove:k,add:F,addBlock:B,edit:A,aspect:O,subscribe:j,resolve:E}}]),"undefined"==typeof jumplink)var jumplink={};angular.module("jumplink.cms.history",["ui.router"]).service("HistoryService",["$window","$location","$state","$anchorScroll","$timeout","$log",function(e,n,t,r,o,i){var a=[],u=function(e,n){a.push({state:e,params:n})},s=function(){return a},l=function(e){if(i.debug("[jumplink.cms.history.HistoryService], history.length",a.length,"step",e,"history.length + step =",a.length+e),a.length+e<=0)return n.path("/");var r=this.previous(e||-1);return t.go(r.state,r.params)},c=function(e){return a[a.length-Math.abs(e||1)]},d=function(){return this.go(-1)},g=function(e){n.hash(e),r.yOffset=60,r()},p=function(){var e=n.hash();e?o(function(){g(e)},1e3):r()};return{push:u,all:s,go:l,previous:c,back:d,goToHashPosition:g,autoScroll:p}}]).run(["HistoryService","$state","$rootScope",function(e,n,t){t.$on("$stateChangeSuccess",function(n,t,r,o,i){o["abstract"]||e.push(o,i)}),console.log(e),e.push(n.current,n.params)}]),angular.module("jumplink.cms.info",["sails.io"]).service("CmsService",["$log","$sailsSocket",function(e,n){var t=function(t,r){var o=["[CmsService] Error: On trying to get cms info, url: "+t,"[CmsService] Error: Result is null, url: "+t],i=["[CmsService] Warn: Request has more than one results, url: "+t];return n.get(t).then(function(n){return angular.isUndefined(n)||angular.isUndefined(n.data)?angular.isFunction(r)?r(o[1]):null:(n.data instanceof Array&&(n.data=n.data[0],e.warn(i[0])),angular.isFunction(r)?r(null,n.data):n.data)},function(n){return e.error(o[0],n),angular.isFunction(r)?r(o[0],n):n})},r=function(e){return t("/cms/infouser",e)},o=function(e){return t("/cms/infoadmin",e)};return{infoUser:r,infoAdmin:o}}]),angular.module("jumplink.cms.multisite",["sails.io","jumplink.cms.sails"]).service("MultisiteService",["$rootScope","JLSailsService","$log",function(e,n,t){var r=function(e,t){var r={method:"get",resultIsArray:!0};return n.resolve("/multisite/find",e,r,t)},o=function(e,t){var r={method:"get",resultIsArray:!0};return n.resolve("/multisite/findnames",e,r,t)},i=function(e,t){var r={method:"get",resultIsArray:!0};return n.resolve("/multisite/findhosts",e,r,t)};return{resolve:r,resolveNames:o,resolveHosts:i}}]),angular.module("jumplink.cms.routes",["sails.io","jumplink.cms.sails","mgcrea.ngStrap","jumplink.cms.sortable","ngFocus","jumplink.cms.utilities"]).filter("showOnlyMainRoutes",function(){return function(e,n){if(n!==!0)return e;for(var t=[],r=0;r<e.length;r++)e[r].main===!0&&t.push(e[r]);return t}}).service("RoutesService",["$rootScope","JLSailsService","$log","SortableService",function(e,n,t,r){var o=function(e){return e&&e.match||(e.match=""),e&&e.title||(e.title=""),e.main||(e.main=!1),e&&e.state||(e.state={}),e&&e.url||(e.url=""),e&&e.alternativeUrls||(e.alternativeUrls=[]),e.state.name||(e.state.name=""),e.state.customstate||(e.state.customstate=!1),e.state.url||(e.state.url=""),e.state.views||(e.state.views=""),e.state.resolve||(e.state.resolve=""),e&&e.fallback||(e.fallback={}),e.fallback.url||(e.fallback.url=""),e},i=function(e,n,i){n=o(n),t.debug("[RoutesService] data",n),r.append(e,n,i)},a=function(e,n,t,o){return r.swap(contents,n,t,o)},u=function(e,n,t){return r.moveForward(e,n,t)},s=function(e,n,t){return r.moveBackward(e,n,t);
},l=function(e,n,t,o){return angular.isFunction(o)?r.remove(e,n,t,o):r.remove(e,n,t)},c=function(e,r,o,i){if((angular.isUndefined(o)||null===o)&&angular.isDefined(r)&&(o=e[r]),(angular.isUndefined(r)||null===r)&&(r=e.indexOf(o)),e=l(e,r,o),o.id){t.debug("[RoutesService.remove] remove from server, too",o);var a={method:"delete",resultIsArray:!1};return n.resolve("/routes/destroy/"+o.id,{id:o.id},a,i)}},d=function(e,t){var r={method:"post",resultIsArray:!0};return n.resolve("/routes/find",e,r,t)},g=function(e,t){var r={method:"post",resultIsArray:!0};return n.resolve("/Routes/findByHost",e,r,t)},p=function(e,r){t.debug("[RoutesService.updateOrCreate]",e);var o={method:"post",resultIsArray:!1};return n.resolve("/Routes/updateOrCreate",{route:e},o,r)},f=function(e,r,o){t.debug("[RoutesService.updateOrCreateByHost]",e,r);var i={method:"post",resultIsArray:!1};return n.resolve("/Routes/updateOrCreateByHost",{host:e,route:r},i,o)},m=function(e,r){t.debug("[RoutesService.updateOrCreateEach]",e);var o={method:"post",resultIsArray:!0};return n.resolve("/Routes/updateOrCreateEach",{routes:e},o,r)},v=function(e,r,o){t.debug("[RoutesService.updateOrCreateEachByHost]",e,r);var i={method:"post",resultIsArray:!0};return n.resolve("/Routes/updateOrCreateEachByHost",{host:e,routes:r},i,o)};return{create:o,append:i,swap:a,moveForward:u,moveBackward:s,removeFromClient:l,remove:c,destroy:c,find:d,findByHost:g,updateOrCreate:p,updateOrCreateByHost:f,updateOrCreateEach:m,updateOrCreateEachByHost:v,saveEachByHost:v}}]),angular.module("jumplink.cms.sails",["sails.io"]).service("JLSailsService",["$rootScope","$sailsSocket","$q","$log",function(e,n,t,r){var o=function(e,o,i,a,u){var s=t.defer(),l=["On trying to resolve "+e,"Request has more than one results","No result"];return angular.isUndefined(i)&&(i={}),angular.isUndefined(i.method)&&(i.method="get"),angular.isUndefined(i.resultIsArray)&&(i.resultIsArray=!1),angular.isUndefined(o)&&(o={}),n[i.method](e,o).then(function(e){return angular.isUndefined(e)||angular.isUndefined(e.data)?angular.isFunction(a)?a(null,null):s.resolve(null):(!i.resultIsArray&&e.data instanceof Array&&(e.data=e.data[0],r.warn(l[1])),u&&(e.data=u(e.data)),angular.isFunction(a)&&a(null,e.data),s.resolve(e.data))},function(e){return r.error(l[0],e),angular.isFunction(a)?a(l[0],e):s.reject(l[0])}),s.promise};return{resolve:o}}]),angular.module("jumplink.cms.session",["sails.io","jumplink.cms.sails"]).service("SessionService",["$rootScope","JLSailsService","$sailsSocket","$q","$log",function(e,n,t,r,o){var i=function(e,t){o.debug("[SessionService.create]",e);var r={method:"post",resultIsArray:!1};return n.resolve("/session/create",e,r,t)},a=function(e,t){o.debug("[SessionService.destroy]",e);var r={method:"post",resultIsArray:!1};return n.resolve("/session/destroy",e,r,t)},u=function(e){o.log("[SessionService.isauthenticated]");r.defer();return t.get("/session/authenticated").then(function(n){return angular.isFunction(e)?e(null,n.data):n.data})},s=function(){o.log("[SessionService.needToBeAuthenticated] authenticated");var e=r.defer();return t.get("/session/authenticated").then(function(n){return n.data?(o.log("is authenticated",n),e.resolve(n.data)):(o.log("is not authenticated",n),e.reject("You need to be logged in"))}),e.promise},l=function(e){o.log("[SessionService.bloggerOrBetter]");r.defer();return t.get("/session/bloggerOrBetter").then(function(n){return angular.isFunction(e)?e(null,n.data):n.data})},c=function(e){o.log("[SessionService.developerOrBetter]");r.defer();return t.get("/session/developerOrBetter").then(function(n){return angular.isFunction(e)?e(null,n.data):n.data})},d=function(e){o.log("[SessionService.siteadminOrBetter]");r.defer();return t.get("/session/siteadminOrBetter").then(function(n){return angular.isFunction(e)?e(null,n.data):n.data})},g=function(e){o.log("[SessionService.superadmin]");r.defer();return t.get("/session/superadmin").then(function(n){return angular.isFunction(e)?e(null,n.data):n.data})},p=function(e){o.log("[SessionService.employee]");r.defer();return t.get("/session/employee").then(function(n){return angular.isFunction(e)?e(null,n.data):n.data})},f=function(e){o.log("[SessionService.employee]");r.defer();return t.get("/session/employeeOrBetter").then(function(n){return angular.isFunction(e)?e(null,n.data):n.data})},m=function(e){o.log("[SessionService.authenticated] authenticated");var n=r.defer();return t.get("/session/employeeOrBetter").then(function(e){return e.data?(o.log("is employeeOrBetter",e),n.resolve(e.data)):(o.log("is not employeeOrBetter",e),n.reject("You must be an employee or a user with more credentials to do that"))}),n.promise},v=function(e){o.log("[SessionService.authenticated] authenticated");var n=r.defer();return t.get("/session/siteadminOrBetter").then(function(e){return e.data?(o.log("is siteadminOrBetter",e),n.resolve(e.data)):(o.log("is not employeeOrBetter",e),n.reject("You must be an admin or a user with more credentials to do that"))}),n.promise},h=function(e){o.log("[SessionService.getAllPolicies]");r.defer();return t.get("/session/getAllPolicies").then(function(n){return angular.isFunction(e)?e(null,n.data):n.data})},b=function(e){o.log("[SessionService.getUser]");r.defer();return t.get("/session/getUser").then(function(n){return angular.isFunction(e)?e(null,n.data):n.data})};return{create:i,destroy:a,authenticated:s,needToBeAuthenticated:s,isAuthenticated:u,bloggerOrBetter:l,developerOrBetter:c,siteadminOrBetter:d,superadmin:g,employee:p,employeeOrBetter:f,needToBeEmployeeOrBetter:m,needToBeSiteadminOrBetter:v,getAllPolicies:h,getUser:b}}]),angular.module("jumplink.cms.sidebar",["mgcrea.ngStrap.aside"]).directive("jlSidebar",["$compile","$window",function(e,n){return{restrict:"E",replace:!0,transclude:!0,templateUrl:"/views/modern/sidebar.jade",scope:{routes:"=",title:"="},link:function(e,n,t){}}}]),angular.module("jumplink.cms.sortable",["jumplink.cms.utilities"]).service("SortableService",["UtilityService","$log",function(e,n){var t=function(e){for(var n=e.length-1;n>=0;n--)e[n].position=n+1;return e},r=function(e,n,t,r){var o=e[n],i=e[t],a=o.position;return o.position=i.position,i.position=a,e[n]=i,e[t]=o,angular.isFunction(r)?r(null,e):e},o=function(e,r,o,i){if(n.debug("[SortableService] move"),o>=e.length)for(var a=o-e.length;a--+1;)e.push(void 0);return e.splice(o,0,e.splice(r,1)[0]),e=t(e),angular.isFunction(i)&&i(null,e),e},i=function(n,t,r,o,i){var a,u=["Unique key '"+i+"' already exist"],s=n.length,l=1,c=-1,d=function(e,n,t,r){return n.push(e),angular.isFunction(r)?r(null,n,t):n},g=function(e,n,t,r){return angular.isFunction(r)?r(e,n,t):e};return s>=1&&(l=n[s-1].position+1),a={position:l},angular.extend(a,t),o&&a[i]?(c=e.findKeyValue(n,i,a[i]),c>-1?g(u[0],n,c,r):d(a,n,s,r)):d(a,n,s,r)},a=function(e,t,r,o,a,u){var s=["[SortableService] Error: Function parameters not correctly set"],c=function(){return n.error(s[0],e,t,r,o),a(s[0])};null===e?e=r[t]:null===t?t=r.indexOf(e):c(),angular.isArray(r)&&angular.isArray(o)||c(),i(o,e,function(n,o,i){return n?a(n):void l(r,t,e,function(e,n){return e?a(e):a(null,{index_from:t,array_from:n,index_to:i,array_to:o})})},!1)},u=function(e,n,t){return e+1<n.length?r(n,e,e+1,t):angular.isFunction(t)?t("Can't move forward, index is the last element.",n):n},s=function(e,n,t){return e-1>=0?r(n,e,e-1,t):angular.isFunction(t)?t("Can't move backward, index is the first element.",n):n},l=function(e,n,t,r){return("undefined"==typeof n||null===n)&&(n=e.indexOf(t)),n>-1&&e.splice(n,1),angular.isFunction(r)?r(null,e):e},c=function(e,t,r,i,a,u){u||(u=o);var s=e.indexOf(r),l=e[t];return n.debug("[SortableService] dropMove, dragObject:",r,"dragObjectIndex",s,"dropObject",l,"dropObjectIndex",t),u(e,s,t,a)};return{resetPosition:t,swap:r,moveObjectToAnotherArray:a,move:o,moveForward:u,moveBackward:s,remove:l,append:i,dropMove:c}}]),angular.module("jumplink.cms.bootstrap.signin",["mgcrea.ngStrap","jumplink.cms.signin"]).service("SigninBootstrapService",["$rootScope","SigninService","$log","$modal",function(e,n,t,r){var o=function(e,o,i,a,u){t.debug("[SigninBootstrapService.siginWithModal]",e,o,i),angular.isFunction(o)&&!angular.isFunction(u)&&(u=o,o=!1),angular.isFunction(i)&&!angular.isFunction(u)&&(u=i,i=!1),angular.isFunction(a)&&!angular.isFunction(u)&&(u=a,a=null);var s=r({title:e,templateUrl:"/views/modern/signin.bootstrap.modal.jade",show:!1});s.$scope.aborted=!1,s.$scope.result=null,s.$scope.user={email:"",password:""},s.$scope.abort=function(e){s.$scope.aborted=!0},s.$scope.signin=function(e){t.debug("[SigninBootstrapService.siginWithModal.signin]",e),n.signin(e,o,i,a,function(e,n){return e?(s.$scope.error=e,s.$scope.error):(s.$scope.result=n,void t.debug(n))})},s.$scope.$on("modal.hide",function(){t.debug("signin modal closed"),angular.isFunction(u)&&u(s.$scope.error,s.$scope.result,s.$scope.user)}),s.$promise.then(s.show)};return{siginWithModal:o}}]),angular.module("jumplink.cms.signin",["jumplink.cms.session","jumplink.cms.history","ngAsync"]).service("SigninService",["SessionService","$log","HistoryService","$async",function(e,n,t,r){var o=function(r,o,i,a,u){angular.isFunction(o)&&!angular.isFunction(u)&&(u=o,o=!1),angular.isFunction(i)&&!angular.isFunction(u)&&(u=i,i=!1),angular.isFunction(a)&&!angular.isFunction(u)&&(u=a,a=null),n.debug("[SigninService.signin]",r),e.create(r,function(s,l){return s?u(s):l.authenticated?(i===!0&&e.getAllPolicies(function(e,r){return e?u(e):(n.debug("scope before extend",a),angular.extend(a,r),n.debug("scope after extend",a),void(o===!0&&t.back()))}),o===!0&&t.back(),n.debug("[SigninService.signin]",r),n.debug("[SigninService.signin] err result",s,l),u(null,l)):null})};return{signin:o}}]),angular.module("jumplink.cms.subnavigation",["mgcrea.ngStrap","sails.io","jumplink.cms.sortable","ngFocus","jumplink.cms.utilities"]).service("SubnavigationService",["$rootScope","$window","$log","$sailsSocket","$filter","$modal","SortableService","UtilityService","focus",function(e,n,t,r,o,i,a,u,s){var l=null,c=function(e){return l=i({scope:e,title:"Navigation bearbeiten",templateUrl:"/views/modern/editsubnavigationmodal.jade",show:!1}),d()},d=function(){return l},g=function(){r.subscribe("navigation",function(n){switch(t.debug("[SubnavigationService] Navigation event!",n),n.verb){case"updated":e.authenticated&&e.pop("success","Navigation wurde aktualisiert",n.id)}})},p=function(){angular.element(n).imagesLoaded(function(){angular.element(n).triggerHandler("resize")})},f=function(e){return e&&e.target||(e.target=""),e&&e.name||(e.name=""),e&&e.page||cb("Page not set."),e},m=function(e,n,t){n=f(n),a.append(e,n,t)},v=function(e,n,t,r){return a.swap(contents,n,t,r)},h=function(e,n,t){return a.moveForward(e,n,t)},b=function(e,n,t){return a.moveBackward(e,n,t)},$=function(e,n){if(l.$scope.navs=e,l.$promise.then(l.show),angular.isDefined(l.$scope.navs)&&l.$scope.navs.length>0){var t=Number(l.$scope.navs.length-1);s("subnavigationeditname"+t)}l.$scope.$on("modal.hide",function(){n(null,l.$scope.navs)})},S=function(e,n,t,r){return angular.isFunction(r)?a.remove(e,n,t,r):a.remove(e,n,t)},y=function(e,n,o,i,a){(angular.isUndefined(o)||null===o)&&angular.isDefined(n)&&(o=e[n]),(angular.isUndefined(n)||null===n)&&(n=e.indexOf(o)),e=S(e,n,o),o.id&&(t.debug("[SubnavigationService] remove from server, too",o),r["delete"]("/navigation/"+o.id+"?page="+i,{id:o.id,page:i}).success(function(n,t,r,o){return angular.isFunction(a)?a(null,e):void 0}).error(function(e,n,r,o){return t.error(errors[0],e),angular.isFunction(a)?a(e):void 0}))},w=function(e,n,r,o){t.debug("[SubnavigationService] remove subnavigation by target "+n);var i=u.findKeyValue(e,"target",n);i>-1?(t.debug("[SubnavigationService] subnavigation found "+i),y(e,i,null,r,o)):angular.isFunction(o)&&o("Subnavigation not found")},k=function(e,n,r,o){return angular.isDefined(n.name)&&angular.isString(n.name)&&""!==n.name?e.push(n):t.warn("Name not set, remove Subnavigation"),angular.isFunction(o)?o(null,e):e},F=function(e,n){for(var t=[],r=e.length-1;r>=0;r--)t=k(t,e[r],r);return angular.isFunction(n)?n(null,t):t},B=function(n,t,i){F(n,function(n,a){r.put("/navigation/replaceall",{navs:a,page:t}).success(function(n,t,r,u){if(null!==n&&"undefined"!=typeof n)a=o("orderBy")(n,"position"),angular.isFunction(i)&&i(null,a);else{var s="Navigation konnte nicht gespeichert werden";e.pop("error",s,""),angular.isFunction(i)&&i(s,a)}})})},A=function(e){return r.get("/navigation?page="+e,{page:e}).then(function(n){return angular.isUndefined(n)||angular.isUndefined(n.data)?(t.warn("Warn: On trying to resolve "+e+" navs!","Not found, navigation is empty!"),null):(n.data=o("orderBy")(n.data,"position"),t.debug("[SubnavigationService]",n),n.data)},function(n){t.error("[SubnavigationService] Error: On trying to resolve "+e+" navs!",n)})};return{resizeOnImagesLoaded:p,subscribe:g,setEditModal:c,getEditModal:d,create:f,append:m,add:m,swap:v,moveForward:h,moveBackward:b,edit:$,removeFromClient:S,remove:y,removeByTarget:w,save:B,resolve:A}}]),angular.module("jumplink.cms.theme",["sails.io","ngAsync","jumplink.cms.sails"]).service("ThemeService",["$rootScope","$sailsSocket","$log","$async","JLSailsService",function(e,n,t,r,o){var i=!1,a=function(e,n){t.debug("[ThemeService.find]",e);var r={method:"get",resultIsArray:!0};return o.resolve("/theme/find",e,r,n)},u=function(e,n){var t={method:"post",resultIsArray:!0};return o.resolve("/theme/findbyhost",{host:e},t,n)},s=function(e,n){l(e,function(e,t){angular.isDefined(n)&&n(e,t)})},l=function(e,n){t.debug("[ThemeService.updateOrCreateEach]",e);var r={method:"post",resultIsArray:!0};return o.resolve("/Theme/updateOrCreateEach",{themes:e},r,n)},c=function(e,n,t){var r={method:"post",resultIsArray:!0};return o.resolve("/Theme/updateOrCreateEachByHost",{host:e,themes:n},r,t)},d=function(){i||(n.subscribe("theme",function(n){switch(e.authenticated&&t.debug(n),n.verb){case"updated":e.authenticated&&e.pop("success","Themeeinstellungen wurdne aktualisiert",n.data);break;case"created":e.authenticated&&e.pop("success","Themeeinstellungen wurden erstellt",n.data);break;case"removedFrom":e.authenticated&&e.pop("success","Themeeinstellungen wurden entfernt","");break;case"destroyed":e.authenticated&&e.pop("success","Themeeinstellungen wurden gelöscht","");break;case"addedTo":e.authenticated&&e.pop("success","Themeeinstellungen wurden hinzugefügt","")}}),i=!0)};return{find:a,findByHost:u,save:s,updateOrCreateEach:l,updateOrCreateEachByHost:c,subscribe:d}}]),angular.module("jumplink.cms.toolbar",["FBAngular"]).directive("jlToolbar",["$compile","$window",function(e,n){return{restrict:"E",templateUrl:"/views/modern/toolbar.jade",scope:{routes:"=",title:"=",shorttitle:"=",fluid:"=",position:"=",filter:"="},link:function(e,n,t){},controller:["$scope","$log","Fullscreen",function(e,n,t){e.fullscreenIsSupported=t.isSupported(),e.isFullscreen=!1,n.debug("[jumplink.cms.toolbar.jlToolbar.controller]",e),t.$on("FBFullscreen.change",function(n,t){e.isFullscreen=t===!0}),e.toggleFullscreen=function(){t.isEnabled()?t.cancel():t.all()}}]}}]),angular.module("jumplink.cms.user",["sails.io","jumplink.cms.sails"]).service("UserService",["$rootScope","$sailsSocket","$log","JLSailsService",function(e,n,t,r){var o=!1,i=function(e,r){angular.isString(e.role)||(e.role="siteadmin"),angular.isDefined(e.id)?(t.debug("update user: sailsSocket.put('/user/"+e.id+"..'"),n.put("/user/"+e.id,e).success(function(e,n,o,i){t.debug(e,n,o,i),angular.isDefined(e)&&angular.isDefined(e.password)&&delete e.password,r(null,e,n,o,i)})):(t.debug("create user: sailsSocket.post('/user.."),n.post("/user",e).success(function(e,n,o,i){t.debug("data",e,"status",n,"headers",o,"config",i),angular.isDefined(e)&&angular.isDefined(e.password)&&delete e.password,r(null,e,n,o,i)}))},a=function(){o||(n.subscribe("user",function(n){switch(e.authenticated&&t.debug(n),n.verb){case"updated":e.authenticated&&e.pop("success","Ein Benutzer wurde aktualisiert",n.data.name);break;case"created":e.authenticated&&e.pop("success","Ein Benutzer wurde erstellt",n.data.name);break;case"removedFrom":e.authenticated&&e.pop("success","Ein Benutzer wurde entfernt","");break;case"destroyed":e.authenticated&&e.pop("success","Ein Benutzer wurde gelöscht","");break;case"addedTo":e.authenticated&&e.pop("success","Ein Benutzer wurde hinzugefügt","")}}),o=!0)},u=function(e,n){var r=e.indexOf(n);t.debug("removeFromClient",n,r),r>-1&&e.splice(r,1)},s=function(r,o){t.debug("$scope.remove",o),e.authenticated&&(r.length<=1?t.error("Der letzte Benutzer kann nicht gelöscht werden."):(u(r,o),o.id&&n["delete"]("/user/"+o.id,{id:o.id}).success(function(e,n,r,o){t.debug("user delete request",e,n,r,o)})))},l=function(e,n){var t={method:"post",resultIsArray:!0};return r.resolve("/user/findbyhost",{host:e},t,n)},c=function(e,n,o){t.debug("[UserService.updateOrCreateByHost]",e,routes);var i={method:"post",resultIsArray:!1};return r.resolve("/user/updateOrCreateByHost",{host:e,user:n},i,o)};return{save:i,subscribe:a,remove:s,findByHost:l,updateOrCreateByHost:c}}]),angular.module("jumplink.cms.utilities",[]).service("UtilityService",["$log",function(e){var n=function(e){for(var n=[],t=e.length-1;t>=0;t--)n.push(e[t]);return n},t=function(e,n,t){for(var r=-1,o=e.length-1;o>=0&&-1>=r;o--)e[o][n]===t&&(r=o);return r},r=function(e){return e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()},o=function(e){return e.charAt(0).toLowerCase()+e.slice(1)};return{invertOrder:n,findKeyValue:t,capitalizeFirstLetter:r,lowercaseFirstLetter:o}}]);
//# sourceMappingURL=jumplink-cms-angular.js.map

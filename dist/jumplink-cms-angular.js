if(angular.module("jumplink.cms.admin",["sails.io"]).directive("adminbar",["$compile","$window","$sailsSocket","$state",function(e,t,n,r){return{restrict:"E",templateUrl:"/views/modern/adminbar.jade",scope:{upload:"=?",download:"=?",toogleHtml:"=?",refresh:"=?",save:"=?",add:"=?",addDropdown:"=?",addDropdownActions:"=?",adminSettingDropdown:"=?",authenticated:"=?",allowActions:"=?"},link:function(e,t,n){e.goToState=r.go,angular.isUndefined(e.adminSettingDropdown)&&(e.adminSettingDropdown=[{text:'<i class="fa fa-list"></i>&nbsp;Übersicht',click:"goToState('layout.administration')"},{text:'<i class="fa fa-users"></i>&nbsp;Benutzer',click:"goToState('layout.users')"},{text:'<i class="fa fa-sign-out"></i>&nbsp;Abmelden',click:"$root.logout()"}])}}}]),angular.module("jumplink.cms.bootstrap.attachment",["jumplink.cms.attachment"]).directive("jlAttachmentBootstrap",["$compile","$window","mediumOptions","AttachmentService",function(e,t,n,r){return{restrict:"E",templateUrl:"/views/modern/attachment.bootstrap.jade",scope:{attachment:"=",attachmentIndex:"=",parent:"=",path:"=",authenticated:"=",destroy:"=",centerImage:"="},link:function(e,t,n){console.log("[jlAttachmentBootstrap.link]",e)},controller:["$scope","AttachmentService",function(e,t){e.open=t.open}]}}]),angular.module("jumplink.cms.attachment",["sails.io"]).service("AttachmentService",["moment","$sailsSocket","$async","$log","$window",function(e,t,n,r,o){var i=function(e,t){o.open(e,t)},a=function(e,t,n,r){return e[t].attachments.length>0&&e[t].attachments.splice(n,1),r(null,e,t,n)},s=function(e,n,o,i){t.put("/blog/destroyAttachment",{blogPostID:e[n].id,attachmentUploadedAs:e[n].attachments[o].uploadedAs}).success(function(e,t,n,o){r.debug(null,e,t,n,o),i()}).error(function(e,t,n,o){r.error(e,t,n,o),i("error",e,t,n,o)})},u=function(e,t,n,o){var i=e.indexOf(t);return r.debug("[BlogService.destroy]",e[i],n),s(e,i,n,function(t,r,s,u,l){return t?o(t,r,s,u,l):a(e,i,n,o)})};return{open:i,destroyLocally:a,destroyExternally:s,destroy:u}}]),angular.module("ngAsync",[]).service("$async",function(){return async.objectMap=function(e,t,n){var r,o=[],i=Object.keys(e);for(r=0;r<i.length;r+=1){var a={};a[i[r]]=e[i[r]],o[r]=a}this.map(o,t,function(e,t){if(e)return n(e);var o={};for(r=0;r<t.length;r+=1)o[i[r]]=t[r];return n(e,o)})},async}),angular.module("jumplink.cms.bootstrap.blog",["jumplink.cms.blog","mgcrea.ngStrap","angular-medium-editor","angularFileUpload","ngFocus"]).service("BlogBootstrapService",["$log","focus","BlogService","$modal","FileUploader",function(e,t,n,r,o){var i=null,a=null,s=null,u=function(e){a.$scope.blogPost=e,a.$promise.then(a.show)},l=function(t,l,c,d){angular.isString(s)||(s=c),i=r({title:"Blogpost bearbeiten",templateUrl:"/views/modern/blog/editmodal.bootstrap.jade",show:!1}),i.$scope.ok=!1,i.$scope.accept=function(e){i.$scope.ok=!0,e()},i.$scope.abort=function(e){i.$scope.ok=!1,e()},angular.isUndefined(l)&&(l={path:"assets/files/blog",thumbnail:{width:300,path:"assets/files/blog"},rescrop:{width:1200,cropwidth:1200,cropheight:1200}});var g={url:"blog/upload",removeAfterUpload:!0,headers:{options:JSON.stringify(l)}};return i.$scope.uploader=new o(g),i.$scope.openTypeChooserModal=u,angular.isFunction(d)&&(t.uploader.onComplete=d),i.$scope.uploader.onCompleteItem=function(t,n,r,o){e.debug("[BlogBootstrapService.onCompleteItem] fileItem",t,"response",n),angular.isArray(t.blogPost.attachments)||(t.blogPost.attachments=[]);for(var i=0;i<n.files.length;i++)t.blogPost.attachments.push(n.files[i])},i.$scope.uploader.onProgressItem=function(t,n){e.debug("[BlogBootstrapService.onProgressItem]",t,n)},i.$scope.upload=function(e,t){e.blogPost=t,e.upload()},a=r({title:"Typ wählen",templateUrl:"/views/modern/blog/typechoosermodal.bootstrap.jade",show:!1}),a.$scope.chooseType=n.chooseType,i.$scope.$on("modal.hide.before",function(t,r){return e.debug("edit closed",r.$scope.blogPost,r),r.$scope.ok?n.validate(r.$scope.blogPost,null,r.$scope.callback):void(r.$scope.callback&&r.$scope.callback("discarded",r.$scope.blogPost))}),p()},c=function(){return i},d=function(){return a},p=function(){return{editModal:c(),typeModal:d()}},g=function(n,r){e.debug("[BlogService.edit]",n),i.$scope.blogPost=n,i.$scope.callback=r,i.$scope.ok=!1,t("blogposttitle"),i.$promise.then(i.show)},f=function(e,t,r){t=n.create(t),g(t,r)};return{edit:g,update:g,createEdit:f,setModals:l,openTypeChooserModal:u}}]),angular.module("jumplink.cms.blog",["jumplink.cms.attachment","angularMoment","ngAsync","sails.io"]).service("BlogService",["moment","$sailsSocket","$async","$log","$filter","AttachmentService",function(e,t,n,r,o,i){var a=["news","other"],s=(i.destroyLocally,i.destroyExternally,i.destroy),u=function(e,t,n){return e.title?h(e,t,n):angular.isFunction(n)?n("Title not set",e):null},l=function(e,t){e.type=t},c=function(e,t,n){var r=e.indexOf(t);r>-1?(e.splice(r,1),angular.isFunction(n)&&n(null,e)):angular.isFunction(n)&&n("no blogPost on client site found to remove",e)},d=function(e,n,o){n.id?(r.debug("[jumplink.cms.blog.BlogService.destroy]",n),t["delete"]("/blog/"+n.id).success(function(t,r,i,a){c(e,n,o)})):c(e,n,o)},p=function(e){var t=!0;return o("orderBy")(e,"createdAt",t)},g=function(e){return e=p(e)},f=function(e,t,n){return e.push.apply(e,t),e=g(e),angular.isFunction(n)?n(null,e):e},m=function(e,t,n){return e.unshift(t),e=g(e),angular.isFunction(n)?n(null,e):e},v=function(t){return t&&t.createdAt||(t.createdAt=e()),t&&t.title||(t.title=""),t&&t.content||(t.content=""),t&&t.author||(t.author=""),t&&t.page||callback("Page not set."),t&&t.type||(t.type=a[0]),r.debug("[BlogService,create]",t),t},h=function(e,t,n){return angular.isUndefined(e.page)&&null!==t&&(e.page=t),e.name&&""!==e.name||(e.name=e.title.toLowerCase().replace(/[^a-z]+/g,"")),angular.isFunction(n)?n(null,e):e},b=function(e,t,n){for(var r=e.length-1;r>=0;r--)e[r]=h(e[r],t);return angular.isFunction(n)?n(null,e):e},S=function(e,t){return r.debug("[jumplink.cms.blog.BlogService.refresh]"),e=g(e),angular.isFunction(t)?t(null,e):e},$=function(e,n,o,i,a){var s=["BlogService: Can't save blogPost.","BlogService: Can't save blogPost, blogPost to update not found.","BlogService: Can't save blogPost, parameters undefind."];return r.debug("[BlogService.saveOne]",n),angular.isDefined(n)&&angular.isDefined(a)?(n=h(n,i),void(angular.isUndefined(n.id)?t.post("/blog",n).success(function(e,t,n,r){angular.isArray(e)&&(e=e[0]),a(null,e)}).error(function(e,t,n,o){return angular.isArray(e)&&(e=e[0]),r.error(e,t,n,o),a(s[0])}):t.put("/blog/"+n.id,n).success(function(e,t,n,r){return angular.isArray(e)&&(e=e[0]),a(null,e)}).error(function(e,t,n,o){return r.error(e,t,n,o),a(s[0])}))):a(s[2])},w=function(e,t,o){var i=["[BlogService.saveBlocks] Can't save blogPosts, parameters undefind."];if(angular.isDefined(e)&&angular.isDefined(o))n.map(e,function(n,r){$(e,n,null,t,r)},function(t,n){return t?o(t):(e=g(e),o(null,e))});else if(r.error(i[0]),angular.isFunction(o))return o(i[0])},y=function(e,t,n,r,o){angular.isDefined(t)?$(e,t,n,r,o):w(e,r,o)},k=function(e,n,o,i){return t.put("/blog/find",{page:e,limit:n,skip:o}).then(function(e){return e.data=g(e.data),angular.isFunction(i)?i(null,e.data):e.data},function(t){return r.error("Error on find "+e,t),angular.isFunction(i)?i(t):null})},F=function(e,n,o,i){return t.put("/blog/count",{page:e}).then(function(e){return angular.isFunction(i)?i(null,e.data.count):e.data.count},function(t){return r.error("Error on resolve "+e,t),angular.isFunction(i)?i(t):null})},B=function(){t.subscribe("blog",function(e){switch(r.debug(e),e.verb){case"updated":$rootScope.authenticated&&$rootScope.pop("success","Ein Blogpost wurde aktualisiert",e.data.title),findEvent(e.id,function(t,n,o,i){t?r.debug(t):n=e.data,$scope.refresh()});break;case"created":$rootScope.authenticated&&$rootScope.pop("success","Ein Blogpost wurde erstellt",e.data.title),$scope.blogPosts.push(e.data),$scope.refresh();break;case"removedFrom":$rootScope.authenticated&&$rootScope.pop("success","Ein Blogpost wurde entfernt",e.data.title),findEvent(e.id,function(e,t,n,o){e?r.debug(e):BlogService.removeFromClient($scope.blogPosts,t,n)});break;case"destroyed":$rootScope.authenticated&&$rootScope.pop("success","Ein Blogpost wurde gelöscht",e.data.title),findEvent(e.id,function(e,t,n,o){return e?(r.debug(e),e):void BlogService.removeFromClient($scope.blogPosts,t,n)});break;case"addedTo":$rootScope.authenticated&&$rootScope.pop("success","Ein Blogpost wurde hinzugefügt",e.data.title)}})};return{validate:u,subscribe:B,append:f,prepent:m,sort:p,transform:g,saveOne:$,saveBlocks:w,save:y,fixEach:b,find:k,resolve:k,count:F,refresh:S,chooseType:l,removeFromClient:c,remove:d,destroy:d,deleteAttachment:s,destroyAttachment:s,create:v}}]),angular.module("jumplink.cms.browser",[]).directive("jlBrowser",["$compile","$window",function(e,t){return{restrict:"E",templateUrl:"/views/modern/browser.bootstrap.jade",scope:{force:"="},link:function(e,t,n){}}}]),angular.module("jumplink.cms.config",["sails.io"]).service("ConfigService",["$sailsSocket","$filter","$log",function(e,t,n){var r=function(t){return e.get("/config/find").then(function(e){return e.data},function(e){n.error("Error on resolve "+t,e)})};return{resolve:r}}]),angular.module("jumplink.cms.bootstrap.content",["jumplink.cms.content"]).service("ContentBootstrapService",["$log","$async","ImportExportBootstrapService","UtilityService","ContentService","SortableService",function(e,t,n,r,o,i){var a=null,s=null,u=function(e){s=e},l=function(r,u){var l={},c=function(t,r){e.debug("[ContentBootstrapService.onCompleteFile]",r);for(var o=[],i=0;i<r.length;i++)o=o.concat(r[i].data);n.setImports(o,{identifierKey:"name",descriptionKey:"title"})},d=function(n,r){e.debug("[ContentBootstrapService.onImportStart]",s),t.map(n,function(e,t){e.importOptions.doImport===!0?o.updateOrCreateByHostByTitleAndPage(s,e,t):t()},function(t,n){e.debug("[ContentBootstrapService.onImportStart] done",t,n),n=i.sort(n),r(t,n)})},p=function(t,n){e.debug("[ContentBootstrapService.onAbort]"),n()};a=n.setModals(r,l,c,d,p,u)};return{setHost:u,setupImportModal:l,showImportModal:n.show}}]),angular.module("jumplink.cms.content",["mgcrea.ngStrap","angular-medium-editor","ui.ace","sails.io","jumplink.cms.sortable","ngFocus","jumplink.cms.utilities"]).service("ContentService",["$rootScope","$log","$sailsSocket","$filter","$modal","$download","JLSailsService","SortableService","UtilityService","focus","$async",function(e,t,n,r,o,i,a,s,u,l,c){var d=!1,p=null,g=function(){return d},f=function(e){return p=o({title:"Inhaltsblock bearbeiten",templateUrl:"/views/modern/contentmodal.jade",show:!1}),p.$scope.ok=!1,p.$scope.accept=function(e){p.$scope.ok=!0,e()},p.$scope.abort=function(e){p.$scope.ok=!1,e()},p.$scope.changeName=!1,p.$scope.$watch("content.title",function(e,t){p.$scope.changeName&&angular.isDefined(p.$scope.content)&&(p.$scope.content.name=I(e))}),p.$scope.$on("modal.hide.before",function(e,t){return t.$scope.changeName=!1,t.$scope.ok?j(t.$scope.content,t.$scope.callback):angular.isFunction(t.$scope.callback)?t.$scope.callback("discarded",t.$scope.content):void 0}),m()},m=function(){return p},v=function(){n.subscribe("content",function(n){switch(t.debug("Content event!",n),n.verb){case"updated":e.authenticated&&e.pop("success","Seite wurde aktualisiert",n.id)}})},h=function(e,t){return d=!d,d&&e&&(e=S(e)),angular.isFunction(t)?t(null,d):d},b=function(e,t){return e.content=html_beautify(e.content),angular.isFunction(t)?t(null,e):e},S=function(e,t){for(var n=e.length-1;n>=0;n--)e[n].content=b(e[n].content);return angular.isFunction(t)?t(null,e):e},$=function(e,t){var n=u.findKeyValue(e,"name",t);return n>-1?e[n]:null},w=function(e){return e&&e.content||(e.content=""),e&&e.title||(e.title=""),e&&e.name||(e.name=""),e&&e.type||(e.type="dynamic"),e&&e.page||t.error("[ContentService] Page not set."),e},y=function(e,t,n){s.append(e,t,n,!0,"name")},k=function(e,t,n){var r=w({page:t});C(r,n,!0)},F=function(e,t,n,r){return s.swap(e,t,n,r)},B=function(e,t,n){return s.moveForward(e,t,n)},O=function(e,t,n){return s.moveBackward(e,t,n)},j=function(e,t){return e.title?x(e,t):angular.isFunction(t)?t("Title not set",e):null},C=function(e,n,r){t.debug("edit",e),p.$scope.content=e,p.$scope.callback=n,r?p.$scope.changeName=r:p.$scope.changeName=!1,l("contentedittitle"),p.$promise.then(p.show)},A=function(e,t,n,r){return s.remove(t,e,r)},E=function(e,r,o,i,a){var u=["Content konnte nicht gelöscht werden."];return("undefined"==typeof r||null===r)&&(r=e.indexOf(o)),e=s.remove(e,r,o),o.id?(t.debug("remove from server, too",o),void n["delete"]("/content/"+o.id+"?page="+i,{id:o.id,page:i}).success(function(t,n,r,o){return angular.isFunction(a)?a(null,e):e}).error(function(e,n,r,o){return t.error(u[0],e),angular.isFunction(a)?a(e):e})):angular.isFunction(a)?a(null,e):e},U=function(e,n){N(e,function(e,r){return e?(t.error(e),angular.isFunction(n)?n(e):e):void S(r,function(e,r){return e?(t.error(e),angular.isFunction(n)?n(e):e):angular.isFunction(n)?n(null,r):r})})},I=function(e){var n="";return e&&""!==e&&(n=e.toLowerCase().replace(/[^a-z1-9]+/g,""),t.debug("set content.name to",n)),n},x=function(e,n){return angular.isDefined(e)?((angular.isUndefined(e.name)||""===e.name||null===e.name)&&(e.name=I(e.title)),angular.isNumber(e.position)||(e.position=0),e.type&&""!==e.type||(t.warn("Fix content type not set, set it to dynamic"),e.type="fix"),angular.isFunction(n)?n(null,e):e):angular.isFunction(n)?n("content not set"):null},N=function(e,t){for(var n=e.length-1;n>=0;n--)e[n]=x(e[n]);return angular.isFunction(t)?t(null,e):e},M=function(e,r,o){var i=["Inhalt konnte nicht gespeichert werden"];e.page=r,x(e,function(e,r){return e?angular.isFunction(o)?o(e):e:void n.put("/content/replace",r).success(function(e,n,a,s){return null!==e&&"undefined"!=typeof e?(r=e,angular.isFunction(o)?o(null,r):r):(t.error(i[0]),angular.isFunction(o)?o(i[0]):i[0])}).error(function(e,n,r,a){return t.error(i[0],e),angular.isFunction(o)?o(e):e})})},D=function(e,o,i){var a=["Seite konnte nicht gespeichert werden"];N(e,function(e,s){return e?angular.isFunction(i)?i(e):e:n.put("/content/replaceall",{contents:s,page:o}).success(function(e,n,o,u){return null!==e&&"undefined"!=typeof e?(s=r("orderBy")(e,"position"),angular.isFunction(i)?i(null,s):s):(t.error(a[0]),angular.isFunction(i)?i(a[0]):a[0])}).error(function(e,n,r,o){t.error(a[0],e),angular.isFunction(i)&&i(e)})})},P=function(e,n,r,o,i){c.parallel(o,function(e,o){return e?(t.error("Error: On save content!",e),n("error","Seiteninhalt konnte nichtgespeichert werden",e),angular.isFunction(i)?i(e):e):(r.applyResults&&(r.scope=angular.extend(r.scope,o)),n("success","Seiteninhalt wurde gespeichert",""),angular.isFunction(i)?i(null,o):o)})},R=function(e,r,o,i,a){var s=["Error: On trying to find one with page: "+e+", name: "+r,"request has more than one results"],u={page:e,name:r},l="/content/find";return angular.isDefined(o)&&null!==o&&(u.type=o),n.put(l,u).then(function(e){return angular.isUndefined(e)||angular.isUndefined(e.data)?null:(e.data instanceof Array&&(e.data=e.data[0],t.error(s[1])),a&&(e.data=a(e.data)),angular.isFunction(i)?i(null,e.data):e.data)},function(e){return t.error(s[0],e),angular.isFunction(i)?i(s[0],e):e})},T=function(e,o,i,a){var s=["Error: On trying to find all with page: "+e+" and type: "+o,"Warn: On trying to find all "+e+" contents! Not found, content is empty!"],u={},l="/content/findall";return angular.isDefined(e)&&null!==e&&(u.page=e),angular.isDefined(o)&&null!==o&&(u.type=o),n.put(l,u).then(function(e){return angular.isUndefined(e)||angular.isUndefined(e.data)?(t.warn(s[1]),null):(e.data=r("orderBy")(e.data,"position"),a&&(e.data=a(e.data)),angular.isFunction(i)?void i(null,e.data):e.data)},function(e){return t.error(s[0],e),angular.isFunction(i)?i(s[0],e):e})},H=function(e,t){var n={method:"post",resultIsArray:!0};return a.resolve("/Content/findByHost",e,n,t)},L=function(e,n,r){var o={method:"post",resultIsArray:!0};return a.resolve("/Content/exportByHost",{host:e},o,function(e,o){return t.debug("[ContentService.exportByHost]",e,o),e?(n&&i(JSON.stringify(o),"error.txt","text/plain"),r(e)):(n&&i(JSON.stringify(o),"content.json","text/json"),r(e,o))})},z=function(e,n,r){t.debug("[contentsService.updateOrCreateByHostByTitleAndPage]",e,n);var o={method:"post",resultIsArray:!1};return a.resolve("/Content/updateOrCreateByHostByTitleAndPage",{host:e,content:n},o,r)},q=function(e,o,i,a){var s=["Error: On trying to find all with page: "+e+" and type: "+o,"Warn: On trying to find all "+e+" contents! Not found, content is empty!"],u={page:e},l="/content/findAllWithImage?page="+e;return o&&(u.type=o,l=l+"&type="+o),n.get(l,u).then(function(e){return angular.isUndefined(e)||angular.isUndefined(e.data)?(t.warn(s[1]),null):(e.data.contents=r("orderBy")(e.data.contents,"position"),e.data.images=r("orderBy")(e.data.images,"position"),a&&(e.data=a(e.data)),angular.isFunction(i)?i(null,e.data):e.data)},function(e){return t.error(s[0],e),angular.isFunction(i)?i(s[0],e):e})},J=function(e,t,n,r,o){return angular.isDefined(t)?R(e,t,n,o):T(e,n,r,o)};return{subscribe:v,setEditModal:f,getShowHtml:g,toogleShowHtml:h,beautify:b,beautifyEach:S,create:w,createEdit:k,append:y,swap:F,moveForward:B,moveBackward:O,edit:C,removeFromClient:A,remove:E,refresh:U,fix:x,fixEach:N,save:D,saveOne:M,saveParallel:P,find:J,resolve:J,findOne:R,resolveOne:R,findAll:T,resolveAll:T,findByHost:H,exportByHost:L,updateOrCreateByHostByTitleAndPage:z,findAllWithImage:q,resolveAllWithImage:q,getByName:$}}]),angular.module("jumplink.cms.content.medium",["jumplink.cms.content","angular-medium-editor"]).value("mediumOptions",{buttonLabels:"fontawesome",toolbar:{buttons:["bold","italic","underline","anchor","h2","h3","h4","quote","orderedlist","unorderedlist"]}}).service("ContentMediumService",["$rootScope","$log","$sailsSocket","$filter","$modal","SortableService","UtilityService","focus",function(e,t,n,r,o,i,a,s){var u=function(){this.button=document.createElement("button"),this.button.className="medium-editor-action",this.button.innerText="Image",this.button.innerHTML='<i class="fa fa-picture-o"></i>',this.button.onclick=this.onClick.bind(this)};return u.prototype.onClick=function(){this.classApplier.toggleSelection()},u.prototype.getButton=function(){return this.button},u.prototype.checkState=function(e){"MARK"===e.tagName&&this.button.classList.add("medium-editor-button-active")},{Imager:u}}]).directive("jlContent",["$compile","$window","mediumOptions","ContentMediumService",function(e,t,n,r){return{restrict:"E",templateUrl:"/views/modern/content.jade",scope:{authenticated:"=",html:"=",content:"=?",mediumOptions:"=?",mediumBindOptions:"=?"},link:function(e,t,o){angular.isUndefined(e.mediumOptions)&&(e.mediumOptions=n),angular.isUndefined(e.mediumBindOptions)&&(e.mediumBindOptions={extensions:{image:new r.Imager}})}}}]).directive("jlContentBlocks",["$compile","$window","mediumOptions","ContentMediumService","SubnavigationService","HistoryService",function(e,t,n,r,o,i){return{restrict:"E",templateUrl:"/views/modern/contentBlocks.jade",scope:{authenticated:"=",html:"=",contents:"=",navs:"=?",afterRefresh:"=?",afterSave:"=?",afterRemove:"=?",afterEdit:"=?",afterAdd:"=?",subnavigation:"=?",afterSaveNav:"=?",afterRemoveNav:"=?",afterEditNav:"=?",afterAddNav:"=?",logger:"=",page:"=?",mediumOptions:"=?",mediumBindOptions:"=?"},link:function(e,t,n){},controller:["$rootScope","$scope","ContentService","$log","$state",function(e,t,n,r,a){n.setEditModal(t),o.setEditModal(t),t.goTo=i.goToHashPosition,n.subscribe(),o.subscribe(),angular.isUndefined(t.page)&&(t.page=a.current.name),angular.isUndefined(t.subnavigation)&&(t.subnavigation=!1),angular.isUndefined(t.afterRefresh)&&(t.afterRefresh=function(e,n){return e?t.logger("error","Inhaltsblock wurde nicht erneuert!",e):void t.logger("success","Inhaltsblock erneuert!","")}),angular.isUndefined(t.afterSave)&&(t.afterSave=function(e,n){return e?t.logger("error","Inhaltsblock wurde nicht gespeichert!",e):void t.logger("success","Inhaltsblock gespeichert!",n.title)}),angular.isUndefined(t.afterRemove)&&(t.afterRemove=function(e,n){return e?t.logger("error","Inhaltsblock wurde nicht entfernt!",e):void t.logger("success","Inhaltsblock entfernt!",n.title)}),angular.isUndefined(t.afterEdit)&&(t.afterEdit=function(e,n){return e?t.logger("error","Inhaltsblock wurde nicht bearbeitet!",e):void t.logger("success","Inhaltsblock bearbeitet!",n.title)}),angular.isUndefined(t.afterAdd)&&(t.afterAdd=function(e,n){return e?t.logger("error","Inhaltsblock wurde nicht hinzugefügt!",e):void t.logger("success","Inhaltsblock hinzugefügt!",n.title)}),angular.isUndefined(t.afterSaveNav)&&(t.afterSaveNav=function(e,n){return e?t.logger("error","Navigation wurde nicht gespeichert!",e):void t.logger("success","Navigation gespeichert!",n.title)}),t.add=function(){return t.authenticated?void n.createEdit(t.contents,t.page,function(e,r){return e?t.afterAdd(e):void n.append(t.contents,r,t.afterAdd)}):!1},t.moveForward=function(e,n){return t.authenticated?void SortableService.moveForward(e,t.contents,function(e,n){return e?(r.error("Error: On move content forward!",e),e):void(t.contents=n)}):!1},t.moveBackward=function(e,n){return t.authenticated?void SortableService.moveBackward(e,t.contents,function(e,n){return e?(r.error("Error: On move content backward!",e),e):void(t.contents=n)}):!1},t.edit=function(e,r){return t.authenticated?void n.edit(r,t.afterEdit):!1},t.remove=function(e,r){return t.authenticated?void n.remove(t.contents,e,r,t.page,t.afterRemove):!1},t.refresh=function(){n.refresh(t.contents,t.afterRefresh)},t.toggleHtml=function(e,t){t.html=t.html!==!0},t.save=function(){return t.authenticated?(n.save(t.contents,t.page,t.afterSave),void(t.subnavigation&&o.save(t.navs,t.page,t.afterSaveNav))):!1}}]}}]),Date.now||(Date.now=function(){return(new Date).getTime()}),function(){"use strict";for(var e=["webkit","moz"],t=0;t<e.length&&!window.requestAnimationFrame;++t){var n=e[t];window.requestAnimationFrame=window[n+"RequestAnimationFrame"],window.cancelAnimationFrame=window[n+"CancelAnimationFrame"]||window[n+"CancelRequestAnimationFrame"]}if(/iP(ad|hone|od).*OS 6/.test(window.navigator.userAgent)||!window.requestAnimationFrame||!window.cancelAnimationFrame){var r=0;window.requestAnimationFrame=function(e){var t=Date.now(),n=Math.max(r+16,t);return setTimeout(function(){e(r=n)},n-t)},window.cancelAnimationFrame=clearTimeout}}(),angular.module("ngDownload",[]).service("$download",["$log",function(e){return angular.isDefined(download)?download:(e.error("[ngDownload] download is not defined, please install it from https://github.com/rndme/download"),null)}]),angular.module("jumplink.cms.event",["mgcrea.ngStrap","angular-medium-editor","angularFileUpload","angularMoment","ngFocus","ngAsync","sails.io","jumplink.cms.utilities"]).service("EventService",["moment","UtilityService","$sailsSocket","$async","$log","focus","$modal","FileUploader",function(e,t,n,r,o,i,a,s){var u=null,l=null,c=null,d=function(e,t){return e.title?O(e,t):angular.isFunction(t)?t("Title not set",e):null},p=function(e,t,n){e.type=t,n()},g=function(e){l.$scope.event=e,l.$promise.then(l.show)},f=function(e,t,n){angular.isString(c)||(c=n),u=a({title:"Ereignis bearbeiten",templateUrl:"/views/modern/events/editmodal.jade",show:!1}),u.$scope.ok=!1,u.$scope.accept=function(e){u.$scope.ok=!0,e()},u.$scope.abort=function(e){u.$scope.ok=!1,e()},angular.isUndefined(t)&&(t={});var r={url:"timeline/upload",removeAfterUpload:!0,headers:{options:JSON.stringify(t)}};return u.$scope.uploader=new s(r),u.$scope.openTypeChooserModal=g,u.$scope.uploader.onCompleteItem=function(e,t,n,r){e.event.download=t.files[0].uploadedAs},u.$scope.uploader.onProgressItem=function(e,t){console.info("onProgressItem",e,t)},u.$scope.upload=function(e,t){e.event=t,e.upload()},l=a({title:"Typ wählen",templateUrl:"/views/modern/events/typechoosermodal.jade",show:!1}),l.$scope.chooseType=p,u.$scope.$on("modal.hide.before",function(e,t){return o.debug("edit closed",e,t),t.$scope.ok?d(t.$scope.event,t.$scope.callback):angular.isFunction(t.$scope.callback)?t.$scope.callback("discarded",t.$scope.event):void 0}),v()},m=function(){return l},v=function(){return{editModal:m(),typeModal:m()}},h=function(e,t,n){u.$scope.event=e,u.$scope.callback=n,u.$scope.ok=!1,i("eventtitle"),u.$promise.then(u.show)},b=function(t){for(var n=[],r=[],o=[],i=0;i<t.length;i++)angular.isDefined(t[i].to)&&(t[i].to=e(t[i].to)),angular.isDefined(t[i].from)?(t[i].from=e(t[i].from),t[i].from.isAfter()?o.push(t[i]):r.push(t[i])):n.push(t[i]);return{unknown:n,before:r,after:o}},S=function(e,t,n,r){var o=["no event on client site found to remove"],i=e[n].indexOf(t);return i>-1?(e[n].splice(i,1),angular.isFunction(r)?r(null,e):e):angular.isFunction(r)?r(o[0],e):o[0]},$=function(e,t,r,i){t.id?(o.debug(t),n["delete"]("/timeline/"+t.id).success(function(n,o,a,s){S(e,t,r,i)})):S(e,t,r,i)},w=function(e){return e=b(e),e.before=t.invertOrder(e.before),e},y=function(e,t,n){return angular.isUndefined(e)&&(e=[]),angular.isUndefined(t)&&(t=[]),angular.isUndefined(n)&&(n=[]),e.concat(t).concat(n)},k=function(e,t,n){e.unknown.push(t);var r=y(e.unknown,e.before,e.after);return e=w(r),angular.isFunction(n)?n(null,e):e},F=function(t){return t&&t.from||(t.from=e(),t.from.add(1,"hours"),t.from.minutes(0)),t&&t.title||(t.title=""),t&&t.person||(t.person=""),t&&t.place||(t.place=""),t&&t.page||callback("Page not set."),t},B=function(e,t,n){t=F(t),h(t,null,n)},O=function(e,t){return e.name&&""!==e.name||(e.name=e.title.toLowerCase().replace(/[^a-z]+/g,"")),angular.isFunction(t)?t(null,e):e},j=function(e,t){for(var n=e.length-1;n>=0;n--)e[n]=O(e[n]);return angular.isFunction(t)?t(null,e):e},C=function(e){var t=y(e.unknown,e.before,e.after);return e=w(t)},A=function(e,t,r,i){var a=["EventService: Can't save event.","EventService: Can't save event, event to update not found.","EventService: Can't save event, parameters undefind."];angular.isDefined(r)&&angular.isDefined(t)&&angular.isDefined(i)?(r=O(r),angular.isUndefined(r.id)?n.post("/timeline",r).success(function(n,o,s,u){angular.isArray(n)&&(n=n[0]);var l=e[t].indexOf(r);l>-1?(e[t][l]=n,i(null,e[t][l])):i(a[1])}).error(function(e,t,n,r){angular.isArray(e)&&(e=e[0]),o.error(e,t,n,r),i(a[0])}):n.put("/timeline/"+r.id,r).success(function(e,t,n,o){angular.isArray(e)&&(e=e[0]),r=e,i(null,r)}).error(function(e,t,n,r){o.error(e,t,n,r),i(a[0])})):i(a[2])},E=function(e,t,n){r.map(e[t],function(n,r){A(e,t,n,r)},n)},U=function(e,t){var n=["EventService: Can't save eventBlocks, parameters undefind."];return angular.isDefined(e)&&angular.isDefined(t)?r.map(["after","before","unknown"],function(t,n){E(e,t,n)},function(n,r){if(n&&(o.error(n),angular.isFunction(t)))return t(n);var i=y(r[0],r[1],r[2]);return e=w(i),t(null,e)}):(o.error(n[0]),angular.isFunction(t)?t(n[0]):void 0)},I=function(e){return n.get("/timeline").then(function(e){return w(e.data)},function(t){o.error("Error on resolve "+e,t)})},x=function(){n.subscribe("timeline",function(e){switch(o.debug(e),e.verb){case"updated":$rootScope.authenticated&&$rootScope.pop("success","Ein Ereignis wurde aktualisiert",e.data.title),findEvent(e.id,function(t,n,r,i){return t?(o.debug(t),t):(n=e.data,void $scope.refresh())});break;case"created":$rootScope.authenticated&&$rootScope.pop("success","Ein Ereignis wurde erstellt",e.data.title),$scope.events.before.push(e.data),$scope.refresh();break;case"removedFrom":$rootScope.authenticated&&$rootScope.pop("success","Ein Ereignis wurde entfernt",e.data.title),findEvent(e.id,function(e,t,n,r){return e?(o.debug(e),e):void EventService.removeFromClient($scope.events,t,n)});break;case"destroyed":$rootScope.authenticated&&$rootScope.pop("success","Ein Ereignis wurde gelöscht",e.data.title),findEvent(e.id,function(e,t,n,r){return e?(o.debug(e),e):void EventService.removeFromClient($scope.events,t,n)});break;case"addedTo":$rootScope.authenticated&&$rootScope.pop("success","Ein Ereignis wurde hinzugefügt",e.data.title)}})};return{subscribe:x,split:b,merge:y,append:k,transform:w,saveOne:A,saveAllInBlock:E,saveBlocks:U,edit:h,createEdit:B,fixEach:j,resolve:I,setModals:f,refresh:C,openTypeChooserModal:g,chooseType:p,removeFromClient:S,remove:$}}]),angular.module("jumplink.cms.fallback",[]).service("FallbackService",["$window","$location","$log",function(e,t,n){var r=function(e){var r=t.protocol(),o=t.host();angular.isString(e)?"/"!==e.charAt(0)&&(e="/"+e):e="/fallback";var i=r+"://"+o+e+"?force=fallback";n.debug("Go to fallback url: "+i)};return{go:r}}]),angular.module("ngFocus",[]).factory("focus",["$timeout","$window",function(e,t){return function(n){e(function(){var e=t.document.getElementById(n);e&&e.focus()})}}]).directive("eventFocus",["focus",function(e){return function(t,n,r){n.on(r.eventFocus,function(){e(r.eventFocusId)}),t.$on("$destroy",function(){n.off(r.eventFocus)})}}]),angular.module("jumplink.cms.gallery",["mgcrea.ngStrap","ngAsync","angular-medium-editor","FBAngular","sails.io","angularFileUpload","jumplink.cms.sortable","jumplink.cms.content"]).service("GalleryService",["$rootScope","$sailsSocket","$async","$filter","Fullscreen","SortableService","ContentService","FileUploader","$modal","$log",function(e,t,n,r,o,i,a,s,u,l){var c=null;uploadModal=null,fullscreenImage=null;var d=[{text:'<i class="fa fa-eye"></i>&nbsp;Anzeigen',click:"goToImage(image)"},{text:'<i class="fa fa-edit"></i>&nbsp;Bearbeiten',click:"editImage(image)"},{text:'<i class="fa fa-trash"></i>&nbsp;Löschen',click:"$dropdown.hide();$dropdown.destroy();removeImage(image);"},{text:'<i class="fa fa-floppy-o"></i>&nbsp;Speichern',click:"saveImage(image)"}],p=function(){return d},g=function(e){return c=u({scope:e,title:"Bild bearbeiten",templateUrl:"/views/modern/gallery/editmodal.jade",show:!1}),f()},f=function(){return c},m=function(t,n,r){return t.$scope.imageBlocks=n,t.$scope.selects=h(n,r),t.$scope.selects.length>0&&(e.selectedContentBlock=t.$scope.selects[0].value),e.$watch("selectedContentBlock",function(e,t){l.debug("selected changed to",e)}),t},v=function(t,n,r,o,i,a){angular.isUndefined(o)&&(o={thumbnail:{width:300},rescrop:{width:1200,cropwidth:1200,cropheight:1200}});var c={url:"gallery/upload",removeAfterUpload:!0,headers:{options:JSON.stringify(o)}};return t.uploader=new s(c),t.uploader.filters.push({name:"imageFilter",fn:function(e,t){var n="|"+e.type.slice(e.type.lastIndexOf("/")+1)+"|";return-1!=="|jpg|png|jpeg|bmp|gif|".indexOf(n)}}),angular.isFunction(a)&&(t.uploader.onComplete=a),t.uploader.onCompleteItem=function(t,n,r,o){l.debug("[GalleryService.uploader.onCompleteItem]",t,n,r,o),n.files.forEach(function(t,n,r){var o=e.selectedContentBlock,i=uploadModal.$scope.imageBlocks,a=i[o];l.debug("[GalleryService.$scope.uploader.onCompleteItem] selected",o,"imageBlocks",i,"currentImages",a);var s=0;a.length>0&&(s=a[a.length-1].position),e.authenticated&&e.pop("success","Ein Bild wurde hochgeladen",t.original.name),"undefined"==typeof t.position&&(s++,t.position=s,t.content=o),l.debug("[GalleryService.$scope.uploader.onCompleteItem] file",t),a.push(t)})},t.upload=function(e,t){e.image=t,e.upload()},uploadModal=u({scope:t,title:"Bilder hinzufügen",uploader:t.uploader,templateUrl:"/views/modern/gallery/uploadimagesmodal.jade",show:!1}),uploadModal=m(uploadModal,n,r),angular.isFunction(i)?i(b()):b()},h=function(e,t){var n=Object.keys(e),r=[];return n.forEach(function(e,n,o){var i=a.getByName(t,e).title||e;r.push({label:i,value:e})}),r},b=function(){return uploadModal},S=function(e,t,n,r){return e.page&&""!==e.page||(e.page=t),e.content&&""!==e.content||(e.content=n),angular.isFunction(r)?r(null,e):e},$=function(e,n,r,o){e=S(e,n,r);var i=["Bild konnte nicht gespeichert werden"];t.put("/gallery/"+e.id,e).success(function(e,t,n,r){angular.isArray(e)&&(e=e[0]),angular.isFunction(o)&&o(null,e)}).error(function(e,t,n,r){l.error(i[0],e),angular.isFunction(o)&&o(i[0],e)})},w=function(e,t,r){var o=Object.keys(e);
n.map(o,function(n,r){y(e[n],t,n,r)},r)},y=function(e,t,r,o){n.map(e,function(e,n){$(e,t,r,n)},o)},k=function(e,n,r,o,a){("undefined"==typeof n||null===n)&&(n=e.indexOf(r)),e=i.remove(e,n,r),r.id?t["delete"]("/gallery/"+r.id+"?filename="+r.original.name+"&page="+o,{id:r.id,filename:r.original.name,page:o}).success(function(t,n,r,o){angular.isFunction(a)&&a(null,e)}).error(function(e,t,n,r){l.error(errors[0],e),angular.isFunction(a)&&a(e)}):angular.isFunction(a)&&a(null,e)},F=function(e,t,n){uploadModal.$promise.then(uploadModal.show),uploadModal=m(uploadModal,e,t),uploadModal.$scope.$on("modal.hide",function(){l.debug("upload modal closed"),angular.isFunction(n)&&n(null)})},B=function(e,t,n){return e[t.name]=[],angular.isFunction(n)?n(null,e[t.name]):e[t.name]},O=function(e,t){l.debug("edit",e),c.$scope.image=e,c.$promise.then(c.show),c.$scope.$on("modal.hide",function(){l.debug("edit closed"),angular.isFunction(t)&&t(null,c.$scope.image)})},j=function(t,n){var r,o,i,a,s=0,u=0;return $scope.isFullScreen(t)?(i=t.original.width/t.original.height,a=e.getWindowDimensions(),a.width/a.height<i?(n=a.width,o=t.original.width/n,r=t.original.height/o,s=(a.height-r)/2,r=a.height):(r=a.height,o=t.original.height/r,n=t.original.width/o,u=(a.width-n)/2,n=a.width),{width:n+"px",height:r+"px","padding-right":u+"px","padding-left":u+"px","padding-top":s+"px","padding-bottom":s+"px"}):(o=t.original.width/n,r=t.original.height/o,{width:n+"px",height:r+"px"})},C=function(){t.subscribe("gallery",function(t){switch(l.debug(t),t.verb){case"updated":e.authenticated&&l.debug("success","Ein Bild wurde aktualisiert",t.data.original.name);break;case"created":e.authenticated&&e.pop("success","Ein Bild wurde hochgeladen",t.data.original.name),$scope.images.push(t.data);break;case"removedFrom":e.authenticated&&e.pop("success","Ein Bild wurde entfernt",""),l.debug(t.data);break;case"destroyed":l.debug(t.data);break;case"addedTo":e.authenticated&&e.pop("success","Ein Bild wurde hinzugefügt",""),l.debug(t.data)}})},A=function(e,n){var o="/gallery?limit=0&page="+e;return n&&(o=o+"&content="+n),t.get(o).then(function(e){return r("orderBy")(e.data,"position")},function(e){l.error(e)})};return{getDropdown:p,setEditModal:g,getEditModal:f,setUploadModal:v,getUploadModal:b,saveOne:$,saveAll:y,saveAllBlocks:w,remove:k,add:F,addBlock:B,edit:O,aspect:j,subscribe:C,resolve:A}}]),"undefined"==typeof jumplink)var jumplink={};angular.module("jumplink.cms.history",["ui.router"]).service("HistoryService",["$window","$location","$state","$anchorScroll","$timeout","$log",function(e,t,n,r,o,i){var a=[],s=function(e,t){a.push({state:e,params:t})},u=function(){return a},l=function(e){if(i.debug("[jumplink.cms.history.HistoryService], history.length",a.length,"step",e,"history.length + step =",a.length+e),a.length+e<=0)return t.path("/");var r=this.previous(e||-1);return n.go(r.state,r.params)},c=function(e){return a[a.length-Math.abs(e||1)]},d=function(){return this.go(-1)},p=function(e){t.hash(e),r.yOffset=60,r()},g=function(){var e=t.hash();e?o(function(){p(e)},1e3):r()};return{push:s,all:u,go:l,previous:c,back:d,goToHashPosition:p,autoScroll:g}}]).run(["HistoryService","$state","$rootScope",function(e,t,n){n.$on("$stateChangeSuccess",function(t,n,r,o,i){o["abstract"]||e.push(o,i)}),console.log(e),e.push(t.current,t.params)}]),angular.module("jumplink.cms.bootstrap.importexport",["jumplink.cms.importexport","jumplink.cms.bootstrap.uploader","mgcrea.ngStrap","ngFocus"]).service("ImportExportBootstrapService",["$log","focus","$modal","FileUploader",function(e,t,n,r){var o=null,i=function(t,r,i,a,u,l){return o=n({title:"JSON importieren",templateUrl:"/views/modern/uploadmodal.bootstrap.jade",show:!1}),o.$scope.fileOptions=r,o.$scope.imports=[],o.$scope.ok=!1,o.$scope["import"]=function(t){o.$scope.ok=!0,angular.isFunction(a)?a(o.$scope.imports,function(e,n){angular.isFunction(l)&&l(e,n),o.$scope.imports=[],t()}):(e.warn("[ImportExportBootstrapService.abort] onImportStart is not defined!"),o.$scope.imports=[],t())},o.$scope.abort=function(t){o.$scope.ok=!1,o.$scope.imports=[],angular.isFunction(u)?u(o.$scope.imports,function(e){t()}):(e.warn("[ImportExportBootstrapService.abort] onAbort is not defined!"),t())},angular.isUndefined(o.$scope.fileOptions)&&(o.$scope.fileOptions={}),o.$scope.uploadOptions={url:"importexport/upload",removeAfterUpload:!0,alias:"import",headers:{options:JSON.stringify(o.$scope.fileOptions)}},o.$scope.onCompleteItem=function(t,n){e.debug("[ImportExportBootstrapService.onCompleteItem]"),angular.isFunction(i)&&i(t,n)},o.$scope.onCompleteAll=function(t,n){e.debug("[ImportExportBootstrapService.onCompleteAll]")},o.$scope.upload=function(e){e.upload()},o.$scope.$on("modal.hide.before",function(t,n){e.debug("edit closed",n.$scope,n),n.$scope.ok?n.$scope.callback(null,n.$scope):n.$scope.callback&&n.$scope.callback("discarded",n.$scope)}),s()},a=function(){return o},s=function(){return{uploadModal:a()}},u=function(n){e.debug("[BlogService.show]"),o.$scope.callback=n,o.$scope.ok=!1,t("blogposttitle"),o.$promise.then(o.show)},l=function(e,t){o.$scope.imports=o.$scope.imports.concat(e);for(var n=o.$scope.imports.length-1;n>=0;n--)o.$scope.imports[n].importOptions={doImport:!0,identifier:o.$scope.imports[n][t.identifierKey],description:o.$scope.imports[n][t.descriptionKey]}};return{show:u,setModals:i,setImports:l}}]),angular.module("jumplink.cms.importexport",["jumplink.cms.attachment","ngAsync","sails.io"]).service("ImportExportService",["$sailsSocket","$async","$log","$filter",function(e,t,n,r){return{}}]),angular.module("jumplink.cms.info",["sails.io"]).service("CmsService",["$log","$sailsSocket",function(e,t){var n=function(n,r){var o=["[CmsService] Error: On trying to get cms info, url: "+n,"[CmsService] Error: Result is null, url: "+n],i=["[CmsService] Warn: Request has more than one results, url: "+n];return t.get(n).then(function(t){return angular.isUndefined(t)||angular.isUndefined(t.data)?angular.isFunction(r)?r(o[1]):null:(t.data instanceof Array&&(t.data=t.data[0],e.warn(i[0])),angular.isFunction(r)?r(null,t.data):t.data)},function(t){return e.error(o[0],t),angular.isFunction(r)?r(o[0],t):t})},r=function(e){return n("/cms/infouser",e)},o=function(e){return n("/cms/infoadmin",e)},i=function(n){return t.post("/cms/restart").then(function(t){return e.debug("[CmsService.restart]",t),n(null,t)},function(t){return e.error("[CmsService.restart]",t),n(t)})};return{infoUser:r,infoAdmin:o,restart:i}}]),angular.module("jumplink.cms.multisite",["sails.io","jumplink.cms.sails"]).service("MultisiteService",["$rootScope","JLSailsService","$log",function(e,t,n){var r=function(e,n){var r={method:"get",resultIsArray:!0};return t.resolve("/multisite/find",e,r,n)},o=function(e,n){var r={method:"get",resultIsArray:!0};return t.resolve("/multisite/findnames",e,r,n)},i=function(e,n){var r={method:"get",resultIsArray:!0};return t.resolve("/multisite/findhosts",e,r,n)};return{resolve:r,resolveNames:o,resolveHosts:i}}]),angular.module("jumplink.cms.bootstrap.routes",["jumplink.cms.routes","jumplink.cms.bootstrap.importexport"]).service("RoutesBootstrapService",["$log","$async","ImportExportBootstrapService","UtilityService","RoutesService","SortableService",function(e,t,n,r,o,i){var a=null,s=null,u=function(e){s=e},l=function(r,u){var l={},c=function(t,r){e.debug("[RoutesBootstrapService.onCompleteFile]",r);for(var o=[],i=0;i<r.length;i++)o=o.concat(r[i].data);n.setImports(o,{identifierKey:"objectName",descriptionKey:"title"})},d=function(n,r){e.debug("[RoutesBootstrapService.onImportStart]",s),t.map(n,function(e,t){e.importOptions.doImport===!0?o.updateOrCreateByHostByObjectNameAndNavbar(s,e,t):t()},function(t,n){e.debug("[RoutesBootstrapService.onImportStart] done",t,n),n=i.sort(n),r(t,n)})},p=function(t,n){e.debug("[RoutesBootstrapService.onAbort]"),n()};a=n.setModals(r,l,c,d,p,u)};return{setHost:u,setupImportModal:l,showImportModal:n.show}}]),angular.module("jumplink.cms.routes",["ui.router","jumplink.cms.sails","jumplink.cms.sortable","jumplink.cms.utilities","ngDownload"]).provider("jlRoutes",["$stateProvider","$urlRouterProvider","$locationProvider",function jlRoutesProvider($stateProvider,$urlRouterProvider,$locationProvider){this.html5Mode=$locationProvider.html5Mode,this.otherwise=$urlRouterProvider.otherwise,this.state=$stateProvider.state,this.when=function(e,t){$urlRouterProvider.when(e,t)},this.setLayouts=function(e){for(var t in e)this.state(t,e[t])},this.setRoutes=function(routes,routeOptions){for(var i=0;i<routes.length;i++)if(routes[i].main){var options={};if("string"==typeof routes[i].url&&routes[i].url.length>0&&(options.url=routes[i].url),routes[i].customstate===!0?(angular.isDefined(routes[i].state.resolve)&&"string"==typeof routes[i].state.resolve&&routes[i].state.resolve.length>0&&(eval(routes[i].state.resolve),options.resolve=resolve),angular.isDefined(routes[i].state.views)&&"string"==typeof routes[i].state.views&&routes[i].state.views.length>0&&(eval(routes[i].state.views),options.views=view)):angular.isDefined(routes[i].objectName)&&angular.isDefined(routeOptions[routes[i].objectName])?(angular.isObject(routeOptions[routes[i].objectName].resolve)&&(options.resolve=routeOptions[routes[i].objectName].resolve),angular.isObject(routeOptions[routes[i].objectName].views)&&(options.views=routeOptions[routes[i].objectName].views)):console.error("objectName "+routes[i].objectName+" not found for route "+routes[i]),angular.isDefined(options.url)&&angular.isDefined(options.views)&&$stateProvider.state(routes[i].state.name,options),angular.isArray(routes[i].alternativeUrls))for(var a=0;a<routes[i].alternativeUrls.length;a++)console.log("New redirect: "+routes[i].alternativeUrls[a]+" -> "+routes[i].url),$urlRouterProvider.when(routes[i].alternativeUrls[a],routes[i].url)}},this.$get=function(){return new jlRoutes}}]).filter("showOnlyMainRoutes",function(){return function(e,t){if(t!==!0)return e;for(var n=[],r=0;r<e.length;r++)e[r].main===!0&&n.push(e[r]);return n}}).service("RoutesService",["$rootScope","$download","JLSailsService","$log","SortableService","UtilityService",function(e,t,n,r,o,i){var a=function(e){return r.debug("[RoutesService.create] data",e),angular.isObject(e)||(e={}),angular.isString(e.match)||(e.match=""),angular.isString(e.title)||(e.title=""),e.main!==!0&&e.main!==!1&&(e.main=!1),angular.isString(e.url)||(e.url=""),angular.isArray(e.alternativeUrls)||(e.alternativeUrls=[]),(angular.isUndefined(e.state)||!angular.isObject(e.state))&&(e.state={}),angular.isString(e.state.name)||(e.state.name=""),e.state.customstate!==!0&&e.state.customstate!==!1&&(e.state.customstate=!1),angular.isString(e.state.url)||(e.state.url=""),angular.isString(e.state.views)||(e.state.views=""),angular.isString(e.state.resolve)||(e.state.resolve=""),angular.isObject(e.fallback)||(e.fallback={}),angular.isString(e.fallback.url)||(e.fallback.url=""),e},s=function(e,t,n){r.debug("[RoutesService] data before",t),t=a(t),r.debug("[RoutesService] data after",t),o.append(e,t,n)},u=function(e,t,n,r){return o.swap(contents,t,n,r)},l=function(e,t,n){return o.moveForward(e,t,n)},c=function(e,t,n){return o.moveBackward(e,t,n)},d=function(e,t,n,r){return angular.isFunction(r)?o.remove(e,t,n,r):o.remove(e,t,n)},p=function(e,t,o,i){if((angular.isUndefined(o)||null===o)&&angular.isDefined(t)&&(o=e[t]),(angular.isUndefined(t)||null===t)&&(t=e.indexOf(o)),e=d(e,t,o),o.id){r.debug("[RoutesService.remove] remove from server, too",o);var a={method:"delete",resultIsArray:!1};return n.resolve("/routes/destroy/"+o.id,{id:o.id},a,i)}},g=function(e,t){var r={method:"post",resultIsArray:!0};return n.resolve("/routes/find",e,r,t)},f=function(e,t){var r={method:"post",resultIsArray:!1};return n.resolve("/routes/findOne",e,r,t)},m=function(e,t){var r={method:"post",resultIsArray:!0};return n.resolve("/Routes/findByHost",e,r,t)},v=function(e,o,i){var a={method:"post",resultIsArray:!0};return n.resolve("/Routes/exportByHost",{host:e},a,function(e,n){return r.debug("[RoutesService.exportByHost]",e,n),e?(o&&t(JSON.stringify(n),"error.txt","text/plain"),i(e)):(o&&t(JSON.stringify(n),"routes.json","text/json"),i(e,n))})},h=function(e,t){r.debug("[RoutesService.updateOrCreate]",e);var o={method:"post",resultIsArray:!1};return n.resolve("/Routes/updateOrCreate",{route:e},o,t)},b=function(e,t,o){r.debug("[RoutesService.updateOrCreateByHostByObjectNameAndNavbar]",e,t);var i={method:"post",resultIsArray:!1};return n.resolve("/Routes/updateOrCreateByHostByObjectNameAndNavbar",{host:e,route:t},i,o)},S=function(e,t,o){r.debug("[RoutesService.updateOrCreateByHost]",e,t);var i={method:"post",resultIsArray:!1};return n.resolve("/Routes/updateOrCreateByHost",{host:e,route:t},i,o)},$=function(e,t){r.debug("[RoutesService.updateOrCreateEach]",e);var o={method:"post",resultIsArray:!0};return n.resolve("/Routes/updateOrCreateEach",{routes:e},o,t)},w=function(e,t,o){r.debug("[RoutesService.updateOrCreateEachByHost]",e,t);var i={method:"post",resultIsArray:!0};return n.resolve("/Routes/updateOrCreateEachByHost",{host:e,routes:t},i,o)},y=function(e){r.debug("[RoutesController.generateObjectnameFromStatename]",e);for(var t="",n=e.split("."),o=0;o<n.length;o++)t+=i.capitalizeFirstLetter(n[o]);return t=i.lowercaseFirstLetter(t)},k=function(e){for(var t="",n=e.split("/"),o=0;o<n.length;o++)t+=i.capitalizeFirstLetter(n[o]);return t=i.lowercaseFirstLetter(t),r.debug("[RoutesController.generateObjectnameFromUrl]",e,n,t,t.length),t};return{create:a,append:s,swap:u,moveForward:l,moveBackward:c,removeFromClient:d,remove:p,destroy:p,find:g,findOne:f,findByHost:m,exportByHost:v,updateOrCreate:h,updateOrCreateByHostByObjectNameAndNavbar:b,updateOrCreateByHost:S,updateOrCreateEach:$,updateOrCreateEachByHost:w,saveEachByHost:w,generateObjectnameFromStatename:y,generateObjectnameFromUrl:k}}]),angular.module("jumplink.cms.sails",["sails.io"]).service("JLSailsService",["$rootScope","$sailsSocket","$q","$log",function(e,t,n,r){var o=function(e,o,i,a,s){var u=n.defer(),l=["On trying to resolve "+e,"Request has more than one results","No result"];return angular.isUndefined(i)&&(i={}),angular.isUndefined(i.method)&&(i.method="get"),angular.isUndefined(i.resultIsArray)&&(i.resultIsArray=!1),angular.isUndefined(o)&&(o={}),t[i.method](e,o).then(function(e){return angular.isUndefined(e)||angular.isUndefined(e.data)?angular.isFunction(a)?a(null,null):u.resolve(null):(!i.resultIsArray&&angular.isArray(e.data)&&(e.data=e.data[0],r.warn(l[1])),s&&(e.data=s(e.data)),angular.isFunction(a)&&a(null,e.data),u.resolve(e.data))},function(e){return r.error(l[0],e),angular.isFunction(a)?a(l[0],e):u.reject(l[0])}),u.promise};return{resolve:o}}]),angular.module("jumplink.cms.session",["sails.io","jumplink.cms.sails"]).service("SessionService",["$rootScope","JLSailsService","$sailsSocket","$q","$log",function(e,t,n,r,o){var i=function(e,n){o.debug("[SessionService.create]",e);var r={method:"post",resultIsArray:!1};return t.resolve("/session/create",e,r,n)},a=function(e,n){o.debug("[SessionService.destroy]",e);var r={method:"post",resultIsArray:!1};return t.resolve("/session/destroy",e,r,n)},s=function(e){o.log("[SessionService.isauthenticated]");r.defer();return n.get("/session/authenticated").then(function(t){return angular.isFunction(e)?e(null,t.data):t.data})},u=function(){o.log("[SessionService.needToBeAuthenticated] authenticated");var e=r.defer();return n.get("/session/authenticated").then(function(t){return t.data?(o.log("is authenticated",t),e.resolve(t.data)):(o.log("is not authenticated",t),e.reject("You need to be logged in"))}),e.promise},l=function(e){o.log("[SessionService.bloggerOrBetter]");r.defer();return n.get("/session/bloggerOrBetter").then(function(t){return angular.isFunction(e)?e(null,t.data):t.data})},c=function(e){o.log("[SessionService.developerOrBetter]");r.defer();return n.get("/session/developerOrBetter").then(function(t){return angular.isFunction(e)?e(null,t.data):t.data})},d=function(e){o.log("[SessionService.siteadminOrBetter]");r.defer();return n.get("/session/siteadminOrBetter").then(function(t){return angular.isFunction(e)?e(null,t.data):t.data})},p=function(e){o.log("[SessionService.superadmin]");r.defer();return n.get("/session/superadmin").then(function(t){return angular.isFunction(e)?e(null,t.data):t.data})},g=function(e){o.log("[SessionService.employee]");r.defer();return n.get("/session/employee").then(function(t){return angular.isFunction(e)?e(null,t.data):t.data})},f=function(e){o.log("[SessionService.employee]");r.defer();return n.get("/session/employeeOrBetter").then(function(t){return angular.isFunction(e)?e(null,t.data):t.data})},m=function(e){o.log("[SessionService.authenticated] authenticated");var t=r.defer();return n.get("/session/employeeOrBetter").then(function(e){return e.data?(o.log("is employeeOrBetter",e),t.resolve(e.data)):(o.log("is not employeeOrBetter",e),t.reject("You must be an employee or a user with more credentials to do that"))}),t.promise},v=function(e){o.log("[SessionService.authenticated] authenticated");var t=r.defer();return n.get("/session/siteadminOrBetter").then(function(e){return e.data?(o.log("is siteadminOrBetter",e),t.resolve(e.data)):(o.log("is not employeeOrBetter",e),t.reject("You must be an admin or a user with more credentials to do that"))}),t.promise},h=function(e){o.log("[SessionService.getAllPolicies]");r.defer();return n.get("/session/getAllPolicies").then(function(t){return angular.isFunction(e)?e(null,t.data):t.data})},b=function(e){o.log("[SessionService.getUser]");r.defer();return n.get("/session/getUser").then(function(t){return angular.isFunction(e)?e(null,t.data):t.data})};return{create:i,destroy:a,authenticated:u,needToBeAuthenticated:u,isAuthenticated:s,bloggerOrBetter:l,developerOrBetter:c,siteadminOrBetter:d,superadmin:p,employee:g,employeeOrBetter:f,needToBeEmployeeOrBetter:m,needToBeSiteadminOrBetter:v,getAllPolicies:h,getUser:b}}]),angular.module("jumplink.cms.sidebar",["mgcrea.ngStrap.aside"]).directive("jlSidebar",["$compile","$window",function(e,t){return{restrict:"E",replace:!0,transclude:!0,templateUrl:"/views/modern/sidebar.jade",scope:{routes:"=",title:"="},link:function(e,t,n){}}}]),angular.module("jumplink.cms.bootstrap.signin",["mgcrea.ngStrap","jumplink.cms.signin"]).service("SigninBootstrapService",["$rootScope","SigninService","$log","$modal",function(e,t,n,r){var o=function(e,o,i,a,s){n.debug("[SigninBootstrapService.siginWithModal]",e,o,i),angular.isFunction(o)&&!angular.isFunction(s)&&(s=o,o=!1),angular.isFunction(i)&&!angular.isFunction(s)&&(s=i,i=!1),angular.isFunction(a)&&!angular.isFunction(s)&&(s=a,a=null);var u=r({title:e,templateUrl:"/views/modern/signin.bootstrap.modal.jade",show:!1});u.$scope.aborted=!1,u.$scope.result=null,u.$scope.user={email:"",password:""},u.$scope.abort=function(e){u.$scope.aborted=!0},u.$scope.signin=function(e){n.debug("[SigninBootstrapService.siginWithModal.signin]",e),t.signin(e,o,i,a,function(e,t){return e?(u.$scope.error=e,u.$scope.error):(u.$scope.result=t,void n.debug(t))})},u.$scope.$on("modal.hide",function(){n.debug("signin modal closed"),angular.isFunction(s)&&s(u.$scope.error,u.$scope.result,u.$scope.user)}),u.$promise.then(u.show)};return{siginWithModal:o}}]),angular.module("jumplink.cms.signin",["jumplink.cms.session","jumplink.cms.history","ngAsync"]).service("SigninService",["SessionService","$log","HistoryService","$async",function(e,t,n,r){var o=function(r,o,i,a,s){angular.isFunction(o)&&!angular.isFunction(s)&&(s=o,o=!1),angular.isFunction(i)&&!angular.isFunction(s)&&(s=i,i=!1),angular.isFunction(a)&&!angular.isFunction(s)&&(s=a,a=null),t.debug("[SigninService.signin]",r),e.create(r,function(u,l){return u?s(u):l.authenticated?(i===!0&&e.getAllPolicies(function(e,r){return e?s(e):(t.debug("scope before extend",a),angular.extend(a,r),t.debug("scope after extend",a),void(o===!0&&n.back()))}),o===!0&&n.back(),t.debug("[SigninService.signin]",r),t.debug("[SigninService.signin] err result",u,l),s(null,l)):null})};return{signin:o}}]),angular.module("jumplink.cms.sortable",["jumplink.cms.utilities"]).service("SortableService",["UtilityService","$log","$filter",function(e,t,n){var r=function(e){for(var t=e.length-1;t>=0;t--)e[t].position=t+1;return e},o=function(e){return n("orderBy")(e,"position")},i=function(e,t,n,r){var o=e[t],i=e[n],a=o.position;return o.position=i.position,i.position=a,e[t]=i,e[n]=o,angular.isFunction(r)?r(null,e):e},a=function(e,n,o,i){if(t.debug("[SortableService] move"),o>=e.length)for(var a=o-e.length;a--+1;)e.push(void 0);return e.splice(o,0,e.splice(n,1)[0]),e=r(e),angular.isFunction(i)&&i(null,e),e},s=function(n,r,o,i,a){t.debug("[SortableService.append] data",r);var s,u=["Unique key '"+a+"' already exist"],l=n.length,c=1,d=-1,p=function(e,t,n,r){return t.push(e),angular.isFunction(r)?r(null,t,n):t},g=function(e,t,n,r){return angular.isFunction(r)?r(e,t,n):e};return l>=1&&(c=n[l-1].position+1),s={position:c},s=angular.extend(s,r),t.debug("[SortableService.append] new_object",s),i&&s[a]?(d=e.findKeyValue(n,a,s[a]),d>-1?g(u[0],n,d,o):p(s,n,l,o)):p(s,n,l,o)},u=function(e,n,r,o,i,a){var u=["[SortableService] Error: Function parameters not correctly set"],l=function(){return t.error(u[0],e,n,r,o),i(u[0])};null===e?e=r[n]:null===n?n=r.indexOf(e):l(),angular.isArray(r)&&angular.isArray(o)||l(),s(o,e,function(t,o,a){return t?i(t):void d(r,n,e,function(e,t){return e?i(e):i(null,{index_from:n,array_from:t,index_to:a,array_to:o})})},!1)},l=function(e,t,n){return e+1<t.length?i(t,e,e+1,n):angular.isFunction(n)?n("Can't move forward, index is the last element.",t):t},c=function(e,t,n){return e-1>=0?i(t,e,e-1,n):angular.isFunction(n)?n("Can't move backward, index is the first element.",t):t},d=function(e,t,n,r){return("undefined"==typeof t||null===t)&&(t=e.indexOf(n)),t>-1&&e.splice(t,1),angular.isFunction(r)?r(null,e):e},p=function(e,n,r,o,i,s){s||(s=a);var u=e.indexOf(r),l=e[n];return t.debug("[SortableService] dropMove, dragObject:",r,"dragObjectIndex",u,"dropObject",l,"dropObjectIndex",n),s(e,u,n,i)};return{resetPosition:r,sort:o,swap:i,moveObjectToAnotherArray:u,move:a,moveForward:l,moveBackward:c,remove:d,append:s,dropMove:p}}]),angular.module("jumplink.cms.subnavigation",["mgcrea.ngStrap","sails.io","jumplink.cms.sortable","ngFocus","jumplink.cms.utilities"]).service("SubnavigationService",["$rootScope","$window","$log","$sailsSocket","$filter","$modal","SortableService","UtilityService","focus",function(e,t,n,r,o,i,a,s,u){var l=null,c=function(e){return l=i({scope:e,title:"Navigation bearbeiten",templateUrl:"/views/modern/editsubnavigationmodal.jade",show:!1}),d()},d=function(){return l},p=function(){r.subscribe("navigation",function(t){switch(n.debug("[SubnavigationService] Navigation event!",t),t.verb){case"updated":e.authenticated&&e.pop("success","Navigation wurde aktualisiert",t.id)}})},g=function(){angular.element(t).imagesLoaded(function(){angular.element(t).triggerHandler("resize")})},f=function(e){return e&&e.target||(e.target=""),e&&e.name||(e.name=""),e&&e.page||cb("Page not set."),e},m=function(e,t,n){t=f(t),a.append(e,t,n)},v=function(e,t,n,r){return a.swap(contents,t,n,r)},h=function(e,t,n){return a.moveForward(e,t,n)},b=function(e,t,n){return a.moveBackward(e,t,n)},S=function(e,t){if(l.$scope.navs=e,l.$promise.then(l.show),angular.isDefined(l.$scope.navs)&&l.$scope.navs.length>0){var n=Number(l.$scope.navs.length-1);u("subnavigationeditname"+n)}l.$scope.$on("modal.hide",function(){t(null,l.$scope.navs)})},$=function(e,t,n,r){return angular.isFunction(r)?a.remove(e,t,n,r):a.remove(e,t,n)},w=function(e,t,o,i,a){(angular.isUndefined(o)||null===o)&&angular.isDefined(t)&&(o=e[t]),(angular.isUndefined(t)||null===t)&&(t=e.indexOf(o)),e=$(e,t,o),o.id&&(n.debug("[SubnavigationService] remove from server, too",o),r["delete"]("/navigation/"+o.id+"?page="+i,{id:o.id,page:i}).success(function(t,n,r,o){return angular.isFunction(a)?a(null,e):void 0}).error(function(e,t,r,o){return n.error(errors[0],e),angular.isFunction(a)?a(e):void 0}))},y=function(e,t,r,o){n.debug("[SubnavigationService] remove subnavigation by target "+t);var i=s.findKeyValue(e,"target",t);i>-1?(n.debug("[SubnavigationService] subnavigation found "+i),w(e,i,null,r,o)):angular.isFunction(o)&&o("Subnavigation not found")},k=function(e,t,r,o){return angular.isDefined(t.name)&&angular.isString(t.name)&&""!==t.name?e.push(t):n.warn("Name not set, remove Subnavigation"),angular.isFunction(o)?o(null,e):e},F=function(e,t){for(var n=[],r=e.length-1;r>=0;r--)n=k(n,e[r],r);return angular.isFunction(t)?t(null,n):n},B=function(t,n,i){F(t,function(t,a){r.put("/navigation/replaceall",{navs:a,page:n}).success(function(t,n,r,s){if(null!==t&&"undefined"!=typeof t)a=o("orderBy")(t,"position"),angular.isFunction(i)&&i(null,a);else{var u="Navigation konnte nicht gespeichert werden";e.pop("error",u,""),angular.isFunction(i)&&i(u,a)}})})},O=function(e){return r.get("/navigation?page="+e,{page:e}).then(function(t){return angular.isUndefined(t)||angular.isUndefined(t.data)?(n.warn("Warn: On trying to resolve "+e+" navs!","Not found, navigation is empty!"),null):(t.data=o("orderBy")(t.data,"position"),n.debug("[SubnavigationService]",t),t.data)},function(t){n.error("[SubnavigationService] Error: On trying to resolve "+e+" navs!",t)})};return{resizeOnImagesLoaded:g,subscribe:p,setEditModal:c,getEditModal:d,create:f,append:m,add:m,swap:v,moveForward:h,moveBackward:b,edit:S,removeFromClient:$,remove:w,removeByTarget:y,save:B,resolve:O}}]).directive("jlSubnavigation",["$compile","$window","SubnavigationService","HistoryService",function(e,t,n,r){return{restrict:"E",templateUrl:"/views/modern/subnavigation.bootstrap.jade",scope:{authenticated:"=",navs:"=",afterSave:"=?",afterRemove:"=?",afterEdit:"=?",afterAdd:"=?",logger:"=",page:"=?"},link:function(e,t,n){},controller:["$rootScope","$scope","ContentService","$log","$state",function(e,t,o,i,a){n.setEditModal(t),t.goTo=r.goToHashPosition,n.subscribe(),angular.isUndefined(t.page)&&(t.page=a.current.name),angular.isUndefined(t.afterSave)&&(t.afterSave=function(e,n){return e?t.logger("error","Navigation wurde nicht gespeichert!",e):void t.logger("success","Navigation gespeichert!",n.title)}),angular.isUndefined(t.afterRemove)&&(t.afterRemove=function(e,n){return e?t.logger("error","Navigation wurde nicht entfernt!",e):void t.logger("success","Navigation entfernt!",n.title)}),angular.isUndefined(t.afterEdit)&&(t.afterEdit=function(e,n){return e?t.logger("error","Navigation wurde nicht bearbeitet!",e):void t.logger("success","Navigation bearbeitet!",n.title)}),angular.isUndefined(t.afterAdd)&&(t.afterAdd=function(e,n){return e?t.logger("error","Navigation wurde nicht hinzugefügt!",e):void t.logger("success","Navigation hinzugefügt!",n.title)}),t.add=function(){return t.authenticated?void n.add(t.navs,{page:page},t.afterAdd):!1},t.addNav=t.add,t.moveForward=function(e,n){SortableService.moveForward(e,t.navs,function(e,n){return e?(i.error("Error: On move subnavigation forward!",e),e):void(t.navs=n)})},t.moveForwardNav=t.moveForward,t.moveBackward=function(e,n){SortableService.moveBackward(e,t.navs,function(e,n){return e?(i.error("Error: On move content backward!",e),e):void(t.navs=n)})},t.moveBackwardNav=t.moveBackward,t.edit=function(e){return t.authenticated?void n.edit(e,t.afterEdit):!1},t.editNavs=t.edit,t.remove=function(e,r){return t.authenticated?void n.remove(t.navs,e,r,page,t.afterRemove):!1},t.removeNav=remove,t.save=function(){n.save(t.navs,page,t.afterSave)},t.onDragOnComplete=function(e,t,n){null===t&&i.debug("*click*",e),i.debug("onDragOnComplete, nav:",t,"index",e)},t.onDragOnNavComplete=t.onDragOnComplete,t.onDropOnComplete=function(e,n,r){SortableService.dropMove(t.navs,e,n,r,function(e,n){t.navs=n})},t.onDropOnNavComplete=t.onDropOnComplete,t.onDropOnAreaComplete=function(e,n){t.navs.indexOf(e)}}]}}]),angular.module("jumplink.cms.theme",["sails.io","ngAsync","jumplink.cms.sails"]).service("ThemeService",["$rootScope","$sailsSocket","$log","$async","JLSailsService",function(e,t,n,r,o){var i=!1,a=function(e,t){n.debug("[ThemeService.find]",e);var r={method:"get",resultIsArray:!0};return o.resolve("/theme/find",e,r,t)},s=function(e,t){var n={method:"post",resultIsArray:!0};return o.resolve("/theme/findbyhost",{host:e},n,t)},u=function(e,t){l(e,function(e,n){angular.isDefined(t)&&t(e,n)})},l=function(e,t){n.debug("[ThemeService.updateOrCreateEach]",e);var r={method:"post",resultIsArray:!0};return o.resolve("/Theme/updateOrCreateEach",{themes:e},r,t)},c=function(e,t,n){var r={method:"post",resultIsArray:!0};return o.resolve("/Theme/updateOrCreateEachByHost",{host:e,themes:t},r,n)},d=function(){i||(t.subscribe("theme",function(t){switch(e.authenticated&&n.debug(t),t.verb){case"updated":e.authenticated&&e.pop("success","Themeeinstellungen wurdne aktualisiert",t.data);break;case"created":e.authenticated&&e.pop("success","Themeeinstellungen wurden erstellt",t.data);break;case"removedFrom":e.authenticated&&e.pop("success","Themeeinstellungen wurden entfernt","");break;case"destroyed":e.authenticated&&e.pop("success","Themeeinstellungen wurden gelöscht","");break;case"addedTo":e.authenticated&&e.pop("success","Themeeinstellungen wurden hinzugefügt","")}}),i=!0)};return{find:a,findByHost:s,save:u,updateOrCreateEach:l,updateOrCreateEachByHost:c,subscribe:d}}]),angular.module("jumplink.cms.toolbar",["FBAngular"]).directive("jlToolbar",["$compile","$window",function(e,t){return{restrict:"E",templateUrl:"/views/modern/toolbar.jade",scope:{routes:"=",title:"=",shorttitle:"=",fluid:"=",position:"=",filter:"=",subnavigation:"=?"},link:function(e,t,n){},controller:["$scope","$log","Fullscreen",function(e,t,n){e.fullscreenIsSupported=n.isSupported(),e.isFullscreen=!1,t.debug("[jumplink.cms.toolbar.jlToolbar.controller]",e),n.$on("FBFullscreen.change",function(t,n){e.isFullscreen=n===!0}),e.toggleFullscreen=function(){n.isEnabled()?n.cancel():n.all()}}]}}]),angular.module("jumplink.cms.bootstrap.uploader",["angularFileUpload"]).directive("jlUploader",function(){return{restrict:"E",templateUrl:"/views/modern/uploader.bootstrap.jade",scope:{label:"@",labelFiles:"@",uploadOptions:"=",fileOptions:"=",onCompleteAll:"=",onCompleteItem:"="},link:function(e,t,n){},controller:["$rootScope","$scope","$log","FileUploader",function(e,t,n,r){t.files=[],angular.isUndefined(t.fileOptions)&&(t.fileOptions={}),t.uploader=new r(t.uploadOptions),n.debug("[jlUploader] uploadOptions",t.uploadOptions),n.debug("[jlUploader] uploader",t.uploader),n.debug("[jlUploader] onCompleteAll",t.onCompleteAll),n.debug("[jlUploader] onCompleteItem",t.onCompleteItem),t.uploader.onCompleteItem=function(e,r,o,i){n.debug("[jlUploader.onCompleteItem] status",o);for(var a=0;a<r.files.length;a++)n.debug("[jlUploader.onCompleteItem] response.files[i]",r.files[a]);t.files=t.files.concat(r.files),angular.isFunction(t.onCompleteItem)&&t.onCompleteItem(null,t.files)},t.uploader.onCompleteAll=function(){n.debug("[jlUploader.onCompleteAll]"),angular.isFunction(t.onCompleteAll)&&t.onCompleteAll(null,t.files)},t.upload=function(e){e.upload()},t.uploader.onProgressItem=function(e,t){n.debug("[jlUploader.onProgressItem]",e,t)}}]}}),angular.module("jumplink.cms.user",["sails.io","jumplink.cms.sails"]).service("UserService",["$rootScope","$sailsSocket","$log","JLSailsService",function(e,t,n,r){var o=!1,i=function(e,r){angular.isString(e.role)||(e.role="siteadmin"),angular.isDefined(e.id)?(n.debug("update user: sailsSocket.put('/user/"+e.id+"..'"),t.put("/user/"+e.id,e).success(function(e,t,o,i){n.debug(e,t,o,i),angular.isDefined(e)&&angular.isDefined(e.password)&&delete e.password,r(null,e,t,o,i)})):(n.debug("create user: sailsSocket.post('/user.."),t.post("/user",e).success(function(e,t,o,i){n.debug("data",e,"status",t,"headers",o,"config",i),angular.isDefined(e)&&angular.isDefined(e.password)&&delete e.password,r(null,e,t,o,i)}))},a=function(){o||(t.subscribe("user",function(t){switch(e.authenticated&&n.debug(t),t.verb){
case"updated":e.authenticated&&e.pop("success","Ein Benutzer wurde aktualisiert",t.data.name);break;case"created":e.authenticated&&e.pop("success","Ein Benutzer wurde erstellt",t.data.name);break;case"removedFrom":e.authenticated&&e.pop("success","Ein Benutzer wurde entfernt","");break;case"destroyed":e.authenticated&&e.pop("success","Ein Benutzer wurde gelöscht","");break;case"addedTo":e.authenticated&&e.pop("success","Ein Benutzer wurde hinzugefügt","")}}),o=!0)},s=function(e,t){var r=e.indexOf(t);n.debug("removeFromClient",t,r),r>-1&&e.splice(r,1)},u=function(r,o){n.debug("$scope.remove",o),e.authenticated&&(r.length<=1?n.error("Der letzte Benutzer kann nicht gelöscht werden."):(s(r,o),o.id&&t["delete"]("/user/"+o.id,{id:o.id}).success(function(e,t,r,o){n.debug("user delete request",e,t,r,o)})))},l=function(e,t){var n={method:"post",resultIsArray:!0};return r.resolve("/user/findbyhost",{host:e},n,t)},c=function(e,t,o){n.debug("[UserService.updateOrCreateByHost]",e,routes);var i={method:"post",resultIsArray:!1};return r.resolve("/user/updateOrCreateByHost",{host:e,user:t},i,o)};return{save:i,subscribe:a,remove:u,findByHost:l,updateOrCreateByHost:c}}]),angular.module("jumplink.cms.utilities",[]).service("UtilityService",["$log",function(e){var t=function(e){for(var t=[],n=e.length-1;n>=0;n--)t.push(e[n]);return t},n=function(e,t,n){for(var r=-1,o=e.length-1;o>=0&&-1>=r;o--)e[o][t]===n&&(r=o);return r},r=function(e){var t=[];if(!angular.isObject(e))return console.error("[UtilityService.getKeys] is not an Object",e),t;for(var n in e)t.push(n);return t},o=function(e){return e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()},i=function(e){return e.charAt(0).toLowerCase()+e.slice(1)};return{invertOrder:t,findKeyValue:n,getKeys:r,capitalizeFirstLetter:o,lowercaseFirstLetter:i}}]),angular.module("jumplink.cms.bootstrap.validation",["jumplink.cms.validation"]).provider("jlValidationBootstrap",["jlValidationProvider","$validationProvider",function(e,t){this.setup=function(){t.setErrorHTML(function(e){return"<span ng-show='form.name.$error.required' class='form-control-feedback'><i class='fa fa-exclamation-triangle'></i></span><label class=\"control-label has-error absolute-control-label-bottom\">"+e+"</label>"}),t.setSuccessHTML(function(e){return"<span class='form-control-feedback'><i class='fa fa-check'></i></span><label class=\"control-label has-success absolute-control-label-bottom\">"+e+"</label>"}),angular.extend(t,{validCallback:function(e){$(e).parents(".form-group:first").removeClass("has-error").addClass("has-success")},invalidCallback:function(e){$(e).parents(".form-group:first").removeClass("has-success").addClass("has-error")}})},this.getLocale=e.getLocale,this.changeLocale=e.changeLocale,this.$get=function(){return new jlValidationBootstrap}}]),angular.module("jumplink.cms.validation",["validation","validation.rule"]).provider("jlValidation",["$validationProvider",function(e){this.getLocale=function(){var t={minlength:e.getDefaultMsg("minlength"),maxlength:e.getDefaultMsg("maxlength"),required:e.getDefaultMsg("required"),email:e.getDefaultMsg("email"),number:e.getDefaultMsg("number"),url:e.getDefaultMsg("url")};return t},this.changeLocale=function(t){var n={};switch(t){case"de":n={minlength:{error:"Eingabe muss länger sein!",success:"Eingabe lang genug"},maxlength:{error:"Eingabe muss kürzer sein!",success:"Eingabe kurz genug"},required:{error:"Eine Eingabe ist erforderlich!",success:"Okay"},email:{error:"Eingabe muss einer E-Mail entsprechen!",success:"Eingabe ist eine E-Mail"},number:{error:"Eingabe darf nur Zahlen enthalten!",success:"Eingabe enthält nur Zahlen"},url:{error:"Eingabe muss einer URL entsprechen!",success:"Eingabe entspricht einer URL"}};break;case"en":}switch(t){case"de":e.setDefaultMsg(n);break;case"en":}},this.$get=function(){return new jlValidation}}]);
//# sourceMappingURL=jumplink-cms-angular.js.map
